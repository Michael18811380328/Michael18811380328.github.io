
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Michael An">
      
      
        <link rel="canonical" href="https://michael18811380328.github.io/react/%E6%A1%88%E4%BE%8B-React%20Hook%2BTS4%20%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E9%A1%B9%E7%9B%AE/">
      
      
        <link rel="prev" href="../%E6%8E%8C%E6%8F%A1%E6%8B%96%E6%8B%BD%E7%9A%84%E5%AE%9E%E7%8E%B0%EF%BC%88%E4%BD%BF%E7%94%A8ReactJS%20hooks%EF%BC%89/">
      
      
        <link rel="next" href="../%E6%A1%88%E4%BE%8B-React%20Testing%20Library%20%E5%92%8C%20Jest%20%E5%AE%8C%E6%88%90%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.42">
    
    
      
        <title>案例-React Hook+TS4 最佳实践项目 - Michale An Blog</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.0253249f.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="red" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#reacthookts-jira" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Michale An Blog" class="md-header__button md-logo" aria-label="Michale An Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Michale An Blog
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              案例-React Hook+TS4 最佳实践项目
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/Michael18811380328/Michael18811380328.github.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    Michael18811380328/Michael18811380328.github.io
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Michale An Blog" class="md-nav__button md-logo" aria-label="Michale An Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Michale An Blog
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Michael18811380328/Michael18811380328.github.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    Michael18811380328/Michael18811380328.github.io
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    index
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    new-third-part-lib
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            new-third-part-lib
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/%40excalidraw_excalidraw/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    @excalidraw_excalidraw
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/Bootstrap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bootstrap
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/JS-Bridge/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    JS-Bridge
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/JSON%20Server/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    JSON Server
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/JSzip/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    JSzip
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/Leaflet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Leaflet
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/Mocha/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mocha
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/React%20Image%20Lightbox/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    React Image Lightbox
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/React-Sweet-Progress/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    React-Sweet-Progress
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/Rxjs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Rxjs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/Storybook/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Storybook
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/ThreeJS/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ThreeJS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/UUID-js/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UUID-js
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/YesPlayMusic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    YesPlayMusic
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/ant-design-vue/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ant-design-vue
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/antd-mobile/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    antd-mobile
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/arco-design-vue/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    arco-design-vue
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/autoprefixer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    autoprefixer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/awesome-vue/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    awesome-vue
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/axios/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    axios
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/babel-cli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    babel-cli
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/babel-eslint/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    babel-eslint
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/babel-jest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    babel-jest
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/babel-loader/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    babel-loader
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/babel-plugin-named-asset-import/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    babel-plugin-named-asset-import
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/babel-preset-env/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    babel-preset-env
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/babel-preset-react-app/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    babel-preset-react-app
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/babel-preset-react/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    babel-preset-react
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/case-sensitive-paths-webpack-plugin/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    case-sensitive-paths-webpack-plugin
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/chartjs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    chartjs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/classnames/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    classnames
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/clean-webpack-plugin/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    clean-webpack-plugin
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/connect-multiparty/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    connect-multiparty
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/copy-to-clipboard/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    copy-to-clipboard
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/crypto-js/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    crypto-js
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/css-loader/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    css-loader
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/csv/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    csv
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/date-format/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    date-format
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/dayjs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    dayjs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/debug/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    debug
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/deep-copy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    deep-copy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/detect-character-encoding/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    detect-character-encoding
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/dir/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    dir
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/docxtemplater/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    docxtemplater
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/dom-helper/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    dom-helper
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/dom-helpers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    dom-helpers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/dotenv/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    dotenv
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/editor-js/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    editor-js
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/element-plus/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    element-plus
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/element-ui/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    element-ui
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/enzyme/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    enzyme
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/eslint-config-react-app/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    eslint-config-react-app
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/eslint-loader/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    eslint-loader
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/eslint-plugin-flowtype/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    eslint-plugin-flowtype
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/eslint-plugin-import/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    eslint-plugin-import
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/eslint-plugin-react/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    eslint-plugin-react
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/eslint/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    eslint
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/etcd3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    etcd3
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/excalidraw/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    excalidraw
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/exif-js/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    exif-js
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/express-rate-limit/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    express-rate-limit
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/express/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    express
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/file-loader/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    file-loader
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/file-saver/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    file-saver
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/form-data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    form-data
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/formik/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    formik
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/github-copilot-resources_copilot-metrics-viewer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    github-copilot-resources_copilot-metrics-viewer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/glamor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    glamor
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/gojs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    gojs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/html2canvas/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    html2canvas
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/http-server/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    http-server
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/i18next-browser-languagedetector/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    i18next-browser-languagedetector
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/i18next-xhr-backend/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    i18next-xhr-backend
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/i18next/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    i18next
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/iconv-lite/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    iconv-lite
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/is-hotkey/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    is-hotkey
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/isScroll/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    isScroll
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/jest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    jest
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/jison/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    jison
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/jsonwebtoken/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    jsonwebtoken
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/keymirror/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    keymirror
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/lerna/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    lerna
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/lodash-throttle/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    lodash-throttle
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/lodash/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    lodash
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/log4js/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    log4js
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/luckysheet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    luckysheet
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/mind-map/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mind-map
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/mockjs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mockjs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/moment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    moment
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/mysql/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mysql
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/number-precision/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    number-precision
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/parcel/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    parcel
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/postcss-loader/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    postcss-loader
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/postcss-normalize/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    postcss-normalize
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/postcss-preset-env/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    postcss-preset-env
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/postcss-safe-parser/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    postcss-safe-parser
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/promise/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    promise
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/puppeteer-print-pdf/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    puppeteer-print-pdf
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/pure-admin_vue-pure-admin/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pure-admin_vue-pure-admin
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/quasar/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quasar
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/raf/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    raf
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/rc-calendar/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    rc-calendar
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/react-cookies/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    react-cookies
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/react-dnd-html5-backend/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    react-dnd-html5-backend
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/react-dnd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    react-dnd
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/react-i18next/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    react-i18next
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/react-intl-universal/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    react-intl-universal
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/react-is-deprecated/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    react-is-deprecated
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/react-is/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    react-is
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/reactstrap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    reactstrap
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/redis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    redis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/request/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    request
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/reselect/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    reselect
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/resolve-url-loader/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    resolve-url-loader
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/resolve/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    resolve
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/response-time/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    response-time
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/resumablejs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    resumablejs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/ron-react-autocomplete/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ron-react-autocomplete
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/sass-loader/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    sass-loader
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/semver/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    semver
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/shallow-equal/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    shallow-equal
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/shallowequal/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    shallowequal
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/simple-statistics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    simple-statistics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/slugid/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    slugid
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/socket%20io/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    socket io
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/socket-io-client/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    socket-io-client
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/socket-io/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    socket-io
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/socket.io/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    socket.io
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/sortable/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    sortable
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/streamsaver/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    streamsaver
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/style-loader/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    style-loader
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/supertest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    supertest
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/terser-webpack-plugin/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    terser-webpack-plugin
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/thingsboard-ui-vue3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    thingsboard-ui-vue3
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/throttle-lodash/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    throttle-lodash
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/tiny-vue/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    tiny-vue
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/ts-jest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ts-jest
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/ts-pnp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ts-pnp
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/tui-image-editor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    tui-image-editor
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/uglyJS/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    uglyJS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/url-loader/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    url-loader
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/uuid/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    uuid
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/v-viewer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    v-viewer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/vee-validate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    vee-validate
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/video-js/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    video-js
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/viewerjs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    viewerjs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/vite/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    vite
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/vue-draggable-resizable/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    vue-draggable-resizable
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/vue-ruoyi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    vue-ruoyi
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/vue-virtual-scroller/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    vue-virtual-scroller
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/vuecli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    vuecli
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/vuepress/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    vuepress
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/vuetify/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    vuetify
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/vuex/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    vuex
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/vxe-table/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    vxe-table
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/wangeditor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    wangeditor
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/watermark/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    watermark
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/webpack-cli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    webpack-cli
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/webpack-dev-server/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    webpack-dev-server
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/webpack-merge/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    webpack-merge
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/webpack-node-externals/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    webpack-node-externals
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/webpack/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    webpack
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/whatwg-fetch/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    whatwg-fetch
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/workbox-webpack-plugin/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    workbox-webpack-plugin
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/zyronon_douyin/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    zyronon_douyin
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../new-third-part-lib/%CE%BCPlot/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    μPlot
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    react
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            react
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Create-React-App/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Create-React-App
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../React%20%26%20Webpack/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    React & Webpack
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../React%2017%20%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E6%96%B0%E7%89%B9%E6%80%A7/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    React 17 事件处理新特性
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../React%2018%20%E8%B6%85%E5%85%A8%E5%8D%87%E7%BA%A7%E6%8C%87%E5%8D%97/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    React 18 超全升级指南
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../React%20FAQ/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    React FAQ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../React%20Fiber%20Architecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    React Fiber Architecture
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../React%20PureComponent%20%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    React PureComponent 使用指南
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../React%20data%20grid/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    React data grid
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../React%20%E4%B8%AD%E7%9A%84%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    React 中的事件处理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../React%20%E5%90%84%E7%A7%8Dbug%20%E4%BC%9A%E5%AE%9E%E6%97%B6%E6%9B%B4%E6%96%B0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    React 各种bug 会实时更新
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../React%20%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E7%AC%94%E8%AE%B0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    React 官方文档笔记
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../React%20%E5%B8%B8%E7%94%A8%E6%9C%AF%E8%AF%AD%E5%90%AB%E4%B9%89/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    React 常用术语含义
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../React%20%E6%93%8D%E4%BD%9C%E5%85%83%E7%B4%A0%E7%9A%84API/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    React 操作元素的API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../React%20%E6%B5%8B%E8%AF%95%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    React 测试入门教程
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../React%20%E7%9A%84%20PureComponent%20%E4%B8%8E%20Component/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    React 的 PureComponent 与 Component
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../React%20%E8%A7%86%E9%A2%91%E6%95%99%E7%A8%8B-%E4%BC%A0%E6%99%BA%E6%92%AD%E5%AE%A2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    React 视频教程-传智播客
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../React%20%E8%A7%86%E9%A2%91%E6%95%99%E7%A8%8B-%E6%8A%80%E6%9C%AF%E8%83%96/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    React 视频教程-技术胖
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../React%20%E9%AB%98%E9%98%B6%E7%BB%84%E4%BB%B6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    React 高阶组件
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../React-Design%20Principles/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    React-Design Principles
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../React-Suspense%E7%9A%84%E5%AE%9E%E7%8E%B0%E4%B8%8E%E6%8E%A2%E8%AE%A8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    React-Suspense的实现与探讨
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../React-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    React-性能优化
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../React.Children%E7%9A%84API/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    React.Children的API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../React.Component/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    React.Component
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ReactRouter-%E9%98%AE%E4%B8%80%E5%B3%B0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ReactRouter-阮一峰
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../React%E4%BA%8B%E4%BB%B6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    React事件
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../React%E6%95%B0%E6%8D%AE%E6%B5%81/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    React数据流
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../React%E6%96%B0%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F--getDerivedStateFromProps/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    React新生命周期--getDerivedStateFromProps
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../React%E7%82%B9%E5%87%BB%E4%BA%8B%E4%BB%B6%E6%94%B9%E5%8F%98DOM%E6%96%B9%E6%B3%95/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    React点击事件改变DOM方法
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../React%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E6%B5%81%E7%A8%8B%E5%9B%BE/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    React生命周期流程图
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../React%E8%8E%B7%E5%8F%96%E5%B0%BA%E5%AF%B8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    React获取尺寸
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../React%E8%BF%9B%E9%98%B6%E2%80%94%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    React进阶—性能优化
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Refs%20%26%20DOM/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Refs & DOM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getDerivedStateFromProps%E7%9A%84%E4%BD%BF%E7%94%A8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    getDerivedStateFromProps的使用
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../jsx%E8%AF%AD%E6%B3%95/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    jsx语法
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../react%20%E4%B8%AD%E9%80%9A%E8%BF%87ref%E8%8E%B7%E5%8F%96%E9%AB%98%E9%98%B6%EF%BC%88HOC%EF%BC%89%E5%AD%90%E7%BB%84%E4%BB%B6%E5%AE%9E%E4%BE%8B%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    react 中通过ref获取高阶（HOC）子组件实例的解决方案
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../react%20%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84%E5%8F%8A%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    react 项目结构及编码规范
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../react-redux/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    react-redux
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../react-transition-group-%E5%8A%A8%E7%94%BB%E6%95%88%E6%9E%9C/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    react-transition-group-动画效果
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../react-useRef/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    react-useRef
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reactjs%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-%E4%B8%8A%E7%AF%87%EF%BC%88%E9%A6%96%E6%AC%A1%E6%B8%B2%E6%9F%93%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%EF%BC%89/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    reactjs源码分析-上篇（首次渲染实现原理）
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reactjs%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-%E4%B8%8B%E7%AF%87%EF%BC%88%E6%9B%B4%E6%96%B0%E6%9C%BA%E5%88%B6%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%EF%BC%89/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    reactjs源码分析-下篇（更新机制实现原理）
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../react%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%87%BD%E6%95%B0%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    react生命周期函数源码学习
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stackoverflow-Highlight%20text%20using%20ReactJS/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    stackoverflow-Highlight text using ReactJS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../todo-Testing%20React%20components/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    todo-Testing React components
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../todo-VS%20Code%20%E5%BF%AB%E6%8D%B7%E8%BE%93%E5%85%A5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    todo-VS Code 快捷输入
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E4%B8%BA%E4%BB%80%E4%B9%88%E8%AF%B4Suspense%E6%98%AF%E4%B8%80%E7%A7%8D%E5%B7%A8%E5%A4%A7%E7%9A%84%E7%AA%81%E7%A0%B4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    为什么说Suspense是一种巨大的突破
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3-React%E9%AB%98%E9%98%B6API/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    官方文档-React高阶API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%AF%B9React%20children%E7%90%86%E8%A7%A3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    对React children理解
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%8E%8C%E6%8F%A1%E6%8B%96%E6%8B%BD%E7%9A%84%E5%AE%9E%E7%8E%B0%EF%BC%88%E4%BD%BF%E7%94%A8ReactJS%20hooks%EF%BC%89/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    掌握拖拽的实现（使用ReactJS hooks）
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    案例-React Hook+TS4 最佳实践项目
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    案例-React Hook+TS4 最佳实践项目
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      说明
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      目录
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      第三方依赖版本
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      一、项目初始化与配置
    </span>
  </a>
  
    <nav class="md-nav" aria-label="一、项目初始化与配置">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-cra" class="md-nav__link">
    <span class="md-ellipsis">
      1.项目初始化 —— cra
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-prettier" class="md-nav__link">
    <span class="md-ellipsis">
      2.格式化 —— Prettier
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-commitlint" class="md-nav__link">
    <span class="md-ellipsis">
      3.提交规范 —— commitlint
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4mock-json-server" class="md-nav__link">
    <span class="md-ellipsis">
      4.Mock —— json-server
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#react-hook" class="md-nav__link">
    <span class="md-ellipsis">
      二、React-hook 搜索展示组件
    </span>
  </a>
  
    <nav class="md-nav" aria-label="二、React-hook 搜索展示组件">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      1.新建文件
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    <span class="md-ellipsis">
      2.状态提升
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    <span class="md-ellipsis">
      3.工具函数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-hook" class="md-nav__link">
    <span class="md-ellipsis">
      4.自定义 Hook
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ts-" class="md-nav__link">
    <span class="md-ellipsis">
      三、TS 应用- 强类型
    </span>
  </a>
  
    <nav class="md-nav" aria-label="三、TS 应用- 强类型">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1ts" class="md-nav__link">
    <span class="md-ellipsis">
      1.TS 的必要性
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_1" class="md-nav__link">
    <span class="md-ellipsis">
      2.代码更改
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#jwt" class="md-nav__link">
    <span class="md-ellipsis">
      四、JWT、用户认证与异步请求
    </span>
  </a>
  
    <nav class="md-nav" aria-label="四、JWT、用户认证与异步请求">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1login" class="md-nav__link">
    <span class="md-ellipsis">
      1.login
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2middleware-of-json-server" class="md-nav__link">
    <span class="md-ellipsis">
      2.middleware of json-server
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3jira-dev-toolimooc-jira-tool" class="md-nav__link">
    <span class="md-ellipsis">
      3.jira-dev-tool（imooc-jira-tool）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4jwtauth-provider" class="md-nav__link">
    <span class="md-ellipsis">
      4.JWT原理与auth-provider实现
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5usecontextuserloginregisterlogout" class="md-nav__link">
    <span class="md-ellipsis">
      5.useContext(user,login,register,logout)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6useauth" class="md-nav__link">
    <span class="md-ellipsis">
      6.用useAuth切换登录与非登录状态
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7fetchhttp" class="md-nav__link">
    <span class="md-ellipsis">
      7.用fetch抽象通用HTTP请求方法，增强通用性
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8usehttpjwt" class="md-nav__link">
    <span class="md-ellipsis">
      8.用useHttp管理JWT和登录状态，保持登录状态
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9tspartialomit" class="md-nav__link">
    <span class="md-ellipsis">
      9.TS的联合类型、Partial和Omit介绍
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#10ts-utility-types-pickexcludepartial-omit" class="md-nav__link">
    <span class="md-ellipsis">
      10.TS 的 Utility Types-Pick、Exclude、Partial 和 Omit 实现
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#css-in-js" class="md-nav__link">
    <span class="md-ellipsis">
      五、用 CSS-in-JS 添加样式
    </span>
  </a>
  
    <nav class="md-nav" aria-label="五、用 CSS-in-JS 添加样式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1antdemotion" class="md-nav__link">
    <span class="md-ellipsis">
      1.antd+emotion
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1.antd+emotion">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#craco" class="md-nav__link">
    <span class="md-ellipsis">
      安装 craco
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#antd" class="md-nav__link">
    <span class="md-ellipsis">
      antd 组件替换原生组件
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2css-in-js" class="md-nav__link">
    <span class="md-ellipsis">
      2.CSS-in-JS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3emotion" class="md-nav__link">
    <span class="md-ellipsis">
      3.emotion &amp; 登录注册页美化
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.emotion & 登录注册页美化">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      全局样式
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#emotion" class="md-nav__link">
    <span class="md-ellipsis">
      安装 emotion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#emotion_1" class="md-nav__link">
    <span class="md-ellipsis">
      原生标签使用 emotion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#antd-emotion" class="md-nav__link">
    <span class="md-ellipsis">
      antd 标签使用 emotion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      进一步美化
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4gridflexbox" class="md-nav__link">
    <span class="md-ellipsis">
      4.用Grid和Flexbox布局优化项目列表页面
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-emotion" class="md-nav__link">
    <span class="md-ellipsis">
      5.使用 emotion 自定义样式组件
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6" class="md-nav__link">
    <span class="md-ellipsis">
      6.完善项目列表页面样式
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7" class="md-nav__link">
    <span class="md-ellipsis">
      7.遗留问题处理
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#-" class="md-nav__link">
    <span class="md-ellipsis">
      六、用户体验优化 - 加载中和错误状态处理
    </span>
  </a>
  
    <nav class="md-nav" aria-label="六、用户体验优化 - 加载中和错误状态处理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-loading-error" class="md-nav__link">
    <span class="md-ellipsis">
      1.给页面添加 Loading 和 Error 状态，增加页面友好性
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-hook-useasync-loading-error" class="md-nav__link">
    <span class="md-ellipsis">
      2.用高级 Hook-useAsync 统一处理 Loading 和 Error 状态
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-loading-error-event-loop" class="md-nav__link">
    <span class="md-ellipsis">
      3.登录注册页面 Loading 和 Error 状态处理，与 Event Loop 详解
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4useasync" class="md-nav__link">
    <span class="md-ellipsis">
      4.用useAsync获取用户信息
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-error-boundaries" class="md-nav__link">
    <span class="md-ellipsis">
      5.实现 Error Boundaries，捕获边界错误
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-12" class="md-nav__link">
    <span class="md-ellipsis">
      7-12节后续的笔记
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%A1%88%E4%BE%8B-React%20Testing%20Library%20%E5%92%8C%20Jest%20%E5%AE%8C%E6%88%90%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    案例-React Testing Library 和 Jest 完成单元测试
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%A1%88%E4%BE%8B-React%E7%BB%84%E4%BB%B6%E5%BA%93%E6%90%AD%E5%BB%BA%E6%80%BB%E7%BB%93/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    案例-React组件库搭建总结
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E9%98%AE%E4%B8%80%E5%B3%B0%20react%20%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    阮一峰 react 系列教程
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E7%9A%84%20REACT%202015%20%E4%B9%8B%E8%B7%AF/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    阿里巴巴的 REACT 2015 之路
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    react-hooks
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            react-hooks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../react-hooks/00%20React%20hook%20%E7%AC%94%E8%AE%B0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    00 React hook 笔记
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../react-hooks/01%20React%20Hooks%20%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B-%E9%98%AE%E4%B8%80%E5%B3%B0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    01 React Hooks 入门教程-阮一峰
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../react-hooks/02%20%E8%BD%BB%E6%9D%BE%E5%AD%A6%E4%BC%9A%20React%20%E9%92%A9%E5%AD%90-%E4%BB%A5%20useEffect%28%29%20%E4%B8%BA%E4%BE%8B-%E9%98%AE%E4%B8%80%E5%B3%B0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    02 轻松学会 React 钩子-以 useEffect() 为例-阮一峰
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../react-hooks/03%20%E4%BB%8E%20Class%20%E8%BF%81%E7%A7%BB%E5%88%B0%20Hook/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    03 从 Class 迁移到 Hook
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../react-hooks/04%20React%20%E5%86%85%E7%BD%AE%20Hook/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    04 React 内置 Hook
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../react-hooks/05%20React%20Hooks%20%E8%AF%A6%E8%A7%A3%20%2B%20%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    05 React Hooks 详解 + 项目实战
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../react-hooks/06%20%E7%B2%BE%E9%80%9AReact%20Hooks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    06 精通React Hooks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../react-hooks/07%20React%20Hooks%20%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    07 React Hooks 最佳实践
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../react-hooks/08%20useMemo%E3%80%81useCallback%E3%80%81useContext/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    08 useMemo、useCallback、useContext
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../react-hooks/09%20React-hook%2BTS%E7%B1%BB%E5%9E%8B%E9%AA%8C%E8%AF%81/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    09 React-hook+TS类型验证
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    react-third-part-lib
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            react-third-part-lib
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../react-third-part-lib/01-CSDN%20%E5%8D%9A%E5%AE%A2%E6%96%87%E6%A1%A3%E9%93%BE%E6%8E%A5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    01-CSDN 博客文档链接
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../react-third-part-lib/030-react-is-deprecated/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    030-react-is-deprecated
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../react-third-part-lib/031-react-sweet-progress/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    031-react-sweet-progress
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../react-third-part-lib/032-reactstrap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    032-reactstrap
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../react-third-part-lib/044-react-app-polyfill/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    044-react-app-polyfill
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../react-third-part-lib/045-react-dev-utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    045-react-dev-utils
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../react-third-part-lib/046-react-dom/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    046-react-dom
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../react-third-part-lib/069-react-codemirror/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    069-react-codemirror
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../react-third-part-lib/073-react-i18next/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    073-react-i18next
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../react-third-part-lib/101-%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93-react-poker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    101-第三方库-react-poker
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../react-third-part-lib/103-react-to-print/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    103-react-to-print
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../react-third-part-lib/112-react-select/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    112-react-select
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../react-third-part-lib/113-react-image-lightbox/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    113-react-image-lightbox
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../react-third-part-lib/21-%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93-react-window/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    21-第三方库-react-window
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../react-third-part-lib/22-%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93-react-mentions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    22-第三方库-react-mentions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../react-third-part-lib/23-%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93-react-loading-skeleton/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    23-第三方库-react-loading-skeleton
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../react-third-part-lib/24-%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93-react-konva/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    24-第三方库-react-konva
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../react-third-part-lib/25-%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93-react-canvas/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    25-第三方库-react-canvas
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../react-third-part-lib/26-%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93-react-image-lightbox/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    26-第三方库-react-image-lightbox
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../react-third-part-lib/React-Select/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    React-Select
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../react-third-part-lib/Todo-054-GGEditor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Todo-054-GGEditor
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../react-third-part-lib/gojs-react/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    gojs-react
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../react-third-part-lib/react-colorful/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    react-colorful
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../react-third-part-lib/react-lazy-load/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    react-lazy-load
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../react-third-part-lib/todo-00-React%20%E7%AC%94%E8%AE%B0%E7%9B%AE%E5%BD%95/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    todo-00-React 笔记目录
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../react-third-part-lib/todo-009-html2canvas/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    todo-009-html2canvas
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../react-third-part-lib/todo-017-qrcode-react/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    todo-017-qrcode-react
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../react-third-part-lib/todo-050-react-custom-scrollbars/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    todo-050-react-custom-scrollbars
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../react-third-part-lib/todo-052-react-select/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    todo-052-react-select
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../react-third-part-lib/todo-053-react-media/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    todo-053-react-media
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../react-third-part-lib/todo-055-DPlayer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    todo-055-DPlayer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../react-third-part-lib/todo-20-React%20Router%20%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A31-v4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    todo-20-React Router 中文文档1-v4
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../react-third-part-lib/todo-20-React%20Router%20%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A32/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    todo-20-React Router 中文文档2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../react-third-part-lib/todo-20-react-router/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    todo-20-react-router
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../react-third-part-lib/todo-26-%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93-react-use/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    todo-26-第三方库-react-use
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../react-third-part-lib/todo-27-%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93-react-motion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    todo-27-第三方库-react-motion
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../react-third-part-lib/todo-28-sort-by/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    todo-28-sort-by
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../react-third-part-lib/todo-29-localForage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    todo-29-localForage
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../react-third-part-lib/todo-30-match-sorter/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    todo-30-match-sorter
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../react-third-part-lib/todo-31-zxing-library%20%E5%AE%9E%E7%8E%B0%E5%89%8D%E7%AB%AF%E6%89%AB%E7%A0%81%E5%8A%9F%E8%83%BD/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    todo-31-zxing-library 实现前端扫码功能
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../react-third-part-lib/todo-32-%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93-react-photoswipe-gallery/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    todo-32-第三方库-react-photoswipe-gallery
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../react-third-part-lib/todo-33-React-%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    todo-33-React-第三方库
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    third-part-lib/codemirror
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            third-part-lib/codemirror
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../third-part-lib/codemirror/Code-mirror/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Code-mirror
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../third-part-lib/codemirror/codemirror-readme/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    codemirror-readme
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../third-part-lib/codemirror/codemirror/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    codemirror
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    third-part-lib/debugjs
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            third-part-lib/debugjs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../third-part-lib/debugjs/debugjs.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    debugjs
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    third-part-lib/echarts
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            third-part-lib/echarts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../third-part-lib/echarts/echarts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    echarts
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    third-part-lib/g2
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            third-part-lib/g2
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../third-part-lib/g2/antv-g2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    antv-g2
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    third-part-lib/react-dnd
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            third-part-lib/react-dnd
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../third-part-lib/react-dnd/01-readme/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    01-readme
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../third-part-lib/react-dnd/02-quickstart/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    02-quickstart
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../third-part-lib/react-dnd/03-Overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    03-Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../third-part-lib/react-dnd/API/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../third-part-lib/react-dnd/React%20DnD/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    React DnD
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../third-part-lib/react-dnd/Testing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Testing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../third-part-lib/react-dnd/Tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tutorial
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../third-part-lib/react-dnd/react-dnd-DragLayer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    react-dnd-DragLayer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../third-part-lib/react-dnd/react-dnd-DragSource/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    react-dnd-DragSource
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../third-part-lib/react-dnd/react-dnd-DropTarget/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    react-dnd-DropTarget
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../third-part-lib/react-dnd/react-dnd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    react-dnd
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../third-part-lib/react-dnd/react-dnd%E4%BD%BF%E7%94%A8%E6%89%8B%E8%AE%B0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    react-dnd使用手记
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      说明
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      目录
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      第三方依赖版本
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      一、项目初始化与配置
    </span>
  </a>
  
    <nav class="md-nav" aria-label="一、项目初始化与配置">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-cra" class="md-nav__link">
    <span class="md-ellipsis">
      1.项目初始化 —— cra
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-prettier" class="md-nav__link">
    <span class="md-ellipsis">
      2.格式化 —— Prettier
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-commitlint" class="md-nav__link">
    <span class="md-ellipsis">
      3.提交规范 —— commitlint
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4mock-json-server" class="md-nav__link">
    <span class="md-ellipsis">
      4.Mock —— json-server
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#react-hook" class="md-nav__link">
    <span class="md-ellipsis">
      二、React-hook 搜索展示组件
    </span>
  </a>
  
    <nav class="md-nav" aria-label="二、React-hook 搜索展示组件">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      1.新建文件
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    <span class="md-ellipsis">
      2.状态提升
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    <span class="md-ellipsis">
      3.工具函数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-hook" class="md-nav__link">
    <span class="md-ellipsis">
      4.自定义 Hook
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ts-" class="md-nav__link">
    <span class="md-ellipsis">
      三、TS 应用- 强类型
    </span>
  </a>
  
    <nav class="md-nav" aria-label="三、TS 应用- 强类型">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1ts" class="md-nav__link">
    <span class="md-ellipsis">
      1.TS 的必要性
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_1" class="md-nav__link">
    <span class="md-ellipsis">
      2.代码更改
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#jwt" class="md-nav__link">
    <span class="md-ellipsis">
      四、JWT、用户认证与异步请求
    </span>
  </a>
  
    <nav class="md-nav" aria-label="四、JWT、用户认证与异步请求">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1login" class="md-nav__link">
    <span class="md-ellipsis">
      1.login
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2middleware-of-json-server" class="md-nav__link">
    <span class="md-ellipsis">
      2.middleware of json-server
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3jira-dev-toolimooc-jira-tool" class="md-nav__link">
    <span class="md-ellipsis">
      3.jira-dev-tool（imooc-jira-tool）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4jwtauth-provider" class="md-nav__link">
    <span class="md-ellipsis">
      4.JWT原理与auth-provider实现
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5usecontextuserloginregisterlogout" class="md-nav__link">
    <span class="md-ellipsis">
      5.useContext(user,login,register,logout)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6useauth" class="md-nav__link">
    <span class="md-ellipsis">
      6.用useAuth切换登录与非登录状态
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7fetchhttp" class="md-nav__link">
    <span class="md-ellipsis">
      7.用fetch抽象通用HTTP请求方法，增强通用性
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8usehttpjwt" class="md-nav__link">
    <span class="md-ellipsis">
      8.用useHttp管理JWT和登录状态，保持登录状态
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9tspartialomit" class="md-nav__link">
    <span class="md-ellipsis">
      9.TS的联合类型、Partial和Omit介绍
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#10ts-utility-types-pickexcludepartial-omit" class="md-nav__link">
    <span class="md-ellipsis">
      10.TS 的 Utility Types-Pick、Exclude、Partial 和 Omit 实现
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#css-in-js" class="md-nav__link">
    <span class="md-ellipsis">
      五、用 CSS-in-JS 添加样式
    </span>
  </a>
  
    <nav class="md-nav" aria-label="五、用 CSS-in-JS 添加样式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1antdemotion" class="md-nav__link">
    <span class="md-ellipsis">
      1.antd+emotion
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1.antd+emotion">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#craco" class="md-nav__link">
    <span class="md-ellipsis">
      安装 craco
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#antd" class="md-nav__link">
    <span class="md-ellipsis">
      antd 组件替换原生组件
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2css-in-js" class="md-nav__link">
    <span class="md-ellipsis">
      2.CSS-in-JS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3emotion" class="md-nav__link">
    <span class="md-ellipsis">
      3.emotion &amp; 登录注册页美化
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.emotion & 登录注册页美化">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      全局样式
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#emotion" class="md-nav__link">
    <span class="md-ellipsis">
      安装 emotion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#emotion_1" class="md-nav__link">
    <span class="md-ellipsis">
      原生标签使用 emotion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#antd-emotion" class="md-nav__link">
    <span class="md-ellipsis">
      antd 标签使用 emotion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      进一步美化
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4gridflexbox" class="md-nav__link">
    <span class="md-ellipsis">
      4.用Grid和Flexbox布局优化项目列表页面
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-emotion" class="md-nav__link">
    <span class="md-ellipsis">
      5.使用 emotion 自定义样式组件
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6" class="md-nav__link">
    <span class="md-ellipsis">
      6.完善项目列表页面样式
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7" class="md-nav__link">
    <span class="md-ellipsis">
      7.遗留问题处理
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#-" class="md-nav__link">
    <span class="md-ellipsis">
      六、用户体验优化 - 加载中和错误状态处理
    </span>
  </a>
  
    <nav class="md-nav" aria-label="六、用户体验优化 - 加载中和错误状态处理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-loading-error" class="md-nav__link">
    <span class="md-ellipsis">
      1.给页面添加 Loading 和 Error 状态，增加页面友好性
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-hook-useasync-loading-error" class="md-nav__link">
    <span class="md-ellipsis">
      2.用高级 Hook-useAsync 统一处理 Loading 和 Error 状态
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-loading-error-event-loop" class="md-nav__link">
    <span class="md-ellipsis">
      3.登录注册页面 Loading 和 Error 状态处理，与 Event Loop 详解
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4useasync" class="md-nav__link">
    <span class="md-ellipsis">
      4.用useAsync获取用户信息
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-error-boundaries" class="md-nav__link">
    <span class="md-ellipsis">
      5.实现 Error Boundaries，捕获边界错误
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-12" class="md-nav__link">
    <span class="md-ellipsis">
      7-12节后续的笔记
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="reacthookts-jira">React+Hook+TS 最佳实践-仿 Jira项目<a class="headerlink" href="#reacthookts-jira" title="Permanent link">&para;</a></h1>
<p>统计信息：字数 83932  阅读168分钟</p>
<p>2023-03</p>
<p>学习内容来源：<a href="https://coding.imooc.com/class/482.html">React + React Hook + TS 最佳实践-慕课网</a></p>
<p>博客原始链接：<a href="https://iseeu.blog.csdn.net/article/details/132747686">https://iseeu.blog.csdn.net/article/details/132747686</a></p>
<h2 id="_1">说明<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>这个是我看到的一个练手项目的笔记。没有接触过“Jira”这个产品。</p>
<h2 id="_2">目录<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>一、项目起航：项目初始化与配置</p>
<p>二、React 与 Hook 应用：实现项目列表</p>
<p>三、TS 应用：JS神助攻 - 强类型</p>
<p>四、JWT、用户认证与异步请求</p>
<p>五、CSS 其实很简单 - 用 CSS-in-JS 添加样式</p>
<p>六、用户体验优化 - 加载中和错误状态处理</p>
<p>七、Hook，路由，与 URL 状态管理</p>
<p>八、用户选择器与项目编辑功能</p>
<p>九、深入React 状态管理与Redux机制</p>
<p>十、用 react-query 获取数据，管理缓存</p>
<p>十一、看板页面及任务组页面开发</p>
<p>十二、自动化测试</p>
<h2 id="_3">第三方依赖版本<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<p>相对原教程，在学习开始时采用的是当前最新版本：</p>
<div class="highlight"><pre><span></span><code>react &amp; react-dom   ^18.2.0
react-router &amp; react-router-dom ^6.11.2
antd    ^4.24.8
@commitlint/cli &amp; @commitlint/config-conventional   ^17.4.4
eslint-config-prettier  ^8.6.0
husky   ^8.0.3
lint-staged ^13.1.2
prettier    2.8.4
json-server 0.17.2
craco-less  ^2.0.0
@craco/craco    ^7.1.0
qs  ^6.11.0
dayjs   ^1.11.7
react-helmet    ^6.1.0
@types/react-helmet ^6.1.6
react-query ^6.1.0
@welldone-software/why-did-you-render   ^7.0.1
@emotion/react &amp; @emotion/styled    ^11.10.6
</code></pre></div>
<p>具体配置、操作和内容会有差异，“坑”也会有所不同。。。</p>
<h2 id="_4">一、项目初始化与配置<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<p>1.项目初始化 —— create-react-app
2.格式化 —— Prettier
3.提交规范 —— commitlint
4.Mock —— json-server</p>
<h3 id="1-cra">1.项目初始化 —— cra<a class="headerlink" href="#1-cra" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>npx<span class="w"> </span>create-react-app<span class="w"> </span>jira<span class="w"> </span>--template<span class="w"> </span>typescript
</code></pre></div>
<p>baseUrl 配置
<div class="highlight"><pre><span></span><code>{
  &quot;compilerOptions&quot;: {
    &quot;baseUrl&quot;: &quot;./src&quot;,
    ...
  }
  ...
}
</code></pre></div></p>
<p>重新配置后，若是项目已启动，则需要重启才能生效</p>
<h3 id="2-prettier">2.格式化 —— Prettier<a class="headerlink" href="#2-prettier" title="Permanent link">&para;</a></h3>
<p>这里没有使用 react 提供的默认的 eslint，而是使用 prettier 会覆盖掉冲突的原有 eslint 规则。具体操作如下：</p>
<p>为确保所有项目参与人员统一格式化代码，项目中引入 Prettier 依赖</p>
<div class="highlight"><pre><span></span><code>npm install --save-dev --save-exact prettier
</code></pre></div>
<p>Prettier 中文网 · Prettier 是一个“有态度”的代码格式化工具——<a href="https://www.prettier.cn/">https://www.prettier.cn/</a></p>
<p>创建配置文件：<code>.prettierrc.json</code></p>
<div class="highlight"><pre><span></span><code>{}
</code></pre></div>
<p>创建格式化忽略文件：<code>.prettierignore</code></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Ignore artifacts:\nbuild\ncoverage</span>
</code></pre></div>
<p>prettierignore 直接输入以下内容：</p>
<div class="highlight"><pre><span></span><code># Ignore artifacts:
build
coverage
</code></pre></div>
<p>为了使格式化操作在每次提交代码时（pre-commit）自动执行，需要安装依赖：husky &amp; lint-staged</p>
<div class="highlight"><pre><span></span><code>npx<span class="w"> </span>mrm@2<span class="w"> </span>lint-staged
</code></pre></div>
<p>执行这行命令会同时安装 husky 和 lint-stage，并自动配置 <code>package.json: "prepare": "husky install"</code> 生成 .husky/pre-commit 和 .husky/_/husky.sh 文件，免除了手动配置</p>
<blockquote>
<p>Pre-commit Hook · Prettier 中文网——<a href="https://www.prettier.cn/docs/precommit.html">https://www.prettier.cn/docs/precommit.html</a></p>
</blockquote>
<p>为避免 prettier 与项目原有 eslint 的冲突，还需要安装依赖：eslint-config-prettier</p>
<div class="highlight"><pre><span></span><code>npm<span class="w"> </span>install<span class="w"> </span>--save-dev<span class="w"> </span>eslint-config-prettier
</code></pre></div>
<p>在 package.json 的 eslint 配置尾部添加 "prettier" (若有 eslintrc 单独配置文件，同)：</p>
<div class="highlight"><pre><span></span><code>  ...
  &quot;eslintConfig&quot;: {
    &quot;extends&quot;: [
      &quot;react-app&quot;,
      &quot;react-app/jest&quot;,
      &quot;prettier&quot;
    ]
  },
  ...
</code></pre></div>
<p>prettier 会覆盖掉冲突的原有 eslint 规则</p>
<ul>
<li><a href="https://www.cnblogs.com/pengchenggang/p/16033168.html">Prettier 和 ESLint 冲突解决方案 eslint-config-prettier eslint-plugin-prettier - 彭成刚 - 博客园</a></li>
</ul>
<p>步骤完成后，尝试改动一些代码（比如随机删去tsx文件的几个换行），进行一次代码提交，提交信息随意尝试，查看提交后代码是否被格式化还原之前正常格式</p>
<h3 id="3-commitlint">3.提交规范 —— commitlint<a class="headerlink" href="#3-commitlint" title="Permanent link">&para;</a></h3>
<p>接下来规范 commit message:</p>
<div class="highlight"><pre><span></span><code>npm install --save-dev @commitlint/config-conventional @commitlint/cli
</code></pre></div>
<p>生成 commitlint.config.js，并配置内容:</p>
<div class="highlight"><pre><span></span><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">  </span><span class="k">extends</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s1">&#39;@commitlint/config-conventional&#39;</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">};</span>
</code></pre></div>
<p>激活 husky</p>
<div class="highlight"><pre><span></span><code>npx husky install
</code></pre></div>
<p>在 husky 中添加 hook —— commit-msg</p>
<div class="highlight"><pre><span></span><code><span class="c1"># bash</span>
npx<span class="w"> </span>husky<span class="w"> </span>add<span class="w"> </span>.husky/commit-msg<span class="w">  </span><span class="s1">&#39;npx --no -- commitlint --edit ${1}&#39;</span>
</code></pre></div>
<blockquote>
<p>windows 的 cmd 或 powershell 中会报错，具体可参考：<a href="https://iseeu.blog.csdn.net/article/details/129238475">【已解决】npx husky add 执行失败</a></p>
</blockquote>
<p>经过这一步后，代码提交如果不规范就会提交失败啦，结果日志如下：</p>
<div class="highlight"><pre><span></span><code>&gt; git -c user.useConfigOnly=true commit --quiet --allow-empty-message --file -
[34m→[39m No staged files match any configured task.
⧗   input: 我掐指一算，这次提交会报错
✖   subject may not be empty [subject-empty]
✖   type may not be empty [type-empty]

✖   found 2 problems, 0 warnings
ⓘ   Get help: https://github.com/conventional-changelog/commitlint/#what-is-commitlint

husky - commit-msg hook exited with code 1 (error)
</code></pre></div>
<p>具体提交规范可参考文章：</p>
<p><a href="https://iseeu.blog.csdn.net/article/details/129241273">【笔记】项目优化代码提交规范 —— commitlint+husky</a></p>
<ul>
<li>
<p><a href="https://commitlint.js.org/#/">commitlint - Lint commit messages</a></p>
</li>
<li>
<p><a href="https://github.com/conventional-changelog/commitlint">conventional-changelog/commitlint: 📓 Lint commit messages</a>details/129241273)</p>
</li>
</ul>
<h3 id="4mock-json-server">4.Mock —— json-server<a class="headerlink" href="#4mock-json-server" title="Permanent link">&para;</a></h3>
<p>一般开发过程中，前后端是并行的，这就意味着前端开发时是没有接口调用的，这时就涉及到了 Mock 的问题，不同方案对比可参考：</p>
<p><a href="https://iseeu.blog.csdn.net/article/details/129242566">【笔记】不同 Mock 方案的对比及选择</a></p>
<p>这里选用 json-server</p>
<div class="highlight"><pre><span></span><code>npm i -g json-server
</code></pre></div>
<p>创建数据源文件</p>
<div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>__json_server_mock__
<span class="nb">cd</span><span class="w"> </span>./__json_server_mock__

<span class="c1"># bash</span>
touch<span class="w"> </span>db.json
</code></pre></div>
<p>在 package.json 中新增 scripts 配置：</p>
<div class="highlight"><pre><span></span><code>  &quot;scripts&quot;: {
    &quot;json-server&quot;: &quot;json-server __json_server_mock__/db.json -w -p 3001&quot;
  },
</code></pre></div>
<p>项目启动默认在 3000 端口，因此把 json-server 端口改为其他: 3001</p>
<p>命令行中输入以下命令启动 json-server：</p>
<div class="highlight"><pre><span></span><code>npm run json-server
</code></pre></div>
<blockquote>
<p>接下来可以自行尝试 json-server 的妙用，可参考：<a href="https://iseeu.blog.csdn.net/article/details/112726099">【笔记】json-server实战</a></p>
</blockquote>
<p>项目初始化和配置完成，可以进行后续正式开发了。</p>
<h2 id="react-hook">二、React-hook 搜索展示组件<a class="headerlink" href="#react-hook" title="Permanent link">&para;</a></h2>
<p>这里实现一个搜索并展示结果列表的组件</p>
<h3 id="1">1.新建文件<a class="headerlink" href="#1" title="Permanent link">&para;</a></h3>
<ul>
<li>项目列表组件（入口组件）：src\screens\ProjectList\index.jsx</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">SearchPanel</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;./components/SearchPanel&quot;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">List</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;./components/List&quot;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">ProjectListScreen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">SearchPanel</span><span class="o">/&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">List</span><span class="o">/&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="w">  </span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>列表组件：src\screens\ProjectList\components\List.jsx</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">List</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">table</span><span class="o">&gt;&lt;</span><span class="err">/table&gt;</span>
<span class="w">  </span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>搜索组件：src\screens\ProjectList\components\SearchPanel.jsx</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useEffect</span><span class="p">,</span><span class="w"> </span><span class="nx">useState</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;react&quot;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">SearchPanel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="c1">// 搜索参数（名称，用户ID）</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">param</span><span class="p">,</span><span class="w"> </span><span class="nx">setParam</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">({</span>
<span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">personId</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span>
<span class="w">  </span><span class="p">})</span>

<span class="w">  </span><span class="c1">// 用户列表</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">users</span><span class="p">,</span><span class="w"> </span><span class="nx">setUsers</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">([])</span>

<span class="w">  </span><span class="c1">// 搜索列表</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">list</span><span class="p">,</span><span class="w"> </span><span class="nx">setList</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">([])</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 从后端获取搜索的结果，并写入 list 状态中</span>
<span class="w">    </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="nx">res</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">setList</span><span class="p">(</span><span class="k">await</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">})</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">param</span><span class="p">])</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">form</span><span class="o">&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
<span class="w">        </span><span class="p">{</span><span class="cm">/* setParam(Object.assign({}, param, { name: evt.target.value })) */</span><span class="p">}</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">input</span><span class="w"> </span><span class="nx">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="w"> </span><span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="nx">param</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="w"> </span><span class="nx">onChange</span><span class="o">=</span><span class="p">{</span><span class="nx">evt</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setParam</span><span class="p">({</span>
<span class="w">          </span><span class="p">...</span><span class="nx">param</span><span class="p">,</span>
<span class="w">          </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="nx">evt</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span>
<span class="w">        </span><span class="p">})}</span><span class="o">/&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">select</span><span class="w"> </span><span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="nx">param</span><span class="p">.</span><span class="nx">personId</span><span class="p">}</span><span class="w"> </span><span class="nx">onChange</span><span class="o">=</span><span class="p">{</span><span class="nx">evt</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setParam</span><span class="p">({</span>
<span class="w">          </span><span class="p">...</span><span class="nx">param</span><span class="p">,</span>
<span class="w">          </span><span class="nx">personId</span><span class="o">:</span><span class="w"> </span><span class="nx">evt</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span>
<span class="w">        </span><span class="p">})}</span><span class="o">&gt;</span>
<span class="w">          </span><span class="o">&lt;</span><span class="nx">option</span><span class="w"> </span><span class="nx">value</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="o">&gt;</span><span class="nx">负责人</span><span class="o">&lt;</span><span class="err">/option&gt;</span>
<span class="w">          </span><span class="p">{</span><span class="nx">users</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">user</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="o">&lt;</span><span class="nx">option</span><span class="w"> </span><span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="w"> </span><span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/option&gt;</span>
<span class="w">          </span><span class="p">))}</span>
<span class="w">        </span><span class="o">&lt;</span><span class="err">/select&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/form&gt;</span>
<span class="w">  </span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<blockquote>
<p>vscode 在 JS 文件中不会自动补全 HTML标签可参考：<a href="https://iseeu.blog.csdn.net/article/details/129254994">【小技巧】vscode 在 JS 文件中补全 HTML标签</a></p>
</blockquote>
<h3 id="2">2.状态提升<a class="headerlink" href="#2" title="Permanent link">&para;</a></h3>
<p>由于 <code>list</code> 和 <code>param</code> 涉及两个不同组件，因此需要将这两个 <code>state</code> 提升到他们共同的父组件中，子组件通过解构 <code>props</code> 使用:</p>
<ul>
<li><code>list</code> 由 <code>List</code> 消费；</li>
<li><code>list</code> 根据 <code>param</code> 获取；</li>
<li><code>param</code> 由 <code>SearchPanel</code> 消费；</li>
</ul>
<p>按照数据库范式思维，project、users 各自单独一张表、而 list 只是关联查询的中间产物，hard 模式中通过 project 只能得到 users 的主键，即 personId，需要根据 personId 再去获取 personName，因此 users 也需要做状态提升。</p>
<p>为了 <strong><code>DRY</code></strong> 原则，将接口调用URL中的 <code>http://host:port</code> 提取到项目全局环境变量 中：</p>
<p><code>.env</code></p>
<div class="highlight"><pre><span></span><code>REACT_APP_API_URL=http://online.com
</code></pre></div>
<p><code>.env.development</code></p>
<div class="highlight"><pre><span></span><code>REACT_APP_API_URL=http://localhost:3001
</code></pre></div>
<p><code>webpack</code> 环境变量识别规则的理解——根据不同 webpack 版本和配置决定。</p>
<ul>
<li>执行 <code>npm run start</code> 时，<code>webpack</code> 读取 <code>.env.development</code> 中的环境变量；</li>
<li>执行 <code>npm run build</code> 时，<code>webpack</code> 读取 <code>.env</code> 中的环境变量；</li>
</ul>
<h3 id="3">3.工具函数<a class="headerlink" href="#3" title="Permanent link">&para;</a></h3>
<p>常用工具方法统一放到 <code>utils/index.js</code> 中</p>
<ul>
<li>由于在fetch传参过程中，多个可传参数单只传一个，那么空参需要过滤(过滤过程中考虑到 <code>0</code> 是有效参数，因此特殊处理)：</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1">// 判断变量是否是 false</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">isFalsy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">val</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">val</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="o">!</span><span class="nx">val</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// 删除某个对象中的空属性</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">cleanObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// 在函数里，不可用直接赋值的方式改变传入的引用类型变量</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="nx">obj</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">res</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">key</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">res</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">isFalsy</span><span class="p">(</span><span class="nx">val</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="ow">delete</span><span class="w"> </span><span class="nx">res</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">})</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span>
<span class="p">}</span>
</code></pre></div>
<blockquote>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Glossary/Falsy">Falsy - MDN Web 文档术语表：Web 相关术语的定义 | MDN</a></li>
</ul>
</blockquote>
<ul>
<li>在url后拼参时，参数较多会显得繁琐，因此引入 <code>qs</code>  <a href="https://www.npmjs.com/package/qs">qs - npm</a></li>
</ul>
<p>经过前面两步，状态提升并使用 <code>cleanObject</code> 和 <code>qs</code> 处理参数后，源码如下：</p>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">SearchPanel</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;./components/SearchPanel&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">List</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;./components/List&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useEffect</span><span class="p">,</span><span class="w"> </span><span class="nx">useState</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;react&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">cleanObject</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;utils&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">qs</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;qs&#39;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">apiUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">REACT_APP_API_URL</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">ProjectListScreen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">param</span><span class="p">,</span><span class="w"> </span><span class="nx">setParam</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">({</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">personId</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">});</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">users</span><span class="p">,</span><span class="w"> </span><span class="nx">setUsers</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">([]);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">list</span><span class="p">,</span><span class="w"> </span><span class="nx">setList</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">([]);</span>

<span class="w">  </span><span class="c1">// 通过输入的名称和用户，查询到列表内容（实时查询）</span>
<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fetch</span><span class="p">(</span>
<span class="w">      </span><span class="c1">// name=${param.name}&amp;personId=${param.personId}</span>
<span class="w">      </span><span class="sb">`</span><span class="si">${</span><span class="nx">apiUrl</span><span class="si">}</span><span class="sb">/projects?</span><span class="si">${</span><span class="nx">qs</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">cleanObject</span><span class="p">(</span><span class="nx">param</span><span class="p">))</span><span class="si">}</span><span class="sb">`</span>
<span class="w">    </span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">setList</span><span class="p">(</span><span class="k">await</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">param</span><span class="p">]);</span>

<span class="w">  </span><span class="c1">// 查询用户列表</span>
<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">apiUrl</span><span class="si">}</span><span class="sb">/users`</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">setUsers</span><span class="p">(</span><span class="k">await</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[]);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">SearchPanel</span><span class="w"> </span><span class="nx">users</span><span class="o">=</span><span class="p">{</span><span class="nx">users</span><span class="p">}</span><span class="w"> </span><span class="nx">param</span><span class="o">=</span><span class="p">{</span><span class="nx">param</span><span class="p">}</span><span class="w"> </span><span class="nx">setParam</span><span class="o">=</span><span class="p">{</span><span class="nx">setParam</span><span class="p">}</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">List</span><span class="w"> </span><span class="nx">users</span><span class="o">=</span><span class="p">{</span><span class="nx">users</span><span class="p">}</span><span class="w"> </span><span class="nx">list</span><span class="o">=</span><span class="p">{</span><span class="nx">list</span><span class="p">}</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>
<ul>
<li><code>src\screens\ProjectList\components\List.jsx</code></li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">List</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">({</span><span class="w"> </span><span class="nx">users</span><span class="p">,</span><span class="w"> </span><span class="nx">list</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">table</span><span class="o">&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">thead</span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">tr</span><span class="o">&gt;</span>
<span class="w">          </span><span class="o">&lt;</span><span class="nx">th</span><span class="o">&gt;</span><span class="nx">名称</span><span class="o">&lt;</span><span class="err">/th&gt;</span>
<span class="w">          </span><span class="o">&lt;</span><span class="nx">th</span><span class="o">&gt;</span><span class="nx">负责人</span><span class="o">&lt;</span><span class="err">/th&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="err">/tr&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="err">/thead&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">tbody</span><span class="o">&gt;</span>
<span class="w">        </span><span class="p">{</span><span class="nx">list</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">project</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="o">&lt;</span><span class="nx">tr</span><span class="w"> </span><span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">project</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="o">&gt;</span>
<span class="w">            </span><span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">project</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/td&gt;</span>
<span class="w">            </span><span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span>
<span class="w">              </span><span class="p">{</span><span class="nx">users</span><span class="p">.</span><span class="nx">find</span><span class="p">((</span><span class="nx">user</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">project</span><span class="p">.</span><span class="nx">personId</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">&quot;未知&quot;</span><span class="p">}</span>
<span class="w">            </span><span class="o">&lt;</span><span class="err">/td&gt;</span>
<span class="w">          </span><span class="o">&lt;</span><span class="err">/tr&gt;</span>
<span class="w">        </span><span class="p">))}</span>
<span class="w">      </span><span class="o">&lt;</span><span class="err">/tbody&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/table&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>
<ul>
<li><code>src\screens\ProjectList\components\SearchPanel.jsx</code></li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">SearchPanel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">({</span><span class="w"> </span><span class="nx">users</span><span class="p">,</span><span class="w"> </span><span class="nx">param</span><span class="p">,</span><span class="w"> </span><span class="nx">setParam</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">form</span><span class="o">&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">input</span>
<span class="w">          </span><span class="nx">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span>
<span class="w">          </span><span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="nx">param</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span>
<span class="w">          </span><span class="nx">onChange</span><span class="o">=</span><span class="p">{(</span><span class="nx">evt</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">            </span><span class="nx">setParam</span><span class="p">({</span>
<span class="w">              </span><span class="p">...</span><span class="nx">param</span><span class="p">,</span>
<span class="w">              </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="nx">evt</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span>
<span class="w">            </span><span class="p">})</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="o">/&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">select</span>
<span class="w">          </span><span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="nx">param</span><span class="p">.</span><span class="nx">personId</span><span class="p">}</span>
<span class="w">          </span><span class="nx">onChange</span><span class="o">=</span><span class="p">{(</span><span class="nx">evt</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">            </span><span class="nx">setParam</span><span class="p">({</span>
<span class="w">              </span><span class="p">...</span><span class="nx">param</span><span class="p">,</span>
<span class="w">              </span><span class="nx">personId</span><span class="o">:</span><span class="w"> </span><span class="nx">evt</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span>
<span class="w">            </span><span class="p">})</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="o">&gt;</span>
<span class="w">          </span><span class="o">&lt;</span><span class="nx">option</span><span class="w"> </span><span class="nx">value</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="o">&gt;</span><span class="nx">负责人</span><span class="o">&lt;</span><span class="err">/option&gt;</span>
<span class="w">          </span><span class="p">{</span><span class="nx">users</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">user</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="o">&lt;</span><span class="nx">option</span><span class="w"> </span><span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="w"> </span><span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="o">&gt;</span>
<span class="w">              </span><span class="p">{</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span>
<span class="w">            </span><span class="o">&lt;</span><span class="err">/option&gt;</span>
<span class="w">          </span><span class="p">))}</span>
<span class="w">        </span><span class="o">&lt;</span><span class="err">/select&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/form&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>
<ul>
<li><code>src\App.tsx</code></li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ProjectListScreen</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;screens/ProjectList&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="s2">&quot;./App.css&quot;</span><span class="p">;</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">App</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">div</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s2">&quot;App&quot;</span><span class="o">&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">ProjectListScreen</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">App</span><span class="p">;</span>
</code></pre></div>
<h3 id="4-hook">4.自定义 Hook<a class="headerlink" href="#4-hook" title="Permanent link">&para;</a></h3>
<p>Custom Hook 可是代码复用利器</p>
<ul>
<li>useMount：生命周期模拟 —— componentDidMount</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">useMount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cb</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">cb</span><span class="p">(),</span><span class="w"> </span><span class="p">[])</span>
<span class="p">}</span>
</code></pre></div>
<p>正常情况下 useEffect 只执行一次，但是 react@v18 严格模式下 useEffect 默认执行两遍，具体详见：<a href="https://iseeu.blog.csdn.net/article/details/129303728">【已解决】react@v18 严格模式下 useEffect 默认执行两遍</a></p>
<ul>
<li>useDebounce：防抖</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * @param { 值 } val </span>
<span class="cm"> * @param { 延时：默认 1000 } delay </span>
<span class="cm"> * @returns 在某段时间内多次变动后最终拿到的值（delay 延迟的是存储在队列中的上一次变化）</span>
<span class="cm"> */</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">useDebounce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">val</span><span class="p">,</span><span class="w"> </span><span class="nx">delay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1000</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">tempVal</span><span class="p">,</span><span class="w"> </span><span class="nx">setTempVal</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 每次在 val 变化后，设置一个定时器</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">timeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">setTimeout</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setTempVal</span><span class="p">(</span><span class="nx">val</span><span class="p">),</span><span class="w"> </span><span class="nx">delay</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// 每次在上一个 useEffect 处理完以后再运行（useEffect 的天然功能即是在运行结束的 return 函数中清除上一个（同一） useEffect）</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">timeout</span><span class="p">)</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">val</span><span class="p">,</span><span class="w"> </span><span class="nx">delay</span><span class="p">])</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">tempVal</span>
<span class="p">}</span>

<span class="c1">// 日常案例，对比理解</span>

<span class="c1">// const debounce = (func, delay) =&gt; {</span>
<span class="c1">//   let timeout;</span>
<span class="c1">//   return () =&gt; {</span>
<span class="c1">//     if (timeout) {</span>
<span class="c1">//       clearTimeout(timeout);</span>
<span class="c1">//     }</span>
<span class="c1">//     timeout = setTimeout(function () {</span>
<span class="c1">//       func()</span>
<span class="c1">//     }, delay)</span>
<span class="c1">//   }</span>
<span class="c1">// }</span>

<span class="c1">// const log = debounce(() =&gt; console.log(&#39;call&#39;), 5000)</span>
<span class="c1">// log()</span>
<span class="c1">// log()</span>
<span class="c1">// log()</span>
<span class="c1">//   ...5s</span>
<span class="c1">// 执行！</span>

<span class="c1">// debounce 原理讲解：</span>
<span class="c1">// 0s ---------&gt; 1s ---------&gt; 2s --------&gt; ...</span>
<span class="c1">//     这三个函数是同步操作，它们一定是在 0~1s 这个时间段内瞬间完成的；</span>
<span class="c1">//     log()#1 // timeout#1</span>
<span class="c1">//     log()#2 // 发现 timeout#1！取消之，然后设置timeout#2</span>
<span class="c1">//     log()#3 // 发现 timeout#2! 取消之，然后设置timeout#3</span>
<span class="c1">//             // 所以，log()#3 结束后，就只有最后一个 —— timeout#3 保留</span>
</code></pre></div>
<p>拓展学习：<a href="https://iseeu.blog.csdn.net/article/details/129306248">【笔记】深度理解并 js 手写不同场景下的防抖函数</a></p>
<ul>
<li>使用了 <code>Custom Hook</code> 后的 <code>src\screens\ProjectList\index.js</code>(<code>lastParam</code> 定义在紧挨 <code>param</code> 后)</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1">// 对 param 进行防抖处理</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">lastParam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useDebounce</span><span class="p">(</span><span class="nx">param</span><span class="p">)</span>
<span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">list</span><span class="p">,</span><span class="w"> </span><span class="nx">setList</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">([]);</span>

<span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">fetch</span><span class="p">(</span>
<span class="w">    </span><span class="c1">// name=${param.name}&amp;personId=${param.personId}</span>
<span class="w">    </span><span class="sb">`</span><span class="si">${</span><span class="nx">apiUrl</span><span class="si">}</span><span class="sb">/projects?</span><span class="si">${</span><span class="nx">qs</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">cleanObject</span><span class="p">(</span><span class="nx">lastParam</span><span class="p">))</span><span class="si">}</span><span class="sb">`</span>
<span class="w">  </span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">setList</span><span class="p">(</span><span class="k">await</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">lastParam</span><span class="p">]);</span>

<span class="nx">useMount</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">apiUrl</span><span class="si">}</span><span class="sb">/users`</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">setUsers</span><span class="p">(</span><span class="k">await</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<p>这样便可 <code>1s</code> 内再次输入不会触发对 <code>projects</code> 的 <code>fetch</code> 请求</p>
<p>拓展学习：<a href="https://blog.csdn.net/qq_32682301/article/details/129383541">【笔记】Custom Hook</a></p>
<h2 id="ts-">三、TS 应用- 强类型<a class="headerlink" href="#ts-" title="Permanent link">&para;</a></h2>
<h3 id="1ts">1.TS 的必要性<a class="headerlink" href="#1ts" title="Permanent link">&para;</a></h3>
<p>作为正常人，我们在开发过程中难免会犯以下错误：</p>
<div class="highlight"><pre><span></span><code>变量名写错
参数少传、多传
数组或对象变量层次弄错
相对 JS 在运行时（runtime）才会发现错误，TS 可以帮助我们在 静态代码 中及时定位错误，将 弱类型 的 JS 转为 强类型 的 TS 能够极大地降低我们编码过程中的误码率
</code></pre></div>
<h3 id="2_1">2.代码更改<a class="headerlink" href="#2_1" title="Permanent link">&para;</a></h3>
<p>将项目中 src 下 js 文件后缀改为 ts，jsx 文件后缀改为 tsx，并对文件代码做如下修改：</p>
<div class="highlight"><pre><span></span><code>有参数的组件使用 interface 声明参数类型
公用类型的可以导出+引入
不明确类型的显性赋予 unknow 类型 (严格版 any)
不确定参数是否会传的使用 ?: 赋予类型
用泛型来规范类型
</code></pre></div>
<ul>
<li><code>src\utils\index.ts</code></li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useEffect</span><span class="p">,</span><span class="w"> </span><span class="nx">useState</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;react&quot;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">isFalsy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">val</span><span class="o">:</span><span class="w"> </span><span class="kt">unknown</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="nx">val</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="o">!</span><span class="nx">val</span><span class="p">);</span>

<span class="c1">// 在函数里，不可用直接赋值的方式改变传入的引用类型变量，清空一个对象的空属性</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">cleanObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">obj</span><span class="o">:</span><span class="w"> </span><span class="kt">object</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="nx">obj</span><span class="w"> </span><span class="p">};</span>
<span class="w">  </span><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">res</span><span class="p">).</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">key</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 忽略下一行的类型检查</span>
<span class="w">    </span><span class="c1">//@ts-ignore </span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">res</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">isFalsy</span><span class="p">(</span><span class="nx">val</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">//@ts-ignore</span>
<span class="w">      </span><span class="ow">delete</span><span class="w"> </span><span class="nx">res</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">});</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">useMount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">cbk</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">cbk</span><span class="p">(),</span><span class="w"> </span><span class="p">[]);</span>

<span class="cm">/**</span>
<span class="cm"> * @param { 值 } val</span>
<span class="cm"> * @param { 延时：默认 1000 } delay</span>
<span class="cm"> * @returns 在某段时间内多次变动后最终拿到的值（delay 延迟的是存储在队列中的上一次变化）</span>
<span class="cm"> */</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">useDebounce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">V</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">val</span><span class="o">:</span><span class="w"> </span><span class="kt">V</span><span class="p">,</span><span class="w"> </span><span class="nx">delay</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1000</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// V 泛型，表示传入与返回类型相同</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">tempVal</span><span class="p">,</span><span class="w"> </span><span class="nx">setTempVal</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="nx">val</span><span class="p">);</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 每次在 val 变化后，设置一个定时器</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">timeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">setTimeout</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setTempVal</span><span class="p">(</span><span class="nx">val</span><span class="p">),</span><span class="w"> </span><span class="nx">delay</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// 每次在上一个 useEffect 处理完以后再运行（useEffect 的天然功能即是在运行结束的 return 函数中清除上一个（同一） useEffect）</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">timeout</span><span class="p">);</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">val</span><span class="p">,</span><span class="w"> </span><span class="nx">delay</span><span class="p">]);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">tempVal</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>
<ul>
<li><code>src\screens\ProjectList\index.jsx</code></li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">SearchPanel</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;./components/SearchPanel&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">List</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;./components/List&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useEffect</span><span class="p">,</span><span class="w"> </span><span class="nx">useState</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;react&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">cleanObject</span><span class="p">,</span><span class="w"> </span><span class="nx">useDebounce</span><span class="p">,</span><span class="w"> </span><span class="nx">useMount</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;utils&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">qs</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;qs&quot;</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">apiUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">REACT_APP_API_URL</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">ProjectListScreen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">users</span><span class="p">,</span><span class="w"> </span><span class="nx">setUsers</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">([]);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">param</span><span class="p">,</span><span class="w"> </span><span class="nx">setParam</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">({</span>
<span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">personId</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="p">});</span>
<span class="w">  </span><span class="c1">// 对 param 进行防抖处理</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">lastParam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useDebounce</span><span class="p">(</span><span class="nx">param</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">list</span><span class="p">,</span><span class="w"> </span><span class="nx">setList</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">([]);</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fetch</span><span class="p">(</span>
<span class="w">      </span><span class="c1">// name=${param.name}&amp;personId=${param.personId}</span>
<span class="w">      </span><span class="sb">`</span><span class="si">${</span><span class="nx">apiUrl</span><span class="si">}</span><span class="sb">/projects?</span><span class="si">${</span><span class="nx">qs</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">cleanObject</span><span class="p">(</span><span class="nx">lastParam</span><span class="p">))</span><span class="si">}</span><span class="sb">`</span>
<span class="w">    </span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">setList</span><span class="p">(</span><span class="k">await</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">lastParam</span><span class="p">]);</span>

<span class="w">  </span><span class="nx">useMount</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">apiUrl</span><span class="si">}</span><span class="sb">/users`</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">setUsers</span><span class="p">(</span><span class="k">await</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">SearchPanel</span><span class="w"> </span><span class="nx">users</span><span class="o">=</span><span class="p">{</span><span class="nx">users</span><span class="p">}</span><span class="w"> </span><span class="nx">param</span><span class="o">=</span><span class="p">{</span><span class="nx">param</span><span class="p">}</span><span class="w"> </span><span class="nx">setParam</span><span class="o">=</span><span class="p">{</span><span class="nx">setParam</span><span class="p">}</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">List</span><span class="w"> </span><span class="nx">users</span><span class="o">=</span><span class="p">{</span><span class="nx">users</span><span class="p">}</span><span class="w"> </span><span class="nx">list</span><span class="o">=</span><span class="p">{</span><span class="nx">list</span><span class="p">}</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>
<ul>
<li><code>src\screens\ProjectList\components\List.jsx</code></li>
</ul>
<div class="highlight"><pre><span></span><code>import { User } from &quot;./SearchPanel&quot;;

interface Project {
  id: string;
  name: string;
  personId: string;
  star: boolean;
  organization: string;
}

interface ListProps {
  users: User[];
  list: Project[];
}

export const List = ({ users, list }: ListProps) =&gt; {
  return (
    &lt;table&gt;
      &lt;thead&gt;
        &lt;tr&gt;
          &lt;th&gt;名称&lt;/th&gt;
          &lt;th&gt;负责人&lt;/th&gt;
        &lt;/tr&gt;
      &lt;/thead&gt;
      &lt;tbody&gt;
        {list.map((project) =&gt; (
          &lt;tr key={project.id}&gt;
            &lt;td&gt;{project.name}&lt;/td&gt;
            {/* undefined.name */}
            &lt;td&gt;
              {users.find((user) =&gt; user.id === project.personId)?.name || &quot;未知&quot;}
            &lt;/td&gt;
          &lt;/tr&gt;
        ))}
      &lt;/tbody&gt;
    &lt;/table&gt;
  );
};
</code></pre></div>
<ul>
<li><code>src\screens\ProjectList\components\SearchPanel.jsx</code></li>
</ul>
<div class="highlight"><pre><span></span><code>export interface User {
  id: string;
  name: string;
  email: string;
  title: string;
  organization: string;
}
interface SearchPanelProps {
  users: User[];
  param: {
    name: string;
    personId: string;
  };
  setParam: (param: SearchPanelProps[&quot;param&quot;]) =&gt; void;
}

export const SearchPanel = ({ users, param, setParam }: SearchPanelProps) =&gt; {
  return (
    &lt;form&gt;
      &lt;div&gt;
        {/* setParam(Object.assign({}, param, { name: evt.target.value })) */}
        &lt;input
          type=&quot;text&quot;
          value={param.name}
          onChange={(evt) =&gt;
            setParam({
              ...param,
              name: evt.target.value,
            })
          }
        /&gt;
        &lt;select
          value={param.personId}
          onChange={(evt) =&gt;
            setParam({
              ...param,
              personId: evt.target.value,
            })
          }
        &gt;
          &lt;option value=&quot;&quot;&gt;负责人&lt;/option&gt;
          {users.map((user) =&gt; (
            &lt;option key={user.id} value={user.id}&gt;
              {user.name}
            &lt;/option&gt;
          ))}
        &lt;/select&gt;
      &lt;/div&gt;
    &lt;/form&gt;
  );
};
</code></pre></div>
<ul>
<li><code>src\App.tsx</code></li>
</ul>
<div class="highlight"><pre><span></span><code>import &quot;./App.css&quot;;
import { ProjectListScreen } from &quot;screens/ProjectList&quot;;

function App() {
  return (
    &lt;div className=&quot;App&quot;&gt;
      &lt;ProjectListScreen /&gt;
    &lt;/div&gt;
  );
}

export default App;
</code></pre></div>
<ul>
<li><a href="https://blog.csdn.net/qq_32682301/article/details/129382797">【实战】用 Custom Hook + TS泛型实现 useArray</a></li>
</ul>
<h2 id="jwt">四、JWT、用户认证与异步请求<a class="headerlink" href="#jwt" title="Permanent link">&para;</a></h2>
<h3 id="1login">1.login<a class="headerlink" href="#1login" title="Permanent link">&para;</a></h3>
<p>增加登录的页面和逻辑</p>
<ul>
<li>新建文件：<code>src\screens\login\index.tsx</code>：</li>
</ul>
<div class="highlight"><pre><span></span><code>import { FormEvent } from &quot;react&quot;;

const apiUrl = process.env.REACT_APP_API_URL;

export const Login = () =&gt; {
  const login = (param: { username: string; password: string }) =&gt; {
    fetch(`${apiUrl}/login`, {
      method: &quot;POST&quot;,
      headers: {
        &quot;Content-Type&quot;: &quot;application/json&quot;,
      },
      body: JSON.stringify(param),
    }).then(async (res) =&gt; {
      if (res.ok) {
        // 登录成功
      }
    });
  };

  // HTMLFormElement extends Element (子类型继承性兼容所有父类型)
  // (鸭子类型：duck typing: 面向接口编程 而非 面向对象编程)
  const handleSubmit = (event: FormEvent&lt;HTMLFormElement&gt;) =&gt; {
    event.preventDefault();
    const username = (event.currentTarget.elements[0] as HTMLFormElement).value;
    const password = (event.currentTarget.elements[1] as HTMLFormElement).value;
    login({ username, password });
  };

  return (
    &lt;form onSubmit={handleSubmit}&gt;
      &lt;div&gt;
        &lt;label htmlFor=&quot;username&quot;&gt;用户名&lt;/label&gt;
        &lt;input type=&quot;text&quot; id=&quot;username&quot; /&gt;
      &lt;/div&gt;
      &lt;div&gt;
        &lt;label htmlFor=&quot;password&quot;&gt;密码&lt;/label&gt;
        &lt;input type=&quot;password&quot; id=&quot;password&quot; /&gt;
      &lt;/div&gt;
      &lt;button type=&quot;submit&quot;&gt;登录&lt;/button&gt;
    &lt;/form&gt;
  );
};
</code></pre></div>
<p><code>src\App.tsx</code> 中引入:</p>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="s2">&quot;./App.css&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Login</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;screens/login&quot;</span><span class="p">;</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">App</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">div</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s2">&quot;App&quot;</span><span class="o">&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">Login</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">App</span><span class="p">;</span>
</code></pre></div>
<p>目前页面点击登录 404，下一步配置 <code>json-server</code> 中间件，使其可以模拟 非 restful 接口</p>
<h3 id="2middleware-of-json-server">2.middleware of json-server<a class="headerlink" href="#2middleware-of-json-server" title="Permanent link">&para;</a></h3>
<p>json-server 中间件，模拟请求和返回数据</p>
<ul>
<li>新建文件：<code>__json_server_mock__\middleware.js</code>：</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">method</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;POST&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">path</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;/login&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">username</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;user&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">password</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;123&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">200</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span>
<span class="w">        </span><span class="nx">user</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nx">token</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;token123&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">400</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span><span class="w"> </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;用户名或者密码错误&quot;</span><span class="w"> </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="nx">next</span><span class="p">();</span>
<span class="p">};</span>
</code></pre></div>
<ul>
<li>配置 <code>package.json</code> 中 <code>json-server</code> 的 <code>script</code>：</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nt">&quot;json-server&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;json-server __json_server_mock__/db.json -w -p 3001 --middlewares ./__json_server_mock__/middleware.js&quot;</span>
</code></pre></div>
<ul>
<li>配置完后重新启动 <code>json-server</code> ,输入中间件预置用户名和密码即可正常访问（200），否则（400：bad request）</li>
</ul>
<h3 id="3jira-dev-toolimooc-jira-tool">3.jira-dev-tool（imooc-jira-tool）<a class="headerlink" href="#3jira-dev-toolimooc-jira-tool" title="Permanent link">&para;</a></h3>
<p><a href="https://www.npmjs.com/package/jira-dev-tool">jira-dev-tool - npm</a></p>
<ul>
<li>首先确认 git 工作区 clean，安装 jira-dev-tool（imooc-jira-tool）</li>
<li>引入到 <code>src\index.tsx</code></li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">loadDevTools</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;jira-dev-tool&quot;</span><span class="p">;</span>

<span class="nx">loadDevTools</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">React</span><span class="p">.</span><span class="na">StrictMode</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">AppProviders</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">App</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">AppProviders</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">React</span><span class="p">.</span><span class="na">StrictMode</span><span class="p">&gt;,</span>
<span class="w">    </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;root&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<p>问题1: 安装 jira-dev-tool（imooc-jira-tool）后启动项目<a href="https://so.csdn.net/so/search?q=联调&amp;spm=1001.2101.3001.7020">联调</a>可能会出现的问题</p>
<ul>
<li>报错：<code>request (TypeError: Failed to fetch). This is probably not a problem with Mock Service Worker. There is likely an additional logging output above.</code></li>
<li>解决：npx msw init ./public/ --save</li>
</ul>
<p>问题二: 由于 jira-dev-tool 已经两年没有更新了，且依赖 react@“^16.0.0”, 若要继续使用，在 npm i 时会有如下报错：</p>
<div class="highlight"><pre><span></span><code>npm ERR! code ERESOLVE
npm ERR! ERESOLVE unable to resolve dependency tree
npm ERR! 
npm ERR! While resolving: jira@0.1.0
npm ERR! Found: react@18.2.0
npm ERR! node_modules/react
npm ERR!   react@&quot;^18.2.0&quot; from the root project
npm ERR!
npm ERR! Could not resolve dependency:
npm ERR! peer react@&quot;^16.0.0&quot; from jira-dev-tool@1.7.61       
npm ERR! node_modules/jira-dev-tool
npm ERR!   jira-dev-tool@&quot;^1.7.61&quot; from the root project      
npm ERR!
npm ERR! Fix the upstream dependency conflict, or retry       
npm ERR! this command with --force or --legacy-peer-deps      
npm ERR! to accept an incorrect (and potentially broken) dependency resolution.
npm ERR!
npm ERR!
npm ERR! For a full report see:
npm ERR! C:\...\npm-cache\_logs\2023-03-08T09_11_24_998Z-eresolve-report.txt

npm ERR! A complete log of this run can be found in:
npm ERR! C:\...\npm-cache\_logs\2023-03-08T09_11_24_998Z-debug-0.log
</code></pre></div>
<p>解决方案一：</p>
<ul>
<li>删掉文件 yarn.lock，以及package.json 中的 <code>"jira-dev-tool": "^1.7.61",</code> 部分，jira-dev-tool 手动安装</li>
</ul>
<p>解决方案二（推荐）</p>
<ul>
<li>使用 <code>yarn</code> 代替 <code>npm i</code></li>
</ul>
<p>使用</p>
<p>开发者工具用 MSW 以 Service Worker 为原理实现了"分布式后端"。后端逻辑处理后，以localStorage为数据库进行增删改查操作。浏览器上安装了一个独立的后端服务和数据库，再也不受任何中心化服务的影响 点击’清空数据库’便可以重置后端服务。可以精准地控制 HTTP请求的时间、失败概率、失败规则</p>
<p>Service Worker + localStorage虽然本质上与传统后端服务并不同，但丝毫不会影响前端开发</p>
<p>其他具体操作可见文档以及接下来的操作：<a href="https://www.npmjs.com/package/jira-dev-tool">jira-dev-tool - npm</a></p>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Service_Worker_API">Service Worker API - Web API 接口参考 | MDN</a></p>
<p>安装好后进入<code>/login</code>,请求login接口，可以看到状态码后带有（from service worker）字样即成功连接：</p>
<h3 id="4jwtauth-provider">4.JWT原理与auth-provider实现<a class="headerlink" href="#4jwtauth-provider" title="Permanent link">&para;</a></h3>
<p>注册一个新用户</p>
<ul>
<li>修改：</li>
</ul>
<div class="highlight"><pre><span></span><code>src\screens\login\index.tsx
</code></pre></div>
<ul>
<li>调用接口 <code>login</code> 改为 <code>register</code>；</li>
<li>按钮 <strong>登录</strong> 改为 <strong>注册</strong></li>
</ul>
<p>注册一个新用户 jira（密码：jira），接口返回：</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;user&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2087569429</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;jira&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;token&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;MjA4NzU2OTQyOQ==&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>token 即是 JWT(JSON Web Tokens) 的产物</p>
<blockquote>
<ul>
<li><a href="https://jwt.io/">JSON Web Tokens - jwt.io</a></li>
</ul>
</blockquote>
<p>auth-provider</p>
<p>修改 <code>src\screens\ProjectList\components\SearchPanel.tsx</code>，为 <code>User</code> 新增 <code>token</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">export</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nx">User</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">organization</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">token</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span><span class="w"> </span><span class="c1">// 新增字段</span>
<span class="p">}</span>
</code></pre></div>
<p>新建 <code>src\auth-provider.ts</code>：</p>
<p>模拟第三方服务</p>
<div class="highlight"><pre><span></span><code><span class="c1">// 在真实环境中，如果使用了 firebase 这种第三方 auth 服务的话，本文件不需要开发者开发</span>

<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">User</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;screens/ProjectList/components/SearchPanel&quot;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">localStorageKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;__auth_provider_token__&#39;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">apiUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">REACT_APP_API_URL</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">getToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="nx">localStorageKey</span><span class="p">)</span>

<span class="c1">// 处理用户响应——存储到浏览器本地</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleUserResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">({</span><span class="nx">user</span><span class="p">}</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">user</span><span class="o">:</span><span class="w"> </span><span class="nx">User</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="nx">localStorageKey</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">token</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">user</span>
<span class="p">}</span>

<span class="c1">// 登录逻辑</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">login</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">username</span><span class="o">:</span><span class="w"> </span><span class="nx">string</span><span class="p">,</span><span class="w"> </span><span class="nx">password</span><span class="o">:</span><span class="w"> </span><span class="nx">string</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">apiUrl</span><span class="si">}</span><span class="sb">/login`</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;POST&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="s2">&quot;Content-Type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">),</span>
<span class="w">  </span><span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">handleUserResponse</span><span class="p">(</span><span class="k">await</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nb">Promise</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">}</span>

<span class="c1">// 注册逻辑</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">register</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">username</span><span class="o">:</span><span class="w"> </span><span class="nx">string</span><span class="p">,</span><span class="w"> </span><span class="nx">password</span><span class="o">:</span><span class="w"> </span><span class="nx">string</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">apiUrl</span><span class="si">}</span><span class="sb">/register`</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;POST&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="s2">&quot;Content-Type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">),</span>
<span class="w">  </span><span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">handleUserResponse</span><span class="p">(</span><span class="k">await</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nb">Promise</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">}</span>

<span class="c1">// 登出逻辑-直接更改本地配置</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">logout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">removeItem</span><span class="p">(</span><span class="nx">localStorageKey</span><span class="p">)</span>
</code></pre></div>
<p>细节点：</p>
<p>函数定义时，值前添加 async 使其返回一个 Promise 对象</p>
<p>回调函数入参和回调函数内有且只有一个函数调用且它的入参与回调函数入参一致，该回调函数可直接简写为其内部的函数调用且不带参（这是函数式编程-PointFree的一种应用）：</p>
<div class="highlight"><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">login</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">form</span><span class="o">:</span><span class="w"> </span><span class="nx">AuthForm</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">auth</span><span class="p">.</span><span class="nx">login</span><span class="p">(</span><span class="nx">form</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">user</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setUser</span><span class="p">(</span><span class="nx">user</span><span class="p">));</span>
<span class="p">}</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">login</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">form</span><span class="o">:</span><span class="w"> </span><span class="nx">AuthForm</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">auth</span><span class="p">.</span><span class="nx">login</span><span class="p">(</span><span class="nx">form</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">setUser</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="5usecontextuserloginregisterlogout">5.useContext(user,login,register,logout)<a class="headerlink" href="#5usecontextuserloginregisterlogout" title="Permanent link">&para;</a></h3>
<p>上下文组件</p>
<p>新建 <code>src\context\auth-context.tsx</code>：</p>
<div class="highlight"><pre><span></span><code>import React, { ReactNode, useState } from &quot;react&quot;
import * as auth from &#39;auth-provider&#39;
import { User } from &quot;screens/ProjectList/components/SearchPanel&quot;

// 表单授权接口（auth）
interface AuthForm {
  username: string,
  password: string
}

// 授权上下文（包括登录，注册，登出接口）
const AuthContext = React.createContext&lt;{
  user: User | null,
  login: (form : AuthForm) =&gt; Promise&lt;void&gt;,
  register: (form : AuthForm) =&gt; Promise&lt;void&gt;,
  logout: () =&gt; Promise&lt;void&gt;,
} | undefined&gt;(undefined)

AuthContext.displayName = &#39;AuthContext&#39;

// 提供授权组件（参数是 children）
export const AuthProvider = ({children}:{children: ReactNode}) =&gt; {
  // 这里要考虑到初始值的类型与后续值类型，取并组成一个泛型
  const [user, setUser] = useState&lt;User | null&gt;(null)

  const login = (form: AuthForm) =&gt; auth.login(form).then(user =&gt; setUser(user))
  const register = (form: AuthForm) =&gt; auth.register(form).then(user =&gt; setUser(user))
  const logout = () =&gt; auth.logout().then(() =&gt; setUser(null))

  return &lt;AuthContext.Provider children={children} value={{ user, login, register, logout }}/&gt;
}

export const useAuth = () =&gt; {
  const context = React.useContext(AuthContext)
  if (!context) {
    throw new Error(&#39;useAuth 必须在 AuthProvider 中使用&#39;)
  }
  return context
}
</code></pre></div>
<p>新建 <code>src\context\index.tsx</code>：</p>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ReactNode</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;react&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">AuthProvider</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;./auth-context&quot;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">AppProvider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">({</span><span class="nx">children</span><span class="p">}</span><span class="o">:</span><span class="p">{</span><span class="nx">children</span><span class="o">:</span><span class="w"> </span><span class="kt">ReactNode</span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">AuthProvider</span><span class="o">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="nx">children</span><span class="p">}</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/AuthProvider&gt;</span>
<span class="w">  </span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p>在项目中使用 <code>AppProvider</code>，修改 <code>src\index.tsx</code>：</p>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">AppProvider</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;context&quot;</span><span class="p">;</span>

<span class="nx">loadDevTools</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">root</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span>
<span class="w">    </span><span class="c1">// &lt;React.StrictMode&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">AppProvider</span><span class="o">&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">App</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/AppProvider&gt;</span>
<span class="w">    </span><span class="c1">// &lt;/React.StrictMode&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<p>修改 <code>src\screens\login\index.tsx</code>，调用 <code>useAuth</code> 中的 <code>login</code>，并使用之前注册的账号 <code>jira(jira)</code> 验证：</p>
<div class="highlight"><pre><span></span><code>import { useAuth } from &quot;context/auth-context&quot;;
import { FormEvent } from &quot;react&quot;;

export const Login = () =&gt; {
  const {login, user} = useAuth()
  // HTMLFormElement extends Element (子类型继承性兼容所有父类型)
  const handleSubmit = (event: FormEvent&lt;HTMLFormElement&gt;) =&gt; {...};
  return (
    &lt;form onSubmit={handleSubmit}&gt;
      &lt;div&gt;
        {user ? &lt;div&gt;登录成功，用户名{user?.name}&lt;/div&gt; : null}
      &lt;/div&gt;
      &lt;div&gt;
        &lt;label htmlFor=&quot;username&quot;&gt;用户名&lt;/label&gt;
        &lt;input type=&quot;text&quot; id=&quot;username&quot; /&gt;
      &lt;/div&gt;
      &lt;div&gt;
        &lt;label htmlFor=&quot;password&quot;&gt;密码&lt;/label&gt;
        &lt;input type=&quot;password&quot; id=&quot;password&quot; /&gt;
      &lt;/div&gt;
      &lt;button type=&quot;submit&quot;&gt;登录&lt;/button&gt;
    &lt;/form&gt;
  );
};
</code></pre></div>
<h3 id="6useauth">6.用useAuth切换登录与非登录状态<a class="headerlink" href="#6useauth" title="Permanent link">&para;</a></h3>
<p>将 <strong>登录态</strong> 页面和 <strong>非登录态</strong> 页面分别整合（过程稀碎。。）：</p>
<ul>
<li>新建文件夹及下面文件：<code>unauthenticated-app</code></li>
<li><code>index.tsx</code></li>
</ul>
<div class="highlight"><pre><span></span><code>import { useState } from &quot;react&quot;;
import { Login } from &quot;./login&quot;;
import { Register } from &quot;./register&quot;;

export const UnauthenticatedApp = () =&gt; {
  const [isRegister, setIsRegister] = useState(false);
  return (
    &lt;div&gt;
      {isRegister ? &lt;Register /&gt; : &lt;Login /&gt;}
      &lt;button onClick={() =&gt; setIsRegister(!isRegister)}&gt;
        切换到{isRegister ? &quot;登录&quot; : &quot;注册&quot;}
      &lt;/button&gt;
    &lt;/div&gt;
  );
};
</code></pre></div>
<ul>
<li><code>login.tsx</code>（把 <code>src\screens\login\index.tsx</code> 剪切并更名）</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useAuth</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;context/auth-context&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">FormEvent</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;react&quot;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">Login</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">login</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useAuth</span><span class="p">();</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleSubmit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="o">:</span><span class="w"> </span><span class="kt">FormEvent</span><span class="o">&lt;</span><span class="nx">HTMLFormElement</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">.</span><span class="nx">elements</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">HTMLFormElement</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">.</span><span class="nx">elements</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">HTMLFormElement</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>
<span class="w">    </span><span class="nx">login</span><span class="p">({</span><span class="w"> </span><span class="nx">username</span><span class="p">,</span><span class="w"> </span><span class="nx">password</span><span class="w"> </span><span class="p">});</span>
<span class="w">  </span><span class="p">};</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">form</span><span class="w"> </span><span class="nx">onSubmit</span><span class="o">=</span><span class="p">{</span><span class="nx">handleSubmit</span><span class="p">}</span><span class="o">&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">label</span><span class="w"> </span><span class="nx">htmlFor</span><span class="o">=</span><span class="s2">&quot;username&quot;</span><span class="o">&gt;</span><span class="nx">用户名</span><span class="o">&lt;</span><span class="err">/label&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">input</span><span class="w"> </span><span class="kr">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="w"> </span><span class="nx">id</span><span class="o">=</span><span class="s2">&quot;username&quot;</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">label</span><span class="w"> </span><span class="nx">htmlFor</span><span class="o">=</span><span class="s2">&quot;password&quot;</span><span class="o">&gt;</span><span class="nx">密码</span><span class="o">&lt;</span><span class="err">/label&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">input</span><span class="w"> </span><span class="kr">type</span><span class="o">=</span><span class="s2">&quot;password&quot;</span><span class="w"> </span><span class="nx">id</span><span class="o">=</span><span class="s2">&quot;password&quot;</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">button</span><span class="w"> </span><span class="kr">type</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span><span class="o">&gt;</span><span class="nx">登录</span><span class="o">&lt;</span><span class="err">/button&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/form&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>
<ul>
<li><code>register.tsx</code>（把 <code>src\screens\login\index.tsx</code> 剪切并更名，代码中 <code>login</code> 相关改为 <code>register</code>）</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useAuth</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;context/auth-context&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">FormEvent</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;react&quot;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">Register</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">register</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useAuth</span><span class="p">();</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleSubmit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="o">:</span><span class="w"> </span><span class="kt">FormEvent</span><span class="o">&lt;</span><span class="nx">HTMLFormElement</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">.</span><span class="nx">elements</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">HTMLFormElement</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">.</span><span class="nx">elements</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">HTMLFormElement</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>
<span class="w">    </span><span class="nx">register</span><span class="p">({</span><span class="w"> </span><span class="nx">username</span><span class="p">,</span><span class="w"> </span><span class="nx">password</span><span class="w"> </span><span class="p">});</span>
<span class="w">  </span><span class="p">};</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">form</span><span class="w"> </span><span class="nx">onSubmit</span><span class="o">=</span><span class="p">{</span><span class="nx">handleSubmit</span><span class="p">}</span><span class="o">&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">label</span><span class="w"> </span><span class="nx">htmlFor</span><span class="o">=</span><span class="s2">&quot;username&quot;</span><span class="o">&gt;</span><span class="nx">用户名</span><span class="o">&lt;</span><span class="err">/label&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">input</span><span class="w"> </span><span class="kr">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="w"> </span><span class="nx">id</span><span class="o">=</span><span class="s2">&quot;username&quot;</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">label</span><span class="w"> </span><span class="nx">htmlFor</span><span class="o">=</span><span class="s2">&quot;password&quot;</span><span class="o">&gt;</span><span class="nx">密码</span><span class="o">&lt;</span><span class="err">/label&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">input</span><span class="w"> </span><span class="kr">type</span><span class="o">=</span><span class="s2">&quot;password&quot;</span><span class="w"> </span><span class="nx">id</span><span class="o">=</span><span class="s2">&quot;password&quot;</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">button</span><span class="w"> </span><span class="kr">type</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span><span class="o">&gt;</span><span class="nx">注册</span><span class="o">&lt;</span><span class="err">/button&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/form&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>
<ul>
<li>删掉目录：<code>src\screens\login</code></li>
<li>新建文件：<code>authenticated-app.tsx</code></li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useAuth</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;context/auth-context&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ProjectList</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;screens/ProjectList&quot;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">AuthenticatedApp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">logout</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useAuth</span><span class="p">();</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">button</span><span class="w"> </span><span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">logout</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">登出</span><span class="o">&lt;</span><span class="err">/button&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">ProjectList</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>
<ul>
<li>修改 <code>src\App.tsx</code>（根据是否可以获取到 <code>user</code> 信息，决定展示 <strong>登录态</strong> 还是 <strong>非登录态</strong> 页面）</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">AuthenticatedApp</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;authenticated-app&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useAuth</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;context/auth-context&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">UnauthenticatedApp</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;unauthenticated-app&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="s2">&quot;./App.css&quot;</span><span class="p">;</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">App</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useAuth</span><span class="p">();</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">div</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s2">&quot;App&quot;</span><span class="o">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="nx">user</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">AuthenticatedApp</span><span class="w"> </span><span class="o">/&gt;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">UnauthenticatedApp</span><span class="w"> </span><span class="o">/&gt;</span><span class="p">}</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">App</span><span class="p">;</span>
</code></pre></div>
<p>查看页面，尝试功能：切换登录/注册，正常/登录：login 正常，但是 projects 和 users 接口 401（A token must be provided） F12 控制台查看 <strong>auth_provider_token</strong> (Application - Storage - Local Storage - <a href="http://localhost:3000">http://localhost:3000</a>)：注册：正常，默认直接登录（同登录，存储 <code>user</code>）</p>
<h3 id="7fetchhttp">7.用fetch抽象通用HTTP请求方法，增强通用性<a class="headerlink" href="#7fetchhttp" title="Permanent link">&para;</a></h3>
<ul>
<li>新建：<code>src\utils\http.ts</code></li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nx">qs</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;qs&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">auth</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;auth-provider&#39;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">apiUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">REACT_APP_API_URL</span><span class="p">;</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">HttpConfig</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nx">RequestInit</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">data?</span><span class="o">:</span><span class="w"> </span><span class="kt">object</span><span class="p">,</span>
<span class="w">  </span><span class="nx">token?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">http</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">funcPath</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">token</span><span class="p">,</span><span class="w"> </span><span class="nx">headers</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="nx">customConfig</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="nx">HttpConfig</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">httpConfig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;GET&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">Authorization</span><span class="o">:</span><span class="w"> </span><span class="kt">token</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="sb">`Bearer </span><span class="si">${</span><span class="nx">token</span><span class="si">}</span><span class="sb">`</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;application/json&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">...</span><span class="nx">customConfig</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">httpConfig</span><span class="p">.</span><span class="nx">method</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">()</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;GET&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">funcPath</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="sb">`?</span><span class="si">${</span><span class="nx">qs</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">httpConfig</span><span class="p">.</span><span class="nx">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">{})</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// axios 和 fetch 不同，axios 会在 状态码 不为 2xx 时，自动抛出异常，fetch 需要 手动处理</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">apiUrl</span><span class="si">}</span><span class="sb">/</span><span class="si">${</span><span class="nx">funcPath</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span><span class="w"> </span><span class="nx">httpConfig</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="nx">res</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">401</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// 自动退出 并 重载页面</span>
<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">auth</span><span class="p">.</span><span class="nx">logout</span><span class="p">()</span>
<span class="w">      </span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">reload</span><span class="p">()</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nb">Promise</span><span class="p">.</span><span class="nx">reject</span><span class="p">({</span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;请重新登录！&#39;</span><span class="p">})</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">()</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">data</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nb">Promise</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">})</span>
<span class="p">}</span>
</code></pre></div>
<p>类型定义思路：按住 Ctrl ，点进 fetch，可见：<code>fetch(input: RequestInfo | URL, init?: RequestInit): Promise&lt;Response&gt;;</code>，因此第二个参数即为 RequestInit 类型，但由于有自定义入参，因此自定义个继承 RequestInit 的类型</p>
<p>customConfig 会覆盖前面已有属性</p>
<p>需要手动区别 get 和 post 不同的携参方式</p>
<p>axios 和 fetch 不同，axios 会在 状态码 不为 2xx 时，自动抛出异常，fetch 需要 手动处理</p>
<p>留心 Authorization (授权)不要写成 Authentication (认证)，否则后面会报401，且很难找出问题所在</p>
<h3 id="8usehttpjwt">8.用useHttp管理JWT和登录状态，保持登录状态<a class="headerlink" href="#8usehttpjwt" title="Permanent link">&para;</a></h3>
<ul>
<li>为了使请求接口时能够自动携带 token 定义 useHttp: <code>src\utils\http.ts</code></li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">http</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="nx">funcPath</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span>
<span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">token</span><span class="p">,</span><span class="w"> </span><span class="nx">headers</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="nx">customConfig</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="nx">HttpConfig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="c1">// 参数有 默认值 会自动变为 可选参数</span>
<span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{...}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">useHttp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useAuth</span><span class="p">()</span>
<span class="w">  </span><span class="c1">// TODO 学习 TS 操作符</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(...[</span><span class="nx">funcPath</span><span class="p">,</span><span class="w"> </span><span class="nx">customConfig</span><span class="p">]</span><span class="o">:</span><span class="w"> </span><span class="nx">Parameters</span><span class="o">&lt;</span><span class="ow">typeof</span><span class="w"> </span><span class="nx">http</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">http</span><span class="p">(</span><span class="nx">funcPath</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="nx">customConfig</span><span class="p">,</span><span class="w"> </span><span class="nx">token</span><span class="o">:</span><span class="w"> </span><span class="kt">user?.token</span><span class="w"> </span><span class="p">})</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>函数定义时参数设定 <strong>默认值</strong>，该参数即为 <strong>可选参数</strong></li>
<li>参数可以解构赋值后使用 rest 操作符降维，实现多参</li>
<li>
<p><code>Parameters</code> 操作符可以将函数入参类型复用</p>
</li>
<li>
<p>在 <code>src\screens\ProjectList\index.tsx</code> 中使用 <code>useHttp</code>(部分原有代码省略)：</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useHttp</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;utils/http&quot;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">ProjectList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useHttp</span><span class="p">()</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// React Hook &quot;useHttp&quot; cannot be called inside a callback. React Hooks must be called in a React function component or a custom React Hook function.</span>
<span class="w">    </span><span class="nx">client</span><span class="p">(</span><span class="s1">&#39;projects&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="kt">cleanObject</span><span class="p">(</span><span class="nx">lastParam</span><span class="p">)}).</span><span class="nx">then</span><span class="p">(</span><span class="nx">setList</span><span class="p">)</span>
<span class="w">    </span><span class="c1">// React Hook useEffect has a missing dependency: &#39;client&#39;. Either include it or remove the dependency array.</span>
<span class="w">  </span><span class="c1">// eslint-disable-next-line react-hooks/exhaustive-deps</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">lastParam</span><span class="p">]);</span><span class="w"> </span>

<span class="w">  </span><span class="nx">useMount</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">client</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">setUsers</span><span class="p">));</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(...);</span>
<span class="p">};</span>
</code></pre></div>
<p>useHttp 不能在 useEffect 的 callback 中直接使用，否则会报错：React Hook "useHttp" cannot be called inside a callback. React Hooks must be called in a React function component or a custom React Hook function.，建议如代码中所示使用（client 即 携带 token 的 http 函数）</p>
<p>依赖中只有 lastParam ，会警告：React Hook useEffect has a missing dependency: 'client'. Either include it or remove the dependency array.，但是添加 client 会无法通过相等检查并导致无限的重新渲染循环。（当前代码中最优解是添加 eslint 注释，其他可参考但不适用：<a href="https://www.cnblogs.com/chuckQu/p/16608977.html">https://www.cnblogs.com/chuckQu/p/16608977.html</a>）</p>
<ul>
<li>检验成果：登录即可见 <code>projects</code> 和 <code>users</code> 接口 <code>200</code>，即正常携带 <code>token</code>，但是当前页面刷新就会退出登录（<code>user</code> 初始值为 <code>null</code>），接下来优化初始化 <code>user</code>(<code>src\context\auth-context.tsx</code>)：</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">http</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;utils/http&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useMount</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;utils&quot;</span><span class="p">;</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">AuthForm</span><span class="w"> </span><span class="p">{...}</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">initUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">auth</span><span class="p">.</span><span class="nx">getToken</span><span class="p">()</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">token</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 由于要自定义 token ，这里使用 http 而非 useHttp</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">http</span><span class="p">(</span><span class="s1">&#39;me&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">token</span><span class="w"> </span><span class="p">})</span>
<span class="w">    </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">user</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">user</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">AuthProvider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">({</span><span class="w"> </span><span class="nx">children</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">children</span><span class="o">:</span><span class="w"> </span><span class="kt">ReactNode</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">...</span>
<span class="w">  </span><span class="nx">useMount</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">initUser</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">setUser</span><span class="p">))</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(...);</span>
<span class="p">};</span>
</code></pre></div>
<p>思路分析：定义 <code>initUser</code> ，并在 <code>AuthProvider</code> 组件 挂载时调用，以确保只要在 <code>localStorage</code> 中存在 <code>token</code>（未登出或清除），即可获取并通过预设接口 <code>me</code> 拿到 <code>user</code> ，完成初始化</p>
<p>至此为止，注册登录系统（功能）闭环</p>
<h3 id="9tspartialomit">9.TS的联合类型、Partial和Omit介绍<a class="headerlink" href="#9tspartialomit" title="Permanent link">&para;</a></h3>
<p>联合类型：type1 | type2</p>
<p>交叉类型：type1 &amp; type2</p>
<p>类型别名： type typeName = typeValue</p>
<p>类型别名在很多情况下可以和 interface 互换，但是两种情况例外：</p>
<div class="highlight"><pre><span></span><code>typeValue 涉及交叉/联合类型
typeValue 涉及 Utility Types (工具类型)
</code></pre></div>
<p>TS 中的 typeof 用来操作类型，在静态代码中使用（JS 的 typeof 在代码运行时(runtime)起作用），最终编译成的 JS 代码不会包含 typeof 字样</p>
<p>Utility Types(工具类型) 的用法：用泛型的形式传入一个类型（typeName 或 typeof functionName）然后进行类型操作</p>
<p>常用 Utility Types ：</p>
<ul>
<li>Partial：将每个子类型转换为可选类型</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * Make all properties in T optional</span>
<span class="cm"> */</span>
<span class="kr">type</span><span class="w"> </span><span class="nx">Partial</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">[</span><span class="nx">P</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">keyof</span><span class="w"> </span><span class="nx">T</span><span class="p">]</span><span class="nx">?</span><span class="o">:</span><span class="w"> </span><span class="kt">T</span><span class="p">[</span><span class="nx">P</span><span class="p">];</span>
<span class="p">};</span>
</code></pre></div>
<ul>
<li><code>Omit</code>：删除父类型中的指定子类型并返回新类型</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * Construct a type with the properties of T except for those in type K.</span>
<span class="cm"> */</span>
<span class="kr">type</span><span class="w"> </span><span class="nx">Omit</span><span class="o">&lt;</span><span class="nx">T</span><span class="p">,</span><span class="w"> </span><span class="nx">K</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nx">keyof</span><span class="w"> </span><span class="nx">any</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Pick</span><span class="o">&lt;</span><span class="nx">T</span><span class="p">,</span><span class="w"> </span><span class="nx">Exclude</span><span class="o">&lt;</span><span class="nx">keyof</span><span class="w"> </span><span class="nx">T</span><span class="p">,</span><span class="w"> </span><span class="nx">K</span><span class="o">&gt;&gt;</span><span class="p">;</span>
</code></pre></div>
<p>案例：</p>
<div class="highlight"><pre><span></span><code><span class="kr">type</span><span class="w"> </span><span class="nx">Person</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span>
<span class="w">  </span><span class="nx">age</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">,</span>
<span class="w">  </span><span class="nx">job</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">salary</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">CustomPerson</span><span class="o">:</span><span class="w"> </span><span class="kt">Partial</span><span class="o">&lt;</span><span class="nx">Person</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">OnlyJobPerson</span><span class="o">:</span><span class="w"> </span><span class="kt">Omit</span><span class="o">&lt;</span><span class="nx">Person</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;name&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;age&#39;</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">job</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">salary</span><span class="o">:</span><span class="w"> </span><span class="kt">3000</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>
<h3 id="10ts-utility-types-pickexcludepartial-omit">10.TS 的 <a href="https://so.csdn.net/so/search?q=Utility&amp;spm=1001.2101.3001.7020">Utility</a> Types-Pick、Exclude、Partial 和 Omit 实现<a class="headerlink" href="#10ts-utility-types-pickexcludepartial-omit" title="Permanent link">&para;</a></h3>
<ul>
<li><code>Pick</code>：经过 泛型约束 生成一个新类型（理解为子类型？）</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * From T, pick a set of properties whose keys are in the union K</span>
<span class="cm"> */</span>
<span class="kr">type</span><span class="w"> </span><span class="nx">Pick</span><span class="o">&lt;</span><span class="nx">T</span><span class="p">,</span><span class="w"> </span><span class="nx">K</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nx">keyof</span><span class="w"> </span><span class="nx">T</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">[</span><span class="nx">P</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">K</span><span class="p">]</span><span class="o">:</span><span class="w"> </span><span class="nx">T</span><span class="p">[</span><span class="nx">P</span><span class="p">];</span>
<span class="p">};</span>
</code></pre></div>
<ul>
<li><code>Exclude</code>： 如果 <code>T</code> 是 <code>U</code> 的子类型则返回 <code>never</code> 不是则返回 <code>T</code></li>
</ul>
<div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * Exclude from T those types that are assignable to U</span>
<span class="cm"> */</span>
<span class="kr">type</span><span class="w"> </span><span class="nx">Exclude</span><span class="o">&lt;</span><span class="nx">T</span><span class="p">,</span><span class="w"> </span><span class="nx">U</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">T</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nx">U</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">never</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">T</span><span class="p">;</span>
</code></pre></div>
<ul>
<li><code>keyof</code>：索引类型查询操作符(对于任何类型 <code>T</code>，<code>keyof T</code>的结果为 <code>T</code> 上已知的公共属性名的联合。)</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nx">man</span><span class="o">:</span><span class="w"> </span><span class="kt">keyof</span><span class="w"> </span><span class="nx">Person</span>
<span class="c1">// 相当于 let man: &#39;name&#39; | &#39;age&#39; | &#39;job&#39;</span>
<span class="c1">// keyof Man === &#39;name&#39; | &#39;age&#39; | &#39;job&#39; // true ???</span>
</code></pre></div>
<p><code>T[K]</code>：索引访问操作符（需要确保类型变量 <code>K extends keyof T</code>）</p>
<p><code>in</code>：遍历</p>
<p><code>extends</code>：泛型约束</p>
<p><code>TS</code> 在一定程度上可以理解为：类型约束系统</p>
<p>——看到这里——</p>
<h2 id="css-in-js">五、用 CSS-in-JS 添加样式<a class="headerlink" href="#css-in-js" title="Permanent link">&para;</a></h2>
<h3 id="1antdemotion">1.antd+emotion<a class="headerlink" href="#1antdemotion" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>npm<span class="w"> </span>i<span class="w"> </span>antd<span class="w"> </span>--force
</code></pre></div>
<ul>
<li><code>jira-dev-tool</code> 依赖树中包含 antd，可尝试不安装直接使用</li>
<li>
<p>鉴于 <code>jira-dev-tool</code> 长时间没有更新，依赖树有较多问题，建议清理 <code>node_modules</code>，执行 <code>npm i --force</code> 重新安装依赖</p>
</li>
<li>
<p>在 <code>src\index.tsx</code> 中引入 <code>antd.less</code>（一定要在 <code>jira-dev-tool</code> 之后引入，以便后续修改主题样式能够覆盖到 <code>jira-dev-tool</code>）</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">loadDevTools</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;jira-dev-tool&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="s1">&#39;antd/dist/antd.less&#39;</span>
</code></pre></div>
<h5 id="craco">安装 craco<a class="headerlink" href="#craco" title="Permanent link">&para;</a></h5>
<p>为对 <code>create-react-app</code> 进行自定义配置，需要安装 <code>craco</code> 和它的子依赖 <code>craco-less</code>:</p>
<div class="highlight"><pre><span></span><code>npm<span class="w"> </span>i<span class="w"> </span>@craco/craco<span class="w"> </span>--force
npm<span class="w"> </span>i<span class="w"> </span>-D<span class="w"> </span>craco-less<span class="w"> </span>--force
</code></pre></div>
<p><a href="https://4x.ant.design/docs/react/use-with-create-react-app-cn#高级配置">https://4x.ant.design/docs/react/use-with-create-react-app-cn#高级配置</a></p>
<ul>
<li>按文档中，替换 <code>package.json</code> 中脚本指令</li>
</ul>
<div class="highlight"><pre><span></span><code>&quot;scripts&quot;: {
<span class="gd">-   &quot;start&quot;: &quot;react-scripts start&quot;,</span>
<span class="gd">-   &quot;build&quot;: &quot;react-scripts build&quot;,</span>
<span class="gd">-   &quot;test&quot;: &quot;react-scripts test&quot;,</span>
<span class="gi">+   &quot;start&quot;: &quot;craco start&quot;,</span>
<span class="gi">+   &quot;build&quot;: &quot;craco build&quot;,</span>
<span class="gi">+   &quot;test&quot;: &quot;craco test&quot;,</span>
}
</code></pre></div>
<p>项目根目录下新建文件 <code>craco.config.js</code>，复制文档中对应部分代码，并配置需要修改的主题变量：</p>
<div class="highlight"><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">CracoLessPlugin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;craco-less&#39;</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">plugins</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nx">plugin</span><span class="o">:</span><span class="w"> </span><span class="nx">CracoLessPlugin</span><span class="p">,</span>
<span class="w">      </span><span class="nx">options</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">lessLoaderOptions</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nx">lessOptions</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">modifyVars</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s1">&#39;@primary-color&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;rgb(0, 82, 204)&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;@font-size-base&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;16px&#39;</span><span class="w"> </span><span class="p">},</span>
<span class="w">            </span><span class="nx">javascriptEnabled</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">          </span><span class="p">},</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">  </span><span class="p">],</span>
<span class="p">};</span>
</code></pre></div>
<ul>
<li><code>npm start</code> 重新启动项目</li>
</ul>
<h5 id="antd">antd 组件替换原生组件<a class="headerlink" href="#antd" title="Permanent link">&para;</a></h5>
<ul>
<li>先修改登录页面 <code>src\unauthenticated-app\login.tsx</code>:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useAuth</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;context/auth-context&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Form</span><span class="p">,</span><span class="w"> </span><span class="nx">Button</span><span class="p">,</span><span class="w"> </span><span class="nx">Input</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;antd&quot;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">Login</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">login</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useAuth</span><span class="p">();</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleSubmit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">values</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">username</span><span class="o">:</span><span class="w"> </span><span class="nx">string</span><span class="p">,</span><span class="w"> </span><span class="nx">password</span><span class="o">:</span><span class="w"> </span><span class="nx">string</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">login</span><span class="p">(</span><span class="nx">values</span><span class="p">);</span>
<span class="w">  </span><span class="p">};</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">Form</span><span class="w"> </span><span class="nx">onFinish</span><span class="o">=</span><span class="p">{</span><span class="nx">handleSubmit</span><span class="p">}</span><span class="o">&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">Form</span><span class="p">.</span><span class="nx">Item</span><span class="w"> </span><span class="nx">name</span><span class="o">=</span><span class="s1">&#39;username&#39;</span><span class="w"> </span><span class="nx">rules</span><span class="o">=</span><span class="p">{[{</span><span class="w"> </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;请输入用户名&#39;</span><span class="w"> </span><span class="p">}]}</span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">Input</span><span class="w"> </span><span class="nx">placeholder</span><span class="o">=</span><span class="s2">&quot;用户名&quot;</span><span class="w"> </span><span class="nx">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="w"> </span><span class="nx">id</span><span class="o">=</span><span class="s2">&quot;username&quot;</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="err">/Form.Item&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">Form</span><span class="p">.</span><span class="nx">Item</span><span class="w"> </span><span class="nx">name</span><span class="o">=</span><span class="s1">&#39;password&#39;</span><span class="w"> </span><span class="nx">rules</span><span class="o">=</span><span class="p">{[{</span><span class="w"> </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;请输入密码&#39;</span><span class="w"> </span><span class="p">}]}</span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">Input</span><span class="w"> </span><span class="nx">placeholder</span><span class="o">=</span><span class="s2">&quot;密码&quot;</span><span class="w"> </span><span class="nx">type</span><span class="o">=</span><span class="s2">&quot;password&quot;</span><span class="w"> </span><span class="nx">id</span><span class="o">=</span><span class="s2">&quot;password&quot;</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="err">/Form.Item&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">Form</span><span class="p">.</span><span class="nx">Item</span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">Button</span><span class="w"> </span><span class="nx">htmlType</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span><span class="w"> </span><span class="nx">type</span><span class="o">=</span><span class="s2">&quot;primary&quot;</span><span class="o">&gt;</span><span class="nx">登录</span><span class="o">&lt;</span><span class="err">/Button&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="err">/Form.Item&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/Form&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>
<ul>
<li>查看页面效果，并尝试 <strong>登录</strong> 功能</li>
<li>修改注册页面 <code>src\unauthenticated-app\register.tsx</code>:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useAuth</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;context/auth-context&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Form</span><span class="p">,</span><span class="w"> </span><span class="nx">Button</span><span class="p">,</span><span class="w"> </span><span class="nx">Input</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;antd&quot;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">Register</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">register</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useAuth</span><span class="p">();</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleSubmit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">values</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">username</span><span class="o">:</span><span class="w"> </span><span class="nx">string</span><span class="p">,</span><span class="w"> </span><span class="nx">password</span><span class="o">:</span><span class="w"> </span><span class="nx">string</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">register</span><span class="p">(</span><span class="nx">values</span><span class="p">);</span>
<span class="w">  </span><span class="p">};</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">Form</span><span class="w"> </span><span class="nx">onFinish</span><span class="o">=</span><span class="p">{</span><span class="nx">handleSubmit</span><span class="p">}</span><span class="o">&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">Form</span><span class="p">.</span><span class="nx">Item</span><span class="w"> </span><span class="nx">name</span><span class="o">=</span><span class="s1">&#39;username&#39;</span><span class="w"> </span><span class="nx">rules</span><span class="o">=</span><span class="p">{[{</span><span class="w"> </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;请输入用户名&#39;</span><span class="w"> </span><span class="p">}]}</span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">Input</span><span class="w"> </span><span class="nx">placeholder</span><span class="o">=</span><span class="s2">&quot;用户名&quot;</span><span class="w"> </span><span class="nx">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="w"> </span><span class="nx">id</span><span class="o">=</span><span class="s2">&quot;username&quot;</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="err">/Form.Item&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">Form</span><span class="p">.</span><span class="nx">Item</span><span class="w"> </span><span class="nx">name</span><span class="o">=</span><span class="s1">&#39;password&#39;</span><span class="w"> </span><span class="nx">rules</span><span class="o">=</span><span class="p">{[{</span><span class="w"> </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;请输入密码&#39;</span><span class="w"> </span><span class="p">}]}</span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">Input</span><span class="w"> </span><span class="nx">placeholder</span><span class="o">=</span><span class="s2">&quot;密码&quot;</span><span class="w"> </span><span class="nx">type</span><span class="o">=</span><span class="s2">&quot;password&quot;</span><span class="w"> </span><span class="nx">id</span><span class="o">=</span><span class="s2">&quot;password&quot;</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="err">/Form.Item&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">Form</span><span class="p">.</span><span class="nx">Item</span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">Button</span><span class="w"> </span><span class="nx">htmlType</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span><span class="w"> </span><span class="nx">type</span><span class="o">=</span><span class="s2">&quot;primary&quot;</span><span class="o">&gt;</span><span class="nx">注册</span><span class="o">&lt;</span><span class="err">/Button&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="err">/Form.Item&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/Form&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>
<ul>
<li>从登录页切换到注册页，查看页面效果，并尝试 <strong>注册</strong> 功能</li>
<li>接下来修改 <code>src\unauthenticated-app\index.tsx</code>：</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useState</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;react&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Login</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;./login&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Register</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;./register&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Card</span><span class="p">,</span><span class="w"> </span><span class="nx">Button</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;antd&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">UnauthenticatedApp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">isRegister</span><span class="p">,</span><span class="w"> </span><span class="nx">setIsRegister</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="o">&lt;</span><span class="nx">Card</span><span class="w"> </span><span class="nx">style</span><span class="o">=</span><span class="p">{{</span><span class="w"> </span><span class="nx">display</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;flex&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">justifyContent</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;center&#39;</span><span class="w"> </span><span class="p">}}</span><span class="o">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="nx">isRegister</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">Register</span><span class="w"> </span><span class="o">/&gt;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">Login</span><span class="w"> </span><span class="o">/&gt;</span><span class="p">}</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">Button</span><span class="w"> </span><span class="kr">type</span><span class="o">=</span><span class="s1">&#39;primary&#39;</span><span class="w"> </span><span class="nx">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setIsRegister</span><span class="p">(</span><span class="o">!</span><span class="nx">isRegister</span><span class="p">)}</span><span class="o">&gt;</span>
<span class="w">        </span><span class="nx">切换到</span><span class="p">{</span><span class="nx">isRegister</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s2">&quot;登录&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;注册&quot;</span><span class="p">}</span>
<span class="w">      </span><span class="o">&lt;</span><span class="err">/Button&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/Card&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>
<p>现在较之前页面好看多了</p>
<ul>
<li>修改 <code>src\screens\ProjectList\components\List.tsx</code>(部分未改动省略)：</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Table</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;antd&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">User</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;./SearchPanel&quot;</span><span class="p">;</span>
<span class="p">...</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">List</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">({</span><span class="w"> </span><span class="nx">users</span><span class="p">,</span><span class="w"> </span><span class="nx">list</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="nx">ListProps</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">Table</span><span class="w"> </span><span class="nx">pagination</span><span class="o">=</span><span class="p">{</span><span class="kc">false</span><span class="p">}</span><span class="w"> </span><span class="nx">columns</span><span class="o">=</span><span class="p">{[{</span>
<span class="w">    </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;名称&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">dataIndex</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;name&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">sorter</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">localeCompare</span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;负责人&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">render</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">text</span><span class="p">,</span><span class="w"> </span><span class="nx">project</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">span</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">users</span><span class="p">.</span><span class="nx">find</span><span class="p">((</span><span class="nx">user</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">project</span><span class="p">.</span><span class="nx">personId</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">&quot;未知&quot;</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/span&gt;</span>
<span class="w">  </span><span class="p">}]}</span><span class="w"> </span><span class="nx">dataSource</span><span class="o">=</span><span class="p">{</span><span class="nx">list</span><span class="p">}</span><span class="o">&gt;&lt;</span><span class="err">/Table&gt;</span>
<span class="p">};</span>
</code></pre></div>
<p>localeCompare 可排序中文字符
在引入 antd 的 Table 后，先不给 columns 属性赋值，而是先赋值 dataSource，然后将鼠标放于 columns 上，这时便可见：
(property) TableProps<Project>.columns?: ColumnsType<Project> | undefined
TS 的类型推断起作用了：</p>
<p>通过 list 的值类型为 Project[] ，推断出 dataSource?: RcTableProps<RecordType>['data'] 中 data 类型为 Project[]
推断出 dataSource?: RcTableProps<RecordType>['data'] 中 RecordType 类型为 Project[]
推断出 columns 类型为 (property) TableProps<Project>.columns?: ColumnsType<Project> | undefined</p>
<ul>
<li>修改 <code>src\screens\ProjectList\components\SearchPanel.tsx</code></li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Form</span><span class="p">,</span><span class="w"> </span><span class="nx">Input</span><span class="p">,</span><span class="w"> </span><span class="nx">Select</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;antd&quot;</span><span class="p">;</span>
<span class="p">...</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">SearchPanel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">({</span><span class="w"> </span><span class="nx">users</span><span class="p">,</span><span class="w"> </span><span class="nx">param</span><span class="p">,</span><span class="w"> </span><span class="nx">setParam</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="nx">SearchPanelProps</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">Form</span><span class="o">&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">Input</span>
<span class="w">        </span><span class="nx">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span>
<span class="w">        </span><span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="nx">param</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span>
<span class="w">        </span><span class="nx">onChange</span><span class="o">=</span><span class="p">{(</span><span class="nx">evt</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">          </span><span class="nx">setParam</span><span class="p">({</span>
<span class="w">            </span><span class="p">...</span><span class="nx">param</span><span class="p">,</span>
<span class="w">            </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="nx">evt</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span>
<span class="w">          </span><span class="p">})</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="o">/&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">Select</span>
<span class="w">        </span><span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="nx">param</span><span class="p">.</span><span class="nx">personId</span><span class="p">}</span>
<span class="w">        </span><span class="nx">onChange</span><span class="o">=</span><span class="p">{</span><span class="nx">value</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">          </span><span class="nx">setParam</span><span class="p">({</span>
<span class="w">            </span><span class="p">...</span><span class="nx">param</span><span class="p">,</span>
<span class="w">            </span><span class="nx">personId</span><span class="o">:</span><span class="w"> </span><span class="nx">value</span><span class="p">,</span>
<span class="w">          </span><span class="p">})</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">Select</span><span class="p">.</span><span class="nx">Option</span><span class="w"> </span><span class="nx">value</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="o">&gt;</span><span class="nx">负责人</span><span class="o">&lt;</span><span class="err">/Select.Option&gt;</span>
<span class="w">        </span><span class="p">{</span><span class="nx">users</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">user</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="o">&lt;</span><span class="nx">Select</span><span class="p">.</span><span class="nx">Option</span><span class="w"> </span><span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="w"> </span><span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="o">&gt;</span>
<span class="w">            </span><span class="p">{</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span>
<span class="w">          </span><span class="o">&lt;</span><span class="err">/Select.Option&gt;</span>
<span class="w">        </span><span class="p">))}</span>
<span class="w">      </span><span class="o">&lt;</span><span class="err">/Select&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/Form&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>
<h3 id="2css-in-js">2.CSS-in-JS<a class="headerlink" href="#2css-in-js" title="Permanent link">&para;</a></h3>
<p>CSS-in-JS 不是指某一个具体的库，是指组织CSS代码的一种方式，代表库有 styled-component 和 emotion</p>
<p>(1)传统CSS的缺陷</p>
<p>①缺乏模块组织
传统的JS和CSS都没有模块的概念，后来在JS界陆续有了 CommonJS 和 ECMAScript Module，CSS-in-JS可以用模块化的方式组织CSS，依托于JS的模块化方案，比如：</p>
<div class="highlight"><pre><span></span><code><span class="c1">// button1.ts</span>
<span class="k">import</span><span class="w"> </span><span class="nx">styled</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@emotion/styled&#39;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">Button</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">styled</span><span class="p">.</span><span class="nx">button</span><span class="sb">`</span>
<span class="sb">  color: turquoise;</span>
<span class="sb">`</span>


<span class="c1">// button2.ts</span>
<span class="k">import</span><span class="w"> </span><span class="nx">styled</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@emotion/styled&#39;</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">Button</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">styled</span><span class="p">.</span><span class="nx">button</span><span class="sb">`</span>
<span class="sb">  font-size: 16px;</span>
<span class="sb">`</span>
</code></pre></div>
<p>②缺乏作用域</p>
<p>传统的CSS只有一个全局作用域，比如说一个class可以匹配全局的任意元素。随着项目成长，CSS会变得越来越难以组织，最终导致失控。CSS-in-JS可以通过生成独特的选择符，来实现作用域的效果</p>
<div class="highlight"><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">css</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">styleBlock</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">className</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">someHash</span><span class="p">(</span><span class="nx">styleBlock</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">styleEl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;style&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="nx">styleEl</span><span class="p">.</span><span class="nx">textContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`</span>
<span class="sb">    .</span><span class="si">${</span><span class="nx">className</span><span class="si">}</span><span class="sb"> {</span>
<span class="sb">      </span><span class="si">${</span><span class="nx">styleBlock</span><span class="si">}</span>
<span class="sb">    }</span>
<span class="sb">  `</span><span class="p">;</span>
<span class="w">  </span><span class="nb">document</span><span class="p">.</span><span class="nx">head</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">styleEl</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">className</span><span class="p">;</span>
<span class="p">};</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">className</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">css</span><span class="p">(</span><span class="sb">`</span>
<span class="sb">  color: red;</span>
<span class="sb">  padding: 20px;</span>
<span class="sb">`</span><span class="p">);</span><span class="w"> </span><span class="c1">// &#39;c23j4&#39;</span>
</code></pre></div>
<p>③隐式依赖，让样式难以追踪</p>
<p>比如这个CSS样式：</p>
<div class="highlight"><pre><span></span><code><span class="p">.</span><span class="nc">target</span><span class="w"> </span><span class="p">.</span><span class="nc">name</span><span class="w"> </span><span class="nt">h1</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="kc">red</span>
<span class="p">}</span>

<span class="nt">body</span><span class="w"> </span><span class="p">#</span><span class="nn">container</span><span class="w"> </span><span class="nt">h1</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="kc">green</span>
<span class="p">}</span>
</code></pre></div>
<p>④没有变量</p>
<p>传统的CSS规则里没有变量，但是在 CSS-in-JS 中可以方便地控制变量</p>
<div class="highlight"><pre><span></span><code>const Container = styled.div(props =&gt; ({
  display: &#39;flex&#39;,
  flexDirection: props.column &amp;&amp; &#39;column&#39;
}))
</code></pre></div>
<p>⑤CSS选择器与HTML元素耦合</p>
<div class="highlight"><pre><span></span><code>.target .name h1 {
  color: red
}

body #container h1 {
  color: green
}
</code></pre></div>
<p>如果你想把 h1 改成h2，必须要同时改动 CSS 和 HTML。而在CSS-in-JS中，HTML和CSS是结合在一起的，易于修改</p>
<p>(2)Emotion 介绍
Emotion 是目前最受欢迎的 CSS-in-JS 库之一，它还对 React 作了很好的适应，可以方便地创建 styled component，也支持写行内样式：</p>
<div class="highlight"><pre><span></span><code>/** @jsx jsx */
import { jsx } from &#39;@emotion/react&#39;

render(
  &lt;div
    css={{
      backgroundColor: &#39;hotpink&#39;,
      &#39;&amp;:hover&#39;: {
        color: &#39;lightgreen&#39;
      }
    }}
  &gt;
    This has a hotpink background.
  &lt;/div&gt;
)
</code></pre></div>
<p>这种写法比起React自带的style的写法功能更强大，比如可以处理级联、伪类等style处理的不了的情况</p>
<h3 id="3emotion">3.emotion &amp; 登录注册页美化<a class="headerlink" href="#3emotion" title="Permanent link">&para;</a></h3>
<h5 id="_5">全局样式<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h5>
<ul>
<li>编辑 <code>src\App.css</code> 清除原有样式，填入如下内容：</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nt">html</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c">/* rem em */</span>
<span class="w">  </span><span class="c">/* em 相对于父元素的 font-size */</span>
<span class="w">  </span><span class="c">/* rem 相对于根元素的 font-size，r root */</span>
<span class="w">  </span><span class="c">/* 浏览器默认 font-size 16px */</span>
<span class="w">  </span><span class="c">/* 16px * 62.5% = 10px */</span>
<span class="w">  </span><span class="c">/* 1rem === 10px */</span>
<span class="w">  </span><span class="k">font-size</span><span class="p">:</span><span class="w"> </span><span class="mf">62.5</span><span class="kt">%</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">html</span><span class="w"> </span><span class="nt">body</span><span class="w"> </span><span class="p">#</span><span class="nn">root</span><span class="w"> </span><span class="p">.</span><span class="nc">App</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">min-height</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="kt">vh</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>删掉文件 <code>src\index.css</code> 并去掉在 <code>src\index.tsx</code> 中的引用，后续全局样式都在 <code>src\App.css</code> 中添加</p>
<h5 id="emotion">安装 emotion<a class="headerlink" href="#emotion" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code><span class="nx">npm</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="err">@</span><span class="nx">emotion</span><span class="o">/</span><span class="nx">react</span><span class="w"> </span><span class="err">@</span><span class="nx">emotion</span><span class="o">/</span><span class="nx">styled</span><span class="w"> </span><span class="o">--</span><span class="nx">force</span>
</code></pre></div>
<h5 id="emotion_1">原生标签使用 emotion<a class="headerlink" href="#emotion_1" title="Permanent link">&para;</a></h5>
<p>编辑 <code>src\unauthenticated-app\index.tsx</code>(部分原有内容省略)</p>
<div class="highlight"><pre><span></span><code><span class="p">...</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Card</span><span class="p">,</span><span class="w"> </span><span class="nx">Button</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;antd&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">styled</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@emotion/styled&quot;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">UnauthenticatedApp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">...</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">Container</span><span class="o">&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">Card</span><span class="o">&gt;</span>
<span class="w">        </span><span class="p">...</span>
<span class="w">      </span><span class="o">&lt;</span><span class="err">/Card&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/Container&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">};</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">Container</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">styled</span><span class="p">.</span><span class="nx">div</span><span class="sb">`</span>
<span class="sb">  display: flex;</span>
<span class="sb">  flex-direction: column;</span>
<span class="sb">  align-items: center;</span>
<span class="sb">  min-height: 100vh;</span>
<span class="sb">  justify-content: center;</span>
<span class="sb">`</span>
</code></pre></div>
<h5 id="antd-emotion">antd 标签使用 emotion<a class="headerlink" href="#antd-emotion" title="Permanent link">&para;</a></h5>
<p>继续编辑 <code>src\unauthenticated-app\index.tsx</code>(部分原有内容省略)</p>
<div class="highlight"><pre><span></span><code><span class="p">...</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Card</span><span class="p">,</span><span class="w"> </span><span class="nx">Button</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;antd&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">styled</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@emotion/styled&quot;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">UnauthenticatedApp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">...</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">Container</span><span class="o">&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">ShadowCard</span><span class="o">&gt;</span>
<span class="w">        </span><span class="p">...</span>
<span class="w">      </span><span class="o">&lt;</span><span class="err">/ShadowCard&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/Container&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">};</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">ShadowCard</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">styled</span><span class="p">(</span><span class="nx">Card</span><span class="p">)</span><span class="sb">`</span>
<span class="sb">  width: 40rem;</span>
<span class="sb">  min-height: 56rem;</span>
<span class="sb">  padding: 3.2rem 4rem;</span>
<span class="sb">  border-radius: 0.3rem;</span>
<span class="sb">  box-sizing: border-box;</span>
<span class="sb">  box-shadow: rgba(0,0,0,0.1) 0 0 10px;</span>
<span class="sb">  text-align: center; </span>
<span class="sb">`</span>
<span class="p">...</span>
</code></pre></div>
<h5 id="_6">进一步美化<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h5>
<p>新建 <code>src\assets</code>，将预置 svg 文件放入(left.svg、logo.svg、right.svg)</p>
<p>继续编辑 <code>src\unauthenticated-app\index.tsx</code>(部分原有内容省略)：切换文案修改并使用 <code>link</code> 类型 <code>button</code>；添加 logo、标题和背景图</p>
<div class="highlight"><pre><span></span><code><span class="p">...</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Card</span><span class="p">,</span><span class="w"> </span><span class="nx">Button</span><span class="p">,</span><span class="w"> </span><span class="nx">Divider</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;antd&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">styled</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@emotion/styled&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">left</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;assets/left.svg&#39;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">logo</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;assets/logo.svg&#39;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">right</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;assets/right.svg&#39;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">UnauthenticatedApp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">...</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">Container</span><span class="o">&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">Header</span><span class="o">/&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">Background</span><span class="o">/&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">ShadowCard</span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">Title</span><span class="o">&gt;</span>
<span class="w">          </span><span class="p">{</span><span class="nx">isRegister</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;请注册&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;请登录&#39;</span><span class="p">}</span>
<span class="w">        </span><span class="o">&lt;</span><span class="err">/Title&gt;</span>
<span class="w">        </span><span class="p">{</span><span class="nx">isRegister</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">Register</span><span class="w"> </span><span class="o">/&gt;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">Login</span><span class="w"> </span><span class="o">/&gt;</span><span class="p">}</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">Divider</span><span class="o">/&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">Button</span><span class="w"> </span><span class="nx">type</span><span class="o">=</span><span class="s2">&quot;link&quot;</span><span class="w"> </span><span class="nx">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setIsRegister</span><span class="p">(</span><span class="o">!</span><span class="nx">isRegister</span><span class="p">)}</span><span class="o">&gt;</span>
<span class="w">          </span><span class="nx">切换到</span><span class="p">{</span><span class="nx">isRegister</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s2">&quot;已经有账号了？直接登录&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;没有账号？注册新账号&quot;</span><span class="p">}</span>
<span class="w">        </span><span class="o">&lt;</span><span class="err">/Button&gt; </span>
<span class="w">      </span><span class="o">&lt;</span><span class="err">/ShadowCard&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/Container&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">};</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">Title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">styled</span><span class="p">.</span><span class="nx">h2</span><span class="sb">`</span>
<span class="sb">  margin-bottom: 2.4rem;</span>
<span class="sb">  color: rgb(94, 108, 132);</span>
<span class="sb">`</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">Background</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">styled</span><span class="p">.</span><span class="nx">div</span><span class="sb">`</span>
<span class="sb">  position: absolute;</span>
<span class="sb">  width: 100%;</span>
<span class="sb">  height: 100%;</span>
<span class="sb">  background-repeat: no-repeat;</span>
<span class="sb">  background-attachment: fixed; // 背景图片是否会随着页面滑动</span>
<span class="sb">  background-position: left bottom, right bottom;</span>
<span class="sb">  background-size: calc(((100vw - 40rem) / 2) - 3.2rem), calc(((100vw - 40rem) / 2) - 3.2rem), cover;</span>
<span class="sb">  background-image: url(</span><span class="si">${</span><span class="nx">left</span><span class="si">}</span><span class="sb">), url(</span><span class="si">${</span><span class="nx">right</span><span class="si">}</span><span class="sb">);</span>
<span class="sb">`</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">Header</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">styled</span><span class="p">.</span><span class="nx">header</span><span class="sb">`</span>
<span class="sb">  background: url(</span><span class="si">${</span><span class="nx">logo</span><span class="si">}</span><span class="sb">) no-repeat center;</span>
<span class="sb">  padding: 5rem 0;</span>
<span class="sb">  background-size: 8rem;</span>
<span class="sb">  width: 100%;</span>
<span class="sb">`</span>
<span class="p">...</span>
</code></pre></div>
<h3 id="4gridflexbox">4.用Grid和Flexbox布局优化项目列表页面<a class="headerlink" href="#4gridflexbox" title="Permanent link">&para;</a></h3>
<p>编辑 <code>src\authenticated-app.tsx</code></p>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nx">styled</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@emotion/styled&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useAuth</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;context/auth-context&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ProjectList</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;screens/ProjectList&quot;</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * grid 和 flex 各自的应用场景</span>
<span class="cm"> * 1. 要考虑，是一维布局 还是 二维布局</span>
<span class="cm"> * 一般来说，一维布局用flex，二维布局用grid</span>
<span class="cm"> * 2. 是从内容出发还是从布局出发？</span>
<span class="cm"> * 从内容出发：你先有一组内容(数量一般不固定),然后希望他们均匀的分布在容器中，由内容自己的大小决定占据的空间</span>
<span class="cm"> * 从布局出发：先规划网格(数量一般比较固定)，然后再把元素往里填充</span>
<span class="cm"> * 从内容出发，用flex</span>
<span class="cm"> * 从布局出发，用grid</span>
<span class="cm"> */</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">AuthenticatedApp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">logout</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useAuth</span><span class="p">();</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">Container</span><span class="o">&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">Header</span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">HeaderLeft</span><span class="o">&gt;</span>
<span class="w">          </span><span class="o">&lt;</span><span class="nx">h3</span><span class="o">&gt;</span><span class="nx">Logo</span><span class="o">&lt;</span><span class="err">/h3&gt;</span>
<span class="w">          </span><span class="o">&lt;</span><span class="nx">h3</span><span class="o">&gt;</span><span class="nx">项目</span><span class="o">&lt;</span><span class="err">/h3&gt;</span>
<span class="w">          </span><span class="o">&lt;</span><span class="nx">h3</span><span class="o">&gt;</span><span class="nx">用户</span><span class="o">&lt;</span><span class="err">/h3&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="err">/HeaderLeft&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">HeaderRight</span><span class="o">&gt;</span>
<span class="w">          </span><span class="o">&lt;</span><span class="nx">button</span><span class="w"> </span><span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">logout</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">登出</span><span class="o">&lt;</span><span class="err">/button&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="err">/HeaderRight&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="err">/Header&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">Nav</span><span class="o">&gt;</span><span class="nx">Nav</span><span class="o">&lt;</span><span class="err">/Nav&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">Main</span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">ProjectList</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="err">/Main&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">Aside</span><span class="o">&gt;</span><span class="nx">Aside</span><span class="o">&lt;</span><span class="err">/Aside&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">Footer</span><span class="o">&gt;</span><span class="nx">Footer</span><span class="o">&lt;</span><span class="err">/Footer&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/Container&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">};</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">Container</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">styled</span><span class="p">.</span><span class="nx">div</span><span class="sb">`</span>
<span class="sb">  display: grid;</span>
<span class="sb">  grid-template-rows: 6rem 1fr 6rem; // 3行每行高度（fr 单位是一个自适应单位，表示剩余空间中所占比例）</span>
<span class="sb">  grid-template-columns: 20rem 1fr 20rem;</span>
<span class="sb">  grid-template-areas:</span>
<span class="sb">    &quot;header header header&quot;</span>
<span class="sb">    &quot;nav main aside&quot;</span>
<span class="sb">    &quot;footer footer footer&quot;;</span>
<span class="sb">  /* grid-gap: 10rem; // 每部分之间的间隔 */</span>
<span class="sb">  height: 100vh;</span>
<span class="sb">`</span><span class="p">;</span>

<span class="c1">// grid-area 用来给 grid 子元素起名字</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">Header</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">styled</span><span class="p">.</span><span class="nx">header</span><span class="sb">`</span>
<span class="sb">  grid-area: header;</span>
<span class="sb">  display: flex;</span>
<span class="sb">  flex-direction: row;</span>
<span class="sb">  align-items: center;</span>
<span class="sb">  justify-content: space-between;</span>
<span class="sb">`</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">HeaderLeft</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">styled</span><span class="p">.</span><span class="nx">div</span><span class="sb">`</span>
<span class="sb">  display: flex;</span>
<span class="sb">  align-items: center;</span>
<span class="sb">`</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">HeaderRight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">styled</span><span class="p">.</span><span class="nx">div</span><span class="sb">``</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">Main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">styled</span><span class="p">.</span><span class="nx">main</span><span class="sb">`</span>
<span class="sb">  grid-area: main;</span>
<span class="sb">  /* height: calc(100vh - 6rem); */</span>
<span class="sb">`</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">Nav</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">styled</span><span class="p">.</span><span class="nx">nav</span><span class="sb">`</span>
<span class="sb">  grid-area: nav;</span>
<span class="sb">`</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">Aside</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">styled</span><span class="p">.</span><span class="nx">aside</span><span class="sb">`</span>
<span class="sb">  grid-area: aside;</span>
<span class="sb">`</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">Footer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">styled</span><span class="p">.</span><span class="nx">footer</span><span class="sb">`</span>
<span class="sb">  grid-area: footer;</span>
<span class="sb">`</span><span class="p">;</span>
</code></pre></div>
<p>grid 和 flex 各自的应用场景</p>
<p>1.要考虑，是一维布局 还是 二维布局</p>
<p>一般来说，一维布局用flex，二维布局用grid
2.是从内容出发还是从布局出发？</p>
<p>从内容出发：你先有一组内容(数量一般不固定),然后希望他们均匀的分布在容器中，由内容自己的大小决定占据的空间
从布局出发：先规划网格(数量一般比较固定)，然后再把元素往里填充
从内容出发，用flex
从布局出发，用grid</p>
<ul>
<li><a href="https://www.digitalocean.com/community/tutorials/css-css-grid-holy-grail-layout">CSS Grid: Holy Grail Layout | DigitalOcean</a></li>
</ul>
<h3 id="5-emotion">5.使用 emotion 自定义样式组件<a class="headerlink" href="#5-emotion" title="Permanent link">&para;</a></h3>
<blockquote>
<p>区别于 <code>react</code> 的功能组件 <code>emotion</code> 组件我们称其为 <strong>样式组件</strong></p>
</blockquote>
<p>新建 <code>src\components\lib.tsx</code>(emotion 自定义样式组件库):</p>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nx">styled</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@emotion/styled&#39;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">Row</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">styled</span><span class="p">.</span><span class="nx">div</span><span class="o">&lt;</span><span class="p">{</span>
<span class="w">  </span><span class="nx">gap</span><span class="o">?:</span><span class="w"> </span><span class="nx">number</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kr">boolean</span><span class="p">,</span>
<span class="w">  </span><span class="nx">butween</span><span class="o">?:</span><span class="w"> </span><span class="kr">boolean</span><span class="p">,</span>
<span class="w">  </span><span class="nx">marginBottom</span><span class="o">?:</span><span class="w"> </span><span class="nx">number</span>
<span class="p">}</span><span class="o">&gt;</span><span class="sb">`</span>
<span class="sb">  display: flex;</span>
<span class="sb">  align-items: center;</span>
<span class="sb">  justify-content: </span><span class="si">${</span><span class="nx">props</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">props</span><span class="p">.</span><span class="nx">butween</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;space-between&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">undefined</span><span class="w"> </span><span class="si">}</span><span class="sb">;</span>
<span class="sb">  margin-bottom: </span><span class="si">${</span><span class="w"> </span><span class="nx">props</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">props</span><span class="p">.</span><span class="nx">marginBottom</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;rem&#39;</span><span class="w"> </span><span class="si">}</span><span class="sb">;</span>
<span class="sb">  &gt; * {</span>
<span class="sb">    /* 直接子元素强制控制样式 */</span>
<span class="sb">    margin-top: 0 !important;</span>
<span class="sb">    margin-bottom: 0 !important;</span>
<span class="sb">    margin-right: </span><span class="si">${</span><span class="w"> </span><span class="nx">props</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">typeof</span><span class="w"> </span><span class="nx">props</span><span class="p">.</span><span class="nx">gap</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;number&#39;</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">props</span><span class="p">.</span><span class="nx">gap</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;rem&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">props</span><span class="p">.</span><span class="nx">gap</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;2rem&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">undefined</span><span class="w"> </span><span class="si">}</span><span class="sb">;</span>
<span class="sb">  }</span>
<span class="sb">`</span>
</code></pre></div>
<h3 id="6">6.完善项目列表页面样式<a class="headerlink" href="#6" title="Permanent link">&para;</a></h3>
<p>编辑 <code>src\screens\ProjectList\components\SearchPanel.tsx</code>（使用<code>Form.Item</code>、 <code>emotion</code> 的 <code>css</code> 属性）:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// /** @jsx jsx */</span>
<span class="c1">// import { jsx } from &#39;@emotion/react&#39;</span>
<span class="cm">/** @jsxImportSource @emotion/react */</span>
<span class="p">...</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">SearchPanel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">({</span><span class="w"> </span><span class="nx">users</span><span class="p">,</span><span class="w"> </span><span class="nx">param</span><span class="p">,</span><span class="w"> </span><span class="nx">setParam</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="nx">SearchPanelProps</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">Form</span><span class="w"> </span><span class="nx">css</span><span class="o">=</span><span class="p">{{</span><span class="w"> </span><span class="nx">marginBottom</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;2rem&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&gt;*&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="p">}}</span><span class="w"> </span><span class="nx">layout</span><span class="o">=</span><span class="s2">&quot;inline&quot;</span><span class="o">&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">Form</span><span class="p">.</span><span class="nx">Item</span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">Input</span><span class="w"> </span><span class="nx">placeholder</span><span class="o">=</span><span class="s1">&#39;项目名&#39;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="err">/Form.Item&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">Form</span><span class="p">.</span><span class="nx">Item</span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">Select</span><span class="o">&gt;</span><span class="p">...</span><span class="o">&lt;</span><span class="err">/Select&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="err">/Form.Item&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/Form&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>
<p>在使用 emotion 的 css 属性时 需要注意，由于 React 17 的自动导入破坏了 @emotion 自身运行时的支持，从而将导致 emotion 的 jsx 运行时导入后未使用，也就无法使用 emotion 的 css 属性将 /** @jsx jsx <em>/ 改为 /*</em> @jsxImportSource @emotion/react <em>/ 即可
截止2023.05.04，官方文档中依旧是 /*</em> @jsx jsx */ 的导入方式：Emotion – The css Prop</p>
<h3 id="7">7.遗留问题处理<a class="headerlink" href="#7" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>src\utils\index.ts
</code></pre></div>
<p>解开 <code>@ts-ignore</code> "封印"的报错</p>
<div class="highlight"><pre><span></span><code><span class="p">...</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">isVoid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">val</span><span class="o">:</span><span class="w"> </span><span class="kt">unknown</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">val</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">val</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">val</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;&#39;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">cleanObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">obj</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">[</span><span class="nx">key</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">]</span><span class="o">:</span><span class="w"> </span><span class="nx">unknown</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="nx">obj</span><span class="w"> </span><span class="p">};</span>
<span class="w">  </span><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">res</span><span class="p">).</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">key</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">res</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">isVoid</span><span class="p">(</span><span class="nx">val</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="ow">delete</span><span class="w"> </span><span class="nx">res</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">});</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">;</span>
<span class="p">};</span><span class="w">  </span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">useMount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">cbk</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// TODO 依赖项里加上callback 会造成无限循环，这个和 useCallback 以及 useMemo 相关</span>
<span class="w">    </span><span class="nx">cbk</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// eslint-disable-next-line react-hooks/exhaustive-deps</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[]);</span>
<span class="p">...</span>
</code></pre></div>
<p>object 类型涵盖很广(function、new RegExp('')…)，若只是想用键值对的形式可以使用上面所示的形式 { [key: string]: unknown }
若 val = res[key] 的值是 false 或是 false 的字面量，isFalsy 也会识别，然后就会有 bug，比如 checked，visible 等</p>
<h2 id="-">六、用户体验优化 - 加载中和错误状态处理<a class="headerlink" href="#-" title="Permanent link">&para;</a></h2>
<h4 id="1-loading-error">1.给页面添加 Loading 和 Error 状态，增加页面友好性<a class="headerlink" href="#1-loading-error" title="Permanent link">&para;</a></h4>
<p>修改 <code>src\screens\ProjectList\index.tsx</code>（新增 loading 状态 和 请求错误提示）（部分未修改内容省略）：</p>
<div class="highlight"><pre><span></span><code><span class="p">...</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Typography</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;antd&quot;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">ProjectList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">users</span><span class="p">,</span><span class="w"> </span><span class="nx">setUsers</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">([]);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">isLoading</span><span class="p">,</span><span class="w"> </span><span class="nx">setIsLoading</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="nx">setError</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="o">&lt;</span><span class="kc">null</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="ne">Error</span><span class="o">&gt;</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>

<span class="w">  </span><span class="p">...</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">setIsLoading</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
<span class="w">    </span><span class="c1">// React Hook &quot;useHttp&quot; cannot be called inside a callback. React Hooks must be called in a React function component or a custom React Hook function.</span>
<span class="w">    </span><span class="nx">client</span><span class="p">(</span><span class="s2">&quot;projects&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="kt">cleanObject</span><span class="p">(</span><span class="nx">lastParam</span><span class="p">)</span><span class="w"> </span><span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="nx">setList</span><span class="p">)</span>
<span class="w">      </span><span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">setList</span><span class="p">([])</span>
<span class="w">        </span><span class="nx">setError</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span>
<span class="w">      </span><span class="p">})</span>
<span class="w">      </span><span class="p">.</span><span class="k">finally</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setIsLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">));</span>
<span class="w">    </span><span class="c1">// React Hook useEffect has a missing dependency: &#39;client&#39;. Either include it or remove the dependency array.</span>
<span class="w">    </span><span class="c1">// eslint-disable-next-line react-hooks/exhaustive-deps</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">lastParam</span><span class="p">]);</span>

<span class="w">  </span><span class="p">...</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">Container</span><span class="o">&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span><span class="nx">项目列表</span><span class="o">&lt;</span><span class="err">/h1&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">SearchPanel</span><span class="w"> </span><span class="nx">users</span><span class="o">=</span><span class="p">{</span><span class="nx">users</span><span class="p">}</span><span class="w"> </span><span class="nx">param</span><span class="o">=</span><span class="p">{</span><span class="nx">param</span><span class="p">}</span><span class="w"> </span><span class="nx">setParam</span><span class="o">=</span><span class="p">{</span><span class="nx">setParam</span><span class="p">}</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="nx">error</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">Typography</span><span class="p">.</span><span class="nx">Text</span><span class="w"> </span><span class="kr">type</span><span class="o">=</span><span class="s2">&quot;danger&quot;</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/Typography.Text&gt; : null}</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">List</span><span class="w"> </span><span class="nx">loading</span><span class="o">=</span><span class="p">{</span><span class="nx">isLoading</span><span class="p">}</span><span class="w"> </span><span class="nx">users</span><span class="o">=</span><span class="p">{</span><span class="nx">users</span><span class="p">}</span><span class="w"> </span><span class="nx">dataSource</span><span class="o">=</span><span class="p">{</span><span class="nx">list</span><span class="p">}</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/Container&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">};</span>

<span class="p">...</span>
</code></pre></div>
<p>修改 <code>src\screens\ProjectList\components\List.tsx</code>（<code>ListProps</code> 继承 <code>TableProps</code>, <code>Table</code> 的属性（<a href="https://so.csdn.net/so/search?q=透传&amp;spm=1001.2101.3001.7020">透传</a>））（部分未修改内容省略）：</p>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Table</span><span class="p">,</span><span class="w"> </span><span class="nx">TableProps</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;antd&quot;</span><span class="p">;</span>
<span class="p">...</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">ListProps</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nx">TableProps</span><span class="o">&lt;</span><span class="nx">Project</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">users</span><span class="o">:</span><span class="w"> </span><span class="kt">User</span><span class="p">[];</span>
<span class="p">}</span>

<span class="c1">// type PropsType = Omit&lt;ListProps, &#39;users&#39;&gt;</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">List</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">({</span><span class="w"> </span><span class="nx">users</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="nx">props</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="nx">ListProps</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">Table</span>
<span class="w">      </span><span class="nx">pagination</span><span class="o">=</span><span class="p">{</span><span class="kc">false</span><span class="p">}</span>
<span class="w">      </span><span class="nx">columns</span><span class="o">=</span><span class="p">{...}</span>
<span class="w">      </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="nx">props</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="o">&gt;&lt;</span><span class="err">/Table&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>
<blockquote>
<p>为方便后续在组件外再次配置 <code>Table</code> 的属性（透传），直接让 <code>ListProps</code> 继承 <code>TableProps</code>, <code>TableProps</code> 单独抽出到 <code>props</code></p>
</blockquote>
<h4 id="2-hook-useasync-loading-error">2.用高级 Hook-useAsync 统一处理 Loading 和 Error 状态<a class="headerlink" href="#2-hook-useasync-loading-error" title="Permanent link">&para;</a></h4>
<p>新建 <code>src\utils\use-async.ts</code> (统一对 <strong>异步状态</strong> 和 <strong>请求数据</strong> 的管理)：</p>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useState</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;react&quot;</span><span class="p">;</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">State</span><span class="o">&lt;</span><span class="nx">D</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">Error</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">  </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="kt">D</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">  </span><span class="nx">stat</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;ready&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;loading&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;error&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;success&#39;</span>
<span class="p">}</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">defaultInitialState</span><span class="o">:</span><span class="w"> </span><span class="kt">State</span><span class="o">&lt;</span><span class="kc">null</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">stat</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;ready&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="kt">null</span><span class="p">,</span>
<span class="w">  </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">null</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">useAsync</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">D</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">initialState?</span><span class="o">:</span><span class="w"> </span><span class="kt">State</span><span class="o">&lt;</span><span class="nx">D</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">state</span><span class="p">,</span><span class="w"> </span><span class="nx">setState</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="o">&lt;</span><span class="nx">State</span><span class="o">&lt;</span><span class="nx">D</span><span class="o">&gt;&gt;</span><span class="p">({</span>
<span class="w">    </span><span class="p">...</span><span class="nx">defaultInitialState</span><span class="p">,</span>
<span class="w">    </span><span class="p">...</span><span class="nx">initialState</span>
<span class="w">  </span><span class="p">})</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">setData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="kt">D</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setState</span><span class="p">({</span>
<span class="w">    </span><span class="nx">data</span><span class="p">,</span>
<span class="w">    </span><span class="nx">stat</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;success&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">null</span>
<span class="w">  </span><span class="p">})</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">setError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">Error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setState</span><span class="p">({</span>
<span class="w">    </span><span class="nx">error</span><span class="p">,</span>
<span class="w">    </span><span class="nx">stat</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;error&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="kt">null</span>
<span class="w">  </span><span class="p">})</span>

<span class="w">  </span><span class="c1">// run 来触发异步请求</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">run</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">promise</span><span class="o">:</span><span class="w"> </span><span class="kt">Promise</span><span class="o">&lt;</span><span class="nx">D</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">promise</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="nx">promise</span><span class="p">.</span><span class="nx">then</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;请传入 Promise 类型数据&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">setState</span><span class="p">({...</span><span class="nx">state</span><span class="p">,</span><span class="w"> </span><span class="nx">stat</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;loading&#39;</span><span class="p">})</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">promise</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">setData</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">data</span>
<span class="w">    </span><span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">setError</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">error</span>
<span class="w">    </span><span class="p">})</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">isReady</span><span class="o">:</span><span class="w"> </span><span class="kt">state.stat</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;ready&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">isLoading</span><span class="o">:</span><span class="w"> </span><span class="kt">state.stat</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;loading&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">isError</span><span class="o">:</span><span class="w"> </span><span class="kt">state.stat</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;error&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">isSuccess</span><span class="o">:</span><span class="w"> </span><span class="kt">state.stat</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;success&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">run</span><span class="p">,</span>
<span class="w">    </span><span class="nx">setData</span><span class="p">,</span>
<span class="w">    </span><span class="nx">setError</span><span class="p">,</span>
<span class="w">    </span><span class="p">...</span><span class="nx">state</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>修改 <code>src\screens\ProjectList\components\List.tsx</code> (将 <code>Project</code> 导出，以便后续引用)（部分未修改内容省略）：</p>
<p>修改 <code>src\screens\ProjectList\index.tsx</code> （部分未修改内容省略）：</p>
<ul>
<li>删去之前 <code>loading</code> 和 <code>error</code> 相关内容；</li>
<li>删去 <code>client</code> 异步请求 <code>then</code> 及后续操作；</li>
<li>使用 <code>useAsync</code> 统一处理 <strong>异步状态</strong> 和 <strong>请求数据</strong>；</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="p">...</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">List</span><span class="p">,</span><span class="w"> </span><span class="nx">Project</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;./components/List&quot;</span><span class="p">;</span>
<span class="p">...</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useAsync</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;utils/use-async&quot;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">ProjectList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">users</span><span class="p">,</span><span class="w"> </span><span class="nx">setUsers</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">([]);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">param</span><span class="p">,</span><span class="w"> </span><span class="nx">setParam</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">({</span>
<span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">personId</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="c1">// 对 param 进行防抖处理</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">lastParam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useDebounce</span><span class="p">(</span><span class="nx">param</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useHttp</span><span class="p">();</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">run</span><span class="p">,</span><span class="w"> </span><span class="nx">isLoading</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="kt">list</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useAsync</span><span class="o">&lt;</span><span class="nx">Project</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">();</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">run</span><span class="p">(</span><span class="nx">client</span><span class="p">(</span><span class="s2">&quot;projects&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="kt">cleanObject</span><span class="p">(</span><span class="nx">lastParam</span><span class="p">)</span><span class="w"> </span><span class="p">}))</span>
<span class="w">    </span><span class="c1">// eslint-disable-next-line react-hooks/exhaustive-deps</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">lastParam</span><span class="p">]);</span>

<span class="w">  </span><span class="nx">useMount</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">client</span><span class="p">(</span><span class="s2">&quot;users&quot;</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">setUsers</span><span class="p">));</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">Container</span><span class="o">&gt;</span>
<span class="w">      </span><span class="p">...</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">List</span><span class="w"> </span><span class="nx">loading</span><span class="o">=</span><span class="p">{</span><span class="nx">isLoading</span><span class="p">}</span><span class="w"> </span><span class="nx">users</span><span class="o">=</span><span class="p">{</span><span class="nx">users</span><span class="p">}</span><span class="w"> </span><span class="nx">dataSource</span><span class="o">=</span><span class="p">{</span><span class="nx">list</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">[]}</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/Container&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">};</span>
<span class="p">...</span>
</code></pre></div>
<p>新建 <code>src\utils\project.ts</code> (单独处理 Project 数据的异步请求)：</p>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">cleanObject</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;utils&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useHttp</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;./http&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useAsync</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;./use-async&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useEffect</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;react&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Project</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;screens/ProjectList/components/List&quot;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">useProjects</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">param?</span><span class="o">:</span><span class="w"> </span><span class="kt">Partial</span><span class="o">&lt;</span><span class="nx">Project</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useHttp</span><span class="p">();</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">run</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="nx">result</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useAsync</span><span class="o">&lt;</span><span class="nx">Project</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">();</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">run</span><span class="p">(</span><span class="nx">client</span><span class="p">(</span><span class="s2">&quot;projects&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="kt">cleanObject</span><span class="p">(</span><span class="nx">param</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">{})</span><span class="w"> </span><span class="p">}))</span>
<span class="w">    </span><span class="c1">// eslint-disable-next-line react-hooks/exhaustive-deps</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">param</span><span class="p">]);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span>
<span class="p">}</span>
</code></pre></div>
<p>新建 <code>src\utils\use-users.ts</code> (单独处理 User 数据的异步请求)：</p>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">cleanObject</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;utils&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useHttp</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;./http&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useAsync</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;./use-async&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useEffect</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;react&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">User</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;screens/ProjectList/components/SearchPanel&quot;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">useUsers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">param?</span><span class="o">:</span><span class="w"> </span><span class="kt">Partial</span><span class="o">&lt;</span><span class="nx">User</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useHttp</span><span class="p">();</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">run</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="nx">result</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useAsync</span><span class="o">&lt;</span><span class="nx">User</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">();</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">run</span><span class="p">(</span><span class="nx">client</span><span class="p">(</span><span class="s2">&quot;users&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="kt">cleanObject</span><span class="p">(</span><span class="nx">param</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">{})</span><span class="w"> </span><span class="p">}))</span>
<span class="w">    </span><span class="c1">// eslint-disable-next-line react-hooks/exhaustive-deps</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">param</span><span class="p">]);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span>
<span class="p">}</span>
</code></pre></div>
<p>再次修改 <code>src\screens\ProjectList\index.tsx</code> （部分未修改内容省略）：</p>
<ul>
<li><code>Project</code> 和 <code>User</code> 数据获取分别单独抽离</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">SearchPanel</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;./components/SearchPanel&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">List</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;./components/List&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useState</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;react&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useDebounce</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;utils&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">styled</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@emotion/styled&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Typography</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;antd&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useProjects</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;utils/project&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useUsers</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;utils/use-users&quot;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">ProjectList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">param</span><span class="p">,</span><span class="w"> </span><span class="nx">setParam</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">({</span>
<span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">personId</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="c1">// 对 param 进行防抖处理后接入请求</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">isLoading</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="kt">list</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useProjects</span><span class="p">(</span><span class="nx">useDebounce</span><span class="p">(</span><span class="nx">param</span><span class="p">));</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="kt">users</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useUsers</span><span class="p">();</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">Container</span><span class="o">&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span><span class="nx">项目列表</span><span class="o">&lt;</span><span class="err">/h1&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">SearchPanel</span><span class="w"> </span><span class="nx">users</span><span class="o">=</span><span class="p">{</span><span class="nx">users</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">[]}</span><span class="w"> </span><span class="nx">param</span><span class="o">=</span><span class="p">{</span><span class="nx">param</span><span class="p">}</span><span class="w"> </span><span class="nx">setParam</span><span class="o">=</span><span class="p">{</span><span class="nx">setParam</span><span class="p">}</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="nx">error</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">Typography</span><span class="p">.</span><span class="nx">Text</span><span class="w"> </span><span class="kr">type</span><span class="o">=</span><span class="s2">&quot;danger&quot;</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/Typography.Text&gt;</span>
<span class="w">      </span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">}</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">List</span><span class="w"> </span><span class="nx">loading</span><span class="o">=</span><span class="p">{</span><span class="nx">isLoading</span><span class="p">}</span><span class="w"> </span><span class="nx">users</span><span class="o">=</span><span class="p">{</span><span class="nx">users</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">[]}</span><span class="w"> </span><span class="nx">dataSource</span><span class="o">=</span><span class="p">{</span><span class="nx">list</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">[]}</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/Container&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">};</span>
<span class="p">...</span>
</code></pre></div>
<h4 id="3-loading-error-event-loop">3.登录注册页面 Loading 和 Error 状态处理，与 Event Loop 详解<a class="headerlink" href="#3-loading-error-event-loop" title="Permanent link">&para;</a></h4>
<p>列表页的 异步状态 弄完，接下来是登录注册页了</p>
<p>修改 src\unauthenticated-app\index.tsx（新增 error 状态处理，将 error j监听操作 交给 登录注册页）：</p>
<div class="highlight"><pre><span></span><code><span class="p">...</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Card</span><span class="p">,</span><span class="w"> </span><span class="nx">Button</span><span class="p">,</span><span class="w"> </span><span class="nx">Divider</span><span class="p">,</span><span class="w"> </span><span class="nx">Typography</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;antd&quot;</span><span class="p">;</span>
<span class="p">...</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">UnauthenticatedApp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">...</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="nx">setError</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="o">&lt;</span><span class="ne">Error</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span><span class="o">&gt;</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">Container</span><span class="o">&gt;</span>
<span class="w">      </span><span class="p">...</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">ShadowCard</span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">Title</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">isRegister</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s2">&quot;请注册&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;请登录&quot;</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/Title&gt;</span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="nx">error</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">Typography</span><span class="p">.</span><span class="nx">Text</span><span class="w"> </span><span class="kr">type</span><span class="o">=</span><span class="s2">&quot;danger&quot;</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/Typography.Text&gt; : null }</span>
<span class="w">        </span><span class="p">{</span><span class="nx">isRegister</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">Register</span><span class="w"> </span><span class="nx">onError</span><span class="o">=</span><span class="p">{</span><span class="nx">setError</span><span class="p">}</span><span class="o">/&gt;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">Login</span><span class="w"> </span><span class="nx">onError</span><span class="o">=</span><span class="p">{</span><span class="nx">setError</span><span class="p">}</span><span class="o">/&gt;</span><span class="p">}</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">Divider</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="w">        </span><span class="p">...</span>
<span class="w">      </span><span class="o">&lt;</span><span class="err">/ShadowCard&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/Container&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">};</span>
<span class="p">...</span>
</code></pre></div>
<p>修改 <code>src\unauthenticated-app\login.tsx</code>（传入 <code>onError</code> 并在异步操作后 <code>catch</code> 中使用）：</p>
<div class="highlight"><pre><span></span><code><span class="p">...</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">Login</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">({</span><span class="nx">onError</span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">onError</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">Error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">...</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleSubmit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">values</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">username</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span><span class="w"> </span><span class="nx">password</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">login</span><span class="p">(</span><span class="nx">values</span><span class="p">).</span><span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">onError</span><span class="p">(</span><span class="nx">e</span><span class="p">))</span>
<span class="w">  </span><span class="p">};</span>
<span class="w">  </span><span class="p">...</span>
<span class="p">};</span>
<span class="p">...</span>
</code></pre></div>
<p>同理修改 <code>src\unauthenticated-app\register.tsx</code>：</p>
<div class="highlight"><pre><span></span><code><span class="p">...</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">Register</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">({</span><span class="nx">onError</span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">onError</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">Error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">...</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleSubmit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">values</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">username</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span><span class="w"> </span><span class="nx">password</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">register</span><span class="p">(</span><span class="nx">values</span><span class="p">).</span><span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">onError</span><span class="p">(</span><span class="nx">e</span><span class="p">))</span>
<span class="w">  </span><span class="p">};</span>
<span class="w">  </span><span class="p">...</span>
<span class="p">};</span>
<span class="p">...</span>
</code></pre></div>
<p>使用非预设用户名密码检验：没反应。。。但是控制台打印出了刚输入的用户名和密码。。。</p>
<p>通过登录的调用链可以找到 导致这个问题的原因：src\auth-provider.ts</p>
<p>!res.ok 时，返回了 Promise.reject(data) ，而 data 是请求入参，这显然不是预想的效果（注册同理），修改这部分为 Promise.reject(await res.json())
修改后再次检验，成了！</p>
<p>Promise.catch 固然好用，但接下来换个思路，使用 try..catch 并引出 Event Loop。</p>
<p>先修改 src\unauthenticated-app\login.tsx 试试水：</p>
<div class="highlight"><pre><span></span><code><span class="p">...</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">Login</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">({</span><span class="nx">onError</span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">onError</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">Error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">...</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleSubmit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">values</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">username</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span><span class="w"> </span><span class="nx">password</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// login(values).catch(e =&gt; onError(e))</span>
<span class="w">      </span><span class="nx">login</span><span class="p">(</span><span class="nx">values</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="o">:</span><span class="w"> </span><span class="kt">Error</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">any</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">onError</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">};</span>
<span class="w">  </span><span class="p">...</span>
<span class="p">};</span>
<span class="p">...</span>
</code></pre></div>
<p>控制台输出正常，但是界面没有效果。。。</p>
<p>问题出在 login 是异步操作，程序中会优先执行同步操作，然后才会异步操作，所以 onError 优先执行，并没有拿到后端返回的报错信息</p>
<p>再次修改 src\unauthenticated-app\login.tsx （使用 async await 处理异步操作）：
————————————————</p>
<div class="highlight"><pre><span></span><code><span class="p">...</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">Login</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">({</span><span class="nx">onError</span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">onError</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">Error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">...</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleSubmit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">values</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">username</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span><span class="w"> </span><span class="nx">password</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// login(values).catch(e =&gt; onError(e))</span>
<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">login</span><span class="p">(</span><span class="nx">values</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="o">:</span><span class="w"> </span><span class="kt">Error</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">any</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">onError</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">};</span>
<span class="w">  </span><span class="p">...</span>
<span class="p">};</span>
<span class="p">...</span>
</code></pre></div>
<p>这样便正常啦!</p>
<p>接下来给注册页新增确认密码功能</p>
<p>修改 <code>src\unauthenticated-app\register.tsx</code> （新增确认密码的 <code>Form.Item</code> 和 相关处理逻辑）：</p>
<div class="highlight"><pre><span></span><code><span class="p">...</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">Register</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">({</span><span class="nx">onError</span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">onError</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">Error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">register</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useAuth</span><span class="p">();</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleSubmit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">({</span><span class="w"> </span><span class="nx">cpassword</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="nx">values</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">username</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">password</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">cpassword</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">cpassword</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">values</span><span class="p">.</span><span class="nx">password</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">register</span><span class="p">(</span><span class="nx">values</span><span class="p">).</span><span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">onError</span><span class="p">(</span><span class="nx">e</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">onError</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;请确认两次的输入密码相同&#39;</span><span class="p">))</span>
<span class="w">      </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">};</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">Form</span><span class="w"> </span><span class="nx">onFinish</span><span class="o">=</span><span class="p">{</span><span class="nx">handleSubmit</span><span class="p">}</span><span class="o">&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">Form</span><span class="p">.</span><span class="nx">Item</span>
<span class="w">        </span><span class="nx">name</span><span class="o">=</span><span class="s2">&quot;username&quot;</span>
<span class="w">        </span><span class="nx">rules</span><span class="o">=</span><span class="p">{[{</span><span class="w"> </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;请输入用户名&quot;</span><span class="w"> </span><span class="p">}]}</span>
<span class="w">      </span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">Input</span><span class="w"> </span><span class="nx">placeholder</span><span class="o">=</span><span class="s2">&quot;用户名&quot;</span><span class="w"> </span><span class="kr">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="w"> </span><span class="nx">id</span><span class="o">=</span><span class="s2">&quot;username&quot;</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="err">/Form.Item&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">Form</span><span class="p">.</span><span class="nx">Item</span>
<span class="w">        </span><span class="nx">name</span><span class="o">=</span><span class="s2">&quot;password&quot;</span>
<span class="w">        </span><span class="nx">rules</span><span class="o">=</span><span class="p">{[{</span><span class="w"> </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;请输入密码&quot;</span><span class="w"> </span><span class="p">}]}</span>
<span class="w">      </span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">Input</span><span class="w"> </span><span class="nx">placeholder</span><span class="o">=</span><span class="s2">&quot;密码&quot;</span><span class="w"> </span><span class="kr">type</span><span class="o">=</span><span class="s2">&quot;password&quot;</span><span class="w"> </span><span class="nx">id</span><span class="o">=</span><span class="s2">&quot;password&quot;</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="err">/Form.Item&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">Form</span><span class="p">.</span><span class="nx">Item</span>
<span class="w">        </span><span class="nx">name</span><span class="o">=</span><span class="s2">&quot;cpassword&quot;</span>
<span class="w">        </span><span class="nx">rules</span><span class="o">=</span><span class="p">{[{</span><span class="w"> </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;请确认密码&quot;</span><span class="w"> </span><span class="p">}]}</span>
<span class="w">      </span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">Input</span><span class="w"> </span><span class="nx">placeholder</span><span class="o">=</span><span class="s2">&quot;确认密码&quot;</span><span class="w"> </span><span class="kr">type</span><span class="o">=</span><span class="s2">&quot;password&quot;</span><span class="w"> </span><span class="nx">id</span><span class="o">=</span><span class="s2">&quot;cpassword&quot;</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="err">/Form.Item&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">Form</span><span class="p">.</span><span class="nx">Item</span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">LongButton</span><span class="w"> </span><span class="nx">htmlType</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span><span class="w"> </span><span class="kr">type</span><span class="o">=</span><span class="s2">&quot;primary&quot;</span><span class="o">&gt;</span>
<span class="w">          </span><span class="nx">注册</span>
<span class="w">        </span><span class="o">&lt;</span><span class="err">/LongButton&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="err">/Form.Item&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/Form&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>
<p>再接着为 登录注册页 添加异步状态 <code>Loading</code> 的处理：</p>
<div class="highlight"><pre><span></span><code><span class="p">...</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useAsync</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;utils/use-async&quot;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">Login</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">({</span><span class="nx">onError</span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">onError</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">Error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">login</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useAuth</span><span class="p">();</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">run</span><span class="p">,</span><span class="w"> </span><span class="nx">isLoading</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useAsync</span><span class="p">()</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleSubmit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">values</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">username</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span><span class="w"> </span><span class="nx">password</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// login(values).catch(e =&gt; onError(e))</span>
<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">run</span><span class="p">(</span><span class="nx">login</span><span class="p">(</span><span class="nx">values</span><span class="p">))</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="o">:</span><span class="w"> </span><span class="kt">Error</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">any</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">onError</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">};</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">Form</span><span class="w"> </span><span class="nx">onFinish</span><span class="o">=</span><span class="p">{</span><span class="nx">handleSubmit</span><span class="p">}</span><span class="o">&gt;</span>
<span class="w">      </span><span class="p">...</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">Form</span><span class="p">.</span><span class="nx">Item</span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">LongButton</span><span class="w"> </span><span class="nx">loading</span><span class="o">=</span><span class="p">{</span><span class="nx">isLoading</span><span class="p">}</span><span class="w"> </span><span class="nx">htmlType</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span><span class="w"> </span><span class="kr">type</span><span class="o">=</span><span class="s2">&quot;primary&quot;</span><span class="o">&gt;</span>
<span class="w">          </span><span class="nx">登录</span>
<span class="w">        </span><span class="o">&lt;</span><span class="err">/LongButton&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="err">/Form.Item&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/Form&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">};</span>
<span class="p">...</span>
</code></pre></div>
<p>检验一下，没有效果，但是控制台抛出 400 错误了，排查一下</p>
<p>try..catch 中的 onError 没接收到，唯一的变数就是这个 run 了
查看一下，果然报错被 run 内部消化了，没有正常抛出（将 catch 到的 error throw 或是用 Promise.reject 包裹返回都是可以的，建议使用后者）
修改 src\utils\use-async.ts：</p>
<div class="highlight"><pre><span></span><code><span class="p">...</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">useAsync</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">D</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">initialState?</span><span class="o">:</span><span class="w"> </span><span class="kt">State</span><span class="o">&lt;</span><span class="nx">D</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">...</span>
<span class="w">  </span><span class="c1">// run 来触发异步请求</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">run</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">promise</span><span class="o">:</span><span class="w"> </span><span class="kt">Promise</span><span class="o">&lt;</span><span class="nx">D</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">...</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">promise</span>
<span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">(...)</span>
<span class="w">      </span><span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// catch 会消化异常，如果不主动抛出，外面是接收不到异常的</span>
<span class="w">        </span><span class="nx">setError</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// return error; // 原代码</span>
<span class="w">        </span><span class="c1">// throw error;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">Promise</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">  </span><span class="p">};</span>
<span class="w">  </span><span class="p">...</span>
<span class="p">};</span>
</code></pre></div>
<p>检验一下，正常 catch 并 展示报错信息</p>
<p>try…catch only works for runtime errors (try…catch 只能处理有效代码之中的异常)
try…catch works synchronously(try…catch 只能处理同步代码之中的异常)
问题是解决了，但这样 try…catch 还是有些拖泥带水的感觉，继续优化：</p>
<p>修改 src\utils\use-async.ts（增加是否抛出异常的配置，来合理化逻辑）：
————————————————</p>
<div class="highlight"><pre><span></span><code><span class="p">...</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">defaultConfig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">throwOnError</span><span class="o">:</span><span class="w"> </span><span class="kt">false</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">useAsync</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">D</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">initialState?</span><span class="o">:</span><span class="w"> </span><span class="kt">State</span><span class="o">&lt;</span><span class="nx">D</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="nx">initialConfig?</span><span class="o">:</span><span class="w"> </span><span class="kt">typeof</span><span class="w"> </span><span class="nx">defaultConfig</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{...</span><span class="nx">defaultConfig</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="nx">initialConfig</span><span class="p">}</span>
<span class="w">  </span><span class="p">...</span>

<span class="w">  </span><span class="c1">// run 来触发异步请求</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">run</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">promise</span><span class="o">:</span><span class="w"> </span><span class="kt">Promise</span><span class="o">&lt;</span><span class="nx">D</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">...</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">promise</span>
<span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">setData</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">data</span><span class="p">;</span>
<span class="w">      </span><span class="p">})</span>
<span class="w">      </span><span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// catch 会消化异常，如果不主动抛出，外面是接收不到异常的</span>
<span class="w">        </span><span class="nx">setError</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">throwOnError</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nb">Promise</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">error</span><span class="p">;</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">  </span><span class="p">};</span>
<span class="w">  </span><span class="p">...</span>
<span class="p">};</span>
</code></pre></div>
<p>修改 <code>src\unauthenticated-app\login.tsx</code> （传入 <code>{ throwOnError: true }</code>）：</p>
<div class="highlight"><pre><span></span><code><span class="p">...</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">Login</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">({</span><span class="nx">onError</span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">onError</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">Error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">...</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">run</span><span class="p">,</span><span class="w"> </span><span class="nx">isLoading</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useAsync</span><span class="p">(</span><span class="kc">undefined</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">throwOnError</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="w"> </span><span class="p">})</span>
<span class="w">  </span><span class="p">...</span>
<span class="p">};</span>
<span class="p">...</span>
</code></pre></div>
<p>同理修改 <code>src\unauthenticated-app\register.tsx</code> ：</p>
<div class="highlight"><pre><span></span><code><span class="p">...</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">Register</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">({</span><span class="nx">onError</span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">onError</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">Error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">...</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">run</span><span class="p">,</span><span class="w"> </span><span class="nx">isLoading</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useAsync</span><span class="p">(</span><span class="kc">undefined</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">throwOnError</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="w"> </span><span class="p">})</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleSubmit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">({</span><span class="w"> </span><span class="nx">cpassword</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="nx">values</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">username</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">password</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">cpassword</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">cpassword</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">values</span><span class="p">.</span><span class="nx">password</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="nx">run</span><span class="p">(</span><span class="nx">register</span><span class="p">(</span><span class="nx">values</span><span class="p">))</span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="o">:</span><span class="w"> </span><span class="kt">Error</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">any</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">onError</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">onError</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;请确认两次的输入密码相同&#39;</span><span class="p">))</span>
<span class="w">      </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">};</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">Form</span><span class="w"> </span><span class="nx">onFinish</span><span class="o">=</span><span class="p">{</span><span class="nx">handleSubmit</span><span class="p">}</span><span class="o">&gt;</span>
<span class="w">      </span><span class="p">...</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">Form</span><span class="p">.</span><span class="nx">Item</span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">LongButton</span><span class="w"> </span><span class="nx">loading</span><span class="o">=</span><span class="p">{</span><span class="nx">isLoading</span><span class="p">}</span><span class="w"> </span><span class="nx">htmlType</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span><span class="w"> </span><span class="kr">type</span><span class="o">=</span><span class="s2">&quot;primary&quot;</span><span class="o">&gt;</span>
<span class="w">          </span><span class="nx">注册</span>
<span class="w">        </span><span class="o">&lt;</span><span class="err">/LongButton&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="err">/Form.Item&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/Form&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>
<p>最后收尾，修改 <code>src\unauthenticated-app\index.tsx</code> （切换登录和注册时，<code>error</code> 清空）：</p>
<div class="highlight"><pre><span></span><code><span class="p">...</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">UnauthenticatedApp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">isRegister</span><span class="p">,</span><span class="w"> </span><span class="nx">setIsRegister</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="nx">setError</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="o">&lt;</span><span class="ne">Error</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span><span class="o">&gt;</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">Container</span><span class="o">&gt;</span>
<span class="w">      </span><span class="p">...</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">ShadowCard</span><span class="o">&gt;</span>
<span class="w">        </span><span class="p">...</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">Button</span><span class="w"> </span><span class="kr">type</span><span class="o">=</span><span class="s2">&quot;link&quot;</span><span class="w"> </span><span class="nx">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">setIsRegister</span><span class="p">(</span><span class="o">!</span><span class="nx">isRegister</span><span class="p">);</span><span class="w"> </span><span class="nx">setError</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">}}</span><span class="o">&gt;</span>
<span class="w">          </span><span class="nx">切换到</span><span class="p">{</span><span class="nx">isRegister</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s2">&quot;已经有账号了？直接登录&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;没有账号？注册新账号&quot;</span><span class="p">}</span>
<span class="w">        </span><span class="o">&lt;</span><span class="err">/Button&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="err">/ShadowCard&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/Container&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">};</span>
<span class="p">...</span>
</code></pre></div>
<p>检验效果，完美！</p>
<p>拓展学习（引用自：<a href="https://www.imooc.com/read/68">高薪之路—前端面试精选集-慕课专栏</a>）</p>
<p>js 是单线程的，异步在 js 中是反直觉的存在</p>
<p>判断打印顺序：</p>
<div class="highlight"><pre><span></span><code><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;script start&#39;</span><span class="p">)</span>
<span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;setTimeout&#39;</span><span class="p">);</span>
<span class="p">},</span><span class="mf">0</span><span class="p">);</span>
<span class="ow">new</span><span class="w"> </span><span class="nb">Promise</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">resolve</span><span class="p">){</span>
<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;promise1&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="nx">resolve</span><span class="p">();</span>
<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;promise2&#39;</span><span class="p">);</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;promise then&#39;</span><span class="p">);</span>
<span class="p">});</span>
<span class="nx">console</span><span class="w"> </span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;script end&#39;</span><span class="p">);</span>

<span class="nx">script</span><span class="w"> </span><span class="nx">start</span>
<span class="nx">promise1</span>
<span class="nx">promise2</span>
<span class="nx">script</span><span class="w"> </span><span class="nx">end</span>
<span class="nx">promise</span><span class="w"> </span><span class="nx">then</span>
<span class="nx">setTimeout</span>
</code></pre></div>
<p>因为JavaScript中有2种任务：</p>
<p>宏任务(macro-task)：同步 script(整体代码)，setTimeout 回调函数，setlnterval 回调函数，l/O，Ul rendering;
微任务(micro-task)：process.nextTick，Promise 回调函数， Object.observe，MutationObserver
其执行的顺序是这样的:</p>
<p>首先 JavaScript 引擎会执行一个宏任务，注意这个宏任务一般是指主干代码本身，也就是目前的同步代码；
执行过程中如果遇到微任务，就把它添加到微任务任务队列中；
宏任务执行完成后，立即执行当前微任务队列中的微任务，直到微任务队列被清空；
微任务执行完成后，开始执行下一个宏任务；
如此循环往复，直到宏任务和微任务被清空。</p>
<h4 id="4useasync">4.用useAsync获取用户信息<a class="headerlink" href="#4useasync" title="Permanent link">&para;</a></h4>
<p>修改 <code>src\components\lib.tsx</code>（新增全屏 Loading 组件 和 全屏 Error 展示组件）：</p>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Spin</span><span class="p">,</span><span class="w"> </span><span class="nx">Typography</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;antd&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">DevTools</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;jira-dev-tool&quot;</span><span class="p">;</span>

<span class="p">...</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">FullPage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">styled</span><span class="p">.</span><span class="nx">div</span><span class="sb">`</span>
<span class="sb">  height: 100vh;</span>
<span class="sb">  display: flex;</span>
<span class="sb">  justify-content: center;</span>
<span class="sb">  align-items: center;</span>
<span class="sb">`</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">FullPageLoading</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">FullPage</span><span class="o">&gt;</span>
<span class="w">  </span><span class="o">&lt;</span><span class="nx">Spin</span><span class="w"> </span><span class="nx">size</span><span class="o">=</span><span class="s2">&quot;large&quot;</span><span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="err">/FullPage&gt;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">FullPageErrorFallback</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">({</span><span class="nx">error</span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">Error</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">FullPage</span><span class="o">&gt;</span>
<span class="w">  </span><span class="o">&lt;</span><span class="nx">DevTools</span><span class="o">/&gt;</span>
<span class="w">  </span><span class="o">&lt;</span><span class="nx">Typography</span><span class="p">.</span><span class="nx">Text</span><span class="w"> </span><span class="kr">type</span><span class="o">=</span><span class="s2">&quot;danger&quot;</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">error</span><span class="o">?</span><span class="p">.</span><span class="nx">message</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/Typography.Text&gt;</span>
<span class="o">&lt;</span><span class="err">/FullPage&gt;</span>
</code></pre></div>
<blockquote>
<ul>
<li>为了展示报错信息的同时，DevTools 依旧展示，需要引入</li>
</ul>
</blockquote>
<p>修改 <code>src\context\auth-context.tsx</code>（使用 <code>useAsync</code> 改造，并新增全屏 <code>Loading</code> 组件 和 全屏 <code>Error</code> 展示组件）（部分未修改内容省略）：</p>
<div class="highlight"><pre><span></span><code><span class="p">...</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useAsync</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;utils/use-async&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">FullPageErrorFallback</span><span class="p">,</span><span class="w"> </span><span class="nx">FullPageLoading</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;components/lib&quot;</span><span class="p">;</span>

<span class="p">...</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">AuthProvider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">({</span><span class="w"> </span><span class="nx">children</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">children</span><span class="o">:</span><span class="w"> </span><span class="kt">ReactNode</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// 这里要考虑到初始值的类型与后续值类型，取并组成一个泛型</span>
<span class="w">  </span><span class="c1">// const [user, setUser] = useState&lt;User | null&gt;(null);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="kt">user</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="nx">isLoading</span><span class="p">,</span><span class="w"> </span><span class="nx">isReady</span><span class="p">,</span><span class="w"> </span><span class="nx">isSuccess</span><span class="p">,</span><span class="w"> </span><span class="nx">isError</span><span class="p">,</span><span class="w"> </span><span class="nx">run</span><span class="p">,</span><span class="w"> </span><span class="nx">setData</span><span class="o">:</span><span class="w"> </span><span class="kt">setUser</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useAsync</span><span class="o">&lt;</span><span class="nx">User</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span><span class="o">&gt;</span><span class="p">()</span>

<span class="w">  </span><span class="p">...</span>

<span class="w">  </span><span class="nx">useMount</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">run</span><span class="p">(</span><span class="nx">initUser</span><span class="p">()));</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">isReady</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">isLoading</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">FullPageLoading</span><span class="o">/&gt;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">isError</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">FullPageErrorFallback</span><span class="w"> </span><span class="nx">error</span><span class="o">=</span><span class="p">{</span><span class="nx">error</span><span class="p">}</span><span class="o">/&gt;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(...);</span>
<span class="p">};</span>
<span class="p">...</span>
</code></pre></div>
<h4 id="5-error-boundaries">5.实现 Error Boundaries，捕获边界错误<a class="headerlink" href="#5-error-boundaries" title="Permanent link">&para;</a></h4>
<p>修改 <code>src\unauthenticated-app\index.tsx</code>（新增一个“<a href="https://so.csdn.net/so/search?q=抛出异常&amp;spm=1001.2101.3001.7020">抛出异常</a>”按钮）：</p>
<div class="highlight"><pre><span></span><code><span class="p">...</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">UnauthenticatedApp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">...</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">Container</span><span class="o">&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">Header</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">Background</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">Button</span><span class="w"> </span><span class="nx">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;点击抛出一个异常&#39;</span><span class="p">)</span>
<span class="w">      </span><span class="p">}}</span><span class="o">&gt;</span><span class="nx">抛出异常</span><span class="o">&lt;</span><span class="err">/Button&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">ShadowCard</span><span class="o">&gt;</span><span class="p">...</span><span class="o">&lt;</span><span class="err">/ShadowCard&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/Container&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">};</span>
<span class="p">...</span>
</code></pre></div>
<p>修改 <code>src\authenticated-app.tsx</code>（新增一个变量展示它不存在的一个属性）：</p>
<div class="highlight"><pre><span></span><code><span class="p">...</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">AuthenticatedApp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">...</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">undefined</span><span class="p">;</span>
<span class="w">  </span><span class="p">...</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">Container</span><span class="o">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="w"> </span><span class="nx">value</span><span class="p">.</span><span class="nx">notExist</span><span class="w"> </span><span class="p">}</span>
<span class="w">      </span><span class="p">...</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/Container&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">};</span>
<span class="p">...</span>
</code></pre></div>
<p>编译代码并全局安装推荐的 <code>serve</code> 库，然后启动并访问：</p>
<div class="highlight"><pre><span></span><code>npm<span class="w"> </span>run<span class="w"> </span>build
yarn<span class="w"> </span>global<span class="w"> </span>add<span class="w"> </span>serve
serve<span class="w"> </span>-s<span class="w"> </span>build
</code></pre></div>
<p>点击“抛出异常”按钮：</p>
<p>测试环境：页面展示抛出异常
生产环境：页面不变，控制台抛出异常
登录后：</p>
<p>测试环境：页面展示异常信息
生产环境：页面空白，控制台打印出异常信息
这两种异常对比可看出：在渲染阶段出现未被捕获的异常，整个组件树都会被卸载（错误的展示内容比空白内容更可怕）</p>
<p>错误边界 – React
接下来写一个错误边界捕获组件 —— 新建：src\components\error-boundary.tsx：</p>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nx">React</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ReactNode</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;react&quot;</span><span class="p">;</span>

<span class="kr">type</span><span class="w"> </span><span class="nx">FallbackRender</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">props</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">Error</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">React</span><span class="p">.</span><span class="nx">ReactElement</span>

<span class="c1">// children: ReactNode</span>
<span class="k">export</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">ErrorBoundary</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nx">React</span><span class="p">.</span><span class="nx">Component</span><span class="o">&lt;</span><span class="nx">React</span><span class="p">.</span><span class="nx">PropsWithChildren</span><span class="o">&lt;</span><span class="p">{</span><span class="nx">fallbackRender</span><span class="o">:</span><span class="w"> </span><span class="kt">FallbackRender</span><span class="p">}</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">Error</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="p">}</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">null</span><span class="w"> </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// 当子组件抛出异常，这里会接受到并更改 state</span>
<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="nx">getDerivedStateFromError</span><span class="p">(</span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">Error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">error</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">render</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">error</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">state</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">fallbackRender</span><span class="p">,</span><span class="w"> </span><span class="nx">children</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">props</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">error</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">fallbackRender</span><span class="p">({</span><span class="w"> </span><span class="nx">error</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">children</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>如果一个 class 组件中定义了 static getDerivedStateFromError() 或 componentDidCatch() 这两个生命周期方法中的任意一个（或两个）时，那么它就变成一个错误边界
React.PropsWithChildren 是 React 中的一个 Utility Types (工具类型) 类型处理器，将传入属性以类似 Object.assign 的方式合并:
type PropsWithChildren<P = unknown> = P &amp; { children?: ReactNode | undefined };
修改：src\App.tsx(使用错误边界组件 ErrorBoundary 包裹，并将异常展示在 FullPageErrorFallback 中)：</p>
<div class="highlight"><pre><span></span><code><span class="p">...</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ErrorBoundary</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;components/error-boundary&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">FullPageErrorFallback</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;components/lib&quot;</span><span class="p">;</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">App</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">...</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">div</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s2">&quot;App&quot;</span><span class="o">&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">ErrorBoundary</span><span class="w"> </span><span class="nx">fallbackRender</span><span class="o">=</span><span class="p">{</span><span class="nx">FullPageErrorFallback</span><span class="p">}</span><span class="o">&gt;</span>
<span class="w">       </span><span class="p">{</span><span class="nx">user</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">AuthenticatedApp</span><span class="w"> </span><span class="o">/&gt;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">UnauthenticatedApp</span><span class="w"> </span><span class="o">/&gt;</span><span class="p">}</span>
<span class="w">      </span><span class="o">&lt;</span><span class="err">/ErrorBoundary&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
<span class="p">...</span>
</code></pre></div>
<p>重新编译代码并重启serve,然后访问：</p>
<div class="highlight"><pre><span></span><code>npm<span class="w"> </span>run<span class="w"> </span>build
serve<span class="w"> </span>-s<span class="w"> </span>build
<span class="m">12</span>
</code></pre></div>
<p>手动抛出错误还是原样，渲染异常导致的边界错误被截获并展示！</p>
<div class="highlight"><pre><span></span><code>Cannot<span class="w"> </span><span class="nb">read</span><span class="w"> </span>property<span class="w"> </span><span class="s1">&#39;notExist&#39;</span><span class="w"> </span>of<span class="w"> </span>undefined
</code></pre></div>
<p>测试结束后清除以下两个文件中的测试内容（“抛出异常”按钮 和 “value”）：</p>
<ul>
<li><code>src\unauthenticated-app\index.tsx</code></li>
<li><code>src\authenticated-app.tsx</code></li>
</ul>
<h2 id="7-12">7-12节后续的笔记<a class="headerlink" href="#7-12" title="Permanent link">&para;</a></h2>
<p>这次没有整理完，这是后面笔记的链接，整体笔记细节很多</p>
<p><a href="https://iseeu.blog.csdn.net/article/details/132747686">https://iseeu.blog.csdn.net/article/details/132747686</a></p>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">November 9, 2024</span>
  </span>

    
    
    
      
  
  <span class="md-source-file__fact">
    <span class="md-icon" title="Contributors">
      
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 4a4 4 0 0 1 4 4 4 4 0 0 1-4 4 4 4 0 0 1-4-4 4 4 0 0 1 4-4m0 10c4.42 0 8 1.79 8 4v2H4v-2c0-2.21 3.58-4 8-4"/></svg>
      
    </span>
    <nav>
      
        <a href="mailto:2331806369@qq.com">Michael An</a>
    </nav>
  </span>

    
    
  </aside>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; Michael An
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.83f73b43.min.js"></script>
      
        <script src="../../js/baidu-statistics.min.js"></script>
      
        <script src="../../js/history.min.js"></script>
      
    
  </body>
</html>