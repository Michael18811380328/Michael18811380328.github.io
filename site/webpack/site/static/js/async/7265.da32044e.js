"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["7265"],{7526:function(e,n,r){r.r(n),r.d(n,{default:function(){return a}});var t=r(6469),s=r(8809);function i(e){let n=Object.assign({h1:"h1",a:"a",p:"p",pre:"pre",code:"code",strong:"strong",ul:"ul",li:"li",h2:"h2",h3:"h3",h4:"h4",h5:"h5",blockquote:"blockquote",h6:"h6",ol:"ol"},(0,s.ah)(),e.components);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.h1,{id:"前端页面测试",children:["前端页面测试",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#前端页面测试",children:"#"})]}),"\n",(0,t.jsx)(n.p,{children:"统计信息：字数 33858  阅读68分钟"}),"\n",(0,t.jsxs)(n.p,{children:["关于函数测试，比如有一些固定的输入输出，可以使用mocha来进行测试，参考 ",(0,t.jsx)(n.a,{href:"https://www.jianshu.com/p/368d580d4365",target:"_blank",rel:"noopener noreferrer",children:"Mocha测试基本使用"}),"。"]}),"\n",(0,t.jsxs)(n.p,{children:["关于页面功能的测试，推荐",(0,t.jsx)(n.a,{href:"https://link.jianshu.com/?t=http%3A%2F%2Fwww.nightmarejs.org%2F",target:"_blank",rel:"noopener noreferrer",children:"nightmare"}),"。"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"var Nightmare = require('nightmare');\nvar nightmare = Nightmare({ show: true });\n\nnightmare\n  .goto('https://www.taobao.com/')  //待测试链接\n  .type('#q', '电视机')   //输入框选中，输入值\n  .click('form[action*=\"/search\"] [type=submit]')//form表单提交\n  .wait(3000)\n  .exists('#spulist-grid')\n  .evaluate(function () {\n    return document.querySelector('#spulist-grid .grid-item .info-cont') //获取需返回的值\n      .textContent.trim();\n  })\n  .end()\n  .then(function (result) {  //即为return中的数据\n    console.log(result);\n  })\n  .catch(function (error) {  //错误捕捉\n    console.error('Search failed:', error);\n  });\n"})}),"\n",(0,t.jsx)(n.p,{children:"可以结合mocha使用。"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"var Nightmare = require('nightmare');\nvar expect = require('chai').expect;\nvar fork = require('child_process').fork;\n\ndescribe('test index.html', function() {\n  var child;\n\n  before(function (done) {   //钩子函数，测试之前调用\n    child = fork('./server.js');\n    child.on('message', function (msg) {\n      if (msg === 'listening') {\n        done();\n      }\n    });\n  });\n\n  after(function () { //钩子函数，测试之后调用\n    child.kill();\n  });\n\n  it('点击后标题改变', function (done) {\n    var nightmare = Nightmare({ show: true });\n    nightmare\n      .goto('http://127.0.0.1:8080/index.html')\n      .click('h1')\n      .wait(1000)\n      .evaluate(function () {\n        return document.querySelector('h1').style.color;\n      })\n      .end()\n      .then(function(color) {\n        console.log(color)\n        expect(color).to.equal('red');\n        done();\n      })\n  });\n\n});\n"})}),"\n",(0,t.jsxs)(n.h1,{id:"nightmare",children:["Nightmare",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#nightmare",children:"#"})]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://github.com/segmentio/nightmare#api",target:"_blank",rel:"noopener noreferrer",children:"https://github.com/segmentio/nightmare#api"})}),"\n",(0,t.jsxs)(n.p,{children:["Nightmare is a high-level browser automation library from ",(0,t.jsx)(n.a,{href:"https://segment.com/",target:"_blank",rel:"noopener noreferrer",children:"Segment"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["The goal is to expose a few simple methods that mimic user actions (like ",(0,t.jsx)(n.code,{children:"goto"}),", ",(0,t.jsx)(n.code,{children:"type"})," and ",(0,t.jsx)(n.code,{children:"click"}),"), with an API that feels synchronous for each block of scripting, rather than deeply nested callbacks. It was originally designed for automating tasks across sites that don't have APIs, but is most often used for UI testing and crawling."]}),"\n",(0,t.jsxs)(n.p,{children:["Under the covers it uses ",(0,t.jsx)(n.a,{href:"http://electron.atom.io/",target:"_blank",rel:"noopener noreferrer",children:"Electron"}),", which is similar to ",(0,t.jsx)(n.a,{href:"http://phantomjs.org/",target:"_blank",rel:"noopener noreferrer",children:"PhantomJS"})," but roughly ",(0,t.jsx)(n.a,{href:"https://github.com/segmentio/nightmare/issues/484#issuecomment-184519591",target:"_blank",rel:"noopener noreferrer",children:"twice as fast"})," and more modern."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"⚠️ Security Warning:"})," We've implemented ",(0,t.jsx)(n.a,{href:"https://github.com/segmentio/nightmare/issues/1388",target:"_blank",rel:"noopener noreferrer",children:"many"})," of the security recommendations ",(0,t.jsx)(n.a,{href:"https://github.com/electron/electron/blob/master/docs/tutorial/security.md",target:"_blank",rel:"noopener noreferrer",children:"outlined by Electron"})," to try and keep you safe, but undiscovered vulnerabilities may exist in Electron that could allow a malicious website to execute code on your computer. Avoid visiting untrusted websites."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\uD83D\uDEE0 Migrating to 3.x:"})," You'll want to check out ",(0,t.jsx)(n.a,{href:"https://github.com/segmentio/nightmare/issues/1396",target:"_blank",rel:"noopener noreferrer",children:"this issue"})," before upgrading. We've worked hard to make improvements to nightmare while limiting the breaking changes and there's a good chance you won't need to do anything."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"https://github.com/segmentio/niffy",target:"_blank",rel:"noopener noreferrer",children:"Niffy"})," is a perceptual diffing tool built on Nightmare. It helps you detect UI changes and bugs across releases of your web app."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"https://github.com/segmentio/daydream",target:"_blank",rel:"noopener noreferrer",children:"Daydream"})," is a complementary chrome extension built by ",(0,t.jsx)(n.a,{href:"https://github.com/stevenmiller888",target:"_blank",rel:"noopener noreferrer",children:"@stevenmiller888"})," that generates Nightmare scripts for you while you browse."]}),"\n",(0,t.jsxs)(n.p,{children:["Many thanks to ",(0,t.jsx)(n.a,{href:"https://github.com/matthewmueller",target:"_blank",rel:"noopener noreferrer",children:"@matthewmueller"})," and ",(0,t.jsx)(n.a,{href:"https://github.com/rosshinkley",target:"_blank",rel:"noopener noreferrer",children:"@rosshinkley"})," for their help on Nightmare."]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Examples","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://segment.com/blog/ui-testing-with-nightmare/",target:"_blank",rel:"noopener noreferrer",children:"UI Testing Quick Start"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://segment.com/blog/perceptual-diffing-with-niffy/",target:"_blank",rel:"noopener noreferrer",children:"Perceptual Diffing with Niffy & Nightmare"})}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["API","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/segmentio/nightmare#nightmareoptions",target:"_blank",rel:"noopener noreferrer",children:"Set up an instance"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/segmentio/nightmare#interact-with-the-page",target:"_blank",rel:"noopener noreferrer",children:"Interact with the page"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/segmentio/nightmare#extract-from-the-page",target:"_blank",rel:"noopener noreferrer",children:"Extract from the page"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/segmentio/nightmare#cookies",target:"_blank",rel:"noopener noreferrer",children:"Cookies"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/segmentio/nightmare#proxies",target:"_blank",rel:"noopener noreferrer",children:"Proxies"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/segmentio/nightmare#promises",target:"_blank",rel:"noopener noreferrer",children:"Promises"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/segmentio/nightmare#extending-nightmare",target:"_blank",rel:"noopener noreferrer",children:"Extending Nightmare"})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/segmentio/nightmare#usage",target:"_blank",rel:"noopener noreferrer",children:"Usage"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/segmentio/nightmare#debugging",target:"_blank",rel:"noopener noreferrer",children:"Debugging"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/segmentio/nightmare#additional-resources",target:"_blank",rel:"noopener noreferrer",children:"Additional Resources"})}),"\n"]}),"\n",(0,t.jsxs)(n.h2,{id:"examples",children:["Examples",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#examples",children:"#"})]}),"\n",(0,t.jsx)(n.p,{children:"Let's search on DuckDuckGo:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"const Nightmare = require('nightmare')\nconst nightmare = Nightmare({ show: true })\n\nnightmare\n  .goto('https://duckduckgo.com')\n  .type('#search_form_input_homepage', 'github nightmare')\n  .click('#search_button_homepage')\n  .wait('#r1-0 a.result__a')\n  .evaluate(() => document.querySelector('#r1-0 a.result__a').href)\n  .end()\n  .then(console.log)\n  .catch(error => {\n    console.error('Search failed:', error)\n  })\n"})}),"\n",(0,t.jsx)(n.p,{children:"You can run this with:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"npm install --save nightmare\nnode example.js\n"})}),"\n",(0,t.jsx)(n.p,{children:"Or, let's run some mocha tests:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"const Nightmare = require('nightmare')\nconst chai = require('chai')\nconst expect = chai.expect\n\ndescribe('test duckduckgo search results', () => {\n  it('should find the nightmare github link first', function(done) {\n    this.timeout('10s')\n\n    const nightmare = Nightmare()\n    nightmare\n      .goto('https://duckduckgo.com')\n      .type('#search_form_input_homepage', 'github nightmare')\n      .click('#search_button_homepage')\n      .wait('#links .result__a')\n      .evaluate(() => document.querySelector('#links .result__a').href)\n      .end()\n      .then(link => {\n        expect(link).to.equal('https://github.com/segmentio/nightmare')\n        done()\n      })\n  })\n})\n"})}),"\n",(0,t.jsxs)(n.p,{children:["You can see examples of every function ",(0,t.jsx)(n.a,{href:"https://github.com/segmentio/nightmare/blob/master/test/index.js",target:"_blank",rel:"noopener noreferrer",children:"in the tests here"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["To get started with UI Testing, check out this ",(0,t.jsx)(n.a,{href:"https://segment.com/blog/ui-testing-with-nightmare",target:"_blank",rel:"noopener noreferrer",children:"quick start guide"}),"."]}),"\n",(0,t.jsxs)(n.h3,{id:"to-run-the-mocha-tests",children:["To run the mocha tests",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#to-run-the-mocha-tests",children:"#"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"npm test\n"})}),"\n",(0,t.jsxs)(n.h2,{id:"api",children:["API",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#api",children:"#"})]}),"\n",(0,t.jsxs)(n.h4,{id:"nightmareoptions",children:["Nightmare(options)",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#nightmareoptions",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["Creates a new instance that can navigate around the web. The available options are ",(0,t.jsx)(n.a,{href:"https://github.com/atom/electron/blob/master/docs/api/browser-window.md#new-browserwindowoptions",target:"_blank",rel:"noopener noreferrer",children:"documented here"}),", along with the following nightmare-specific options."]}),"\n",(0,t.jsxs)(n.h5,{id:"waittimeout-default-30s",children:["waitTimeout (default: 30s)",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#waittimeout-default-30s",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["Throws an exception if the ",(0,t.jsx)(n.code,{children:".wait()"})," didn't return ",(0,t.jsx)(n.code,{children:"true"})," within the set timeframe."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"const nightmare = Nightmare({\n  waitTimeout: 1000 // in ms\n})\n"})}),"\n",(0,t.jsxs)(n.h5,{id:"gototimeout-default-30s",children:["gotoTimeout (default: 30s)",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#gototimeout-default-30s",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["Throws an exception if the ",(0,t.jsx)(n.code,{children:".goto()"})," didn't finish loading within the set timeframe. Note that, even though ",(0,t.jsx)(n.code,{children:"goto"})," normally waits for all the resources on a page to load, a timeout exception is only raised if the DOM itself has not yet loaded."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"const nightmare = Nightmare({\n  gotoTimeout: 1000 // in ms\n})\n"})}),"\n",(0,t.jsxs)(n.h5,{id:"loadtimeout-default-infinite",children:["loadTimeout (default: infinite)",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#loadtimeout-default-infinite",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["Forces Nightmare to move on if a page transition caused by an action (eg, ",(0,t.jsx)(n.code,{children:".click()"}),") didn't finish within the set timeframe. If ",(0,t.jsx)(n.code,{children:"loadTimeout"})," is shorter than ",(0,t.jsx)(n.code,{children:"gotoTimeout"}),", the exceptions thrown by ",(0,t.jsx)(n.code,{children:"gotoTimeout"})," will be suppressed."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"const nightmare = Nightmare({\n  loadTimeout: 1000 // in ms\n})\n"})}),"\n",(0,t.jsxs)(n.h5,{id:"executiontimeout-default-30s",children:["executionTimeout (default: 30s)",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#executiontimeout-default-30s",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["The maximum amount of time to wait for an ",(0,t.jsx)(n.code,{children:".evaluate()"})," statement to complete."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"const nightmare = Nightmare({\n  executionTimeout: 1000 // in ms\n})\n"})}),"\n",(0,t.jsxs)(n.h5,{id:"paths",children:["paths",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#paths",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["The default system paths that Electron knows about. Here's a list of available paths: ",(0,t.jsx)(n.a,{href:"https://github.com/atom/electron/blob/master/docs/api/app.md#appgetpathname",target:"_blank",rel:"noopener noreferrer",children:"https://github.com/atom/electron/blob/master/docs/api/app.md#appgetpathname"})]}),"\n",(0,t.jsx)(n.p,{children:"You can overwrite them in Nightmare by doing the following:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"const nightmare = Nightmare({\n  paths: {\n    userData: '/user/data'\n  }\n})\n"})}),"\n",(0,t.jsxs)(n.h5,{id:"switches",children:["switches",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#switches",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["The command line switches used by the Chrome browser that are also supported by Electron. Here's a list of supported Chrome command line switches: ",(0,t.jsx)(n.a,{href:"https://github.com/atom/electron/blob/master/docs/api/chrome-command-line-switches.md",target:"_blank",rel:"noopener noreferrer",children:"https://github.com/atom/electron/blob/master/docs/api/chrome-command-line-switches.md"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"const nightmare = Nightmare({\n  switches: {\n    'proxy-server': '1.2.3.4:5678',\n    'ignore-certificate-errors': true\n  }\n})\n"})}),"\n",(0,t.jsxs)(n.h5,{id:"electronpath",children:["electronPath",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#electronpath",children:"#"})]}),"\n",(0,t.jsx)(n.p,{children:"The path to the prebuilt Electron binary. This is useful for testing on different versions of Electron. Note that Nightmare only supports the version on which this package depends. Use this option at your own risk."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"const nightmare = Nightmare({\n  electronPath: require('electron')\n})\n"})}),"\n",(0,t.jsxs)(n.h5,{id:"dock-os-x",children:["dock (OS X)",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#dock-os-x",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["A boolean to optionally show the Electron icon in the dock (defaults to ",(0,t.jsx)(n.code,{children:"false"}),"). This is useful for testing purposes."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"const nightmare = Nightmare({\n  dock: true\n})\n"})}),"\n",(0,t.jsxs)(n.h5,{id:"opendevtools",children:["openDevTools",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#opendevtools",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["Optionally shows the DevTools in the Electron window using ",(0,t.jsx)(n.code,{children:"true"}),", or use an object hash containing ",(0,t.jsx)(n.code,{children:"mode: 'detach'"})," to show in a separate window. The hash gets passed to ",(0,t.jsx)(n.a,{href:"https://github.com/electron/electron/blob/master/docs/api/web-contents.md#contentsopendevtoolsoptions",target:"_blank",rel:"noopener noreferrer",children:(0,t.jsx)(n.code,{children:"contents.openDevTools()"})})," to be handled. This is also useful for testing purposes. Note that this option is honored only if ",(0,t.jsx)(n.code,{children:"show"})," is set to ",(0,t.jsx)(n.code,{children:"true"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"const nightmare = Nightmare({\n  openDevTools: {\n    mode: 'detach'\n  },\n  show: true\n})\n"})}),"\n",(0,t.jsxs)(n.h5,{id:"typeinterval-default-100ms",children:["typeInterval (default: 100ms)",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#typeinterval-default-100ms",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["How long to wait between keystrokes when using ",(0,t.jsx)(n.code,{children:".type()"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"const nightmare = Nightmare({\n  typeInterval: 20\n})\n"})}),"\n",(0,t.jsxs)(n.h5,{id:"pollinterval-default-250ms",children:["pollInterval (default: 250ms)",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#pollinterval-default-250ms",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["How long to wait between checks for the ",(0,t.jsx)(n.code,{children:".wait()"})," condition to be successful."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"const nightmare = Nightmare({\n  pollInterval: 50 //in ms\n})\n"})}),"\n",(0,t.jsxs)(n.h5,{id:"maxauthretries-default-3",children:["maxAuthRetries (default: 3)",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#maxauthretries-default-3",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["Defines the number of times to retry an authentication when set up with ",(0,t.jsx)(n.code,{children:".authenticate()"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"const nightmare = Nightmare({\n  maxAuthRetries: 3\n})\n"})}),"\n",(0,t.jsxs)(n.h4,{id:"certificatesubjectname",children:["certificateSubjectName",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#certificatesubjectname",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["A string to determine the client certificate selected by electron. If this options is set, the ",(0,t.jsx)(n.a,{href:"https://github.com/electron/electron/blob/master/docs/api/app.md#event-select-client-certificate",target:"_blank",rel:"noopener noreferrer",children:(0,t.jsx)(n.code,{children:"select-client-certificate"})})," event will be set to loop through the certificateList and find the first certificate that matches ",(0,t.jsx)(n.code,{children:"subjectName"})," on the electron ",(0,t.jsx)(n.a,{href:"https://electronjs.org/docs/api/structures/certificate",target:"_blank",rel:"noopener noreferrer",children:(0,t.jsx)(n.code,{children:"Certificate Object"})}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"const nightmare = Nightmare({\n  certificateSubjectName: 'tester'\n})\n"})}),"\n",(0,t.jsxs)(n.h4,{id:"engineversions",children:[".engineVersions()",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#engineversions",children:"#"})]}),"\n",(0,t.jsx)(n.p,{children:"Gets the versions for Electron and Chromium."}),"\n",(0,t.jsxs)(n.h4,{id:"useragentuseragent",children:[".useragent(useragent)",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#useragentuseragent",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["Sets the ",(0,t.jsx)(n.code,{children:"useragent"})," used by electron."]}),"\n",(0,t.jsxs)(n.h4,{id:"authenticationuser-password",children:[".authentication(user, password)",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#authenticationuser-password",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["Sets the ",(0,t.jsx)(n.code,{children:"user"})," and ",(0,t.jsx)(n.code,{children:"password"})," for accessing a web page using basic authentication. Be sure to set it before calling ",(0,t.jsx)(n.code,{children:".goto(url)"}),"."]}),"\n",(0,t.jsxs)(n.h4,{id:"end",children:[".end()",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#end",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["Completes any queue operations, disconnect and close the electron process. Note that if you're using promises, ",(0,t.jsx)(n.code,{children:".then()"})," must be called after ",(0,t.jsx)(n.code,{children:".end()"})," to run the ",(0,t.jsx)(n.code,{children:".end()"})," task. Also note that if using an ",(0,t.jsx)(n.code,{children:".end()"})," callback, the ",(0,t.jsx)(n.code,{children:".end()"})," call is equivalent to calling ",(0,t.jsx)(n.code,{children:".end()"})," followed by ",(0,t.jsx)(n.code,{children:".then(fn)"}),". Consider:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"nightmare\n  .goto(someUrl)\n  .end(() => 'some value')\n  //prints \"some value\"\n  .then(console.log)\n"})}),"\n",(0,t.jsxs)(n.h4,{id:"halterror-done",children:[".halt(error, done)",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#halterror-done",children:"#"})]}),"\n",(0,t.jsx)(n.p,{children:"Clears all queued operations, kills the electron process, and passes error message or 'Nightmare Halted' to an unresolved promise. Done will be called after the process has exited."}),"\n",(0,t.jsxs)(n.h3,{id:"interact-with-the-page",children:["Interact with the Page",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#interact-with-the-page",children:"#"})]}),"\n",(0,t.jsxs)(n.h4,{id:"gotourl-headers",children:[".goto(url[, headers])",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#gotourl-headers",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["Loads the page at ",(0,t.jsx)(n.code,{children:"url"}),". Optionally, a ",(0,t.jsx)(n.code,{children:"headers"})," hash can be supplied to set headers on the ",(0,t.jsx)(n.code,{children:"goto"})," request."]}),"\n",(0,t.jsxs)(n.p,{children:["When a page load is successful, ",(0,t.jsx)(n.code,{children:"goto"})," returns an object with metadata about the page load, including:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"url"}),": The URL that was loaded"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"code"}),": The HTTP status code (e.g. 200, 404, 500)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"method"}),': The HTTP method used (e.g. "GET", "POST")']}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"referrer"}),": The page that the window was displaying prior to this load or an empty string if this is the first page load."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"headers"}),": An object representing the response headers for the request as in ",(0,t.jsx)(n.code,{children:"{header1-name: header1-value, header2-name: header2-value}"})]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"If the page load fails, the error will be an object with the following properties:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"message"}),": A string describing the type of error"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"code"}),": The underlying error code describing what went wrong. Note this is NOT the HTTP status code. For possible values, see ",(0,t.jsx)(n.a,{href:"https://code.google.com/p/chromium/codesearch#chromium/src/net/base/net_error_list.h",target:"_blank",rel:"noopener noreferrer",children:"https://code.google.com/p/chromium/codesearch#chromium/src/net/base/net_error_list.h"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"details"}),": A string with additional details about the error. This may be null or an empty string."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"url"}),": The URL that failed to load"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Note that any valid response from a server is considered “successful.” That means things like 404 “not found” errors are successful results for ",(0,t.jsx)(n.code,{children:"goto"}),". Only things that would cause no page to appear in the browser window, such as no server responding at the given address, the server hanging up in the middle of a response, or invalid URLs, are errors."]}),"\n",(0,t.jsxs)(n.p,{children:["You can also adjust how long ",(0,t.jsx)(n.code,{children:"goto"})," will wait before timing out by setting the ",(0,t.jsxs)(n.a,{href:"https://github.com/segmentio/nightmare#gototimeout-default-30s",target:"_blank",rel:"noopener noreferrer",children:[(0,t.jsx)(n.code,{children:"gotoTimeout"})," option"]})," on the Nightmare constructor."]}),"\n",(0,t.jsxs)(n.h4,{id:"back",children:[".back()",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#back",children:"#"})]}),"\n",(0,t.jsx)(n.p,{children:"Goes back to the previous page."}),"\n",(0,t.jsxs)(n.h4,{id:"forward",children:[".forward()",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#forward",children:"#"})]}),"\n",(0,t.jsx)(n.p,{children:"Goes forward to the next page."}),"\n",(0,t.jsxs)(n.h4,{id:"refresh",children:[".refresh()",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#refresh",children:"#"})]}),"\n",(0,t.jsx)(n.p,{children:"Refreshes the current page."}),"\n",(0,t.jsxs)(n.h4,{id:"clickselector",children:[".click(selector)",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#clickselector",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["Clicks the ",(0,t.jsx)(n.code,{children:"selector"})," element once."]}),"\n",(0,t.jsxs)(n.h4,{id:"mousedownselector",children:[".mousedown(selector)",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#mousedownselector",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["Mousedowns the ",(0,t.jsx)(n.code,{children:"selector"})," element once."]}),"\n",(0,t.jsxs)(n.h4,{id:"mouseupselector",children:[".mouseup(selector)",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#mouseupselector",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["Mouseups the ",(0,t.jsx)(n.code,{children:"selector"})," element once."]}),"\n",(0,t.jsxs)(n.h4,{id:"mouseoverselector",children:[".mouseover(selector)",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#mouseoverselector",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["Mouseovers the ",(0,t.jsx)(n.code,{children:"selector"})," element once."]}),"\n",(0,t.jsxs)(n.h4,{id:"mouseoutselector",children:[".mouseout(selector)",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#mouseoutselector",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["Mouseout the ",(0,t.jsx)(n.code,{children:"selector"})," element once."]}),"\n",(0,t.jsxs)(n.h4,{id:"typeselector-text",children:[".type(selector[, text])",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#typeselector-text",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["Enters the ",(0,t.jsx)(n.code,{children:"text"})," provided into the ",(0,t.jsx)(n.code,{children:"selector"})," element. Empty or falsey values provided for ",(0,t.jsx)(n.code,{children:"text"})," will clear the selector's value."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:".type()"})," mimics a user typing in a textbox and will emit the proper keyboard events."]}),"\n",(0,t.jsxs)(n.p,{children:["Key presses can also be fired using Unicode values with ",(0,t.jsx)(n.code,{children:".type()"}),". For example, if you wanted to fire an enter key press, you would write ",(0,t.jsx)(n.code,{children:".type('body', '\\u000d')"}),"."]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["If you don't need the keyboard events, consider using ",(0,t.jsx)(n.code,{children:".insert()"})," instead as it will be faster and more robust."]}),"\n"]}),"\n",(0,t.jsxs)(n.h4,{id:"insertselector-text",children:[".insert(selector[, text])",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#insertselector-text",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["Similar to ",(0,t.jsx)(n.code,{children:".type()"}),", ",(0,t.jsx)(n.code,{children:".insert()"})," enters the ",(0,t.jsx)(n.code,{children:"text"})," provided into the ",(0,t.jsx)(n.code,{children:"selector"})," element. Empty or falsey values provided for ",(0,t.jsx)(n.code,{children:"text"})," will clear the selector's value."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:".insert()"})," is faster than ",(0,t.jsx)(n.code,{children:".type()"})," but does not trigger the keyboard events."]}),"\n",(0,t.jsxs)(n.h4,{id:"checkselector",children:[".check(selector)",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#checkselector",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["Checks the ",(0,t.jsx)(n.code,{children:"selector"})," checkbox element."]}),"\n",(0,t.jsxs)(n.h4,{id:"uncheckselector",children:[".uncheck(selector)",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#uncheckselector",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["Unchecks the ",(0,t.jsx)(n.code,{children:"selector"})," checkbox element."]}),"\n",(0,t.jsxs)(n.h4,{id:"selectselector-option",children:[".select(selector, option)",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#selectselector-option",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["Changes the ",(0,t.jsx)(n.code,{children:"selector"})," dropdown element to the option with attribute [value=",(0,t.jsx)(n.code,{children:"option"}),"]"]}),"\n",(0,t.jsxs)(n.h4,{id:"scrolltotop-left",children:[".scrollTo(top, left)",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#scrolltotop-left",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["Scrolls the page to desired position. ",(0,t.jsx)(n.code,{children:"top"})," and ",(0,t.jsx)(n.code,{children:"left"})," are always relative to the top left corner of the document."]}),"\n",(0,t.jsxs)(n.h4,{id:"viewportwidth-height",children:[".viewport(width, height)",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#viewportwidth-height",children:"#"})]}),"\n",(0,t.jsx)(n.p,{children:"Sets the viewport size."}),"\n",(0,t.jsxs)(n.h4,{id:"injecttype-file",children:[".inject(type, file)",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#injecttype-file",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["Injects a local ",(0,t.jsx)(n.code,{children:"file"})," onto the current page. The file ",(0,t.jsx)(n.code,{children:"type"})," must be either ",(0,t.jsx)(n.code,{children:"js"})," or ",(0,t.jsx)(n.code,{children:"css"}),"."]}),"\n",(0,t.jsxs)(n.h4,{id:"evaluatefn-arg1-arg2",children:[".evaluate(fn[, arg1, arg2,...])",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#evaluatefn-arg1-arg2",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["Invokes ",(0,t.jsx)(n.code,{children:"fn"})," on the page with ",(0,t.jsx)(n.code,{children:"arg1, arg2,..."}),". All the ",(0,t.jsx)(n.code,{children:"args"})," are optional. On completion it returns the return value of ",(0,t.jsx)(n.code,{children:"fn"}),". Useful for extracting information from the page. Here's an example:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"const selector = 'h1'\nnightmare\n  .evaluate(selector => {\n    // now we're executing inside the browser scope.\n    return document.querySelector(selector).innerText\n  }, selector) // <-- that's how you pass parameters from Node scope to browser scope\n  .then(text => {\n    // ...\n  })\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Error-first callbacks are supported as a part of ",(0,t.jsx)(n.code,{children:"evaluate()"}),". If the arguments passed are one fewer than the arguments expected for the evaluated function, the evaluation will be passed a callback as the last parameter to the function. For example:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"const selector = 'h1'\nnightmare\n  .evaluate((selector, done) => {\n    // now we're executing inside the browser scope.\n    setTimeout(\n      () => done(null, document.querySelector(selector).innerText),\n      2000\n    )\n  }, selector)\n  .then(text => {\n    // ...\n  })\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Note that callbacks support only one value argument (eg ",(0,t.jsx)(n.code,{children:"function(err, value)"}),"). Ultimately, the callback will get wrapped in a native Promise and only be able to resolve a single value."]}),"\n",(0,t.jsxs)(n.p,{children:["Promises are also supported as a part of ",(0,t.jsx)(n.code,{children:"evaluate()"}),". If the return value of the function has a ",(0,t.jsx)(n.code,{children:"then"})," member, ",(0,t.jsx)(n.code,{children:".evaluate()"})," assumes it is waiting for a promise. For example:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"const selector = 'h1';\nnightmare\n  .evaluate((selector) => (\n    new Promise((resolve, reject) => {\n      setTimeout(() => resolve(document.querySelector(selector).innerText), 2000);\n    )}, selector)\n  )\n  .then((text) => {\n    // ...\n  })\n"})}),"\n",(0,t.jsxs)(n.h4,{id:"waitms",children:[".wait(ms)",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#waitms",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["Waits for ",(0,t.jsx)(n.code,{children:"ms"})," milliseconds e.g. ",(0,t.jsx)(n.code,{children:".wait(5000)"}),"."]}),"\n",(0,t.jsxs)(n.h4,{id:"waitselector",children:[".wait(selector)",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#waitselector",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["Waits until the element ",(0,t.jsx)(n.code,{children:"selector"})," is present e.g. ",(0,t.jsx)(n.code,{children:".wait('#pay-button')"}),"."]}),"\n",(0,t.jsxs)(n.h4,{id:"waitfn-arg1-arg2",children:[".wait(fn[, arg1, arg2,...])",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#waitfn-arg1-arg2",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["Waits until the ",(0,t.jsx)(n.code,{children:"fn"})," evaluated on the page with ",(0,t.jsx)(n.code,{children:"arg1, arg2,..."})," returns ",(0,t.jsx)(n.code,{children:"true"}),". All the ",(0,t.jsx)(n.code,{children:"args"})," are optional. See ",(0,t.jsx)(n.code,{children:".evaluate()"})," for usage."]}),"\n",(0,t.jsxs)(n.h4,{id:"headerheader-value",children:[".header(header, value)",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#headerheader-value",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["Adds a header override for all HTTP requests. If ",(0,t.jsx)(n.code,{children:"header"})," is undefined, the header overrides will be reset."]}),"\n",(0,t.jsxs)(n.h3,{id:"extract-from-the-page",children:["Extract from the Page",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#extract-from-the-page",children:"#"})]}),"\n",(0,t.jsxs)(n.h4,{id:"existsselector",children:[".exists(selector)",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#existsselector",children:"#"})]}),"\n",(0,t.jsx)(n.p,{children:"Returns whether the selector exists or not on the page."}),"\n",(0,t.jsxs)(n.h4,{id:"visibleselector",children:[".visible(selector)",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#visibleselector",children:"#"})]}),"\n",(0,t.jsx)(n.p,{children:"Returns whether the selector is visible or not."}),"\n",(0,t.jsxs)(n.h4,{id:"onevent-callback",children:[".on(event, callback)",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#onevent-callback",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["Captures page events with the callback. You have to call ",(0,t.jsx)(n.code,{children:".on()"})," before calling ",(0,t.jsx)(n.code,{children:".goto()"}),". Supported events are ",(0,t.jsx)(n.a,{href:"http://electron.atom.io/docs/api/web-contents/#class-webcontents",target:"_blank",rel:"noopener noreferrer",children:"documented here"}),"."]}),"\n",(0,t.jsxs)(n.h5,{id:"additional-page-events",children:['Additional "page" events',(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#additional-page-events",children:"#"})]}),"\n",(0,t.jsxs)(n.h6,{id:"onpage-functiontypeerror-message-stack",children:[".on('page', function(type=\"error\", message, stack))",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#onpage-functiontypeerror-message-stack",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["This event is triggered if any javascript exception is thrown on the page. But this event is not triggered if the injected javascript code (e.g. via ",(0,t.jsx)(n.code,{children:".evaluate()"}),") is throwing an exception."]}),"\n",(0,t.jsxs)(n.h5,{id:"page-events",children:['"page" events',(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#page-events",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["Listens for ",(0,t.jsx)(n.code,{children:"window.addEventListener('error')"}),", ",(0,t.jsx)(n.code,{children:"alert(...)"}),", ",(0,t.jsx)(n.code,{children:"prompt(...)"})," & ",(0,t.jsx)(n.code,{children:"confirm(...)"}),"."]}),"\n",(0,t.jsxs)(n.h6,{id:"onpage-functiontypeerror-message-stack-1",children:[".on('page', function(type=\"error\", message, stack))",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#onpage-functiontypeerror-message-stack-1",children:"#"})]}),"\n",(0,t.jsx)(n.p,{children:"Listens for top-level page errors. This will get triggered when an error is thrown on the page."}),"\n",(0,t.jsxs)(n.h6,{id:"onpage-functiontypealert-message",children:[".on('page', function(type=\"alert\", message))",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#onpage-functiontypealert-message",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["Nightmare disables ",(0,t.jsx)(n.code,{children:"window.alert"})," from popping up by default, but you can still listen for the contents of the alert dialog."]}),"\n",(0,t.jsxs)(n.h6,{id:"onpage-functiontypeprompt-message-response",children:[".on('page', function(type=\"prompt\", message, response))",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#onpage-functiontypeprompt-message-response",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["Nightmare disables ",(0,t.jsx)(n.code,{children:"window.prompt"})," from popping up by default, but you can still listen for the message to come up. If you need to handle the confirmation differently, you'll need to use your own preload script."]}),"\n",(0,t.jsxs)(n.h6,{id:"onpage-functiontypeconfirm-message-response",children:[".on('page', function(type=\"confirm\", message, response))",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#onpage-functiontypeconfirm-message-response",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["Nightmare disables ",(0,t.jsx)(n.code,{children:"window.confirm"})," from popping up by default, but you can still listen for the message to come up. If you need to handle the confirmation differently, you'll need to use your own preload script."]}),"\n",(0,t.jsxs)(n.h6,{id:"onconsole-functiontype--arguments-",children:[".on('console', function(type [, arguments, ...]))",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#onconsole-functiontype--arguments-",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"type"})," will be either ",(0,t.jsx)(n.code,{children:"log"}),", ",(0,t.jsx)(n.code,{children:"warn"})," or ",(0,t.jsx)(n.code,{children:"error"})," and ",(0,t.jsx)(n.code,{children:"arguments"})," are what gets passed from the console. This event is not triggered if the injected javascript code (e.g. via ",(0,t.jsx)(n.code,{children:".evaluate()"}),") is using ",(0,t.jsx)(n.code,{children:"console.log"}),"."]}),"\n",(0,t.jsxs)(n.h4,{id:"onceevent-callback",children:[".once(event, callback)",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#onceevent-callback",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["Similar to ",(0,t.jsx)(n.code,{children:".on()"}),", but captures page events with the callback one time."]}),"\n",(0,t.jsxs)(n.h4,{id:"removelistenerevent-callback",children:[".removeListener(event, callback)",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#removelistenerevent-callback",children:"#"})]}),"\n",(0,t.jsx)(n.p,{children:"Removes a given listener callback for an event."}),"\n",(0,t.jsxs)(n.h4,{id:"screenshotpath-clip",children:[".screenshot([path][, clip])",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#screenshotpath-clip",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["Takes a screenshot of the current page. Useful for debugging. The output is always a ",(0,t.jsx)(n.code,{children:"png"}),". Both arguments are optional. If ",(0,t.jsx)(n.code,{children:"path"})," is provided, it saves the image to the disk. Otherwise it returns a ",(0,t.jsx)(n.code,{children:"Buffer"})," of the image data. If ",(0,t.jsx)(n.code,{children:"clip"})," is provided (as ",(0,t.jsx)(n.a,{href:"https://github.com/atom/electron/blob/master/docs/api/browser-window.md#wincapturepagerect-callback",target:"_blank",rel:"noopener noreferrer",children:"documented here"}),"), the image will be clipped to the rectangle."]}),"\n",(0,t.jsxs)(n.h4,{id:"htmlpath-savetype",children:[".html(path, saveType)",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#htmlpath-savetype",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["Saves the current page as html as files to disk at the given path. Save type options are ",(0,t.jsx)(n.a,{href:"https://github.com/atom/electron/blob/master/docs/api/web-contents.md#webcontentssavepagefullpath-savetype-callback",target:"_blank",rel:"noopener noreferrer",children:"here"}),"."]}),"\n",(0,t.jsxs)(n.h4,{id:"pdfpath-options",children:[".pdf(path, options)",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#pdfpath-options",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["Saves a PDF to the specified ",(0,t.jsx)(n.code,{children:"path"}),". Options are ",(0,t.jsx)(n.a,{href:"https://github.com/electron/electron/blob/v1.4.4/docs/api/web-contents.md#contentsprinttopdfoptions-callback",target:"_blank",rel:"noopener noreferrer",children:"here"}),"."]}),"\n",(0,t.jsxs)(n.h4,{id:"title",children:[".title()",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#title",children:"#"})]}),"\n",(0,t.jsx)(n.p,{children:"Returns the title of the current page."}),"\n",(0,t.jsxs)(n.h4,{id:"url",children:[".url()",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#url",children:"#"})]}),"\n",(0,t.jsx)(n.p,{children:"Returns the url of the current page."}),"\n",(0,t.jsxs)(n.h4,{id:"path",children:[".path()",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#path",children:"#"})]}),"\n",(0,t.jsx)(n.p,{children:"Returns the path name of the current page."}),"\n",(0,t.jsxs)(n.h3,{id:"cookies",children:["Cookies",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#cookies",children:"#"})]}),"\n",(0,t.jsxs)(n.h4,{id:"cookiesgetname",children:[".cookies.get(name)",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#cookiesgetname",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["Gets a cookie by it's ",(0,t.jsx)(n.code,{children:"name"}),". The url will be the current url."]}),"\n",(0,t.jsxs)(n.h4,{id:"cookiesgetquery",children:[".cookies.get(query)",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#cookiesgetquery",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["Queries multiple cookies with the ",(0,t.jsx)(n.code,{children:"query"})," object. If a ",(0,t.jsx)(n.code,{children:"query.name"})," is set, it will return the first cookie it finds with that name, otherwise it will query for an array of cookies. If no ",(0,t.jsx)(n.code,{children:"query.url"})," is set, it will use the current url. Here's an example:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"// get all google cookies that are secure\n// and have the path `/query`\nnightmare\n  .goto('http://google.com')\n  .cookies.get({\n    path: '/query',\n    secure: true\n  })\n  .then(cookies => {\n    // do something with the cookies\n  })\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Available properties are documented here: ",(0,t.jsx)(n.a,{href:"https://github.com/atom/electron/blob/master/docs/api/session.md#sescookiesgetdetails-callback",target:"_blank",rel:"noopener noreferrer",children:"https://github.com/atom/electron/blob/master/docs/api/session.md#sescookiesgetdetails-callback"})]}),"\n",(0,t.jsxs)(n.h4,{id:"cookiesget",children:[".cookies.get()",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#cookiesget",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["Gets all the cookies for the current url. If you'd like get all cookies for all urls, use: ",(0,t.jsx)(n.code,{children:".get({ url: null })"}),"."]}),"\n",(0,t.jsxs)(n.h4,{id:"cookiessetname-value",children:[".cookies.set(name, value)",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#cookiessetname-value",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["Sets a cookie's ",(0,t.jsx)(n.code,{children:"name"})," and ",(0,t.jsx)(n.code,{children:"value"}),". This is the most basic form, and the url will be the current url."]}),"\n",(0,t.jsxs)(n.h4,{id:"cookiessetcookie",children:[".cookies.set(cookie)",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#cookiessetcookie",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["Sets a ",(0,t.jsx)(n.code,{children:"cookie"}),". If ",(0,t.jsx)(n.code,{children:"cookie.url"})," is not set, it will set the cookie on the current url. Here's an example:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"nightmare\n  .goto('http://google.com')\n  .cookies.set({\n    name: 'token',\n    value: 'some token',\n    path: '/query',\n    secure: true\n  })\n  // ... other actions ...\n  .then(() => {\n    // ...\n  })\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Available properties are documented here: ",(0,t.jsx)(n.a,{href:"https://github.com/atom/electron/blob/master/docs/api/session.md#sescookiessetdetails-callback",target:"_blank",rel:"noopener noreferrer",children:"https://github.com/atom/electron/blob/master/docs/api/session.md#sescookiessetdetails-callback"})]}),"\n",(0,t.jsxs)(n.h4,{id:"cookiessetcookies",children:[".cookies.set(cookies)",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#cookiessetcookies",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["Sets multiple cookies at once. ",(0,t.jsx)(n.code,{children:"cookies"})," is an array of ",(0,t.jsx)(n.code,{children:"cookie"})," objects. Take a look at the ",(0,t.jsx)(n.code,{children:".cookies.set(cookie)"})," documentation above for a better idea of what ",(0,t.jsx)(n.code,{children:"cookie"})," should look like."]}),"\n",(0,t.jsxs)(n.h4,{id:"cookiesclearname",children:[".cookies.clear([name])",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#cookiesclearname",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["Clears a cookie for the current domain. If ",(0,t.jsx)(n.code,{children:"name"})," is not specified, all cookies for the current domain will be cleared."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"nightmare\n  .goto('http://google.com')\n  .cookies.clear('SomeCookieName')\n  // ... other actions ...\n  .then(() => {\n    // ...\n  })\n"})}),"\n",(0,t.jsxs)(n.h4,{id:"cookiesclearall",children:[".cookies.clearAll()",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#cookiesclearall",children:"#"})]}),"\n",(0,t.jsx)(n.p,{children:"Clears all cookies for all domains."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"nightmare\n  .goto('http://google.com')\n  .cookies.clearAll()\n  // ... other actions ...\n  .then(() => {\n    //...\n  })\n"})}),"\n",(0,t.jsxs)(n.h3,{id:"proxies",children:["Proxies",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#proxies",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["Proxies are supported in Nightmare through ",(0,t.jsx)(n.a,{href:"https://github.com/segmentio/nightmare#switches",target:"_blank",rel:"noopener noreferrer",children:"switches"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["If your proxy requires authentication you also need the ",(0,t.jsx)(n.a,{href:"https://github.com/segmentio/nightmare#authenticationuser-password",target:"_blank",rel:"noopener noreferrer",children:"authentication"})," call."]}),"\n",(0,t.jsx)(n.p,{children:"The following example not only demonstrates how to use proxies, but you can run it to test if your proxy connection is working:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"import Nightmare from 'nightmare';\n\nconst proxyNightmare = Nightmare({\n  switches: {\n    'proxy-server': 'my_proxy_server.example.com:8080' // set the proxy server here ...\n  },\n  show: true\n});\n\nproxyNightmare\n  .authentication('proxyUsername', 'proxyPassword') // ... and authenticate here before `goto`\n  .goto('http://www.ipchicken.com')\n  .evaluate(() => {\n    return document.querySelector('b').innerText.replace(/[^\\d\\.]/g, '');\n  })\n  .end()\n  .then((ip) => { // This will log the Proxy's IP\n    console.log('proxy IP:', ip);\n  });\n\n// The rest is just normal Nightmare to get your local IP\nconst regularNightmare = Nightmare({ show: true });\n\nregularNightmare\n  .goto('http://www.ipchicken.com')\n  .evaluate(() =>\n    document.querySelector('b').innerText.replace(/[^\\d\\.]/g, '');\n  )\n  .end()\n  .then((ip) => { // This will log the your local IP\n    console.log('local IP:', ip);\n  });\n"})}),"\n",(0,t.jsxs)(n.h3,{id:"promises",children:["Promises",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#promises",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["By default, Nightmare uses default native ES6 promises. You can plug in your favorite ",(0,t.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise",target:"_blank",rel:"noopener noreferrer",children:"ES6-style promises library"})," like ",(0,t.jsx)(n.a,{href:"https://www.npmjs.com/package/bluebird",target:"_blank",rel:"noopener noreferrer",children:"bluebird"})," or ",(0,t.jsx)(n.a,{href:"https://www.npmjs.com/package/q",target:"_blank",rel:"noopener noreferrer",children:"q"})," for convenience!"]}),"\n",(0,t.jsx)(n.p,{children:"Here's an example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"var Nightmare = require('nightmare')\n\nNightmare.Promise = require('bluebird')\n// OR:\nNightmare.Promise = require('q').Promise\n"})}),"\n",(0,t.jsxs)(n.p,{children:["You can also specify a custom Promise library per-instance with the ",(0,t.jsx)(n.code,{children:"Promise"})," constructor option like so:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"var Nightmare = require('nightmare')\n\nvar es6Nightmare = Nightmare()\nvar bluebirdNightmare = Nightmare({\n  Promise: require('bluebird')\n})\n\nvar es6Promise = es6Nightmare\n  .goto('https://github.com/segmentio/nightmare')\n  .then()\nvar bluebirdPromise = bluebirdNightmare\n  .goto('https://github.com/segmentio/nightmare')\n  .then()\n\nes6Promise.isFulfilled() // throws: `TypeError: es6EndPromise.isFulfilled is not a function`\nbluebirdPromise.isFulfilled() // returns: `true | false`\n"})}),"\n",(0,t.jsxs)(n.h3,{id:"extending-nightmare",children:["Extending Nightmare",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#extending-nightmare",children:"#"})]}),"\n",(0,t.jsxs)(n.h4,{id:"nightmareactionname-electronactionelectronnamespace-actionnamespace",children:["Nightmare.action(name, [electronAction|electronNamespace], action|namespace)",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#nightmareactionname-electronactionelectronnamespace-actionnamespace",children:"#"})]}),"\n",(0,t.jsx)(n.p,{children:"You can add your own custom actions to the Nightmare prototype. Here's an example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Nightmare.action('size', function(done) {\n  this.evaluate_now(() => {\n    const w = Math.max(\n      document.documentElement.clientWidth,\n      window.innerWidth || 0\n    )\n    const h = Math.max(\n      document.documentElement.clientHeight,\n      window.innerHeight || 0\n    )\n    return {\n      height: h,\n      width: w\n    }\n  }, done)\n})\n\nNightmare()\n  .goto('http://cnn.com')\n  .size()\n  .then(size => {\n    //... do something with the size information\n  })\n"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["Remember, this is attached to the static class ",(0,t.jsx)(n.code,{children:"Nightmare"}),", not the instance."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["You'll notice we used an internal function ",(0,t.jsx)(n.code,{children:"evaluate_now"}),". This function is different than ",(0,t.jsx)(n.code,{children:"nightmare.evaluate"})," because it runs it immediately, whereas ",(0,t.jsx)(n.code,{children:"nightmare.evaluate"})," is queued."]}),"\n",(0,t.jsxs)(n.p,{children:["An easy way to remember: when in doubt, use ",(0,t.jsx)(n.code,{children:"evaluate"}),". If you're creating custom actions, use ",(0,t.jsx)(n.code,{children:"evaluate_now"}),". The technical reason is that since our action has already been queued and we're running it now, we shouldn't re-queue the evaluate function."]}),"\n",(0,t.jsxs)(n.p,{children:["We can also create custom namespaces. We do this internally for ",(0,t.jsx)(n.code,{children:"nightmare.cookies.get"})," and ",(0,t.jsx)(n.code,{children:"nightmare.cookies.set"}),". These are useful if you have a bundle of actions you want to expose, but it will clutter up the main nightmare object. Here's an example of that:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Nightmare.action('style', {\n  background(done) {\n    this.evaluate_now(\n      () => window.getComputedStyle(document.body, null).backgroundColor,\n      done\n    )\n  }\n})\n\nNightmare()\n  .goto('http://google.com')\n  .style.background()\n  .then(background => {\n    // ... do something interesting with background\n  })\n"})}),"\n",(0,t.jsxs)(n.p,{children:["You can also add custom Electron actions. The additional Electron action or namespace actions take ",(0,t.jsx)(n.code,{children:"name"}),", ",(0,t.jsx)(n.code,{children:"options"}),", ",(0,t.jsx)(n.code,{children:"parent"}),", ",(0,t.jsx)(n.code,{children:"win"}),", ",(0,t.jsx)(n.code,{children:"renderer"}),", and ",(0,t.jsx)(n.code,{children:"done"}),". Note the Electron action comes first, mirroring how ",(0,t.jsx)(n.code,{children:".evaluate()"})," works. For example:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Nightmare.action(\n  'clearCache',\n  (name, options, parent, win, renderer, done) => {\n    parent.respondTo('clearCache', done => {\n      win.webContents.session.clearCache(done)\n    })\n    done()\n  },\n  function(done) {\n    this.child.call('clearCache', done)\n  }\n)\n\nNightmare()\n  .clearCache()\n  .goto('http://example.org')\n  //... more actions ...\n  .then(() => {\n    // ...\n  })\n"})}),"\n",(0,t.jsxs)(n.p,{children:["...would clear the browser’s cache before navigating to ",(0,t.jsx)(n.code,{children:"example.org"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["See ",(0,t.jsx)(n.a,{href:"https://github.com/rosshinkley/nightmare-examples/blob/master/docs/beginner/action.md",target:"_blank",rel:"noopener noreferrer",children:"this document"})," for more details on creating custom actions."]}),"\n",(0,t.jsxs)(n.h4,{id:"useplugin",children:[".use(plugin)",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#useplugin",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"nightmare.use"})," is useful for reusing a set of tasks on an instance. Check out ",(0,t.jsx)(n.a,{href:"https://github.com/segmentio/nightmare-swiftly",target:"_blank",rel:"noopener noreferrer",children:"nightmare-swiftly"})," for some examples."]}),"\n",(0,t.jsxs)(n.h4,{id:"custom-preload-script",children:["Custom preload script",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#custom-preload-script",children:"#"})]}),"\n",(0,t.jsx)(n.p,{children:"If you need to do something custom when you first load the window environment, you can specify a custom preload script. Here's how you do that:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"import path from 'path'\n\nconst nightmare = Nightmare({\n  webPreferences: {\n    preload: path.resolve('custom-script.js')\n    //alternative: preload: \"absolute/path/to/custom-script.js\"\n  }\n})\n"})}),"\n",(0,t.jsx)(n.p,{children:"The only requirement for that script is that you'll need the following prelude:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"window.__nightmare = {}\n__nightmare.ipc = require('electron').ipcRenderer\n"})}),"\n",(0,t.jsxs)(n.p,{children:["To benefit of all of nightmare's feedback from the browser, you can instead copy the contents of nightmare's ",(0,t.jsx)(n.a,{href:"https://github.com/segmentio/nightmare/blob/master/lib/preload.js",target:"_blank",rel:"noopener noreferrer",children:"preload script"}),"."]}),"\n",(0,t.jsxs)(n.h4,{id:"storage-persistence-between-nightmare-instances",children:["Storage Persistence between nightmare instances",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#storage-persistence-between-nightmare-instances",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["By default nightmare will create an in-memory partition for each instance. This means that any localStorage or cookies or any other form of persistent state will be destroyed when nightmare is ended. If you would like to persist state between instances you can use the ",(0,t.jsx)(n.a,{href:"http://electron.atom.io/docs/api/browser-window/#new-browserwindowoptions",target:"_blank",rel:"noopener noreferrer",children:"webPreferences.partition"})," api in electron."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"import Nightmare from 'nightmare';\n\nnightmare = Nightmare(); // non persistent paritition by default\nyield nightmare\n  .evaluate(() => {\n    window.localStorage.setItem('testing', 'This will not be persisted');\n  })\n  .end();\n\nnightmare = Nightmare({\n  webPreferences: {\n    partition: 'persist: testing'\n  }\n});\nyield nightmare\n  .evaluate(() => {\n    window.localStorage.setItem('testing', 'This is persisted for other instances with the same paritition name');\n  })\n  .end();\n"})}),"\n",(0,t.jsxs)(n.p,{children:["If you specify a ",(0,t.jsx)(n.code,{children:"null"})," paritition then it will use the electron default behavior (persistent) or any string that starts with ",(0,t.jsx)(n.code,{children:"'persist:'"})," will persist under that partition name, any other string will result in in-memory only storage."]}),"\n",(0,t.jsxs)(n.h2,{id:"usage",children:["Usage",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#usage",children:"#"})]}),"\n",(0,t.jsxs)(n.h4,{id:"installation",children:["Installation",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#installation",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["Nightmare is a Node.js module, so you'll need to ",(0,t.jsx)(n.a,{href:"http://nodejs.org/",target:"_blank",rel:"noopener noreferrer",children:"have Node.js installed"}),". Then you just need to ",(0,t.jsx)(n.code,{children:"npm install"})," the module:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"$ npm install --save nightmare\n"})}),"\n",(0,t.jsxs)(n.h4,{id:"execution",children:["Execution",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#execution",children:"#"})]}),"\n",(0,t.jsx)(n.p,{children:"Nightmare is a node module that can be used in a Node.js script or module. Here's a simple script to open a web page:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"import Nightmare from 'nightmare';\n\nconst nightmare = Nightmare();\n\nnightmare.goto('http://cnn.com')\n  .evaluate(() => {\n    return document.title;\n  })\n  .end()\n  .then((title) => {\n    console.log(title);\n  })\n"})}),"\n",(0,t.jsxs)(n.p,{children:["If you save this as ",(0,t.jsx)(n.code,{children:"cnn.js"}),", you can run it on the command line like this:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"npm install --save nightmare\nnode cnn.js\n"})}),"\n",(0,t.jsxs)(n.h4,{id:"common-execution-problems",children:["Common Execution Problems",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#common-execution-problems",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["Nightmare heavily relies on ",(0,t.jsx)(n.a,{href:"http://electron.atom.io/",target:"_blank",rel:"noopener noreferrer",children:"Electron"})," for heavy lifting. And Electron in turn relies on several UI-focused dependencies (eg. libgtk+) which are often missing from server distros."]}),"\n",(0,t.jsxs)(n.p,{children:["For help running nightmare on your server distro check out ",(0,t.jsx)(n.a,{href:"https://gist.github.com/dimkir/f4afde77366ff041b66d2252b45a13db",target:"_blank",rel:"noopener noreferrer",children:"How to run nightmare on Amazon Linux and CentOS"})," guide."]}),"\n",(0,t.jsxs)(n.h4,{id:"debugging",children:["Debugging",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#debugging",children:"#"})]}),"\n",(0,t.jsx)(n.p,{children:"There are three good ways to get more information about what's happening inside the headless browser:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Use the ",(0,t.jsx)(n.code,{children:"DEBUG=*"})," flag described below."]}),"\n",(0,t.jsxs)(n.li,{children:["Pass ",(0,t.jsx)(n.code,{children:"{ show: true }"})," to the ",(0,t.jsx)(n.a,{href:"https://github.com/segmentio/nightmare#nightmareoptions",target:"_blank",rel:"noopener noreferrer",children:"nightmare constructor"})," to have it create a visible, rendered window where you can watch what is happening."]}),"\n",(0,t.jsxs)(n.li,{children:["Listen for ",(0,t.jsx)(n.a,{href:"https://github.com/segmentio/nightmare#onevent-callback",target:"_blank",rel:"noopener noreferrer",children:"specific events"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["To run the same file with debugging output, run it like this ",(0,t.jsx)(n.code,{children:"DEBUG=nightmare node cnn.js"})," (on Windows use ",(0,t.jsx)(n.code,{children:"set DEBUG=nightmare & node cnn.js"}),")."]}),"\n",(0,t.jsx)(n.p,{children:"This will print out some additional information about what's going on:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'nightmare queueing action "goto" +0ms\nnightmare queueing action "evaluate" +4ms\nBreaking News, U.S., World, Weather, Entertainment & Video News - CNN.com\n'})}),"\n",(0,t.jsxs)(n.h5,{id:"debug-flags",children:["Debug Flags",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#debug-flags",children:"#"})]}),"\n",(0,t.jsx)(n.p,{children:"All nightmare messages"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"DEBUG=nightmare*\n"})}),"\n",(0,t.jsx)(n.p,{children:"Only actions"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"DEBUG=nightmare:actions*\n"})}),"\n",(0,t.jsx)(n.p,{children:"Only logs"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"DEBUG=nightmare:log*\n"})}),"\n",(0,t.jsxs)(n.h2,{id:"additional-resources",children:["Additional Resources",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#additional-resources",children:"#"})]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://github.com/rosshinkley/nightmare-examples",target:"_blank",rel:"noopener noreferrer",children:"Ross Hinkley's Nightmare Examples"})," is a great resource for setting up nightmare, learning about custom actions, and avoiding common pitfalls."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://github.com/matthewmueller/nightmare-issues",target:"_blank",rel:"noopener noreferrer",children:"Nightmare Issues"})," has a bunch of standalone runnable examples. The script numbers correspond to nightmare issue numbers."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://hackernoon.com/nightmarishly-good-scraping-with-nightmare-js-and-async-await-b7b20a38438f",target:"_blank",rel:"noopener noreferrer",children:"Nightmarishly good scraping"})," is a great tutorial by ",(0,t.jsx)(n.a,{href:"https://twitter.com/@aendrew",target:"_blank",rel:"noopener noreferrer",children:"\xc6ndrew Rininsland"})," on getting up & running with Nightmare using real-life data."]}),"\n"]}),"\n",(0,t.jsxs)(n.h2,{id:"tests",children:["Tests",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#tests",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["Automated tests for nightmare itself are run using ",(0,t.jsx)(n.a,{href:"http://mochajs.org/",target:"_blank",rel:"noopener noreferrer",children:"Mocha"})," and Chai, both of which will be installed via ",(0,t.jsx)(n.code,{children:"npm install"}),". To run nightmare's tests, just run ",(0,t.jsx)(n.code,{children:"make test"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"When the tests are done, you'll see something like this:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"make test\n  ․․․․․․․․․․․․․․․․․․\n  18 passing (1m)\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Note that if you are using ",(0,t.jsx)(n.code,{children:"xvfb"}),", ",(0,t.jsx)(n.code,{children:"make test"})," will automatically run the tests under an ",(0,t.jsx)(n.code,{children:"xvfb-run"})," wrapper. If you are planning to run the tests headlessly without running ",(0,t.jsx)(n.code,{children:"xvfb"})," first, set the ",(0,t.jsx)(n.code,{children:"HEADLESS"})," environment variable to ",(0,t.jsx)(n.code,{children:"0"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"下面是实际的案例"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"var Nightmare = require('nightmare');\nvar nightmare = Nightmare({ show: true });\n\nnightmare\n  .goto('https://www.taobao.com/')  //待测试链接\n  .type('#q', '电视机')   //输入框选中，输入值\n  .click('form[action*=\"/search\"] [type=submit]')//form表单提交\n  .wait(3000)\n  .exists('#spulist-grid')\n  .evaluate(function () {\n    return document.querySelector('#spulist-grid .grid-item .info-cont') //获取需返回的值\n      .textContent.trim();\n  })\n  .end()\n  .then(function (result) {  //即为return中的数据\n    console.log(result);\n  })\n  .catch(function (error) {  //错误捕捉\n    console.error('Search failed:', error);\n  });\n"})})]})}function o(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,s.ah)(),e.components);return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(i,{...e})}):i(e)}let a=o;o.__RSPRESS_PAGE_META={},o.__RSPRESS_PAGE_META["git%2FNightmare.md"]={toc:[{text:"Examples",id:"examples",depth:2},{text:"To run the mocha tests",id:"to-run-the-mocha-tests",depth:3},{text:"API",id:"api",depth:2},{text:"Nightmare(options)",id:"nightmareoptions",depth:4},{text:"certificateSubjectName",id:"certificatesubjectname",depth:4},{text:".engineVersions()",id:"engineversions",depth:4},{text:".useragent(useragent)",id:"useragentuseragent",depth:4},{text:".authentication(user, password)",id:"authenticationuser-password",depth:4},{text:".end()",id:"end",depth:4},{text:".halt(error, done)",id:"halterror-done",depth:4},{text:"Interact with the Page",id:"interact-with-the-page",depth:3},{text:".goto(url[, headers])",id:"gotourl-headers",depth:4},{text:".back()",id:"back",depth:4},{text:".forward()",id:"forward",depth:4},{text:".refresh()",id:"refresh",depth:4},{text:".click(selector)",id:"clickselector",depth:4},{text:".mousedown(selector)",id:"mousedownselector",depth:4},{text:".mouseup(selector)",id:"mouseupselector",depth:4},{text:".mouseover(selector)",id:"mouseoverselector",depth:4},{text:".mouseout(selector)",id:"mouseoutselector",depth:4},{text:".type(selector[, text])",id:"typeselector-text",depth:4},{text:".insert(selector[, text])",id:"insertselector-text",depth:4},{text:".check(selector)",id:"checkselector",depth:4},{text:".uncheck(selector)",id:"uncheckselector",depth:4},{text:".select(selector, option)",id:"selectselector-option",depth:4},{text:".scrollTo(top, left)",id:"scrolltotop-left",depth:4},{text:".viewport(width, height)",id:"viewportwidth-height",depth:4},{text:".inject(type, file)",id:"injecttype-file",depth:4},{text:".evaluate(fn[, arg1, arg2,...])",id:"evaluatefn-arg1-arg2",depth:4},{text:".wait(ms)",id:"waitms",depth:4},{text:".wait(selector)",id:"waitselector",depth:4},{text:".wait(fn[, arg1, arg2,...])",id:"waitfn-arg1-arg2",depth:4},{text:".header(header, value)",id:"headerheader-value",depth:4},{text:"Extract from the Page",id:"extract-from-the-page",depth:3},{text:".exists(selector)",id:"existsselector",depth:4},{text:".visible(selector)",id:"visibleselector",depth:4},{text:".on(event, callback)",id:"onevent-callback",depth:4},{text:".once(event, callback)",id:"onceevent-callback",depth:4},{text:".removeListener(event, callback)",id:"removelistenerevent-callback",depth:4},{text:".screenshot([path][, clip])",id:"screenshotpath-clip",depth:4},{text:".html(path, saveType)",id:"htmlpath-savetype",depth:4},{text:".pdf(path, options)",id:"pdfpath-options",depth:4},{text:".title()",id:"title",depth:4},{text:".url()",id:"url",depth:4},{text:".path()",id:"path",depth:4},{text:"Cookies",id:"cookies",depth:3},{text:".cookies.get(name)",id:"cookiesgetname",depth:4},{text:".cookies.get(query)",id:"cookiesgetquery",depth:4},{text:".cookies.get()",id:"cookiesget",depth:4},{text:".cookies.set(name, value)",id:"cookiessetname-value",depth:4},{text:".cookies.set(cookie)",id:"cookiessetcookie",depth:4},{text:".cookies.set(cookies)",id:"cookiessetcookies",depth:4},{text:".cookies.clear([name])",id:"cookiesclearname",depth:4},{text:".cookies.clearAll()",id:"cookiesclearall",depth:4},{text:"Proxies",id:"proxies",depth:3},{text:"Promises",id:"promises",depth:3},{text:"Extending Nightmare",id:"extending-nightmare",depth:3},{text:"Nightmare.action(name, [electronAction|electronNamespace], action|namespace)",id:"nightmareactionname-electronactionelectronnamespace-actionnamespace",depth:4},{text:".use(plugin)",id:"useplugin",depth:4},{text:"Custom preload script",id:"custom-preload-script",depth:4},{text:"Storage Persistence between nightmare instances",id:"storage-persistence-between-nightmare-instances",depth:4},{text:"Usage",id:"usage",depth:2},{text:"Installation",id:"installation",depth:4},{text:"Execution",id:"execution",depth:4},{text:"Common Execution Problems",id:"common-execution-problems",depth:4},{text:"Debugging",id:"debugging",depth:4},{text:"Additional Resources",id:"additional-resources",depth:2},{text:"Tests",id:"tests",depth:2}],title:"Nightmare",frontmatter:{}}}}]);