"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["1087"],{2894:function(e,i,n){n.r(i),n.d(i,{default:function(){return c}});var s=n(6469),t=n(8809);function r(e){let i=Object.assign({h1:"h1",a:"a",p:"p",img:"img",h2:"h2",pre:"pre",code:"code",blockquote:"blockquote",ul:"ul",li:"li"},(0,t.ah)(),e.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(i.h1,{id:"git-使用规范流程",children:["Git 使用规范流程",(0,s.jsx)(i.a,{className:"header-anchor","aria-hidden":"true",href:"#git-使用规范流程",children:"#"})]}),"\n",(0,s.jsx)(i.p,{children:"统计信息：字数 6168  阅读13分钟"}),"\n",(0,s.jsx)(i.p,{children:"团队开发中，遵循一个合理、清晰的Git使用流程，是非常重要的。"}),"\n",(0,s.jsx)(i.p,{children:"否则，每个人都提交一堆杂乱无章的commit，项目很快就会变得难以协调和维护。"}),"\n",(0,s.jsxs)(i.p,{children:["下面是",(0,s.jsx)(i.a,{href:"https://github.com/thoughtbot/guides/tree/master/protocol/git",target:"_blank",rel:"noopener noreferrer",children:"ThoughtBot"})," 的Git使用规范流程。我从中学到了很多，推荐你也这样使用Git。"]}),"\n",(0,s.jsx)(i.p,{children:(0,s.jsx)(i.img,{src:"http://www.ruanyifeng.com/blogimg/asset/2015/bg2015080501.png",alt:""})}),"\n",(0,s.jsxs)(i.h2,{id:"第一步新建分支",children:["第一步：新建分支",(0,s.jsx)(i.a,{className:"header-anchor","aria-hidden":"true",href:"#第一步新建分支",children:"#"})]}),"\n",(0,s.jsxs)(i.p,{children:["首先，每次开发新功能，都应该新建一个单独的分支（这方面可以参考",(0,s.jsx)(i.a,{href:"http://www.ruanyifeng.com/blog/2012/07/git.html",target:"_blank",rel:"noopener noreferrer",children:"《Git分支管理策略》"}),"）。"]}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-bash",children:"# 获取主干最新代码\n$ git checkout master\n$ git pull\n\n# 新建一个开发分支myfeature\n$ git checkout -b myfeature\n"})}),"\n",(0,s.jsxs)(i.h2,{id:"第二步提交分支commit",children:["第二步：提交分支commit",(0,s.jsx)(i.a,{className:"header-anchor","aria-hidden":"true",href:"#第二步提交分支commit",children:"#"})]}),"\n",(0,s.jsx)(i.p,{children:"分支修改后，就可以提交commit了。"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-bash",children:"$ git add .\n$ git status\n$ git commit --verbose\n"})}),"\n",(0,s.jsx)(i.p,{children:"git add 命令的all参数，表示保存所有变化（包括新建、修改和删除）。"}),"\n",(0,s.jsx)(i.p,{children:"git status 命令，用来查看发生变动的文件。"}),"\n",(0,s.jsxs)(i.p,{children:["git commit 命令的verbose参数，会列出 ",(0,s.jsx)(i.a,{href:"http://www.ruanyifeng.com/blog/2012/08/how_to_read_diff.html",target:"_blank",rel:"noopener noreferrer",children:"diff"})," 的结果。"]}),"\n",(0,s.jsxs)(i.h2,{id:"第三步撰写提交信息",children:["第三步：撰写提交信息",(0,s.jsx)(i.a,{className:"header-anchor","aria-hidden":"true",href:"#第三步撰写提交信息",children:"#"})]}),"\n",(0,s.jsx)(i.p,{children:"提交commit时，必须给出完整扼要的提交信息，下面是一个范本。"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-bash",children:"Present-tense summary under 50 characters\n\n* More information about commit (under 72 characters).\n* More information about commit (under 72 characters).\n\nhttp://project.management-system.com/ticket/123\n"})}),"\n",(0,s.jsx)(i.p,{children:"第一行是不超过50个字的提要，然后空一行，罗列出改动原因、主要变动、以及需要注意的问题。最后，提供对应的网址（比如Bug ticket）。"}),"\n",(0,s.jsxs)(i.h2,{id:"第四步与主干同步",children:["第四步：与主干同步",(0,s.jsx)(i.a,{className:"header-anchor","aria-hidden":"true",href:"#第四步与主干同步",children:"#"})]}),"\n",(0,s.jsx)(i.p,{children:"分支的开发过程中，要经常与主干保持同步。"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-bash",children:"$ git fetch origin\n$ git rebase origin/master\n"})}),"\n",(0,s.jsxs)(i.h2,{id:"第五步合并commit",children:["第五步：合并commit",(0,s.jsx)(i.a,{className:"header-anchor","aria-hidden":"true",href:"#第五步合并commit",children:"#"})]}),"\n",(0,s.jsx)(i.p,{children:"分支开发完成后，很可能有一堆commit，但是合并到主干的时候，往往希望只有一个（或最多两三个）commit，这样不仅清晰，也容易管理。"}),"\n",(0,s.jsx)(i.p,{children:"那么，怎样才能将多个commit合并呢？这就要用到 git rebase 命令。"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-bash",children:"$ git rebase -i origin/master\n"})}),"\n",(0,s.jsx)(i.p,{children:"git rebase命令的i参数表示互动（interactive），这时git会打开一个互动界面，进行下一步操作。"}),"\n",(0,s.jsxs)(i.p,{children:["下面采用",(0,s.jsx)(i.a,{href:"https://robots.thoughtbot.com/git-interactive-rebase-squash-amend-rewriting-history",target:"_blank",rel:"noopener noreferrer",children:"Tute Costa"}),"的例子，来解释怎么合并commit。"]}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-bash",children:'pick 07c5abd Introduce OpenPGP and teach basic usage\npick de9b1eb Fix PostChecker::Post#urls\npick 3e7ee36 Hey kids, stop all the highlighting\npick fa20af3 git interactive rebase, squash, amend\n\n# Rebase 8db7e8b..fa20af3 onto 8db7e8b\n#\n# Commands:\n#  p, pick = use commit\n#  r, reword = use commit, but edit the commit message\n#  e, edit = use commit, but stop for amending\n#  s, squash = use commit, but meld into previous commit\n#  f, fixup = like "squash", but discard this commit\'s log message\n#  x, exec = run command (the rest of the line) using shell\n#\n# These lines can be re-ordered; they are executed from top to bottom.\n#\n# If you remove a line here THAT COMMIT WILL BE LOST.\n#\n# However, if you remove everything, the rebase will be aborted.\n#\n# Note that empty commits are commented out\n'})}),"\n",(0,s.jsx)(i.p,{children:"上面的互动界面，先列出当前分支最新的4个commit（越下面越新）。每个commit前面有一个操作命令，默认是pick，表示该行commit被选中，要进行rebase操作。"}),"\n",(0,s.jsx)(i.p,{children:"4个commit的下面是一大堆注释，列出可以使用的命令。"}),"\n",(0,s.jsxs)(i.blockquote,{children:["\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"pick：正常选中"}),"\n",(0,s.jsx)(i.li,{children:"reword：选中，并且修改提交信息；"}),"\n",(0,s.jsxs)(i.li,{children:["edit：选中，rebase时会暂停，允许你修改这个commit（参考",(0,s.jsx)(i.a,{href:"https://schacon.github.io/gitbook/4_interactive_rebasing.html",target:"_blank",rel:"noopener noreferrer",children:"这里"}),"）"]}),"\n",(0,s.jsx)(i.li,{children:"squash：选中，会将当前commit与上一个commit合并"}),"\n",(0,s.jsx)(i.li,{children:"fixup：与squash相同，但不会保存当前commit的提交信息"}),"\n",(0,s.jsx)(i.li,{children:"exec：执行其他shell命令"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(i.p,{children:"上面这6个命令当中，squash和fixup可以用来合并commit。先把需要合并的commit前面的动词，改成squash（或者s）。"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-bash",children:"pick 07c5abd Introduce OpenPGP and teach basic usage\ns de9b1eb Fix PostChecker::Post#urls\ns 3e7ee36 Hey kids, stop all the highlighting\npick fa20af3 git interactive rebase, squash, amend\n"})}),"\n",(0,s.jsx)(i.p,{children:"这样一改，执行后，当前分支只会剩下两个commit。第二行和第三行的commit，都会合并到第一行的commit。提交信息会同时包含，这三个commit的提交信息。"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-bash",children:"# This is a combination of 3 commits.\n# The first commit's message is:\nIntroduce OpenPGP and teach basic usage\n\n# This is the 2nd commit message:\nFix PostChecker::Post#urls\n\n# This is the 3rd commit message:\nHey kids, stop all the highlighting\n"})}),"\n",(0,s.jsx)(i.p,{children:"如果将第三行的squash命令改成fixup命令。"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-bash",children:"pick 07c5abd Introduce OpenPGP and teach basic usage\ns de9b1eb Fix PostChecker::Post#urls\nf 3e7ee36 Hey kids, stop all the highlighting\npick fa20af3 git interactive rebase, squash, amend\n"})}),"\n",(0,s.jsx)(i.p,{children:"运行结果相同，还是会生成两个commit，第二行和第三行的commit，都合并到第一行的commit。但是，新的提交信息里面，第三行commit的提交信息，会被注释掉。"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-bash",children:"# This is a combination of 3 commits.\n# The first commit's message is:\nIntroduce OpenPGP and teach basic usage\n\n# This is the 2nd commit message:\nFix PostChecker::Post#urls\n\n# This is the 3rd commit message:\n# Hey kids, stop all the highlighting\n"})}),"\n",(0,s.jsx)(i.p,{children:"squash和fixup命令，还可以当作命令行参数使用，自动合并commit。"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-bash",children:"$ git commit --fixup <commit> \n$ git rebase -i --autosquash \n"})}),"\n",(0,s.jsxs)(i.h2,{id:"第六步推送到远程仓库",children:["第六步：推送到远程仓库",(0,s.jsx)(i.a,{className:"header-anchor","aria-hidden":"true",href:"#第六步推送到远程仓库",children:"#"})]}),"\n",(0,s.jsx)(i.p,{children:"合并commit后，就可以推送当前分支到远程仓库了。"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-bash",children:"$ git push --force origin myfeature\n"})}),"\n",(0,s.jsx)(i.p,{children:"git push命令要加上force参数，因为rebase以后，分支历史改变了，跟远程分支不一定兼容，有可能要强行推送。"}),"\n",(0,s.jsxs)(i.h2,{id:"第七步发出pull-request",children:["第七步：发出Pull Request",(0,s.jsx)(i.a,{className:"header-anchor","aria-hidden":"true",href:"#第七步发出pull-request",children:"#"})]}),"\n",(0,s.jsx)(i.p,{children:"提交到远程仓库以后，就可以发出 Pull Request 到master分支，然后请求别人进行代码review，确认可以合并到master。"})]})}function a(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:i}=Object.assign({},(0,t.ah)(),e.components);return i?(0,s.jsx)(i,{...e,children:(0,s.jsx)(r,{...e})}):r(e)}let c=a;a.__RSPRESS_PAGE_META={},a.__RSPRESS_PAGE_META["git%2Fgit-use-process.md"]={toc:[{text:"第一步：新建分支",id:"第一步新建分支",depth:2},{text:"第二步：提交分支commit",id:"第二步提交分支commit",depth:2},{text:"第三步：撰写提交信息",id:"第三步撰写提交信息",depth:2},{text:"第四步：与主干同步",id:"第四步与主干同步",depth:2},{text:"第五步：合并commit",id:"第五步合并commit",depth:2},{text:"第六步：推送到远程仓库",id:"第六步推送到远程仓库",depth:2},{text:"第七步：发出Pull Request",id:"第七步发出pull-request",depth:2}],title:"Git 使用规范流程",frontmatter:{}}}}]);