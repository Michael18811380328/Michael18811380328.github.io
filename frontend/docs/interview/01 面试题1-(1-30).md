# å¤§å‚é¢è¯•é¢˜ç¬¬ä¸€éƒ¨åˆ†

https://github.com/Advanced-Frontend/Daily-Interview-Question/blob/master/datum/summary.md



## B ç¬¬ 3 é¢˜ï¼šä»€ä¹ˆæ˜¯é˜²æŠ–å’ŒèŠ‚æµï¼Ÿæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿå¦‚ä½•å®ç°ï¼Ÿ

è§£æï¼šç¬¬ 3 é¢˜

1. **é˜²æŠ–**

> è§¦å‘é«˜é¢‘äº‹ä»¶ånç§’å†…å‡½æ•°åªä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œå¦‚æœnç§’å†…é«˜é¢‘äº‹ä»¶å†æ¬¡è¢«è§¦å‘ï¼Œåˆ™é‡æ–°è®¡ç®—æ—¶é—´

- æ€è·¯ï¼š

> æ¯æ¬¡è§¦å‘äº‹ä»¶æ—¶éƒ½å–æ¶ˆä¹‹å‰çš„å»¶æ—¶è°ƒç”¨æ–¹æ³•

```js
function debounce(fn) {
  let timeout = null; // åˆ›å»ºä¸€ä¸ªæ ‡è®°ç”¨æ¥å­˜æ”¾å®šæ—¶å™¨çš„è¿”å›å€¼
  return function () {
    clearTimeout(timeout); // æ¯å½“ç”¨æˆ·è¾“å…¥çš„æ—¶å€™æŠŠå‰ä¸€ä¸ª setTimeout clear æ‰
    timeout = setTimeout(() => { // ç„¶ååˆåˆ›å»ºä¸€ä¸ªæ–°çš„ setTimeout, è¿™æ ·å°±èƒ½ä¿è¯è¾“å…¥å­—ç¬¦åçš„ interval é—´éš”å†…å¦‚æœè¿˜æœ‰å­—ç¬¦è¾“å…¥çš„è¯ï¼Œå°±ä¸ä¼šæ‰§è¡Œ fn å‡½æ•°
      fn.apply(this, arguments);
    }, 500);
  };
}
function sayHi() {
  console.log('é˜²æŠ–æˆåŠŸ');
}

var inp = document.getElementById('inp');
inp.addEventListener('input', debounce(sayHi)); // é˜²æŠ–
```

1. **èŠ‚æµ**

> é«˜é¢‘äº‹ä»¶è§¦å‘ï¼Œä½†åœ¨nç§’å†…åªä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œæ‰€ä»¥èŠ‚æµä¼šç¨€é‡Šå‡½æ•°çš„æ‰§è¡Œé¢‘ç‡

- æ€è·¯ï¼š

> æ¯æ¬¡è§¦å‘äº‹ä»¶æ—¶éƒ½åˆ¤æ–­å½“å‰æ˜¯å¦æœ‰ç­‰å¾…æ‰§è¡Œçš„å»¶æ—¶å‡½æ•°

```js
function throttle(fn) {
  let canRun = true; // é€šè¿‡é—­åŒ…ä¿å­˜ä¸€ä¸ªæ ‡è®°
  return function () {
    if (!canRun) return; // åœ¨å‡½æ•°å¼€å¤´åˆ¤æ–­æ ‡è®°æ˜¯å¦ä¸ºtrueï¼Œä¸ä¸ºtrueåˆ™return
    canRun = false; // ç«‹å³è®¾ç½®ä¸ºfalse
    setTimeout(() => { // å°†å¤–éƒ¨ä¼ å…¥çš„å‡½æ•°çš„æ‰§è¡Œæ”¾åœ¨setTimeoutä¸­
      fn.apply(this, arguments);
      // æœ€ååœ¨setTimeoutæ‰§è¡Œå®Œæ¯•åå†æŠŠæ ‡è®°è®¾ç½®ä¸ºtrue(å…³é”®)è¡¨ç¤ºå¯ä»¥æ‰§è¡Œä¸‹ä¸€æ¬¡å¾ªç¯äº†ã€‚å½“å®šæ—¶å™¨æ²¡æœ‰æ‰§è¡Œçš„æ—¶å€™æ ‡è®°æ°¸è¿œæ˜¯falseï¼Œåœ¨å¼€å¤´è¢«returnæ‰
      canRun = true;
    }, 500);
  };
}
function sayHi(e) {
  console.log(e.target.innerWidth, e.target.innerHeight);
}
window.addEventListener('resize', throttle(sayHi));
```





## C ç¬¬ 4 é¢˜ï¼šä»‹ç»ä¸‹ Setã€Mapã€WeakSet å’Œ WeakMap çš„åŒºåˆ«ï¼Ÿ

è§£æï¼šç¬¬ 4 é¢˜

https://es6.ruanyifeng.com/#docs/set-map

#### Set

1. æˆå‘˜ä¸èƒ½é‡å¤
2. åªæœ‰å¥å€¼ï¼Œæ²¡æœ‰å¥åï¼Œæœ‰ç‚¹ç±»ä¼¼æ•°ç»„ã€‚
3. å¯ä»¥éå†ï¼Œæ–¹æ³•æœ‰add, delete,has

#### weakSet

1. æˆå‘˜éƒ½æ˜¯å¯¹è±¡
2. æˆå‘˜éƒ½æ˜¯å¼±å¼•ç”¨ï¼Œéšæ—¶å¯ä»¥æ¶ˆå¤±ã€‚ å¯ä»¥ç”¨æ¥ä¿å­˜DOMèŠ‚ç‚¹ï¼Œä¸å®¹æ˜“é€ æˆå†…å­˜æ³„æ¼
3. ä¸èƒ½éå†ï¼Œæ–¹æ³•æœ‰add, delete,has
   
#### Map
1. æœ¬è´¨ä¸Šæ˜¯å¥å€¼å¯¹çš„é›†åˆï¼Œç±»ä¼¼é›†åˆ
2. å¯ä»¥éå†ï¼Œæ–¹æ³•å¾ˆå¤šï¼Œå¯ä»¥å¹²è·Ÿå„ç§æ•°æ®æ ¼å¼è½¬æ¢

#### weakMap

1. ç›´æ¥å—å¯¹è±¡ä½œä¸ºå¥åï¼ˆnullé™¤å¤–ï¼‰ï¼Œä¸æ¥å—å…¶ä»–ç±»å‹çš„å€¼ä½œä¸ºå¥å
2. å¥åæ‰€æŒ‡å‘çš„å¯¹è±¡ï¼Œä¸è®¡å…¥åƒåœ¾å›æ”¶æœºåˆ¶
3. ä¸èƒ½éå†ï¼Œæ–¹æ³•åŒget,set,has,delete





## B ç¬¬ 5 é¢˜ï¼šä»‹ç»ä¸‹æ·±åº¦ä¼˜å…ˆéå†å’Œå¹¿åº¦ä¼˜å…ˆéå†ï¼Œå¦‚ä½•å®ç°ï¼Ÿ

è§£æï¼šç¬¬ 5 é¢˜

ç¬¬äº”é¢˜é—®çš„æ˜¯æ·±åº¦ä¼˜å…ˆéå†å’Œå¹¿åº¦ä¼˜å…ˆéå†ï¼Œæˆ‘æ˜¯ä»domèŠ‚ç‚¹çš„éå†æ¥ç†è§£è¿™ä¸ªé—®é¢˜çš„

htmlä»£ç 

[![image](https://user-images.githubusercontent.com/27856388/52606290-118a3180-2ead-11e9-86b7-d0feae6f8030.png)](https://user-images.githubusercontent.com/27856388/52606290-118a3180-2ead-11e9-86b7-d0feae6f8030.png)

æˆ‘å°†ç”¨æ·±åº¦ä¼˜å…ˆéå†å’Œå¹¿åº¦ä¼˜å…ˆéå†å¯¹è¿™ä¸ªdomæ ‘è¿›è¡ŒæŸ¥æ‰¾

æ·±åº¦ä¼˜å…ˆéå†

æ·±åº¦ä¼˜å…ˆéå†DFS ä¸æ ‘çš„å…ˆåºéå†æ¯”è¾ƒç±»ä¼¼ã€‚
å‡è®¾åˆå§‹çŠ¶æ€æ˜¯å›¾ä¸­æ‰€æœ‰é¡¶ç‚¹å‡æœªè¢«è®¿é—®ï¼Œåˆ™ä»æŸä¸ªé¡¶ç‚¹vå‡ºå‘ï¼Œé¦–å…ˆè®¿é—®è¯¥é¡¶ç‚¹ç„¶åä¾æ¬¡ä»å®ƒçš„å„ä¸ªæœªè¢«è®¿é—®çš„é‚»æ¥ç‚¹å‡ºå‘æ·±åº¦ä¼˜å…ˆæœç´¢éå†å›¾ï¼Œç›´è‡³å›¾ä¸­æ‰€æœ‰å’Œvæœ‰è·¯å¾„ç›¸é€šçš„é¡¶ç‚¹éƒ½è¢«è®¿é—®åˆ°ã€‚è‹¥æ­¤æ—¶å°šæœ‰å…¶ä»–é¡¶ç‚¹æœªè¢«è®¿é—®åˆ°ï¼Œåˆ™å¦é€‰ä¸€ä¸ªæœªè¢«è®¿é—®çš„é¡¶ç‚¹ä½œèµ·å§‹ç‚¹ï¼Œé‡å¤ä¸Šè¿°è¿‡ç¨‹ï¼Œç›´è‡³å›¾ä¸­æ‰€æœ‰é¡¶ç‚¹éƒ½è¢«è®¿é—®åˆ°ä¸ºæ­¢ã€‚

```js
/*æ·±åº¦ä¼˜å…ˆéå†ä¸‰ç§æ–¹å¼*/
let deepTraversal1 = (node, nodeList = []) => {
  if (node !== null) {
    nodeList.push(node)
    let children = node.children
    for (let i = 0; i < children.length; i++) {
      deepTraversal1(children[i], nodeList)
    }
  }
  return nodeList
}

let deepTraversal2 = (node) => {
    let nodes = []
    if (node !== null) {
      nodes.push(node)
      let children = node.children
      for (let i = 0; i < children.length; i++) {
        nodes = nodes.concat(deepTraversal2(children[i]))
      }
    }
    return nodes
  }
}

// éé€’å½’
let deepTraversal3 = (node) => {
  let stack = []
  let nodes = []
  if (node) {
    // æ¨å…¥å½“å‰å¤„ç†çš„node
    stack.push(node)
    while (stack.length) {
      let item = stack.pop()
      let children = item.children
      nodes.push(item)
      // node = [] stack = [parent]
      // node = [parent] stack = [child3,child2,child1]
      // node = [parent, child1] stack = [child3,child2,child1-2,child1-1]
      // node = [parent, child1-1] stack = [child3,child2,child1-2]
      for (let i = children.length - 1; i >= 0; i--) {
        stack.push(children[i])
      }
    }
  }
  return nodes
}
```

å¹¿åº¦ä¼˜å…ˆéå† BFS
ä»å›¾ä¸­æŸé¡¶ç‚¹vå‡ºå‘ï¼Œåœ¨è®¿é—®äº†vä¹‹åä¾æ¬¡è®¿é—®vçš„å„ä¸ªæœªæ›¾è®¿é—®è¿‡çš„é‚»æ¥ç‚¹ï¼Œç„¶ååˆ†åˆ«ä»è¿™äº›é‚»æ¥ç‚¹å‡ºå‘ä¾æ¬¡è®¿é—®å®ƒä»¬çš„é‚»æ¥ç‚¹ï¼Œå¹¶ä½¿å¾—â€œå…ˆè¢«è®¿é—®çš„é¡¶ç‚¹çš„é‚»æ¥ç‚¹å…ˆäºåè¢«è®¿é—®çš„é¡¶ç‚¹çš„é‚»æ¥ç‚¹è¢«è®¿é—®ï¼Œç›´è‡³å›¾ä¸­æ‰€æœ‰å·²è¢«è®¿é—®çš„é¡¶ç‚¹çš„é‚»æ¥ç‚¹éƒ½è¢«è®¿é—®åˆ°ã€‚ å¦‚æœæ­¤æ—¶å›¾ä¸­å°šæœ‰é¡¶ç‚¹æœªè¢«è®¿é—®ï¼Œåˆ™éœ€è¦å¦é€‰ä¸€ä¸ªæœªæ›¾è¢«è®¿é—®è¿‡çš„é¡¶ç‚¹ä½œä¸ºæ–°çš„èµ·å§‹ç‚¹ï¼Œé‡å¤ä¸Šè¿°è¿‡ç¨‹ï¼Œç›´è‡³å›¾ä¸­æ‰€æœ‰é¡¶ç‚¹éƒ½è¢«è®¿é—®åˆ°ä¸ºæ­¢ã€‚

```js
let widthTraversal2 = (node) => {
  let nodes = []
  let stack = []
  if (node) {
    stack.push(node)
    while (stack.length) {
      let item = stack.shift()
      let children = item.children
      nodes.push(item)
        // é˜Ÿåˆ—ï¼Œå…ˆè¿›å…ˆå‡º
        // nodes = [] stack = [parent]
        // nodes = [parent] stack = [child1,child2,child3]
        // nodes = [parent, child1] stack = [child2,child3,child1-1,child1-2]
        // nodes = [parent,child1,child2]
      for (let i = 0; i < children.length; i++) {
        stack.push(children[i])
      }
    }
  }
  return nodes
}
```



## ç¬¬ 6 é¢˜ï¼šè¯·åˆ†åˆ«ç”¨æ·±åº¦ä¼˜å…ˆæ€æƒ³å’Œå¹¿åº¦ä¼˜å…ˆæ€æƒ³å®ç°ä¸€ä¸ªæ‹·è´å‡½æ•°ï¼Ÿ

è§£æï¼šç¬¬ 6 é¢˜

è¯ä¸å¤šè¯´ç›´æ¥æ”¾ä»£ç 
å‘ç°äº†æ¯”è¾ƒå¤šçš„é”™è¯¯ï¼Œä½†ç”±äºæœ€è¿‘å·¥ä½œæœ‰ç‚¹å¿™ï¼Œä¸€ç›´æ²¡æ¥å¾—åŠçº æ­£

æ›´æ”¹(0226)

```js
// å·¥å…·å‡½æ•°
let _toString = Object.prototype.toString
let map = {
  array: 'Array',
  object: 'Object',
  function: 'Function',
  string: 'String',
  null: 'Null',
  undefined: 'Undefined',
  boolean: 'Boolean',
  number: 'Number'
}
let getType = (item) => {
  return _toString.call(item).slice(8, -1)
}
let isTypeOf = (item, type) => {
  return map[type] && map[type] === getType(item)
}
```

æ·±å¤åˆ¶ æ·±åº¦ä¼˜å…ˆéå†

```js
let DFSdeepClone = (obj, visitedArr = []) => {
  let _obj = {}
  if (isTypeOf(obj, 'array') || isTypeOf(obj, 'object')) {
    let index = visitedArr.indexOf(obj)
    _obj = isTypeOf(obj, 'array') ? [] : {}
    if (~index) { // åˆ¤æ–­ç¯çŠ¶æ•°æ®
      _obj = visitedArr[index]
    } else {
      visitedArr.push(obj)
      for (let item in obj) {
        _obj[item] = DFSdeepClone(obj[item], visitedArr)
      }
    }
  } else if (isTypeOf(obj, 'function')) {
    _obj = eval('(' + obj.toString() + ')');
  } else {
    _obj = obj
  }
  return _obj
}
```

å¹¿åº¦ä¼˜å…ˆéå†

```js
let BFSdeepClone = (obj) => {
    let origin = [obj],
      copyObj = {},
      copy = [copyObj]
      // å»é™¤ç¯çŠ¶æ•°æ®
    let visitedQueue = [],
      visitedCopyQueue = []
    while (origin.length > 0) {
      let items = origin.shift(),
        _obj = copy.shift()
      visitedQueue.push(items)
      if (isTypeOf(items, 'object') || isTypeOf(items, 'array')) {
        for (let item in items) {
          let val = items[item]
          if (isTypeOf(val, 'object')) {
            let index = visitedQueue.indexOf(val)
            if (!~index) {
              _obj[item] = {}
                //ä¸‹æ¬¡whileå¾ªç¯ä½¿ç”¨ç»™ç©ºå¯¹è±¡æä¾›æ•°æ®
              origin.push(val)
                // æ¨å…¥å¼•ç”¨å¯¹è±¡
              copy.push(_obj[item])
            } else {
              _obj[item] = visitedCopyQueue[index]
              visitedQueue.push(_obj)
            }
          } else if (isTypeOf(val, 'array')) {
            // æ•°ç»„ç±»å‹åœ¨è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªç©ºæ•°ç»„
            _obj[item] = []
            origin.push(val)
            copy.push(_obj[item])
          } else if (isTypeOf(val, 'function')) {
            _obj[item] = eval('(' + val.toString() + ')');
          } else {
            _obj[item] = val
          }
        }
        // å°†å·²ç»å¤„ç†è¿‡çš„å¯¹è±¡æ•°æ®æ¨å…¥æ•°ç»„ ç»™ç¯çŠ¶æ•°æ®ä½¿ç”¨
        visitedCopyQueue.push(_obj)
      } else if (isTypeOf(items, 'function')) {
        copyObj = eval('(' + items.toString() + ')');
      } else {
        copyObj = obj
      }
    }
  return copyObj
}
```

æµ‹è¯•

```js
/**æµ‹è¯•æ•°æ® */
// è¾“å…¥ å­—ç¬¦ä¸²String
// é¢„æœŸè¾“å‡ºString
let str = 'String'
var strCopy = DFSdeepClone(str)
var strCopy1 = BFSdeepClone(str)
console.log(strCopy, strCopy1) // String String æµ‹è¯•é€šè¿‡
// è¾“å…¥ æ•°å­— -1980
// é¢„æœŸè¾“å‡ºæ•°å­— -1980
let num = -1980
var numCopy = DFSdeepClone(num)
var numCopy1 = BFSdeepClone(num)
console.log(numCopy, numCopy1) // -1980 -1980 æµ‹è¯•é€šè¿‡
// è¾“å…¥boolç±»å‹
// é¢„æœŸè¾“å‡ºboolç±»å‹
let bool = false
var boolCopy = DFSdeepClone(bool)
var boolCopy1 = BFSdeepClone(bool)
console.log(boolCopy, boolCopy1) //false false æµ‹è¯•é€šè¿‡
// è¾“å…¥ null
// é¢„æœŸè¾“å‡º null
let nul = null
var nulCopy = DFSdeepClone(nul)
var nulCopy1 = BFSdeepClone(nul)
console.log(nulCopy, nulCopy1) //null null æµ‹è¯•é€šè¿‡

// è¾“å…¥undefined
// é¢„æœŸè¾“å‡ºundefined
let und = undefined
var undCopy = DFSdeepClone(und)
var undCopy1 = BFSdeepClone(und)
console.log(undCopy, undCopy1) //undefined undefined æµ‹è¯•é€šè¿‡
  //è¾“å…¥å¼•ç”¨ç±»å‹obj
let obj = {
  a: 1,
  b: () => console.log(1),
  c: {
    d: 3,
    e: 4
  },
  f: [1, 2],
  und: undefined,
  nul: null
}
var objCopy = DFSdeepClone(obj)
var objCopy1 = BFSdeepClone(obj)
console.log(objCopy === objCopy1) // å¯¹è±¡ç±»å‹åˆ¤æ–­ false æµ‹è¯•é€šè¿‡
console.log(obj.c === objCopy.c) // å¯¹è±¡ç±»å‹åˆ¤æ–­ false æµ‹è¯•é€šè¿‡
console.log(obj.c === objCopy1.c) // å¯¹è±¡ç±»å‹åˆ¤æ–­ false æµ‹è¯•é€šè¿‡
console.log(obj.b === objCopy1.b) // å‡½æ•°ç±»å‹åˆ¤æ–­ false æµ‹è¯•é€šè¿‡
console.log(obj.b === objCopy.b) // å‡½æ•°ç±»å‹åˆ¤æ–­ false æµ‹è¯•é€šè¿‡
console.log(obj.f === objCopy.f) // æ•°ç»„ç±»å‹åˆ¤æ–­ false æµ‹è¯•é€šè¿‡
console.log(obj.f === objCopy1.f) // æ•°ç»„ç±»å‹åˆ¤æ–­ false æµ‹è¯•é€šè¿‡
console.log(obj.nul, obj.und) // è¾“å‡ºnullï¼Œundefined æµ‹è¯•é€šè¿‡

// è¾“å…¥ç¯çŠ¶æ•°æ®
// é¢„æœŸä¸çˆ†æ ˆä¸”æ·±åº¦å¤åˆ¶
let circleObj = {
  foo: {
    name: function() {
      console.log(1)
    },
    bar: {
      name: 'bar',
      baz: {
        name: 'baz',
        aChild: null //å¾…ä¼šè®©å®ƒæŒ‡å‘obj.foo
      }
    }
  }
}
circleObj.foo.bar.baz.aChild = circleObj.foo
var circleObjCopy = DFSdeepClone(circleObj)
var circleObjCopy1 = BFSdeepClone(circleObj)
console.log(circleObjCopy, circleObjCopy1) // æµ‹è¯•é€šè¿‡?
```

ps

å…³äºæ·±æµ…æ‹·è´çš„é—®é¢˜åšä¸»å·²ç»åœ¨ä»–çš„gitä¸Šæœ‰æ–‡ç« è¯´è¿‡äº†ï¼Œæˆ‘å°±ä¸åšå¤šçš„å™è¿°
è¿™ä¸¤ä¸ªæ–¹æ³•æˆ‘è®¤ä¸ºä¸»è¦åŒºåˆ«åœ¨äºå¯¹äºæ·±å±‚æ¬¡ä»¥åŠç¯çŠ¶æ•°æ®ï¼Œç”¨æ·±åº¦ä¼˜å…ˆéå†é€’å½’å»åšå®¹æ˜“çˆ†æ ˆï¼Œå¹¿åº¦ä¼˜å…ˆéå†æˆ‘å¯¹ç¯çŠ¶æ•°æ®è¿›è¡Œäº†å¤„ç†ï¼Œå·²ç»å­˜åœ¨è¿‡çš„å¯¹è±¡ä¼šå­˜åœ¨æ•°ç»„ä¸­ï¼Œä¸‹æ¬¡ç›´æ¥èµ‹å€¼å³å¯ï¼Œæ— éœ€ç»§ç»­éå†





## C ç¬¬ 7 é¢˜ï¼šES5/ES6 çš„ç»§æ‰¿é™¤äº†å†™æ³•ä»¥å¤–è¿˜æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

è§£æï¼šç¬¬ 7 é¢˜

[æ¥æºï¼šUnderstanding ECMAScript 6](https://leanpub.com/understandinges6/read#leanpub-auto-class-declarations)

1. `class` å£°æ˜ä¼šæå‡ï¼Œä½†ä¸ä¼šåˆå§‹åŒ–èµ‹å€¼ã€‚`Foo` è¿›å…¥æš‚æ—¶æ€§æ­»åŒºï¼Œç±»ä¼¼äº `let`ã€`const` å£°æ˜å˜é‡ã€‚

```js
const bar = new Bar(); // it's ok
function Bar() {
  this.bar = 42;
}

const foo = new Foo(); // ReferenceError: Foo is not defined
class Foo {
  constructor() {
    this.foo = 42;
  }
}
```

1. `class` å£°æ˜å†…éƒ¨ä¼šå¯ç”¨ä¸¥æ ¼æ¨¡å¼ã€‚

```js
// å¼•ç”¨ä¸€ä¸ªæœªå£°æ˜çš„å˜é‡
function Bar() {
  baz = 42; // it's ok
}
const bar = new Bar();

class Foo {
  constructor() {
    fol = 42; // ReferenceError: fol is not defined
  }
}
const foo = new Foo();
```

1. `class` çš„æ‰€æœ‰æ–¹æ³•ï¼ˆåŒ…æ‹¬é™æ€æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•ï¼‰éƒ½æ˜¯ä¸å¯æšä¸¾çš„ã€‚

```js
// å¼•ç”¨ä¸€ä¸ªæœªå£°æ˜çš„å˜é‡
function Bar() {
  this.bar = 42;
}
Bar.answer = function() {
  return 42;
};
Bar.prototype.print = function() {
  console.log(this.bar);
};
const barKeys = Object.keys(Bar); // ['answer']
const barProtoKeys = Object.keys(Bar.prototype); // ['print']

class Foo {
  constructor() {
    this.foo = 42;
  }
  static answer() {
    return 42;
  }
  print() {
    console.log(this.foo);
  }
}
const fooKeys = Object.keys(Foo); // []
const fooProtoKeys = Object.keys(Foo.prototype); // []
```

1. `class` çš„æ‰€æœ‰æ–¹æ³•ï¼ˆåŒ…æ‹¬é™æ€æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•ï¼‰éƒ½æ²¡æœ‰åŸå‹å¯¹è±¡ prototypeï¼Œæ‰€ä»¥ä¹Ÿæ²¡æœ‰`[[construct]]`ï¼Œä¸èƒ½ä½¿ç”¨ `new` æ¥è°ƒç”¨ã€‚

```js
function Bar() {
  this.bar = 42;
}
Bar.prototype.print = function() {
  console.log(this.bar);
};

const bar = new Bar();
const barPrint = new bar.print(); // it's ok

class Foo {
  constructor() {
    this.foo = 42;
  }
  print() {
    console.log(this.foo);
  }
}
const foo = new Foo();
const fooPrint = new foo.print(); // TypeError: foo.print is not a constructor
```

1. å¿…é¡»ä½¿ç”¨ `new` è°ƒç”¨ `class`ã€‚

```js
function Bar() {
  this.bar = 42;
}
const bar = Bar(); // it's ok

class Foo {
  constructor() {
    this.foo = 42;
  }
}
const foo = Foo(); // TypeError: Class constructor Foo cannot be invoked without 'new'
```

1. `class` å†…éƒ¨æ— æ³•é‡å†™ç±»åã€‚

```js
function Bar() {
  Bar = 'Baz'; // it's ok
  this.bar = 42;
}
const bar = new Bar();
// Bar: 'Baz'
// bar: Bar {bar: 42}  

class Foo {
  constructor() {
    this.foo = 42;
    Foo = 'Fol'; // TypeError: Assignment to constant variable
  }
}
const foo = new Foo();
Foo = 'Fol'; // it's ok
```





## ç¬¬ 8 é¢˜ï¼šsetTimeoutã€Promiseã€Async/Await çš„åŒºåˆ«

è§£æï¼šç¬¬ 8 é¢˜

è¿™é¢˜æ€ä¹ˆæ²¡äººç­”ï¼Œæˆ‘è¯´ä¸‹æˆ‘ç²—æµ…çš„è®¤è¯†ï¼ŒæŠ›ç –å¼•ç‰ï¼Œæ¬¢è¿æŒ‡æ­£å’Œè¡¥å……ã€‚
æˆ‘è§‰å¾—è¿™é¢˜ä¸»è¦æ˜¯è€ƒå¯Ÿè¿™ä¸‰è€…åœ¨äº‹ä»¶å¾ªç¯ä¸­çš„åŒºåˆ«ï¼Œäº‹ä»¶å¾ªç¯ä¸­åˆ†ä¸ºå®ä»»åŠ¡é˜Ÿåˆ—å’Œå¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚
å…¶ä¸­settimeoutçš„å›è°ƒå‡½æ•°æ”¾åˆ°å®ä»»åŠ¡é˜Ÿåˆ—é‡Œï¼Œç­‰åˆ°æ‰§è¡Œæ ˆæ¸…ç©ºä»¥åæ‰§è¡Œï¼›
promise.thené‡Œçš„å›è°ƒå‡½æ•°ä¼šæ”¾åˆ°ç›¸åº”å®ä»»åŠ¡çš„å¾®ä»»åŠ¡é˜Ÿåˆ—é‡Œï¼Œç­‰å®ä»»åŠ¡é‡Œé¢çš„åŒæ­¥ä»£ç æ‰§è¡Œå®Œå†æ‰§è¡Œï¼›asyncå‡½æ•°è¡¨ç¤ºå‡½æ•°é‡Œé¢å¯èƒ½ä¼šæœ‰å¼‚æ­¥æ–¹æ³•ï¼Œawaitåé¢è·Ÿä¸€ä¸ªè¡¨è¾¾å¼ï¼Œasyncæ–¹æ³•æ‰§è¡Œæ—¶ï¼Œé‡åˆ°awaitä¼šç«‹å³æ‰§è¡Œè¡¨è¾¾å¼ï¼Œç„¶åæŠŠè¡¨è¾¾å¼åé¢çš„ä»£ç æ”¾åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—é‡Œï¼Œè®©å‡ºæ‰§è¡Œæ ˆè®©åŒæ­¥ä»£ç å…ˆæ‰§è¡Œã€‚

#### 1. setTimeout

```
console.log('script start')	//1. æ‰“å° script start
setTimeout(function(){
    console.log('settimeout')	// 4. æ‰“å° settimeout
})	// 2. è°ƒç”¨ setTimeout å‡½æ•°ï¼Œå¹¶å®šä¹‰å…¶å®Œæˆåæ‰§è¡Œçš„å›è°ƒå‡½æ•°
console.log('script end')	//3. æ‰“å° script start
// è¾“å‡ºé¡ºåºï¼šscript start->script end->settimeout
```

#### 2. Promise

Promiseæœ¬èº«æ˜¯**åŒæ­¥çš„ç«‹å³æ‰§è¡Œå‡½æ•°**ï¼Œ å½“åœ¨executorä¸­æ‰§è¡Œresolveæˆ–è€…rejectçš„æ—¶å€™, æ­¤æ—¶æ˜¯å¼‚æ­¥æ“ä½œï¼Œ ä¼šå…ˆæ‰§è¡Œthen/catchç­‰ï¼Œå½“ä¸»æ ˆå®Œæˆåï¼Œæ‰ä¼šå»è°ƒç”¨resolve/rejectä¸­å­˜æ”¾çš„æ–¹æ³•æ‰§è¡Œï¼Œæ‰“å°pçš„æ—¶å€™ï¼Œæ˜¯æ‰“å°çš„è¿”å›ç»“æœï¼Œä¸€ä¸ªPromiseå®ä¾‹ã€‚

```
console.log('script start')
let promise1 = new Promise(function (resolve) {
    console.log('promise1')
    resolve()
    console.log('promise1 end')
}).then(function () {
    console.log('promise2')
})
setTimeout(function(){
    console.log('settimeout')
})
console.log('script end')
// è¾“å‡ºé¡ºåº: script start->promise1->promise1 end->script end->promise2->settimeout
```

å½“JSä¸»çº¿ç¨‹æ‰§è¡Œåˆ°Promiseå¯¹è±¡æ—¶ï¼Œ

- promise1.then() çš„å›è°ƒå°±æ˜¯ä¸€ä¸ª task
- promise1 æ˜¯ resolvedæˆ–rejected: é‚£è¿™ä¸ª task å°±ä¼šæ”¾å…¥å½“å‰äº‹ä»¶å¾ªç¯å›åˆçš„ microtask queue
- promise1 æ˜¯ pending: è¿™ä¸ª task å°±ä¼šæ”¾å…¥ äº‹ä»¶å¾ªç¯çš„æœªæ¥çš„æŸä¸ª(å¯èƒ½ä¸‹ä¸€ä¸ª)å›åˆçš„ microtask queue ä¸­
- setTimeout çš„å›è°ƒä¹Ÿæ˜¯ä¸ª task ï¼Œå®ƒä¼šè¢«æ”¾å…¥ macrotask queue å³ä½¿æ˜¯ 0ms çš„æƒ…å†µ

#### 3. async/await

```
async function async1(){
   console.log('async1 start');
    await async2();
    console.log('async1 end')
}
async function async2(){
    console.log('async2')
}

console.log('script start');
async1();
console.log('script end')

// è¾“å‡ºé¡ºåºï¼šscript start->async1 start->async2->script end->async1 end
```

async å‡½æ•°è¿”å›ä¸€ä¸ª Promise å¯¹è±¡ï¼Œå½“å‡½æ•°æ‰§è¡Œçš„æ—¶å€™ï¼Œä¸€æ—¦é‡åˆ° await å°±ä¼šå…ˆè¿”å›ï¼Œç­‰åˆ°è§¦å‘çš„å¼‚æ­¥æ“ä½œå®Œæˆï¼Œå†æ‰§è¡Œå‡½æ•°ä½“å†…åé¢çš„è¯­å¥ã€‚å¯ä»¥ç†è§£ä¸ºï¼Œæ˜¯è®©å‡ºäº†çº¿ç¨‹ï¼Œè·³å‡ºäº† async å‡½æ•°ä½“ã€‚

ä¸¾ä¸ªä¾‹å­ï¼š

```
async function func1() {
    return 1
}

console.log(func1())
```

[![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://camo.githubusercontent.com/cdf382b45dfc37ae972c480664cefd416ee13d234453deaae506230f6c3f55ea/68747470733a2f2f696d672d626c6f672e6373646e696d672e636e2f32303139303133313137343431333536322e706e67)](https://camo.githubusercontent.com/cdf382b45dfc37ae972c480664cefd416ee13d234453deaae506230f6c3f55ea/68747470733a2f2f696d672d626c6f672e6373646e696d672e636e2f32303139303133313137343431333536322e706e67)
å¾ˆæ˜¾ç„¶ï¼Œfunc1çš„è¿è¡Œç»“æœå…¶å®å°±æ˜¯ä¸€ä¸ªPromiseå¯¹è±¡ã€‚å› æ­¤æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨thenæ¥å¤„ç†åç»­é€»è¾‘ã€‚

```
func1().then(res => {
    console.log(res);  // 30
})
```

awaitçš„å«ä¹‰ä¸ºç­‰å¾…ï¼Œä¹Ÿå°±æ˜¯ async å‡½æ•°éœ€è¦ç­‰å¾…awaitåçš„å‡½æ•°æ‰§è¡Œå®Œæˆå¹¶ä¸”æœ‰äº†è¿”å›ç»“æœï¼ˆPromiseå¯¹è±¡ï¼‰ä¹‹åï¼Œæ‰èƒ½ç»§ç»­æ‰§è¡Œä¸‹é¢çš„ä»£ç ã€‚awaité€šè¿‡è¿”å›ä¸€ä¸ªPromiseå¯¹è±¡æ¥å®ç°åŒæ­¥çš„æ•ˆæœã€‚

æ›´å¤šå¯è§[setTimeoutã€Promiseã€Async/Await](https://github.com/sisterAn/blog/issues/21)





## ç¬¬ 9 é¢˜ï¼šï¼ˆå¤´æ¡ã€å¾®åŒ»ï¼‰Async/Await å¦‚ä½•é€šè¿‡åŒæ­¥çš„æ–¹å¼å®ç°å¼‚æ­¥

è§£æï¼šç¬¬ 9 é¢˜

æœ¬è´¨æ˜¯å•å‘é“¾è¡¨å§

Async/Await å¦‚ä½•é€šè¿‡åŒæ­¥çš„æ–¹å¼å®ç°å¼‚æ­¥

ä½œä¸ºå‰ç«¯äººå‘˜è¦å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦äº†è§£è¿™ä¸‰ä¸ªçŸ¥è¯†ç‚¹ï¼š

- åŒæ­¥
- å¼‚æ­¥
- Async/Await

é¦–å…ˆï¼Œ**js æ˜¯å•çº¿ç¨‹çš„ï¼ˆé‡å¤ä¸‰éï¼‰**ï¼Œæ‰€è°“å•çº¿ç¨‹ï¼Œ
é€šä¿—çš„è®²å°±æ˜¯ï¼Œ~~ä¸€æ ¹ç­‹~~ï¼ˆæ¯”å–»æœ‰ç‚¹è¿‡åˆ†ï¼Œå“ˆå“ˆï¼‰æ‰§è¡Œä»£ç æ˜¯ä¸€è¡Œä¸€è¡Œçš„å¾€ä¸‹èµ°ï¼ˆå³æ‰€è°“çš„**åŒæ­¥**ï¼‰ï¼Œ
å¦‚æœä¸Šé¢çš„æ²¡æ‰§è¡Œå®Œï¼Œå°±ç—´ç—´çš„ç­‰ç€ï¼ˆæ˜¯ä¸æ˜¯å¾ˆåƒæ‹çˆ±ä¸­åœ¨è·¯è¾¹ç­‰å¥¹/ä»–çš„ä½ ï¼Œå‡è£… new äº†ä¸ªå¯¹è±¡ï¼Œå•Šå“ˆå“ˆå“ˆï¼Œè°ƒçš®ä¸€ä¸‹å¾ˆå¼€å¿ƒï¼‰ï¼Œ
è¿˜æ˜¯ä¸¾ä¸ª ğŸŒ° å§ï¼š

```
// chrome 75
function test() {
  let d = Date.now();
  for (let i = 0; i < 1e8; i++) {}
  console.log(Date.now() - d); // 62mså·¦å³
}
function test1() {
  let d = Date.now();

  console.log(Date.now() - d); // 0
}
test();
test1();
```

ä¸Šé¢ä»…ä»…æ˜¯ä¸€ä¸ª for å¾ªç¯ï¼Œè€Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œä¼šæœ‰å¤§é‡çš„ç½‘ç»œè¯·æ±‚ï¼Œå®ƒçš„å“åº”æ—¶é—´æ˜¯ä¸ç¡®å®šçš„ï¼Œè¿™ç§æƒ…å†µä¸‹ä¹Ÿè¦ç—´ç—´çš„ç­‰ä¹ˆï¼Ÿæ˜¾ç„¶æ˜¯ä¸è¡Œçš„ï¼Œå› è€Œ js è®¾è®¡äº†å¼‚æ­¥ï¼Œå³ å‘èµ·ç½‘ç»œè¯·æ±‚ï¼ˆè¯¸å¦‚ IO æ“ä½œï¼Œå®šæ—¶å™¨ï¼‰ï¼Œç”±äºéœ€è¦ç­‰æœåŠ¡å™¨å“åº”ï¼Œå°±å…ˆä¸ç†ä¼šï¼Œè€Œæ˜¯å»åšå…¶ä»–çš„äº‹å„¿ï¼Œç­‰è¯·æ±‚è¿”å›äº†ç»“æœçš„æ—¶å€™å†è¯´ï¼ˆå³**å¼‚æ­¥**ï¼‰ã€‚
é‚£ä¹ˆå¦‚ä½•å®ç°å¼‚æ­¥å‘¢ï¼Ÿå…¶å®æˆ‘ä»¬å¹³æ—¶å·²ç»åœ¨å¤§é‡ä½¿ç”¨äº†ï¼Œé‚£å°±æ˜¯ `callback`ï¼Œä¾‹å¦‚ï¼š

```
$.ajax({
  url: 'http://xxx',
  success: function(res) {
    console.log(res);
  },
});
```

success ä½œä¸ºå‡½æ•°ä¼ é€’è¿‡å»å¹¶ä¸ä¼šç«‹å³æ‰§è¡Œï¼Œè€Œæ˜¯ç­‰è¯·æ±‚æˆåŠŸäº†æ‰æ‰§è¡Œï¼Œå³**å›è°ƒå‡½æ•°**ï¼ˆcallbackï¼‰

```
const fs = require('fs');
fs.rename('æ—§æ–‡ä»¶.txt', 'æ–°æ–‡ä»¶.txt', err => {
  if (err) throw err;
  console.log('é‡å‘½åå®Œæˆ');
});
```

å’Œç½‘ç»œè¯·æ±‚ç±»ä¼¼ï¼Œç­‰åˆ° IO æ“ä½œæœ‰äº†ç»“æœï¼ˆæ— è®ºæˆåŠŸä¸å¦ï¼‰æ‰ä¼šæ‰§è¡Œç¬¬ä¸‰ä¸ªå‚æ•°ï¼š`(err)=>{}`

ä»ä¸Šé¢æˆ‘ä»¬å°±å¯ä»¥çœ‹å‡ºï¼Œå®ç°å¼‚æ­¥çš„æ ¸å¿ƒå°±æ˜¯å›è°ƒé’©å­ï¼Œå°† cb ä½œä¸ºå‚æ•°ä¼ é€’ç»™å¼‚æ­¥æ‰§è¡Œå‡½æ•°ï¼Œå½“æœ‰äº†ç»“æœååœ¨è§¦å‘ cbã€‚æƒ³äº†è§£æ›´å¤šï¼Œå»çœ‹çœ‹ `event-loop` æœºåˆ¶å§ã€‚

è‡³äº async/await æ˜¯å¦‚ä½•å‡ºç°çš„å‘¢ï¼Œåœ¨ es6 ä¹‹å‰ï¼Œå¤§å¤š js æ•°é¡¹ç›®ä¸­ä¼šæœ‰ç±»ä¼¼è¿™æ ·çš„ä»£ç ï¼š

```
ajax1(url, () => {
  ajax2(url, () => {
    ajax3(url, () => {
      // do something
    });
  });
});
```

è¿™ç§å‡½æ•°åµŒå¥—ï¼Œå¤§é‡çš„å›è°ƒå‡½æ•°ï¼Œä½¿ä»£ç é˜…è¯»èµ·æ¥æ™¦æ¶©éš¾æ‡‚ï¼Œä¸ç›´è§‚ï¼Œå½¢è±¡çš„ç§°ä¹‹ä¸º**å›è°ƒåœ°ç‹±ï¼ˆcallback hellï¼‰**ï¼Œæ‰€ä»¥ä¸ºäº†åœ¨å†™æ³•ä¸Šèƒ½æ›´é€šä¿—ä¸€ç‚¹ï¼Œes6+é™†ç»­å‡ºç°äº† `Promise`ã€`Generator`ã€`Async/await`ï¼ŒåŠ›æ±‚åœ¨å†™æ³•ä¸Šç®€æ´æ˜äº†ï¼Œå¯è¯»æ€§å¼ºã€‚

=========================æˆ‘æ˜¯åˆ†å‰²çº¿==========================

ä»¥ä¸Šåªæ˜¯é“ºå«ï¼Œä¸‹é¢åœ¨è¿›å…¥æ­£é¢˜ ğŸ‘‡ï¼Œå¼€å§‹è¯´é“è¯´é“ä¸»è§’ï¼š`async/await`

=========================æˆ‘æ˜¯åˆ†å‰²çº¿==========================

`async/await` æ˜¯å‚ç…§ `Generator` å°è£…çš„ä¸€å¥—å¼‚æ­¥å¤„ç†æ–¹æ¡ˆï¼Œå¯ä»¥ç†è§£ä¸º `Generator` çš„è¯­æ³•ç³–ï¼Œ

æ‰€ä»¥äº†è§£ `async/await` å°±ä¸å¾—ä¸è®²ä¸€è®² `Generator`,

è€Œ `Generator` åˆä¾èµ–äºè¿­ä»£å™¨`Iterator`ï¼Œ

æ‰€ä»¥å°±å¾—å…ˆè®²ä¸€è®² `Iterator`,

è€Œ `Iterator` çš„æ€æƒ³å‘¢åˆæ¥æºäºå•å‘é“¾è¡¨ï¼Œ

ç»ˆäºæ‰¾åˆ°æºå¤´äº†ï¼šå•å‘é“¾è¡¨

1. å•å‘é“¾è¡¨

> wikiï¼šé“¾è¡¨ï¼ˆLinked listï¼‰æ˜¯ä¸€ç§å¸¸è§çš„åŸºç¡€æ•°æ®ç»“æ„ï¼Œæ˜¯ä¸€ç§[çº¿æ€§è¡¨](https://zh.wikipedia.org/wiki/çº¿æ€§è¡¨)ï¼Œä½†æ˜¯å¹¶ä¸ä¼šæŒ‰çº¿æ€§çš„é¡ºåºå‚¨å­˜æ•°æ®ï¼Œè€Œæ˜¯åœ¨æ¯ä¸€ä¸ªèŠ‚ç‚¹é‡Œå­˜åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„[æŒ‡é’ˆ](https://zh.wikipedia.org/wiki/æŒ‡æ¨™_(é›»è…¦ç§‘å­¸))ï¼ˆPointerï¼‰ã€‚ç”±äºä¸å¿…é¡»æŒ‰é¡ºåºå‚¨å­˜ï¼Œé“¾è¡¨åœ¨æ’å…¥çš„æ—¶å€™å¯ä»¥è¾¾åˆ° o(1)çš„å¤æ‚åº¦ï¼Œæ¯”å¦ä¸€ç§çº¿æ€§è¡¨[é¡ºåºè¡¨](https://zh.wikipedia.org/wiki/é¡ºåºè¡¨)å¿«å¾—å¤šï¼Œä½†æ˜¯æŸ¥æ‰¾ä¸€ä¸ªèŠ‚ç‚¹æˆ–è€…è®¿é—®ç‰¹å®šç¼–å·çš„èŠ‚ç‚¹åˆ™éœ€è¦ o(n)çš„æ—¶é—´ï¼Œè€Œé¡ºåºè¡¨å“åº”çš„æ—¶é—´å¤æ‚åº¦åˆ†åˆ«æ˜¯ o(logn)å’Œ o(1)ã€‚

æ€»ç»“ä¸€ä¸‹é“¾è¡¨ä¼˜ç‚¹ï¼š

- æ— éœ€é¢„å…ˆåˆ†é…å†…å­˜
- æ’å…¥/åˆ é™¤èŠ‚ç‚¹ä¸å½±å“å…¶ä»–èŠ‚ç‚¹ï¼Œæ•ˆç‡é«˜ï¼ˆå…¸å‹çš„ä¾‹å­ï¼šgit commitã€~~dom æ“ä½œ~~ï¼‰

å•å‘é“¾è¡¨ï¼šæ˜¯é“¾è¡¨ä¸­æœ€ç®€å•çš„ä¸€ç§ï¼Œå®ƒåŒ…å«ä¸¤ä¸ªåŸŸï¼Œä¸€ä¸ªä¿¡æ¯åŸŸå’Œä¸€ä¸ªæŒ‡é’ˆåŸŸã€‚è¿™ä¸ªé“¾æ¥æŒ‡å‘åˆ—è¡¨ä¸­çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè€Œæœ€åä¸€ä¸ªèŠ‚ç‚¹åˆ™æŒ‡å‘ä¸€ä¸ªç©ºå€¼ã€‚
[![image](https://camo.githubusercontent.com/beac82e401ecd06f6ffb9d202a23da183e9934571b5c3b76ad3ae55e5fb953a3/68747470733a2f2f757365722d676f6c642d63646e2e786974752e696f2f323031392f372f31352f313662663564396531336430653462313f773d38333326683d34373026663d706e6726733d3234333938)](https://camo.githubusercontent.com/beac82e401ecd06f6ffb9d202a23da183e9934571b5c3b76ad3ae55e5fb953a3/68747470733a2f2f757365722d676f6c642d63646e2e786974752e696f2f323031392f372f31352f313662663564396531336430653462313f773d38333326683d34373026663d706e6726733d3234333938)
ä¸€ä¸ªå•å‘é“¾è¡¨åŒ…å«ä¸¤ä¸ªå€¼: å½“å‰èŠ‚ç‚¹çš„å€¼å’Œä¸€ä¸ªæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„é“¾æ¥

å•é“¾ç‰¹ç‚¹ï¼šèŠ‚ç‚¹çš„é“¾æ¥æ–¹å‘æ˜¯å•å‘çš„ï¼›ç›¸å¯¹äºæ•°ç»„æ¥è¯´ï¼Œå•é“¾è¡¨çš„çš„éšæœºè®¿é—®é€Ÿåº¦è¾ƒæ…¢ï¼Œä½†æ˜¯å•é“¾è¡¨åˆ é™¤/æ·»åŠ æ•°æ®çš„æ•ˆç‡å¾ˆé«˜ã€‚

ç†è§£ js åŸå‹é“¾/ä½œç”¨åŸŸé“¾çš„è¯ï¼Œç†è§£è¿™ä¸ªå¾ˆå®¹æ˜“ï¼Œä»–ä»¬æ˜¯ç›¸é€šçš„ã€‚~~ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œæ•°ç»„çš„é•¿åº¦æ—¶å›ºå®šçš„ï¼Œæ‰€ä»¥æ•°ç»„ä¸­çš„å¢åŠ å’Œåˆ é™¤æ¯”è¾ƒéº»çƒ¦ï¼Œéœ€è¦é¢‘ç¹çš„ç§»åŠ¨æ•°ç»„ä¸­çš„å…¶ä»–å…ƒç´ ï¼Œè€Œ js ä½œä¸ºä¸€é—¨åŠ¨æ€è¯­è¨€ï¼Œæ•°ç»„æœ¬è´¨æ˜¯ä¸€ä¸ªç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ï¼Œæ˜¯åŠ¨æ€çš„ï¼Œä¸éœ€è¦é¢„å…ˆåˆ†é…å†…å­˜~~

é‚£ä¹ˆå¦‚ä½•è®¾è®¡ä¸€ä¸ªå•å‘é“¾è¡¨å‘¢ï¼Ÿè¿™ä¸ªå–å†³äºæˆ‘ä»¬éœ€è¦å“ªäº›æ“ä½œï¼Œé€šå¸¸æœ‰ï¼š

- append(element)ï¼šè¿½åŠ èŠ‚ç‚¹
- insert(element,index)ï¼šåœ¨ç´¢å¼•ä½ç½®æ’å…¥èŠ‚ç‚¹
- remove(element)ï¼šåˆ é™¤ç¬¬ä¸€ä¸ªåŒ¹é…åˆ°çš„èŠ‚ç‚¹
- removeAt(index)ï¼šåˆ é™¤æŒ‡å®šç´¢å¼•èŠ‚ç‚¹
- removeAll(element)ï¼šåˆ é™¤æ‰€æœ‰åŒ¹é…çš„èŠ‚ç‚¹
- get(index)ï¼šè·å–æŒ‡å®šç´¢å¼•çš„èŠ‚ç‚¹ä¿¡æ¯
- set(element,index)ï¼šä¿®æ”¹æŒ‡å®šç´¢å¼•çš„èŠ‚ç‚¹å€¼
- indexOf(element)ï¼šè·å–æŸèŠ‚ç‚¹çš„ç´¢å¼•ä½ç½®
- clear()ï¼šæ¸…é™¤æ‰€æœ‰èŠ‚ç‚¹
- length()ï¼šè¿”å›èŠ‚ç‚¹é•¿åº¦
- printf()ï¼šæ‰“å°èŠ‚ç‚¹ä¿¡æ¯

çœ‹åˆ°è¿™äº›æ–¹æ³•æ˜¯ä¸æ˜¯æœ‰äº›è®¸ç†Ÿæ‚‰ï¼Œå½“ä½ ç”¨åŸç”Ÿ js æˆ– jq æ—¶å¸¸ä¼šç”¨ä¸Šé¢ç±»ä¼¼çš„æ–¹æ³•ï¼Œç°åœ¨æ ¹æ®ä¸Šé¢åˆ—å‡ºçš„æ–¹æ³•è¿›è¡Œå®ç°ä¸€ä¸ªå•å‘é“¾ï¼š

```
// èŠ‚ç‚¹æ¨¡å‹
class LinkNode {
  constructor(element, next) {
    this.element = element;
    this.next = next;
  }
}

class LinkedList {
  constructor() {
    this._head = null;
    this._size = 0;
    this._errorBoundary = this._errorBoundary.bind(this);
    this._getNodeByIndex = this._getNodeByIndex.bind(this);
    this.append = this.append.bind(this);
    this.insert = this.insert.bind(this);
    this.remove = this.remove.bind(this);
    this.removeAt = this.removeAt.bind(this);
    this.removeAll = this.removeAll.bind(this);
    this.getElement = this.getElement.bind(this);
    this.setIndex = this.setIndex.bind(this);
    this.indexOf = this.indexOf.bind(this);
    this.clear = this.clear.bind(this);
    this.length = this.length.bind(this);
    this.printf = this.printf.bind(this);
  }

  // è¾¹ç•Œæ£€éªŒ
  _errorBoundary(index) {
    if (index < 0 || index >= this._size) {
      throw `è¶…å‡ºè¾¹ç•Œ(${0}~${this._size})ï¼Œç›®æ ‡ä½ç½®${index}ä¸å­˜åœ¨ï¼`;
    }
  }
  // æ ¹æ®ç´¢å¼•è·å–ç›®æ ‡å¯¹è±¡
  _getNodeByIndex(index) {
    this._errorBoundary(index);
    let obj = this._head;
    for (let i = 0; i < index; i++) {
      obj = obj.next;
    }
    return obj;
  }
  // è¿½åŠ èŠ‚ç‚¹
  append(element) {
    if (this._size === 0) {
      this._head = new LinkNode(element, null);
    } else {
      let obj = this._getNodeByIndex(this._size - 1);
      obj.next = new LinkNode(element, null);
    }
    this._size++;
  }
  // åœ¨ç´¢å¼•ä½ç½®æ’å…¥èŠ‚ç‚¹
  insert(element, index) {
    if (index === 0) {
      this._head = new LinkNode(element, this._head);
    } else {
      let obj = this._getNodeByIndex(index - 1);
      obj.next = new LinkNode(element, obj.next);
    }
    this._size++;
  }
  // åˆ é™¤ç¬¬ä¸€ä¸ªåŒ¹é…åˆ°çš„èŠ‚ç‚¹
  remove(element) {
    if (this._size < 1) return null;

    if (this._head.element == element) {
      this._head.element = this._head.next;
      this._size--;
      return element;
    } else {
      let temp = this._head;
      while (temp.next) {
        if (temp.next.element == element) {
          temp.next = temp.next.next;
          this._size--;
          return element;
        } else {
          temp = temp.next;
        }
      }
    }
    return null;
  }
  // åˆ é™¤æŒ‡å®šç´¢å¼•èŠ‚ç‚¹
  removeAt(index) {
    this._errorBoundary(index);
    let element = null;
    if (index === 0) {
      element = this._head.element;
      this._head = this._head.next;
    } else {
      let prev = this._getNodeByIndex(index - 1);
      element = prev.next.element;
      prev.next = prev.next.next;
    }
    this._size--;
    return element;
  }
  // åˆ é™¤æ‰€æœ‰åŒ¹é…çš„èŠ‚ç‚¹
  removeAll(element) {
    // åˆ›å»ºè™šæ‹Ÿå¤´èŠ‚ç‚¹ï¼Œ
    let v_head = new LinkNode(null, this._head);
    let tempNode = v_head;
    // let tempEle = null;
    while (tempNode.next) {
      if (tempNode.next.element == element) {
        tempNode.next = tempNode.next.next;
        this._size--;
        // tempEle = element;
      } else {
        tempNode = tempNode.next;
      }
    }
    this._head = v_head.next;
  }
  // è·å–æŒ‡å®šç´¢å¼•çš„èŠ‚ç‚¹ä¿¡æ¯
  getElement(index) {
    return this._getNodeByIndex(index).element;
  }
  // ä¿®æ”¹æŒ‡å®šç´¢å¼•çš„èŠ‚ç‚¹å€¼
  setIndex(element, index) {
    this._errorBoundary(index);
    let obj = this._getNodeByIndex(index);
    obj.element = element;
  }
  // è·å–æŸèŠ‚ç‚¹çš„ç´¢å¼•ä½ç½®
  indexOf(element) {
    let obj = this._head;
    let index = -1;
    for (let i = 0; i < this._size; i++) {
      if (obj.element == element) {
        index = i;
        break;
      }
      obj = obj.next;
    }
    return index;
  }
  // æ¸…é™¤æ‰€æœ‰èŠ‚ç‚¹
  clear() {
    this._head = null;
    this._size = 0;
  }
  // è¿”å›èŠ‚ç‚¹é•¿åº¦
  length() {
    return this._size;
  }
  // æ‰“å°èŠ‚ç‚¹ä¿¡æ¯
  printf() {
    let obj = this._head;
    const arr = [];
    while (obj != null) {
      arr.push(obj.element);
      obj = obj.next;
    }
    const str = arr.join('->');
    return str || null;
  }
}

const obj = new LinkedList();
obj.append(0);
obj.append(1);
obj.append(2);
obj.printf();
// "0->1->2"

obj.insert(3, 3);
obj.printf();
// "0->1->2->3"

obj.remove(3);
obj.printf();
// "0->1->2"

obj.removeAt(0);
obj.printf();
// "1->2"

obj.setIndex(0, 0);
obj.printf();
// "0->2"

obj.indexOf(2);
// 1

obj.length();
// 2

obj.clear();
obj.printf();
// null
```

[æŸ¥çœ‹æºç ](https://github.com/Mr-jiangzhiguo/book/code/linked.js)

é€šè¿‡ä»¥ä¸Šï¼Œæˆ‘å‡è£…ä½ æ˜ç™½ä»€ä¹ˆæ˜¯å•å‘é“¾è¡¨ï¼Œå¹¶ä¸”èƒ½å¤Ÿç”¨ä»£ç å®ç°ä¸€ä¸ªå•å‘é“¾è¡¨äº†ï¼Œä¸‹ä¸€æ­¥å¼€å§‹è¯´ä¸€è¯´**è¿­ä»£å™¨** `Iterator`

#### 2. Iterator

`Iterator` ç¿»è¯‘è¿‡æ¥å°±æ˜¯**è¿­ä»£å™¨ï¼ˆéå†å™¨ï¼‰**è®©æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹å®ƒçš„éå†è¿‡ç¨‹(ç±»ä¼¼äºå•å‘é“¾è¡¨)ï¼š

- åˆ›å»ºä¸€ä¸ª**æŒ‡é’ˆå¯¹è±¡**ï¼ŒæŒ‡å‘å½“å‰æ•°æ®ç»“æ„çš„èµ·å§‹ä½ç½®
- ç¬¬ä¸€æ¬¡è°ƒç”¨æŒ‡é’ˆå¯¹è±¡çš„ `next` æ–¹æ³•ï¼Œå°†æŒ‡é’ˆæŒ‡å‘æ•°æ®ç»“æ„çš„ç¬¬ä¸€ä¸ªæˆå‘˜
- ç¬¬äºŒæ¬¡è°ƒç”¨æŒ‡é’ˆå¯¹è±¡çš„ `next` æ–¹æ³•ï¼Œå°†æŒ‡é’ˆæŒ‡å‘æ•°æ®ç»“æ„çš„ç¬¬äºŒä¸ªæˆå‘˜
- ä¸æ–­çš„è°ƒç”¨æŒ‡é’ˆå¯¹è±¡çš„ `next` æ–¹æ³•ï¼Œç›´åˆ°å®ƒæŒ‡å‘æ•°æ®ç»“æ„çš„ç»“æŸä½ç½®

ä¸€ä¸ªå¯¹è±¡è¦å˜æˆå¯è¿­ä»£çš„ï¼Œå¿…é¡»å®ç° `@@iterator` æ–¹æ³•ï¼Œå³å¯¹è±¡ï¼ˆæˆ–å®ƒåŸå‹é“¾ä¸Šçš„æŸä¸ªå¯¹è±¡ï¼‰å¿…é¡»æœ‰ä¸€ä¸ªåå­—æ˜¯ `Symbol.iterator` çš„å±æ€§ï¼ˆåŸç”Ÿå…·æœ‰è¯¥å±æ€§çš„æœ‰ï¼šå­—ç¬¦ä¸²ã€æ•°ç»„ã€ç±»æ•°ç»„çš„å¯¹è±¡ã€Set å’Œ Mapï¼‰ï¼š

| å±æ€§               | å€¼                                               |
| ------------------ | ------------------------------------------------ |
| [Symbol.iterator]: | è¿”å›ä¸€ä¸ªå¯¹è±¡çš„æ— å‚å‡½æ•°ï¼Œè¢«è¿”å›å¯¹è±¡ç¬¦åˆè¿­ä»£å™¨åè®® |

å½“ä¸€ä¸ªå¯¹è±¡éœ€è¦è¢«è¿­ä»£çš„æ—¶å€™ï¼ˆæ¯”å¦‚å¼€å§‹ç”¨äºä¸€ä¸ª `for..of` å¾ªç¯ä¸­ï¼‰ï¼Œå®ƒçš„ `@@iterator` æ–¹æ³•è¢«è°ƒç”¨å¹¶ä¸”æ— å‚æ•°ï¼Œç„¶åè¿”å›ä¸€ä¸ªç”¨äºåœ¨è¿­ä»£ä¸­è·å¾—å€¼çš„è¿­ä»£å™¨

è¿­ä»£å™¨åè®®ï¼šäº§ç”Ÿä¸€ä¸ªæœ‰é™æˆ–æ— é™åºåˆ—çš„å€¼ï¼Œå¹¶ä¸”å½“æ‰€æœ‰çš„å€¼éƒ½å·²ç»è¢«è¿­ä»£åï¼Œå°±ä¼šæœ‰ä¸€ä¸ªé»˜è®¤çš„è¿”å›å€¼

å½“ä¸€ä¸ªå¯¹è±¡åªæœ‰æ»¡è¶³ä¸‹è¿°æ¡ä»¶æ‰ä¼šè¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªè¿­ä»£å™¨ï¼š

å®ƒå®ç°äº†ä¸€ä¸ª `next()` çš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•**å¿…é¡»è¿”å›ä¸€ä¸ªå¯¹è±¡**,å¯¹è±¡æœ‰ä¸¤ä¸ªå¿…è¦çš„å±æ€§ï¼š

- ```
  done
  ```

  ï¼ˆboolï¼‰

  - trueï¼šè¿­ä»£å™¨å·²ç»è¶…è¿‡äº†å¯è¿­ä»£æ¬¡æ•°ã€‚è¿™ç§æƒ…å†µä¸‹,value çš„å€¼å¯ä»¥è¢«çœç•¥
  - å¦‚æœè¿­ä»£å™¨å¯ä»¥äº§ç”Ÿåºåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªå€¼ï¼Œåˆ™ä¸º falseã€‚è¿™ç­‰æ•ˆäºæ²¡æœ‰æŒ‡å®š done è¿™ä¸ªå±æ€§

- `value` è¿­ä»£å™¨è¿”å›çš„ä»»ä½• JavaScript å€¼ã€‚done ä¸º true æ—¶å¯çœç•¥

æ ¹æ®ä¸Šé¢çš„è§„åˆ™ï¼Œå’±ä»¬æ¥è‡ªå®šä¹‰ä¸€ä¸ªç®€å•çš„è¿­ä»£å™¨ï¼š

```
const makeIterator = arr => {
  let nextIndex = 0;
  return {
    next: () =>
      nextIndex < arr.length
        ? { value: arr[nextIndex++], done: false }
        : { value: undefined, done: true },
  };
};
const it = makeIterator(['äººæœˆ', 'ç¥è¯']);
console.log(it.next()); // { value: "äººæœˆ", done: false }
console.log(it.next()); // { value: "ç¥è¯", done: false }
console.log(it.next()); // {value: undefined, done: true }
```

æˆ‘ä»¬è¿˜å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼š

```
const myIterable = {};
myIterable[Symbol.iterator] = function*() {
  yield 1;
  yield 2;
  yield 3;
};

for (let value of myIterable) {
  console.log(value);
}
// 1
// 2
// 3

//or

console.log([...myIterable]); // [1, 2, 3]
```

äº†è§£äº†è¿­ä»£å™¨ï¼Œä¸‹é¢å¯ä»¥è¿›ä¸€æ­¥äº†è§£ç”Ÿæˆå™¨äº†

#### 3. Generator

`Generator`ï¼šç”Ÿæˆå™¨å¯¹è±¡æ˜¯ç”Ÿæˆå™¨å‡½æ•°ï¼ˆGeneratorFunctionï¼‰è¿”å›çš„ï¼Œå®ƒç¬¦åˆ**å¯è¿­ä»£åè®®**å’Œ**è¿­ä»£å™¨åè®®**ï¼Œæ—¢æ˜¯è¿­ä»£å™¨ä¹Ÿæ˜¯å¯è¿­ä»£å¯¹è±¡ï¼Œå¯ä»¥è°ƒç”¨ `next` æ–¹æ³•ï¼Œä½†å®ƒä¸æ˜¯å‡½æ•°ï¼Œæ›´ä¸æ˜¯æ„é€ å‡½æ•°

ç”Ÿæˆå™¨å‡½æ•°ï¼ˆGeneratorFunctionï¼‰ï¼š

> function* name([param[, param[, ... param]]]) { statements }
>
> - nameï¼šå‡½æ•°å
> - paramï¼šå‚æ•°
> - statementsï¼šjs è¯­å¥

è°ƒç”¨ä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•°å¹¶ä¸ä¼šé©¬ä¸Šæ‰§è¡Œå®ƒé‡Œé¢çš„è¯­å¥ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªè¿™ä¸ªç”Ÿæˆå™¨çš„è¿­ä»£å™¨å¯¹è±¡ï¼Œå½“è¿™ä¸ªè¿­ä»£å™¨çš„ `next()` æ–¹æ³•è¢«é¦–æ¬¡ï¼ˆåç»­ï¼‰è°ƒç”¨æ—¶ï¼Œå…¶å†…çš„è¯­å¥ä¼šæ‰§è¡Œåˆ°ç¬¬ä¸€ä¸ªï¼ˆåç»­ï¼‰å‡ºç° `yield` çš„ä½ç½®ä¸ºæ­¢ï¼ˆè®©æ‰§è¡Œå¤„äº**æš‚åœçŠ¶**ï¼‰ï¼Œ`yield` åç´§è·Ÿè¿­ä»£å™¨è¦è¿”å›çš„å€¼ã€‚æˆ–è€…å¦‚æœç”¨çš„æ˜¯ `yield*`ï¼ˆå¤šäº†ä¸ªæ˜Ÿå·ï¼‰ï¼Œåˆ™è¡¨ç¤ºå°†æ‰§è¡Œæƒç§»äº¤ç»™å¦ä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•°ï¼ˆå½“å‰ç”Ÿæˆå™¨**æš‚åœæ‰§è¡Œ**ï¼‰ï¼Œè°ƒç”¨ `next()` ï¼ˆå†å¯åŠ¨ï¼‰æ–¹æ³•æ—¶ï¼Œå¦‚æœä¼ å…¥äº†å‚æ•°ï¼Œé‚£ä¹ˆè¿™ä¸ªå‚æ•°ä¼šä½œä¸º**ä¸Šä¸€æ¡æ‰§è¡Œçš„ `yield` è¯­å¥çš„è¿”å›å€¼**ï¼Œä¾‹å¦‚ï¼š

```
function* another() {
  yield 'äººæœˆç¥è¯';
}
function* gen() {
  yield* another(); // ç§»äº¤æ‰§è¡Œæƒ
  const a = yield 'hello';
  const b = yield a; // a='world' æ˜¯ next('world') ä¼ å‚èµ‹å€¼ç»™äº†ä¸Šä¸€ä¸ª yidle 'hello' çš„å·¦å€¼
  yield b; // b=ï¼ æ˜¯ next('ï¼') ä¼ å‚èµ‹å€¼ç»™äº†ä¸Šä¸€ä¸ª yidle a çš„å·¦å€¼
}
const g = gen();
g.next(); // {value: "äººæœˆç¥è¯", done: false}
g.next(); // {value: "hello", done: false}
g.next('world'); // {value: "world", done: false} å°† 'world' èµ‹ç»™ä¸Šä¸€æ¡ yield 'hello' çš„å·¦å€¼ï¼Œå³æ‰§è¡Œ a='world'ï¼Œ
g.next('!'); // {value: "!", done: false} å°† '!' èµ‹ç»™ä¸Šä¸€æ¡ yield a çš„å·¦å€¼ï¼Œå³æ‰§è¡Œ b='!'ï¼Œè¿”å› b
g.next(); // {value: undefined, done: false}
```

çœ‹åˆ°è¿™é‡Œï¼Œä½ å¯èƒ½ä¼šé—®ï¼Œ`Generator` å’Œ `callback` æœ‰å•¥å…³ç³»ï¼Œå¦‚ä½•å¤„ç†å¼‚æ­¥å‘¢ï¼Ÿå…¶å®äºŒè€…æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œæˆ‘ä»¬åªæ˜¯é€šè¿‡ä¸€äº›æ–¹å¼å¼ºè¡Œçš„å®ƒä»¬äº§ç”Ÿäº†å…³ç³»ï¼Œæ‰ä¼šæœ‰ `Generator` å¤„ç†å¼‚æ­¥

æˆ‘ä»¬æ¥æ€»ç»“ä¸€ä¸‹ `Generator` çš„æœ¬è´¨ï¼Œæš‚åœï¼Œå®ƒä¼šè®©ç¨‹åºæ‰§è¡Œåˆ°æŒ‡å®šä½ç½®å…ˆæš‚åœï¼ˆ`yield`ï¼‰ï¼Œç„¶åå†å¯åŠ¨ï¼ˆ`next`ï¼‰ï¼Œå†æš‚åœï¼ˆ`yield`ï¼‰ï¼Œå†å¯åŠ¨ï¼ˆ`next`ï¼‰ï¼Œè€Œè¿™ä¸ªæš‚åœå°±å¾ˆå®¹æ˜“è®©å®ƒå’Œå¼‚æ­¥æ“ä½œäº§ç”Ÿè”ç³»ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨å¤„ç†å¼‚æ­¥æ—¶ï¼šå¼€å§‹å¼‚æ­¥å¤„ç†ï¼ˆç½‘ç»œæ±‚æƒ…ã€IO æ“ä½œï¼‰ï¼Œç„¶åæš‚åœä¸€ä¸‹ï¼Œç­‰å¤„ç†å®Œäº†ï¼Œå†è¯¥å¹²å˜›å¹²å˜›ã€‚ä¸è¿‡å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ**js æ˜¯å•çº¿ç¨‹çš„ï¼ˆåˆé‡å¤äº†ä¸‰éï¼‰**ï¼Œå¼‚æ­¥è¿˜æ˜¯å¼‚æ­¥ï¼Œcallback è¿˜æ˜¯ callbackï¼Œä¸ä¼šå› ä¸º `Generator` è€Œæœ‰ä»»ä½•æ”¹å˜

ä¸‹é¢æ¥çœ‹çœ‹ï¼Œç”¨ `Generator` å®ç°å¼‚æ­¥ï¼š

```
const promisify = require('util').promisify;
const path = require('path');
const fs = require('fs');
const readFile = promisify(fs.readFile);

const gen = function*() {
  const res1 = yield readFile(path.resolve(__dirname, '../data/a.json'), { encoding: 'utf8' });
  console.log(res1);
  const res2 = yield readFile(path.resolve(__dirname, '../data/b.json'), { encoding: 'utf8' });
  console.log(res2);
};

const g = gen();

const g1 = g.next();
console.log('g1:', g1);

g1.value
  .then(res1 => {
    console.log('res1:', res1);
    const g2 = g.next(res1);
    console.log('g2:', g2);
    g2.value
      .then(res2 => {
        console.log('res2:', res2);
        g.next(res2);
      })
      .catch(err2 => {
        console.log(err2);
      });
  })
  .catch(err1 => {
    console.log(err1);
  });
// g1: { value: Promise { <pending> }, done: false }
// res1: {
//   "a": 1
// }

// {
//   "a": 1
// }

// g2: { value: Promise { <pending> }, done: false }
// res2: {
//   "b": 2
// }

// {
//   "b": 2
// }
```

ä»¥ä¸Šä»£ç æ˜¯ `Generator` å’Œ `callback` ç»“åˆå®ç°çš„å¼‚æ­¥ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œä»ç„¶éœ€è¦æ‰‹åŠ¨æ‰§è¡Œ `.then` å±‚å±‚æ·»åŠ å›è°ƒï¼Œä½†ç”±äº `next()` æ–¹æ³•è¿”å›å¯¹è±¡ `{value: xxx,done: true/false}` æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç®€åŒ–å®ƒï¼Œå†™ä¸€ä¸ªè‡ªåŠ¨æ‰§è¡Œå™¨ï¼š

```
const promisify = require('util').promisify;
const path = require('path');
const fs = require('fs');
const readFile = promisify(fs.readFile);

function run(gen) {
  const g = gen();
  function next(data) {
    const res = g.next(data);
    // æ·±åº¦é€’å½’ï¼Œåªè¦ `Generator` å‡½æ•°è¿˜æ²¡æ‰§è¡Œåˆ°æœ€åä¸€æ­¥ï¼Œ`next` å‡½æ•°å°±è°ƒç”¨è‡ªèº«
    if (res.done) return res.value;
    res.value.then(function(data) {
      next(data);
    });
  }
  next();
}
run(function*() {
  const res1 = yield readFile(path.resolve(__dirname, '../data/a.json'), { encoding: 'utf8' });
  console.log(res1);
  // {
  //   "a": 1
  // }
  const res2 = yield readFile(path.resolve(__dirname, '../data/b.json'), { encoding: 'utf8' });
  console.log(res2);
  // {
  //   "b": 2
  // }
});
```

è¯´äº†è¿™ä¹ˆå¤šï¼Œæ€ä¹ˆè¿˜æ²¡æœ‰åˆ° `async/await`ï¼Œå®¢å®˜åˆ«æ€¥ï¼Œé©¬ä¸Šæ¥äº†ï¼ˆå…¶å®æˆ‘å·²ç»æ¼äº†ä¸€äº›å†…å®¹æ²¡è¯´ï¼šPromise å’Œ callback çš„å…³ç³»ï¼Œthunk å‡½æ•°ï¼Œco åº“ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥å» google ä¸€ä¸‹ï¼Œruanyifeng è€å¸ˆè®²çš„[es6 å…¥é—¨](http://es6.ruanyifeng.com/)éå¸¸æ£’ï¼Œæˆ‘æ—¶ä¸æ—¶çš„éƒ½ä¼šå»çœ‹ä¸€çœ‹ï¼‰

#### 4. Async/Await

é¦–å…ˆï¼Œ`async/await` æ˜¯ `Generator` çš„è¯­æ³•ç³–ï¼Œä¸Šé¢*æˆ‘æ˜¯åˆ†å‰²çº¿*ä¸‹çš„ç¬¬ä¸€å¥å·²ç»è®²è¿‡ï¼Œå…ˆæ¥çœ‹ä¸€ä¸‹äºŒè€…çš„å¯¹æ¯”ï¼š

```
// Generator
run(function*() {
  const res1 = yield readFile(path.resolve(__dirname, '../data/a.json'), { encoding: 'utf8' });
  console.log(res1);
  const res2 = yield readFile(path.resolve(__dirname, '../data/b.json'), { encoding: 'utf8' });
  console.log(res2);
});

// async/await
const readFile = async ()=>{
  const res1 = await readFile(path.resolve(__dirname, '../data/a.json'), { encoding: 'utf8' });
  console.log(res1);
  const res2 = await readFile(path.resolve(__dirname, '../data/b.json'), { encoding: 'utf8' });
  console.log(res2);
  return 'done'ï¼›
}
const res = readFile();
```

å¯ä»¥çœ‹åˆ°ï¼Œ`async function` ä»£æ›¿äº† `function*`ï¼Œ`await` ä»£æ›¿äº† `yield`ï¼ŒåŒæ—¶ä¹Ÿæ— éœ€è‡ªå·±æ‰‹å†™ä¸€ä¸ªè‡ªåŠ¨æ‰§è¡Œå™¨ `run` äº†

ç°åœ¨å†æ¥çœ‹çœ‹`async/await` çš„ç‰¹ç‚¹ï¼š

- å½“ `await` åé¢è·Ÿçš„æ˜¯ Promise å¯¹è±¡æ—¶ï¼Œæ‰ä¼šå¼‚æ­¥æ‰§è¡Œï¼Œå…¶å®ƒç±»å‹çš„æ•°æ®ä¼šåŒæ­¥æ‰§è¡Œ
- æ‰§è¡Œ `const res = readFile();` è¿”å›çš„ä»ç„¶æ˜¯ä¸ª Promise å¯¹è±¡ï¼Œä¸Šé¢ä»£ç ä¸­çš„ `return 'done';` ä¼šç›´æ¥è¢«ä¸‹é¢ `then` å‡½æ•°æ¥æ”¶åˆ°

```
res.then(data => {
  console.log(data); // done
});
```

å•Šï¼Œç»ˆäºå®Œäº†ï¼Œä¸€ä¸ª `async-await` è¿å¸¦å‡ºæ¥è¿™ä¹ˆå¤šçŸ¥è¯†ç‚¹ï¼Œä»¥åé¢è¯•è¢«é—®åˆ°å®ƒçš„åŸç†æ—¶ï¼Œå¸Œæœ›èƒ½å¤Ÿå¸®åŠ©åˆ°ä½ 

ã€å‚è€ƒã€‘ï¼š

1. [https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Iteration_protocols#%E5%8F%AF%E8%BF%AD%E4%BB%A3%E5%8D%8F%E8%AE%AE](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Iteration_protocols#å¯è¿­ä»£åè®®)
2. http://es6.ruanyifeng.com/#docs/iterator
3. http://es6.ruanyifeng.com/#docs/async

åŸæ–‡åœ°å€ï¼šhttps://juejin.im/post/5d2c814c6fb9a07ecd3d8e43







## ç¬¬ 10 é¢˜ï¼šï¼ˆå¤´æ¡ï¼‰å¼‚æ­¥ç¬”è¯•é¢˜

è¯·å†™å‡ºä¸‹é¢ä»£ç çš„è¿è¡Œç»“æœ

~~~js
async function async1() {
  console.log('async1 start');
  await async2();
  console.log('async1 end');
}
async function async2() {
  console.log('async2');
}
console.log('script start');
setTimeout(function() {
  console.log('setTimeout');
}, 0)
async1();
new Promise(function(resolve) {
  console.log('promise1');
  resolve();
}).then(function() {
  console.log('promise2');
});
console.log('script end');
~~~

è§£æï¼šç¬¬ 10 é¢˜

ä»ä¸€é“é¢˜æµ…è¯´ JavaScript çš„äº‹ä»¶å¾ªç¯

**æ³¨ï¼šæœ¬ç¯‡æ–‡ç« è¿è¡Œç¯å¢ƒä¸ºå½“å‰æœ€æ–°ç‰ˆæœ¬çš„è°·æ­Œæµè§ˆå™¨ï¼ˆ72.0.3626.109ï¼‰**

æœ€è¿‘çœ‹åˆ°è¿™æ ·ä¸€é“æœ‰å…³äº‹ä»¶å¾ªç¯çš„å‰ç«¯é¢è¯•é¢˜ï¼š

```
//è¯·å†™å‡ºè¾“å‡ºå†…å®¹
async function async1() {
    console.log('async1 start');
    await async2();
    console.log('async1 end');
}
async function async2() {
	console.log('async2');
}

console.log('script start');

setTimeout(function() {
    console.log('setTimeout');
}, 0)

async1();

new Promise(function(resolve) {
    console.log('promise1');
    resolve();
}).then(function() {
    console.log('promise2');
});
console.log('script end');


/*
script start
async1 start
async2
promise1
script end
async1 end
promise2
setTimeout
*/
```

è¿™é“é¢˜ä¸»è¦è€ƒå¯Ÿçš„æ˜¯äº‹ä»¶å¾ªç¯ä¸­å‡½æ•°æ‰§è¡Œé¡ºåºçš„é—®é¢˜ï¼Œå…¶ä¸­åŒ…æ‹¬`async` ï¼Œ`await`ï¼Œ`setTimeout`ï¼Œ`Promise`å‡½æ•°ã€‚ä¸‹é¢æ¥è¯´ä¸€ä¸‹æœ¬é¢˜ä¸­æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹ã€‚

ä»»åŠ¡é˜Ÿåˆ—

é¦–å…ˆæˆ‘ä»¬éœ€è¦æ˜ç™½ä»¥ä¸‹å‡ ä»¶äº‹æƒ…ï¼š

- JSåˆ†ä¸ºåŒæ­¥ä»»åŠ¡å’Œå¼‚æ­¥ä»»åŠ¡
- åŒæ­¥ä»»åŠ¡éƒ½åœ¨ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œï¼Œå½¢æˆä¸€ä¸ªæ‰§è¡Œæ ˆ
- ä¸»çº¿ç¨‹ä¹‹å¤–ï¼Œäº‹ä»¶è§¦å‘çº¿ç¨‹ç®¡ç†ç€ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ï¼Œåªè¦å¼‚æ­¥ä»»åŠ¡æœ‰äº†è¿è¡Œç»“æœï¼Œå°±åœ¨ä»»åŠ¡é˜Ÿåˆ—ä¹‹ä¸­æ”¾ç½®ä¸€ä¸ªäº‹ä»¶ã€‚
- ä¸€æ—¦æ‰§è¡Œæ ˆä¸­çš„æ‰€æœ‰åŒæ­¥ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼ˆæ­¤æ—¶JSå¼•æ“ç©ºé—²ï¼‰ï¼Œç³»ç»Ÿå°±ä¼šè¯»å–ä»»åŠ¡é˜Ÿåˆ—ï¼Œå°†å¯è¿è¡Œçš„å¼‚æ­¥ä»»åŠ¡æ·»åŠ åˆ°å¯æ‰§è¡Œæ ˆä¸­ï¼Œå¼€å§‹æ‰§è¡Œã€‚

æ ¹æ®è§„èŒƒï¼Œäº‹ä»¶å¾ªç¯æ˜¯é€šè¿‡[ä»»åŠ¡é˜Ÿåˆ—](https://www.w3.org/TR/html5/webappapis.html#task-queues)çš„æœºåˆ¶æ¥è¿›è¡Œåè°ƒçš„ã€‚ä¸€ä¸ª Event Loop ä¸­ï¼Œå¯ä»¥æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ªä»»åŠ¡é˜Ÿåˆ—(task queue)ï¼Œä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ä¾¿æ˜¯ä¸€ç³»åˆ—æœ‰åºä»»åŠ¡(task)çš„é›†åˆï¼›**æ¯ä¸ªä»»åŠ¡éƒ½æœ‰ä¸€ä¸ªä»»åŠ¡æº(task source)ï¼Œæºè‡ªåŒä¸€ä¸ªä»»åŠ¡æºçš„ task å¿…é¡»æ”¾åˆ°åŒä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ï¼Œä»ä¸åŒæºæ¥çš„åˆ™è¢«æ·»åŠ åˆ°ä¸åŒé˜Ÿåˆ—ã€‚** setTimeout/Promise ç­‰APIä¾¿æ˜¯ä»»åŠ¡æºï¼Œè€Œè¿›å…¥ä»»åŠ¡é˜Ÿåˆ—çš„æ˜¯ä»–ä»¬æŒ‡å®šçš„å…·ä½“æ‰§è¡Œä»»åŠ¡ã€‚

[![ä»»åŠ¡é˜Ÿåˆ—](https://camo.githubusercontent.com/569f3f8af4ef408bf1c8e86ef1a0c593a6b2a678e1ab36fb1d641d1f292dce08/68747470733a2f2f692e6c6f6c692e6e65742f323031392f30322f30382f356335643764383530353663372e706e67)](https://camo.githubusercontent.com/569f3f8af4ef408bf1c8e86ef1a0c593a6b2a678e1ab36fb1d641d1f292dce08/68747470733a2f2f692e6c6f6c692e6e65742f323031392f30322f30382f356335643764383530353663372e706e67)

å®ä»»åŠ¡

(macro)taskï¼ˆåˆç§°ä¹‹ä¸ºå®ä»»åŠ¡ï¼‰ï¼Œå¯ä»¥ç†è§£æ˜¯æ¯æ¬¡æ‰§è¡Œæ ˆæ‰§è¡Œçš„ä»£ç å°±æ˜¯ä¸€ä¸ªå®ä»»åŠ¡ï¼ˆåŒ…æ‹¬æ¯æ¬¡ä»äº‹ä»¶é˜Ÿåˆ—ä¸­è·å–ä¸€ä¸ªäº‹ä»¶å›è°ƒå¹¶æ”¾åˆ°æ‰§è¡Œæ ˆä¸­æ‰§è¡Œï¼‰ã€‚

æµè§ˆå™¨ä¸ºäº†èƒ½å¤Ÿä½¿å¾—JSå†…éƒ¨(macro)taskä¸DOMä»»åŠ¡èƒ½å¤Ÿæœ‰åºçš„æ‰§è¡Œï¼Œ**ä¼šåœ¨ä¸€ä¸ª(macro)taskæ‰§è¡Œç»“æŸåï¼Œåœ¨ä¸‹ä¸€ä¸ª(macro)task æ‰§è¡Œå¼€å§‹å‰ï¼Œå¯¹é¡µé¢è¿›è¡Œé‡æ–°æ¸²æŸ“**ï¼Œæµç¨‹å¦‚ä¸‹ï¼š

```
(macro)task->æ¸²æŸ“->(macro)task->...
```

(macro)taskä¸»è¦åŒ…å«ï¼šscript(æ•´ä½“ä»£ç )ã€setTimeoutã€setIntervalã€I/Oã€UIäº¤äº’äº‹ä»¶ã€postMessageã€MessageChannelã€setImmediate(Node.js ç¯å¢ƒ)

å¾®ä»»åŠ¡

microtaskï¼ˆåˆç§°ä¸ºå¾®ä»»åŠ¡ï¼‰ï¼Œ**å¯ä»¥ç†è§£æ˜¯åœ¨å½“å‰ task æ‰§è¡Œç»“æŸåç«‹å³æ‰§è¡Œçš„ä»»åŠ¡**ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨å½“å‰taskä»»åŠ¡åï¼Œä¸‹ä¸€ä¸ªtaskä¹‹å‰ï¼Œåœ¨æ¸²æŸ“ä¹‹å‰ã€‚

æ‰€ä»¥å®ƒçš„å“åº”é€Ÿåº¦ç›¸æ¯”setTimeoutï¼ˆsetTimeoutæ˜¯taskï¼‰ä¼šæ›´å¿«ï¼Œå› ä¸ºæ— éœ€ç­‰æ¸²æŸ“ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æŸä¸€ä¸ªmacrotaskæ‰§è¡Œå®Œåï¼Œå°±ä¼šå°†åœ¨å®ƒæ‰§è¡ŒæœŸé—´äº§ç”Ÿçš„æ‰€æœ‰microtaskéƒ½æ‰§è¡Œå®Œæ¯•ï¼ˆåœ¨æ¸²æŸ“å‰ï¼‰ã€‚

microtaskä¸»è¦åŒ…å«ï¼šPromise.thenã€MutaionObserverã€process.nextTick(Node.js ç¯å¢ƒ)

è¿è¡Œæœºåˆ¶

åœ¨äº‹ä»¶å¾ªç¯ä¸­ï¼Œæ¯è¿›è¡Œä¸€æ¬¡å¾ªç¯æ“ä½œç§°ä¸º tickï¼Œæ¯ä¸€æ¬¡ tick çš„ä»»åŠ¡[å¤„ç†æ¨¡å‹](https://www.w3.org/TR/html5/webappapis.html#event-loops-processing-model)æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œä½†å…³é”®æ­¥éª¤å¦‚ä¸‹ï¼š

- æ‰§è¡Œä¸€ä¸ªå®ä»»åŠ¡ï¼ˆæ ˆä¸­æ²¡æœ‰å°±ä»äº‹ä»¶é˜Ÿåˆ—ä¸­è·å–ï¼‰
- æ‰§è¡Œè¿‡ç¨‹ä¸­å¦‚æœé‡åˆ°å¾®ä»»åŠ¡ï¼Œå°±å°†å®ƒæ·»åŠ åˆ°å¾®ä»»åŠ¡çš„ä»»åŠ¡é˜Ÿåˆ—ä¸­
- å®ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åï¼Œç«‹å³æ‰§è¡Œå½“å‰å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰å¾®ä»»åŠ¡ï¼ˆä¾æ¬¡æ‰§è¡Œï¼‰
- å½“å‰å®ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œå¼€å§‹æ£€æŸ¥æ¸²æŸ“ï¼Œç„¶åGUIçº¿ç¨‹æ¥ç®¡æ¸²æŸ“
- æ¸²æŸ“å®Œæ¯•åï¼ŒJSçº¿ç¨‹ç»§ç»­æ¥ç®¡ï¼Œå¼€å§‹ä¸‹ä¸€ä¸ªå®ä»»åŠ¡ï¼ˆä»äº‹ä»¶é˜Ÿåˆ—ä¸­è·å–ï¼‰

æµç¨‹å›¾å¦‚ä¸‹ï¼š

[![mark](https://camo.githubusercontent.com/6960fe108d5b5064db1751528fc65ed70f08be3f40c25024ceef66370f4ef1b3/68747470733a2f2f692e6c6f6c692e6e65742f323031392f30322f30382f356335643661353238626461662e6a7067)](https://camo.githubusercontent.com/6960fe108d5b5064db1751528fc65ed70f08be3f40c25024ceef66370f4ef1b3/68747470733a2f2f692e6c6f6c692e6e65742f323031392f30322f30382f356335643661353238626461662e6a7067)

Promiseå’Œasyncä¸­çš„ç«‹å³æ‰§è¡Œ

æˆ‘ä»¬çŸ¥é“Promiseä¸­çš„å¼‚æ­¥ä½“ç°åœ¨`then`å’Œ`catch`ä¸­ï¼Œæ‰€ä»¥å†™åœ¨Promiseä¸­çš„ä»£ç æ˜¯è¢«å½“åšåŒæ­¥ä»»åŠ¡ç«‹å³æ‰§è¡Œçš„ã€‚è€Œåœ¨async/awaitä¸­ï¼Œåœ¨å‡ºç°awaitå‡ºç°ä¹‹å‰ï¼Œå…¶ä¸­çš„ä»£ç ä¹Ÿæ˜¯ç«‹å³æ‰§è¡Œçš„ã€‚é‚£ä¹ˆå‡ºç°äº†awaitæ—¶å€™å‘ç”Ÿäº†ä»€ä¹ˆå‘¢ï¼Ÿ

awaitåšäº†ä»€ä¹ˆ

ä»å­—é¢æ„æ€ä¸Šçœ‹awaitå°±æ˜¯ç­‰å¾…ï¼Œawait ç­‰å¾…çš„æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œè¿™ä¸ªè¡¨è¾¾å¼çš„è¿”å›å€¼å¯ä»¥æ˜¯ä¸€ä¸ªpromiseå¯¹è±¡ä¹Ÿå¯ä»¥æ˜¯å…¶ä»–å€¼ã€‚

å¾ˆå¤šäººä»¥ä¸ºawaitä¼šä¸€ç›´ç­‰å¾…ä¹‹åçš„è¡¨è¾¾å¼æ‰§è¡Œå®Œä¹‹åæ‰ä¼šç»§ç»­æ‰§è¡Œåé¢çš„ä»£ç ï¼Œ**å®é™…ä¸Šawaitæ˜¯ä¸€ä¸ªè®©å‡ºçº¿ç¨‹çš„æ ‡å¿—ã€‚awaitåé¢çš„è¡¨è¾¾å¼ä¼šå…ˆæ‰§è¡Œä¸€éï¼Œå°†awaitåé¢çš„ä»£ç åŠ å…¥åˆ°microtaskä¸­ï¼Œç„¶åå°±ä¼šè·³å‡ºæ•´ä¸ªasyncå‡½æ•°æ¥æ‰§è¡Œåé¢çš„ä»£ç ã€‚**

è¿™é‡Œæ„Ÿè°¢[@chenjigeng](https://github.com/chenjigeng)çš„çº æ­£ï¼š

ç”±äºå› ä¸ºasync await æœ¬èº«å°±æ˜¯promise+generatorçš„è¯­æ³•ç³–ã€‚æ‰€ä»¥awaitåé¢çš„ä»£ç æ˜¯microtaskã€‚æ‰€ä»¥å¯¹äºæœ¬é¢˜ä¸­çš„

```
async function async1() {
	console.log('async1 start');
	await async2();
	console.log('async1 end');
}
```

ç­‰ä»·äº

```
async function async1() {
	console.log('async1 start');
	Promise.resolve(async2()).then(() => {
                console.log('async1 end');
        })
}
```

å›åˆ°æœ¬é¢˜

ä»¥ä¸Šå°±æœ¬é“é¢˜æ¶‰åŠåˆ°çš„æ‰€æœ‰ç›¸å…³çŸ¥è¯†ç‚¹äº†ï¼Œä¸‹é¢æˆ‘ä»¬å†å›åˆ°è¿™é“é¢˜æ¥ä¸€æ­¥ä¸€æ­¥çœ‹çœ‹æ€ä¹ˆå›äº‹å„¿ã€‚

1. é¦–å…ˆï¼Œäº‹ä»¶å¾ªç¯ä»å®ä»»åŠ¡(macrotask)é˜Ÿåˆ—å¼€å§‹ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå®ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œåªæœ‰ä¸€ä¸ªscript(æ•´ä½“ä»£ç )ä»»åŠ¡ï¼›å½“é‡åˆ°ä»»åŠ¡æº(task source)æ—¶ï¼Œåˆ™ä¼šå…ˆåˆ†å‘ä»»åŠ¡åˆ°å¯¹åº”çš„ä»»åŠ¡é˜Ÿåˆ—ä¸­å»ã€‚æ‰€ä»¥ï¼Œä¸Šé¢ä¾‹å­çš„ç¬¬ä¸€æ­¥æ‰§è¡Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

   [![img](https://camo.githubusercontent.com/5f236daf1f85b04ffae36a526b7a50aaa4331d58b43b99cdf7c8703c94ead6e4/68747470733a2f2f692e6c6f6c692e6e65742f323031392f30322f30382f356335643639623432316166332e706e67)](https://camo.githubusercontent.com/5f236daf1f85b04ffae36a526b7a50aaa4331d58b43b99cdf7c8703c94ead6e4/68747470733a2f2f692e6c6f6c692e6e65742f323031392f30322f30382f356335643639623432316166332e706e67)

2. ç„¶åæˆ‘ä»¬çœ‹åˆ°é¦–å…ˆå®šä¹‰äº†ä¸¤ä¸ªasyncå‡½æ•°ï¼Œæ¥ç€å¾€ä¸‹çœ‹ï¼Œç„¶åé‡åˆ°äº† `console` è¯­å¥ï¼Œç›´æ¥è¾“å‡º `script start`ã€‚è¾“å‡ºä¹‹åï¼Œscript ä»»åŠ¡ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œé‡åˆ° `setTimeout`ï¼Œå…¶ä½œä¸ºä¸€ä¸ªå®ä»»åŠ¡æºï¼Œåˆ™ä¼šå…ˆå°†å…¶ä»»åŠ¡åˆ†å‘åˆ°å¯¹åº”çš„é˜Ÿåˆ—ä¸­ï¼š

   [![img](https://camo.githubusercontent.com/2022ffd886068fcd25518f4c7528c2baec00afd0d895f985a5f599d9d03821dd/68747470733a2f2f692e6c6f6c692e6e65742f323031392f30322f30382f356335643639623432353530612e706e67)](https://camo.githubusercontent.com/2022ffd886068fcd25518f4c7528c2baec00afd0d895f985a5f599d9d03821dd/68747470733a2f2f692e6c6f6c692e6e65742f323031392f30322f30382f356335643639623432353530612e706e67)

3. script ä»»åŠ¡ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œæ‰§è¡Œäº†async1()å‡½æ•°ï¼Œå‰é¢è®²è¿‡asyncå‡½æ•°ä¸­åœ¨awaitä¹‹å‰çš„ä»£ç æ˜¯ç«‹å³æ‰§è¡Œçš„ï¼Œæ‰€ä»¥ä¼šç«‹å³è¾“å‡º`async1 start`ã€‚

   é‡åˆ°äº†awaitæ—¶ï¼Œä¼šå°†awaitåé¢çš„è¡¨è¾¾å¼æ‰§è¡Œä¸€éï¼Œæ‰€ä»¥å°±ç´§æ¥ç€è¾“å‡º`async2`ï¼Œç„¶åå°†awaitåé¢çš„ä»£ç ä¹Ÿå°±æ˜¯`console.log('async1 end')`åŠ å…¥åˆ°microtaskä¸­çš„Promiseé˜Ÿåˆ—ä¸­ï¼Œæ¥ç€è·³å‡ºasync1å‡½æ•°æ¥æ‰§è¡Œåé¢çš„ä»£ç ã€‚

   [![img](https://camo.githubusercontent.com/88b70d88483e46afee14e2b69072fb1759cddef336ea79a7329e895512283657/68747470733a2f2f692e6c6f6c692e6e65742f323031392f30322f31382f356336616435383333376165642e706e67)](https://camo.githubusercontent.com/88b70d88483e46afee14e2b69072fb1759cddef336ea79a7329e895512283657/68747470733a2f2f692e6c6f6c692e6e65742f323031392f30322f31382f356336616435383333376165642e706e67)

4. scriptä»»åŠ¡ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œé‡åˆ°Promiseå®ä¾‹ã€‚ç”±äºPromiseä¸­çš„å‡½æ•°æ˜¯ç«‹å³æ‰§è¡Œçš„ï¼Œè€Œåç»­çš„ `.then` åˆ™ä¼šè¢«åˆ†å‘åˆ° microtask çš„ `Promise` é˜Ÿåˆ—ä¸­å»ã€‚æ‰€ä»¥ä¼šå…ˆè¾“å‡º `promise1`ï¼Œç„¶åæ‰§è¡Œ `resolve`ï¼Œå°† `promise2` åˆ†é…åˆ°å¯¹åº”é˜Ÿåˆ—ã€‚

   [![img](https://camo.githubusercontent.com/0916cb5a9c1704fe199de69944ae7929ebe59b9ef3b3cd49961de26accd98fa9/68747470733a2f2f692e6c6f6c692e6e65742f323031392f30322f31382f356336616435383334376135652e706e67)](https://camo.githubusercontent.com/0916cb5a9c1704fe199de69944ae7929ebe59b9ef3b3cd49961de26accd98fa9/68747470733a2f2f692e6c6f6c692e6e65742f323031392f30322f31382f356336616435383334376135652e706e67)

5. scriptä»»åŠ¡ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œæœ€ååªæœ‰ä¸€å¥è¾“å‡ºäº† `script end`ï¼Œè‡³æ­¤ï¼Œå…¨å±€ä»»åŠ¡å°±æ‰§è¡Œå®Œæ¯•äº†ã€‚

   æ ¹æ®ä¸Šè¿°ï¼Œæ¯æ¬¡æ‰§è¡Œå®Œä¸€ä¸ªå®ä»»åŠ¡ä¹‹åï¼Œä¼šå»æ£€æŸ¥æ˜¯å¦å­˜åœ¨ Microtasksï¼›å¦‚æœæœ‰ï¼Œåˆ™æ‰§è¡Œ Microtasks ç›´è‡³æ¸…ç©º Microtask Queueã€‚

   å› è€Œåœ¨scriptä»»åŠ¡æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œå¼€å§‹æŸ¥æ‰¾æ¸…ç©ºå¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚æ­¤æ—¶ï¼Œå¾®ä»»åŠ¡ä¸­ï¼Œ `Promise` é˜Ÿåˆ—æœ‰çš„ä¸¤ä¸ªä»»åŠ¡`async1 end`å’Œ`promise2`ï¼Œå› æ­¤æŒ‰å…ˆåé¡ºåºè¾“å‡º `async1 endï¼Œpromise2`ã€‚å½“æ‰€æœ‰çš„ Microtasks æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œè¡¨ç¤ºç¬¬ä¸€è½®çš„å¾ªç¯å°±ç»“æŸäº†ã€‚

6. ~~ç¬¬äºŒè½®å¾ªç¯å¼€å§‹ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šè·³å›async1å‡½æ•°ä¸­æ‰§è¡Œåé¢çš„ä»£ç ï¼Œç„¶åé‡åˆ°äº†åŒæ­¥ä»»åŠ¡ `console` è¯­å¥ï¼Œç›´æ¥è¾“å‡º `async1 end`ã€‚è¿™æ ·ç¬¬äºŒè½®çš„å¾ªç¯å°±ç»“æŸäº†ã€‚ï¼ˆä¹Ÿå¯ä»¥ç†è§£ä¸ºè¢«åŠ å…¥åˆ°scriptä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œæ‰€ä»¥ä¼šå…ˆä¸setTimeouté˜Ÿåˆ—æ‰§è¡Œï¼‰~~

7. ç¬¬äºŒè½®å¾ªç¯ä¾æ—§ä»å®ä»»åŠ¡é˜Ÿåˆ—å¼€å§‹ã€‚æ­¤æ—¶å®ä»»åŠ¡ä¸­åªæœ‰ä¸€ä¸ª `setTimeout`ï¼Œå–å‡ºç›´æ¥è¾“å‡ºå³å¯ï¼Œè‡³æ­¤æ•´ä¸ªæµç¨‹ç»“æŸã€‚

ä¸‹é¢æˆ‘ä¼šæ”¹å˜ä¸€ä¸‹ä»£ç æ¥åŠ æ·±å°è±¡ã€‚

å˜å¼ä¸€

åœ¨ç¬¬ä¸€ä¸ªå˜å¼ä¸­æˆ‘å°†async2ä¸­çš„å‡½æ•°ä¹Ÿå˜æˆäº†Promiseå‡½æ•°ï¼Œä»£ç å¦‚ä¸‹ï¼š

```
async function async1() {
    console.log('async1 start');
    await async2();
    console.log('async1 end');
}
async function async2() {
    //async2åšå‡ºå¦‚ä¸‹æ›´æ”¹ï¼š
    new Promise(function(resolve) {
    console.log('promise1');
    resolve();
}).then(function() {
    console.log('promise2');
    });
}
console.log('script start');

setTimeout(function() {
    console.log('setTimeout');
}, 0)
async1();

new Promise(function(resolve) {
    console.log('promise3');
    resolve();
}).then(function() {
    console.log('promise4');
});

console.log('script end');
```

å¯ä»¥å…ˆè‡ªå·±çœ‹çœ‹è¾“å‡ºé¡ºåºä¼šæ˜¯ä»€ä¹ˆï¼Œä¸‹é¢æ¥å…¬å¸ƒç»“æœï¼š

```
script start
async1 start
promise1
promise3
script end
promise2
async1 end
promise4
setTimeout
```

åœ¨ç¬¬ä¸€æ¬¡macrotaskæ‰§è¡Œå®Œä¹‹åï¼Œä¹Ÿå°±æ˜¯è¾“å‡º`script end`ä¹‹åï¼Œä¼šå»æ¸…ç†æ‰€æœ‰microtaskã€‚æ‰€ä»¥ä¼šç›¸ç»§è¾“å‡º`promise2`ï¼Œ` async1 end` ï¼Œ`promise4`ï¼Œå…¶ä½™ä¸å†å¤šè¯´ã€‚

å˜å¼äºŒ

åœ¨ç¬¬äºŒä¸ªå˜å¼ä¸­ï¼Œæˆ‘å°†async1ä¸­awaitåé¢çš„ä»£ç å’Œasync2çš„ä»£ç éƒ½æ”¹ä¸ºå¼‚æ­¥çš„ï¼Œä»£ç å¦‚ä¸‹ï¼š

```
async function async1() {
    console.log('async1 start');
    await async2();
    //æ›´æ”¹å¦‚ä¸‹ï¼š
    setTimeout(function() {
        console.log('setTimeout1')
    },0)
}
async function async2() {
    //æ›´æ”¹å¦‚ä¸‹ï¼š
	setTimeout(function() {
		console.log('setTimeout2')
	},0)
}
console.log('script start');

setTimeout(function() {
    console.log('setTimeout3');
}, 0)
async1();

new Promise(function(resolve) {
    console.log('promise1');
    resolve();
}).then(function() {
    console.log('promise2');
});
console.log('script end');
```

å¯ä»¥å…ˆè‡ªå·±çœ‹çœ‹è¾“å‡ºé¡ºåºä¼šæ˜¯ä»€ä¹ˆï¼Œä¸‹é¢æ¥å…¬å¸ƒç»“æœï¼š

```
script start
async1 start
promise1
script end
promise2
setTimeout3
setTimeout2
setTimeout1
```

åœ¨è¾“å‡ºä¸º`promise2`ä¹‹åï¼Œæ¥ä¸‹æ¥ä¼šæŒ‰ç…§åŠ å…¥setTimeouté˜Ÿåˆ—çš„é¡ºåºæ¥ä¾æ¬¡è¾“å‡ºï¼Œé€šè¿‡ä»£ç æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åŠ å…¥é¡ºåºä¸º`3 2 1`ï¼Œæ‰€ä»¥ä¼šæŒ‰3ï¼Œ2ï¼Œ1çš„é¡ºåºæ¥è¾“å‡ºã€‚

å˜å¼ä¸‰

å˜å¼ä¸‰æ˜¯æˆ‘åœ¨ä¸€ç¯‡é¢ç»ä¸­çœ‹åˆ°çš„åŸé¢˜ï¼Œæ•´ä½“æ¥è¯´å¤§åŒå°å¼‚ï¼Œä»£ç å¦‚ä¸‹ï¼š

```
async function a1 () {
    console.log('a1 start')
    await a2()
    console.log('a1 end')
}
async function a2 () {
    console.log('a2')
}

console.log('script start')

setTimeout(() => {
    console.log('setTimeout')
}, 0)

Promise.resolve().then(() => {
    console.log('promise1')
})

a1()

let promise2 = new Promise((resolve) => {
    resolve('promise2.then')
    console.log('promise2')
})

promise2.then((res) => {
    console.log(res)
    Promise.resolve().then(() => {
        console.log('promise3')
    })
})
console.log('script end')
```

æ— éæ˜¯åœ¨å¾®ä»»åŠ¡é‚£å—å„¿åšç‚¹æ–‡ç« ï¼Œå‰é¢çš„å†…å®¹å¦‚æœä½ éƒ½çœ‹æ‡‚äº†çš„è¯è¿™é“é¢˜ä¸€å®šæ²¡é—®é¢˜çš„ï¼Œç»“æœå¦‚ä¸‹ï¼š

```
script start
a1 start
a2
promise2
script end
promise1
a1 end
promise2.then
promise3
setTimeout
```

å‚è€ƒæ–‡ç« 

- [ä»ä¸€é“é¢˜æµ…è¯´ JavaScript çš„äº‹ä»¶å¾ªç¯](https://github.com/dwqs/blog/issues/61)
- [async/await æ‰§è¡Œé¡ºåºè¯¦è§£](https://segmentfault.com/a/1190000011296839)



## ç¬¬ 11 é¢˜ï¼šï¼ˆæºç¨‹ï¼‰ç®—æ³•æ‰‹å†™é¢˜

å·²çŸ¥å¦‚ä¸‹æ•°ç»„ï¼š

~~~js
var arr = [[1, 2, 2], [3, 4, 5, 5], [6, 7, 8, 9, [11, 12, [12, 13, [14] ] ] ], 10];
~~~

ç¼–å†™ä¸€ä¸ªç¨‹åºå°†æ•°ç»„æ‰å¹³åŒ–å»å¹¶é™¤å…¶ä¸­é‡å¤éƒ¨åˆ†æ•°æ®ï¼Œæœ€ç»ˆå¾—åˆ°ä¸€ä¸ªå‡åºä¸”ä¸é‡å¤çš„æ•°ç»„

Array.from(new Set(arr.flat(Infinity))).sort((a,b)=>{ return a-b})





## ç¬¬ 12 é¢˜ï¼šï¼ˆæ»´æ»´ã€æŒ–è´¢ã€å¾®åŒ»ã€æµ·åº·ï¼‰JS å¼‚æ­¥è§£å†³æ–¹æ¡ˆçš„å‘å±•å†ç¨‹ä»¥åŠä¼˜ç¼ºç‚¹ã€‚

è§£æï¼šç¬¬ 12 é¢˜JS å¼‚æ­¥å·²ç»å‘Šä¸€æ®µè½äº†ï¼Œè¿™é‡Œæ¥ä¸€æ³¢å°æ€»ç»“

#### 1. å›è°ƒå‡½æ•°ï¼ˆcallbackï¼‰

```
setTimeout(() => {
    // callback å‡½æ•°ä½“
}, 1000)
```

**ç¼ºç‚¹ï¼šå›è°ƒåœ°ç‹±ï¼Œä¸èƒ½ç”¨ try catch æ•è·é”™è¯¯ï¼Œä¸èƒ½ return**

å›è°ƒåœ°ç‹±çš„æ ¹æœ¬é—®é¢˜åœ¨äºï¼š

- ç¼ºä¹é¡ºåºæ€§ï¼š å›è°ƒåœ°ç‹±å¯¼è‡´çš„è°ƒè¯•å›°éš¾ï¼Œå’Œå¤§è„‘çš„æ€ç»´æ–¹å¼ä¸ç¬¦
- åµŒå¥—å‡½æ•°å­˜åœ¨è€¦åˆæ€§ï¼Œä¸€æ—¦æœ‰æ‰€æ”¹åŠ¨ï¼Œå°±ä¼šç‰µä¸€å‘è€ŒåŠ¨å…¨èº«ï¼Œå³ï¼ˆ**æ§åˆ¶åè½¬**ï¼‰
- åµŒå¥—å‡½æ•°è¿‡å¤šçš„å¤šè¯ï¼Œå¾ˆéš¾å¤„ç†é”™è¯¯

```
ajax('XXX1', () => {
    // callback å‡½æ•°ä½“
    ajax('XXX2', () => {
        // callback å‡½æ•°ä½“
        ajax('XXX3', () => {
            // callback å‡½æ•°ä½“
        })
    })
})
```

**ä¼˜ç‚¹ï¼šè§£å†³äº†åŒæ­¥çš„é—®é¢˜**ï¼ˆåªè¦æœ‰ä¸€ä¸ªä»»åŠ¡è€—æ—¶å¾ˆé•¿ï¼Œåé¢çš„ä»»åŠ¡éƒ½å¿…é¡»æ’é˜Ÿç­‰ç€ï¼Œä¼šæ‹–å»¶æ•´ä¸ªç¨‹åºçš„æ‰§è¡Œã€‚ï¼‰

#### 2. Promise

Promiseå°±æ˜¯ä¸ºäº†è§£å†³callbackçš„é—®é¢˜è€Œäº§ç”Ÿçš„ã€‚

Promise å®ç°äº†é“¾å¼è°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯æ¬¡ then åè¿”å›çš„éƒ½æ˜¯ä¸€ä¸ªå…¨æ–° Promiseï¼Œå¦‚æœæˆ‘ä»¬åœ¨ then ä¸­ return ï¼Œreturn çš„ç»“æœä¼šè¢« Promise.resolve() åŒ…è£…

**ä¼˜ç‚¹ï¼šè§£å†³äº†å›è°ƒåœ°ç‹±çš„é—®é¢˜**

```
ajax('XXX1')
  .then(res => {
      // æ“ä½œé€»è¾‘
      return ajax('XXX2')
  }).then(res => {
      // æ“ä½œé€»è¾‘
      return ajax('XXX3')
  }).then(res => {
      // æ“ä½œé€»è¾‘
  })
```

**ç¼ºç‚¹ï¼šæ— æ³•å–æ¶ˆ Promise ï¼Œé”™è¯¯éœ€è¦é€šè¿‡å›è°ƒå‡½æ•°æ¥æ•è·**

#### 3. Generator

**ç‰¹ç‚¹ï¼šå¯ä»¥æ§åˆ¶å‡½æ•°çš„æ‰§è¡Œ**ï¼Œå¯ä»¥é…åˆ co å‡½æ•°åº“ä½¿ç”¨

```
function *fetch() {
    yield ajax('XXX1', () => {})
    yield ajax('XXX2', () => {})
    yield ajax('XXX3', () => {})
}
let it = fetch()
let result1 = it.next()
let result2 = it.next()
let result3 = it.next()
```

#### 4. Async/await

asyncã€await æ˜¯å¼‚æ­¥çš„ç»ˆæè§£å†³æ–¹æ¡ˆ

**ä¼˜ç‚¹æ˜¯ï¼šä»£ç æ¸…æ™°ï¼Œä¸ç”¨åƒ Promise å†™ä¸€å¤§å † then é“¾ï¼Œå¤„ç†äº†å›è°ƒåœ°ç‹±çš„é—®é¢˜**

**ç¼ºç‚¹ï¼šawait å°†å¼‚æ­¥ä»£ç æ”¹é€ æˆåŒæ­¥ä»£ç ï¼Œå¦‚æœå¤šä¸ªå¼‚æ­¥æ“ä½œæ²¡æœ‰ä¾èµ–æ€§è€Œä½¿ç”¨ await ä¼šå¯¼è‡´æ€§èƒ½ä¸Šçš„é™ä½ã€‚**

```
async function test() {
  // ä»¥ä¸‹ä»£ç æ²¡æœ‰ä¾èµ–æ€§çš„è¯ï¼Œå®Œå…¨å¯ä»¥ä½¿ç”¨ Promise.all çš„æ–¹å¼
  // å¦‚æœæœ‰ä¾èµ–æ€§çš„è¯ï¼Œå…¶å®å°±æ˜¯è§£å†³å›è°ƒåœ°ç‹±çš„ä¾‹å­äº†
  await fetch('XXX1')
  await fetch('XXX2')
  await fetch('XXX3')
}
```

ä¸‹é¢æ¥çœ‹ä¸€ä¸ªä½¿ç”¨ `await` çš„ä¾‹å­ï¼š

```
let a = 0
let b = async () => {
  a = a + await 10
  console.log('2', a) // -> '2' 10
}
b()
a++
console.log('1', a) // -> '1' 1
```

å¯¹äºä»¥ä¸Šä»£ç ä½ å¯èƒ½ä¼šæœ‰ç–‘æƒ‘ï¼Œè®©æˆ‘æ¥è§£é‡Šä¸‹åŸå› 

- é¦–å…ˆå‡½æ•° `b` å…ˆæ‰§è¡Œï¼Œåœ¨æ‰§è¡Œåˆ° `await 10` ä¹‹å‰å˜é‡ `a` è¿˜æ˜¯ 0ï¼Œå› ä¸º `await` å†…éƒ¨å®ç°äº† `generator` ï¼Œ**`generator` ä¼šä¿ç•™å †æ ˆä¸­ä¸œè¥¿ï¼Œæ‰€ä»¥è¿™æ—¶å€™ `a = 0` è¢«ä¿å­˜äº†ä¸‹æ¥**
- å› ä¸º `await` æ˜¯å¼‚æ­¥æ“ä½œï¼Œåæ¥çš„è¡¨è¾¾å¼ä¸è¿”å› `Promise` çš„è¯ï¼Œå°±ä¼šåŒ…è£…æˆ `Promise.reslove(è¿”å›å€¼)`ï¼Œç„¶åä¼šå»æ‰§è¡Œå‡½æ•°å¤–çš„åŒæ­¥ä»£ç 
- åŒæ­¥ä»£ç æ‰§è¡Œå®Œæ¯•åå¼€å§‹æ‰§è¡Œå¼‚æ­¥ä»£ç ï¼Œå°†ä¿å­˜ä¸‹æ¥çš„å€¼æ‹¿å‡ºæ¥ä½¿ç”¨ï¼Œè¿™æ—¶å€™ `a = 0 + 10`

ä¸Šè¿°è§£é‡Šä¸­æåˆ°äº† `await` å†…éƒ¨å®ç°äº† `generator`ï¼Œå…¶å® `await` å°±æ˜¯ `generator` åŠ ä¸Š `Promise`çš„è¯­æ³•ç³–ï¼Œä¸”å†…éƒ¨å®ç°äº†è‡ªåŠ¨æ‰§è¡Œ `generator`ã€‚å¦‚æœä½ ç†Ÿæ‚‰ co çš„è¯ï¼Œå…¶å®è‡ªå·±å°±å¯ä»¥å®ç°è¿™æ ·çš„è¯­æ³•ç³–ã€‚

æœ¬æ–‡é¦–å‘äºæˆ‘çš„åšå®¢ï¼š[JSå¼‚æ­¥è§£å†³æ–¹æ¡ˆçš„å‘å±•å†ç¨‹ä»¥åŠä¼˜ç¼ºç‚¹](https://github.com/LuNaHaiJiao/blog/issues/29)

http://www.ruanyifeng.com/blog/2012/12/asynchronous%EF%BC%BFjavascript.html



## ç¬¬ 13 é¢˜ï¼šï¼ˆå¾®åŒ»ï¼‰Promise æ„é€ å‡½æ•°æ˜¯åŒæ­¥æ‰§è¡Œè¿˜æ˜¯å¼‚æ­¥æ‰§è¡Œï¼Œé‚£ä¹ˆ then æ–¹æ³•å‘¢ï¼Ÿ

è§£æï¼šç¬¬ 13 é¢˜

```
const promise = new Promise((resolve, reject) => {
  console.log(1)
  resolve()
  console.log(2)
})

promise.then(() => {
  console.log(3)
})

console.log(4)
```

æ‰§è¡Œç»“æœæ˜¯ï¼š1243
promiseæ„é€ å‡½æ•°æ˜¯åŒæ­¥æ‰§è¡Œçš„ï¼Œthenæ–¹æ³•æ˜¯å¼‚æ­¥æ‰§è¡Œçš„







## ç¬¬ 14 é¢˜ï¼šï¼ˆå…‘å§ï¼‰æƒ…äººèŠ‚ç¦åˆ©é¢˜ï¼Œå¦‚ä½•å®ç°ä¸€ä¸ª new

è§£æï¼šç¬¬ 14 é¢˜

è¿™æ ·å†™æ˜¯ä¸æ˜¯ç®€å•ç‚¹å•Š

```
function _new(fn, ...arg) {
    const obj = Object.create(fn.prototype);
    const ret = fn.apply(obj, arg);
    return ret instanceof Object ? ret : obj;
}
```





## ç¬¬ 15 é¢˜ï¼šï¼ˆç½‘æ˜“ï¼‰ç®€å•è®²è§£ä¸€ä¸‹http2çš„å¤šè·¯å¤ç”¨

è§£æï¼šç¬¬ 15 é¢˜

HTTP2é‡‡ç”¨äºŒè¿›åˆ¶æ ¼å¼ä¼ è¾“ï¼Œå–ä»£äº†HTTP1.xçš„æ–‡æœ¬æ ¼å¼ï¼ŒäºŒè¿›åˆ¶æ ¼å¼è§£ææ›´é«˜æ•ˆã€‚
å¤šè·¯å¤ç”¨ä»£æ›¿äº†HTTP1.xçš„åºåˆ—å’Œé˜»å¡æœºåˆ¶ï¼Œæ‰€æœ‰çš„ç›¸åŒåŸŸåè¯·æ±‚éƒ½é€šè¿‡åŒä¸€ä¸ªTCPè¿æ¥å¹¶å‘å®Œæˆã€‚åœ¨HTTP1.xä¸­ï¼Œå¹¶å‘å¤šä¸ªè¯·æ±‚éœ€è¦å¤šä¸ªTCPè¿æ¥ï¼Œæµè§ˆå™¨ä¸ºäº†æ§åˆ¶èµ„æºä¼šæœ‰6-8ä¸ªTCPè¿æ¥éƒ½é™åˆ¶ã€‚
HTTP2ä¸­

- åŒåŸŸåä¸‹æ‰€æœ‰é€šä¿¡éƒ½åœ¨å•ä¸ªè¿æ¥ä¸Šå®Œæˆï¼Œæ¶ˆé™¤äº†å› å¤šä¸ª TCP è¿æ¥è€Œå¸¦æ¥çš„å»¶æ—¶å’Œå†…å­˜æ¶ˆè€—ã€‚
- å•ä¸ªè¿æ¥ä¸Šå¯ä»¥å¹¶è¡Œäº¤é”™çš„è¯·æ±‚å’Œå“åº”ï¼Œä¹‹é—´äº’ä¸å¹²æ‰°

åœ¨ HTTP/1 ä¸­ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½ä¼šå»ºç«‹ä¸€æ¬¡HTTPè¿æ¥ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„3æ¬¡æ¡æ‰‹4æ¬¡æŒ¥æ‰‹ï¼Œè¿™ä¸ªè¿‡ç¨‹åœ¨ä¸€æ¬¡è¯·æ±‚è¿‡ç¨‹ä¸­å ç”¨äº†ç›¸å½“é•¿çš„æ—¶é—´ï¼Œå³ä½¿å¼€å¯äº† Keep-Alive ï¼Œè§£å†³äº†å¤šæ¬¡è¿æ¥çš„é—®é¢˜ï¼Œä½†æ˜¯ä¾ç„¶æœ‰ä¸¤ä¸ªæ•ˆç‡ä¸Šçš„é—®é¢˜ï¼š

- ç¬¬ä¸€ä¸ªï¼šä¸²è¡Œçš„æ–‡ä»¶ä¼ è¾“ã€‚å½“è¯·æ±‚aæ–‡ä»¶æ—¶ï¼Œbæ–‡ä»¶åªèƒ½ç­‰å¾…ï¼Œç­‰å¾…aè¿æ¥åˆ°æœåŠ¡å™¨ã€æœåŠ¡å™¨å¤„ç†æ–‡ä»¶ã€æœåŠ¡å™¨è¿”å›æ–‡ä»¶ï¼Œè¿™ä¸‰ä¸ªæ­¥éª¤ã€‚æˆ‘ä»¬å‡è®¾è¿™ä¸‰æ­¥ç”¨æ—¶éƒ½æ˜¯1ç§’ï¼Œé‚£ä¹ˆaæ–‡ä»¶ç”¨æ—¶ä¸º3ç§’ï¼Œbæ–‡ä»¶ä¼ è¾“å®Œæˆç”¨æ—¶ä¸º6ç§’ï¼Œä¾æ­¤ç±»æ¨ã€‚ï¼ˆæ³¨ï¼šæ­¤é¡¹è®¡ç®—æœ‰ä¸€ä¸ªå‰ææ¡ä»¶ï¼Œå°±æ˜¯æµè§ˆå™¨å’ŒæœåŠ¡å™¨æ˜¯å•é€šé“ä¼ è¾“ï¼‰
- ç¬¬äºŒä¸ªï¼šè¿æ¥æ•°è¿‡å¤šã€‚æˆ‘ä»¬å‡è®¾Apacheè®¾ç½®äº†æœ€å¤§å¹¶å‘æ•°ä¸º300ï¼Œå› ä¸ºæµè§ˆå™¨é™åˆ¶ï¼Œæµè§ˆå™¨å‘èµ·çš„æœ€å¤§è¯·æ±‚æ•°ä¸º6ï¼Œä¹Ÿå°±æ˜¯æœåŠ¡å™¨èƒ½æ‰¿è½½çš„æœ€é«˜å¹¶å‘ä¸º50ï¼Œå½“ç¬¬51ä¸ªäººè®¿é—®æ—¶ï¼Œå°±éœ€è¦ç­‰å¾…å‰é¢æŸä¸ªè¯·æ±‚å¤„ç†å®Œæˆã€‚

HTTP/2çš„å¤šè·¯å¤ç”¨å°±æ˜¯ä¸ºäº†è§£å†³ä¸Šè¿°çš„ä¸¤ä¸ªæ€§èƒ½é—®é¢˜ã€‚
åœ¨ HTTP/2 ä¸­ï¼Œæœ‰ä¸¤ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µï¼Œåˆ†åˆ«æ˜¯å¸§ï¼ˆframeï¼‰å’Œæµï¼ˆstreamï¼‰ã€‚
å¸§ä»£è¡¨ç€æœ€å°çš„æ•°æ®å•ä½ï¼Œæ¯ä¸ªå¸§ä¼šæ ‡è¯†å‡ºè¯¥å¸§å±äºå“ªä¸ªæµï¼Œæµä¹Ÿå°±æ˜¯å¤šä¸ªå¸§ç»„æˆçš„æ•°æ®æµã€‚
å¤šè·¯å¤ç”¨ï¼Œå°±æ˜¯åœ¨ä¸€ä¸ª TCP è¿æ¥ä¸­å¯ä»¥å­˜åœ¨å¤šæ¡æµã€‚æ¢å¥è¯è¯´ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥å‘é€å¤šä¸ªè¯·æ±‚ï¼Œå¯¹ç«¯å¯ä»¥é€šè¿‡å¸§ä¸­çš„æ ‡è¯†çŸ¥é“å±äºå“ªä¸ªè¯·æ±‚ã€‚é€šè¿‡è¿™ä¸ªæŠ€æœ¯ï¼Œå¯ä»¥é¿å… HTTP æ—§ç‰ˆæœ¬ä¸­çš„é˜Ÿå¤´é˜»å¡é—®é¢˜ï¼Œæå¤§çš„æé«˜ä¼ è¾“æ€§èƒ½ã€‚







## ç¬¬ 16 é¢˜ï¼šè°ˆè°ˆä½ å¯¹TCPä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹çš„ç†è§£

è§£æï¼šç¬¬ 16 é¢˜

TCPçš„å†…å®¹

https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/15





ç¬¬ 17 é¢˜ï¼šAã€B æœºå™¨æ­£å¸¸è¿æ¥åï¼ŒB æœºå™¨çªç„¶é‡å¯ï¼Œé—® A æ­¤æ—¶å¤„äº TCP ä»€ä¹ˆçŠ¶æ€

å¦‚æœA ä¸ B å»ºç«‹äº†æ­£å¸¸è¿æ¥åï¼Œä»æœªç›¸äº’å‘è¿‡æ•°æ®ï¼Œè¿™ä¸ªæ—¶å€™ B çªç„¶æœºå™¨é‡å¯ï¼Œé—® A æ­¤æ—¶å¤„äº TCP ä»€ä¹ˆçŠ¶æ€ï¼Ÿå¦‚ä½•æ¶ˆé™¤æœåŠ¡å™¨ç¨‹åºä¸­çš„è¿™ä¸ªçŠ¶æ€ï¼Ÿï¼ˆè¶…çº²é¢˜ï¼Œäº†è§£å³å¯ï¼‰

è§£æï¼šç¬¬ 17 é¢˜





## ç¬¬ 18 é¢˜ï¼šï¼ˆå¾®åŒ»ï¼‰React ä¸­ setState ä»€ä¹ˆæ—¶å€™æ˜¯åŒæ­¥çš„ï¼Œä»€ä¹ˆæ—¶å€™æ˜¯å¼‚æ­¥çš„ï¼Ÿ

è§£æï¼šç¬¬ 18 é¢˜

åœ¨Reactä¸­ï¼Œ**å¦‚æœæ˜¯ç”±Reactå¼•å‘çš„äº‹ä»¶å¤„ç†ï¼ˆæ¯”å¦‚é€šè¿‡onClickå¼•å‘çš„äº‹ä»¶å¤„ç†ï¼‰ï¼Œè°ƒç”¨setStateä¸ä¼šåŒæ­¥æ›´æ–°this.stateï¼Œé™¤æ­¤ä¹‹å¤–çš„setStateè°ƒç”¨ä¼šåŒæ­¥æ‰§è¡Œthis.state** ã€‚æ‰€è°“â€œé™¤æ­¤ä¹‹å¤–â€ï¼ŒæŒ‡çš„æ˜¯ç»•è¿‡Reacté€šè¿‡addEventListenerç›´æ¥æ·»åŠ çš„äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œè¿˜æœ‰é€šè¿‡setTimeout/setIntervaläº§ç”Ÿçš„å¼‚æ­¥è°ƒç”¨ã€‚

**åŸå› ï¼š** åœ¨Reactçš„setStateå‡½æ•°å®ç°ä¸­ï¼Œä¼šæ ¹æ®ä¸€ä¸ªå˜é‡isBatchingUpdatesåˆ¤æ–­æ˜¯ç›´æ¥æ›´æ–°this.stateè¿˜æ˜¯æ”¾åˆ°é˜Ÿåˆ—ä¸­å›å¤´å†è¯´ï¼Œè€ŒisBatchingUpdatesé»˜è®¤æ˜¯falseï¼Œä¹Ÿå°±è¡¨ç¤ºsetStateä¼šåŒæ­¥æ›´æ–°this.stateï¼Œä½†æ˜¯ï¼Œ**æœ‰ä¸€ä¸ªå‡½æ•°batchedUpdatesï¼Œè¿™ä¸ªå‡½æ•°ä¼šæŠŠisBatchingUpdatesä¿®æ”¹ä¸ºtrueï¼Œè€Œå½“Reactåœ¨è°ƒç”¨äº‹ä»¶å¤„ç†å‡½æ•°ä¹‹å‰å°±ä¼šè°ƒç”¨è¿™ä¸ªbatchedUpdatesï¼Œé€ æˆçš„åæœï¼Œå°±æ˜¯ç”±Reactæ§åˆ¶çš„äº‹ä»¶å¤„ç†è¿‡ç¨‹setStateä¸ä¼šåŒæ­¥æ›´æ–°this.state**ã€‚

**æ³¨æ„ï¼š** setStateçš„â€œå¼‚æ­¥â€å¹¶ä¸æ˜¯è¯´å†…éƒ¨ç”±å¼‚æ­¥ä»£ç å®ç°ï¼Œå…¶å®æœ¬èº«æ‰§è¡Œçš„è¿‡ç¨‹å’Œä»£ç éƒ½æ˜¯åŒæ­¥çš„ï¼Œåªæ˜¯åˆæˆäº‹ä»¶å’Œé’©å­å‡½æ•°çš„è°ƒç”¨é¡ºåºåœ¨æ›´æ–°ä¹‹å‰ï¼Œå¯¼è‡´åœ¨åˆæˆäº‹ä»¶å’Œé’©å­å‡½æ•°ä¸­æ²¡æ³•ç«‹é©¬æ‹¿åˆ°æ›´æ–°åçš„å€¼ï¼Œå½¢å¼äº†æ‰€è°“çš„â€œå¼‚æ­¥â€ï¼Œå½“ç„¶å¯ä»¥é€šè¿‡ç¬¬äºŒä¸ªå‚æ•° setState(partialState, callback) ä¸­çš„callbackæ‹¿åˆ°æ›´æ–°åçš„ç»“æœã€‚

è¯¦ç»†è¯·çœ‹ [æ·±å…¥ setState æœºåˆ¶](https://github.com/LuNaHaiJiao/blog/issues/26)

è¿™é‡Œæ‰€è¯´çš„åŒæ­¥å¼‚æ­¥ï¼Œ å¹¶ä¸æ˜¯çœŸæ­£çš„åŒæ­¥å¼‚æ­¥ï¼Œ å®ƒè¿˜æ˜¯åŒæ­¥æ‰§è¡Œçš„ã€‚

è¿™é‡Œçš„å¼‚æ­¥æŒ‡çš„æ˜¯å¤šä¸ªstateä¼šåˆæˆåˆ°ä¸€èµ·è¿›è¡Œæ‰¹é‡æ›´æ–°ã€‚

å¸Œæœ›åˆå­¦è€…ä¸è¦è¢«è¯¯å¯¼



## ç¬¬ 19 é¢˜ï¼šReact setState ç¬”è¯•é¢˜ï¼Œä¸‹é¢çš„ä»£ç è¾“å‡ºä»€ä¹ˆï¼Ÿ

~~~js
class Example extends React.Component {
  constructor() {
    super();
    this.state = {
      val: 0
    };
  }

  componentDidMount() {
    this.setState({val: this.state.val + 1});
    console.log(this.state.val);    // ç¬¬ 1 æ¬¡ log

    this.setState({val: this.state.val + 1});
    console.log(this.state.val);    // ç¬¬ 2 æ¬¡ log

    setTimeout(() => {
      this.setState({val: this.state.val + 1});
      console.log(this.state.val);  // ç¬¬ 3 æ¬¡ log

      this.setState({val: this.state.val + 1});
      console.log(this.state.val);  // ç¬¬ 4 æ¬¡ log
    }, 0);
  }

  render() {
    return null;
  }
};
~~~

è§£æï¼šç¬¬ 19 é¢˜

1ã€ç¬¬ä¸€æ¬¡å’Œç¬¬äºŒæ¬¡éƒ½æ˜¯åœ¨ react è‡ªèº«ç”Ÿå‘½å‘¨æœŸå†…ï¼Œè§¦å‘æ—¶ isBatchingUpdates ä¸º trueï¼Œæ‰€ä»¥å¹¶ä¸ä¼šç›´æ¥æ‰§è¡Œæ›´æ–° stateï¼Œè€Œæ˜¯åŠ å…¥äº† dirtyComponentsï¼Œæ‰€ä»¥æ‰“å°æ—¶è·å–çš„éƒ½æ˜¯æ›´æ–°å‰çš„çŠ¶æ€ 0ã€‚

2ã€ä¸¤æ¬¡ setState æ—¶ï¼Œè·å–åˆ° this.state.val éƒ½æ˜¯ 0ï¼Œæ‰€ä»¥æ‰§è¡Œæ—¶éƒ½æ˜¯å°† 0 è®¾ç½®æˆ 1ï¼Œåœ¨ react å†…éƒ¨ä¼šè¢«åˆå¹¶æ‰ï¼Œåªæ‰§è¡Œä¸€æ¬¡ã€‚è®¾ç½®å®Œæˆå state.val å€¼ä¸º 1ã€‚

3ã€setTimeout ä¸­çš„ä»£ç ï¼Œè§¦å‘æ—¶ isBatchingUpdates ä¸º falseï¼Œæ‰€ä»¥èƒ½å¤Ÿç›´æ¥è¿›è¡Œæ›´æ–°ï¼Œæ‰€ä»¥è¿ç€è¾“å‡º 2ï¼Œ3ã€‚

è¾“å‡ºï¼š 0 0 2 3



## ç¬¬ 20 é¢˜ï¼šä»‹ç»ä¸‹ npm æ¨¡å—å®‰è£…æœºåˆ¶ï¼Œä¸ºä»€ä¹ˆè¾“å…¥ npm install å°±å¯ä»¥è‡ªåŠ¨å®‰è£…å¯¹åº”çš„æ¨¡å—ï¼Ÿ

è§£æï¼šç¬¬ 20 é¢˜

#### 1. npm æ¨¡å—å®‰è£…æœºåˆ¶ï¼š

- å‘å‡º`npm install`å‘½ä»¤
- æŸ¥è¯¢node_modulesç›®å½•ä¹‹ä¸­æ˜¯å¦å·²ç»å­˜åœ¨æŒ‡å®šæ¨¡å—
  - è‹¥å­˜åœ¨ï¼Œä¸å†é‡æ–°å®‰è£…
  - è‹¥ä¸å­˜åœ¨
    - npm å‘ registry æŸ¥è¯¢æ¨¡å—å‹ç¼©åŒ…çš„ç½‘å€
    - ä¸‹è½½å‹ç¼©åŒ…ï¼Œå­˜æ”¾åœ¨æ ¹ç›®å½•ä¸‹çš„`.npm`ç›®å½•é‡Œ
    - è§£å‹å‹ç¼©åŒ…åˆ°å½“å‰é¡¹ç›®çš„`node_modules`ç›®å½•

#### 2. npm å®ç°åŸç†

è¾“å…¥ npm install å‘½ä»¤å¹¶æ•²ä¸‹å›è½¦åï¼Œä¼šç»å†å¦‚ä¸‹å‡ ä¸ªé˜¶æ®µï¼ˆä»¥ npm 5.5.1 ä¸ºä¾‹ï¼‰ï¼š

1. **æ‰§è¡Œå·¥ç¨‹è‡ªèº« preinstall**

å½“å‰ npm å·¥ç¨‹å¦‚æœå®šä¹‰äº† preinstall é’©å­æ­¤æ—¶ä¼šè¢«æ‰§è¡Œã€‚

1. **ç¡®å®šé¦–å±‚ä¾èµ–æ¨¡å—**

é¦–å…ˆéœ€è¦åšçš„æ˜¯ç¡®å®šå·¥ç¨‹ä¸­çš„é¦–å±‚ä¾èµ–ï¼Œä¹Ÿå°±æ˜¯ dependencies å’Œ devDependencies å±æ€§ä¸­ç›´æ¥æŒ‡å®šçš„æ¨¡å—ï¼ˆå‡è®¾æ­¤æ—¶æ²¡æœ‰æ·»åŠ  npm install å‚æ•°ï¼‰ã€‚

å·¥ç¨‹æœ¬èº«æ˜¯æ•´æ£µä¾èµ–æ ‘çš„æ ¹èŠ‚ç‚¹ï¼Œæ¯ä¸ªé¦–å±‚ä¾èµ–æ¨¡å—éƒ½æ˜¯æ ¹èŠ‚ç‚¹ä¸‹é¢çš„ä¸€æ£µå­æ ‘ï¼Œnpm ä¼šå¼€å¯å¤šè¿›ç¨‹ä»æ¯ä¸ªé¦–å±‚ä¾èµ–æ¨¡å—å¼€å§‹é€æ­¥å¯»æ‰¾æ›´æ·±å±‚çº§çš„èŠ‚ç‚¹ã€‚

1. **è·å–æ¨¡å—**

è·å–æ¨¡å—æ˜¯ä¸€ä¸ªé€’å½’çš„è¿‡ç¨‹ï¼Œåˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š

- è·å–æ¨¡å—ä¿¡æ¯ã€‚åœ¨ä¸‹è½½ä¸€ä¸ªæ¨¡å—ä¹‹å‰ï¼Œé¦–å…ˆè¦ç¡®å®šå…¶ç‰ˆæœ¬ï¼Œè¿™æ˜¯å› ä¸º package.json ä¸­å¾€å¾€æ˜¯ semantic versionï¼ˆsemverï¼Œè¯­ä¹‰åŒ–ç‰ˆæœ¬ï¼‰ã€‚æ­¤æ—¶å¦‚æœç‰ˆæœ¬æè¿°æ–‡ä»¶ï¼ˆnpm-shrinkwrap.json æˆ– package-lock.jsonï¼‰ä¸­æœ‰è¯¥æ¨¡å—ä¿¡æ¯ç›´æ¥æ‹¿å³å¯ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä»ä»“åº“è·å–ã€‚å¦‚ packaeg.json ä¸­æŸä¸ªåŒ…çš„ç‰ˆæœ¬æ˜¯ ^1.1.0ï¼Œnpm å°±ä¼šå»ä»“åº“ä¸­è·å–ç¬¦åˆ 1.x.x å½¢å¼çš„æœ€æ–°ç‰ˆæœ¬ã€‚
- è·å–æ¨¡å—å®ä½“ã€‚ä¸Šä¸€æ­¥ä¼šè·å–åˆ°æ¨¡å—çš„å‹ç¼©åŒ…åœ°å€ï¼ˆresolved å­—æ®µï¼‰ï¼Œnpm ä¼šç”¨æ­¤åœ°å€æ£€æŸ¥æœ¬åœ°ç¼“å­˜ï¼Œç¼“å­˜ä¸­æœ‰å°±ç›´æ¥æ‹¿ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä»ä»“åº“ä¸‹è½½ã€‚
- æŸ¥æ‰¾è¯¥æ¨¡å—ä¾èµ–ï¼Œå¦‚æœæœ‰ä¾èµ–åˆ™å›åˆ°ç¬¬1æ­¥ï¼Œå¦‚æœæ²¡æœ‰åˆ™åœæ­¢ã€‚

1. **æ¨¡å—æ‰å¹³åŒ–ï¼ˆdedupeï¼‰**

ä¸Šä¸€æ­¥è·å–åˆ°çš„æ˜¯ä¸€æ£µå®Œæ•´çš„ä¾èµ–æ ‘ï¼Œå…¶ä¸­å¯èƒ½åŒ…å«å¤§é‡é‡å¤æ¨¡å—ã€‚æ¯”å¦‚ A æ¨¡å—ä¾èµ–äº loadshï¼ŒB æ¨¡å—åŒæ ·ä¾èµ–äº lodashã€‚åœ¨ npm3 ä»¥å‰ä¼šä¸¥æ ¼æŒ‰ç…§ä¾èµ–æ ‘çš„ç»“æ„è¿›è¡Œå®‰è£…ï¼Œå› æ­¤ä¼šé€ æˆæ¨¡å—å†—ä½™ã€‚

ä» npm3 å¼€å§‹é»˜è®¤åŠ å…¥äº†ä¸€ä¸ª dedupe çš„è¿‡ç¨‹ã€‚å®ƒä¼šéå†æ‰€æœ‰èŠ‚ç‚¹ï¼Œé€ä¸ªå°†æ¨¡å—æ”¾åœ¨æ ¹èŠ‚ç‚¹ä¸‹é¢ï¼Œä¹Ÿå°±æ˜¯ node-modules çš„ç¬¬ä¸€å±‚ã€‚å½“å‘ç°æœ‰**é‡å¤æ¨¡å—**æ—¶ï¼Œåˆ™å°†å…¶ä¸¢å¼ƒã€‚

è¿™é‡Œéœ€è¦å¯¹**é‡å¤æ¨¡å—**è¿›è¡Œä¸€ä¸ªå®šä¹‰ï¼Œå®ƒæŒ‡çš„æ˜¯**æ¨¡å—åç›¸åŒ**ä¸” **semver å…¼å®¹ã€‚\**æ¯ä¸ª semver éƒ½å¯¹åº”ä¸€æ®µç‰ˆæœ¬å…è®¸èŒƒå›´ï¼Œå¦‚æœä¸¤ä¸ªæ¨¡å—çš„ç‰ˆæœ¬å…è®¸èŒƒå›´å­˜åœ¨äº¤é›†ï¼Œé‚£ä¹ˆå°±å¯ä»¥å¾—åˆ°ä¸€ä¸ª\**å…¼å®¹**ç‰ˆæœ¬ï¼Œè€Œä¸å¿…ç‰ˆæœ¬å·å®Œå…¨ä¸€è‡´ï¼Œè¿™å¯ä»¥ä½¿æ›´å¤šå†—ä½™æ¨¡å—åœ¨ dedupe è¿‡ç¨‹ä¸­è¢«å»æ‰ã€‚

æ¯”å¦‚ node-modules ä¸‹ foo æ¨¡å—ä¾èµ– lodash@^1.0.0ï¼Œbar æ¨¡å—ä¾èµ– lodash@^1.1.0ï¼Œåˆ™ **^1.1.0** ä¸ºå…¼å®¹ç‰ˆæœ¬ã€‚

è€Œå½“ foo ä¾èµ– lodash@^2.0.0ï¼Œbar ä¾èµ– lodash@^1.1.0ï¼Œåˆ™ä¾æ® semver çš„è§„åˆ™ï¼ŒäºŒè€…ä¸å­˜åœ¨å…¼å®¹ç‰ˆæœ¬ã€‚ä¼šå°†ä¸€ä¸ªç‰ˆæœ¬æ”¾åœ¨ node_modules ä¸­ï¼Œå¦ä¸€ä¸ªä»ä¿ç•™åœ¨ä¾èµ–æ ‘é‡Œã€‚

ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ä¸€ä¸ªä¾èµ–æ ‘åŸæœ¬æ˜¯è¿™æ ·ï¼š

node_modules
-- foo
---- lodash@version1

-- bar
---- lodash@version2

å‡è®¾ version1 å’Œ version2 æ˜¯å…¼å®¹ç‰ˆæœ¬ï¼Œåˆ™ç»è¿‡ dedupe ä¼šæˆä¸ºä¸‹é¢çš„å½¢å¼ï¼š

node_modules
-- foo

-- bar

-- lodashï¼ˆä¿ç•™çš„ç‰ˆæœ¬ä¸ºå…¼å®¹ç‰ˆæœ¬ï¼‰

å‡è®¾ version1 å’Œ version2 ä¸ºéå…¼å®¹ç‰ˆæœ¬ï¼Œåˆ™åé¢çš„ç‰ˆæœ¬ä¿ç•™åœ¨ä¾èµ–æ ‘ä¸­ï¼š

node_modules
-- foo
-- lodash@version1

-- bar
---- lodash@version2

1. **å®‰è£…æ¨¡å—**

è¿™ä¸€æ­¥å°†ä¼šæ›´æ–°å·¥ç¨‹ä¸­çš„ node_modulesï¼Œå¹¶æ‰§è¡Œæ¨¡å—ä¸­çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼ˆæŒ‰ç…§ preinstallã€installã€postinstall çš„é¡ºåºï¼‰ã€‚

1. **æ‰§è¡Œå·¥ç¨‹è‡ªèº«ç”Ÿå‘½å‘¨æœŸ**

å½“å‰ npm å·¥ç¨‹å¦‚æœå®šä¹‰äº†é’©å­æ­¤æ—¶ä¼šè¢«æ‰§è¡Œï¼ˆæŒ‰ç…§ installã€postinstallã€prepublishã€prepare çš„é¡ºåºï¼‰ã€‚

æœ€åä¸€æ­¥æ˜¯ç”Ÿæˆæˆ–æ›´æ–°ç‰ˆæœ¬æè¿°æ–‡ä»¶ï¼Œnpm install è¿‡ç¨‹å®Œæˆã€‚











### ç¬¬ 21 - 30 é¢˜

## ç¬¬ 21 é¢˜ï¼šæœ‰ä»¥ä¸‹ 3 ä¸ªåˆ¤æ–­æ•°ç»„çš„æ–¹æ³•ï¼Œè¯·åˆ†åˆ«ä»‹ç»å®ƒä»¬ä¹‹é—´çš„åŒºåˆ«å’Œä¼˜åŠ£

Object.prototype.toString.call() ã€ instanceof ä»¥åŠ Array.isArray()

#### 1. Object.prototype.toString.call()

æ¯ä¸€ä¸ªç»§æ‰¿ Object çš„å¯¹è±¡éƒ½æœ‰ `toString` æ–¹æ³•ï¼Œå¦‚æœ `toString` æ–¹æ³•æ²¡æœ‰é‡å†™çš„è¯ï¼Œä¼šè¿”å› `[Object type]`ï¼Œå…¶ä¸­ type ä¸ºå¯¹è±¡çš„ç±»å‹ã€‚ä½†å½“é™¤äº† Object ç±»å‹çš„å¯¹è±¡å¤–ï¼Œå…¶ä»–ç±»å‹ç›´æ¥ä½¿ç”¨ `toString` æ–¹æ³•æ—¶ï¼Œä¼šç›´æ¥è¿”å›éƒ½æ˜¯å†…å®¹çš„å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨callæˆ–è€…applyæ–¹æ³•æ¥æ”¹å˜toStringæ–¹æ³•çš„æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚

```
const an = ['Hello','An'];
an.toString(); // "Hello,An"
Object.prototype.toString.call(an); // "[object Array]"
```

è¿™ç§æ–¹æ³•å¯¹äºæ‰€æœ‰åŸºæœ¬çš„æ•°æ®ç±»å‹éƒ½èƒ½è¿›è¡Œåˆ¤æ–­ï¼Œå³ä½¿æ˜¯ null å’Œ undefined ã€‚

```
Object.prototype.toString.call('An') // "[object String]"
Object.prototype.toString.call(1) // "[object Number]"
Object.prototype.toString.call(Symbol(1)) // "[object Symbol]"
Object.prototype.toString.call(null) // "[object Null]"
Object.prototype.toString.call(undefined) // "[object Undefined]"
Object.prototype.toString.call(function(){}) // "[object Function]"
Object.prototype.toString.call({name: 'An'}) // "[object Object]"
```

`Object.prototype.toString.call()` å¸¸ç”¨äºåˆ¤æ–­æµè§ˆå™¨å†…ç½®å¯¹è±¡æ—¶ã€‚

æ›´å¤šå®ç°å¯è§ [è°ˆè°ˆ Object.prototype.toString](https://juejin.im/post/591647550ce4630069df1c4a)

#### 2. instanceof

`instanceof` çš„å†…éƒ¨æœºåˆ¶æ˜¯é€šè¿‡åˆ¤æ–­å¯¹è±¡çš„åŸå‹é“¾ä¸­æ˜¯ä¸æ˜¯èƒ½æ‰¾åˆ°ç±»å‹çš„ `prototype`ã€‚

ä½¿ç”¨ `instanceof`åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦ä¸ºæ•°ç»„ï¼Œ`instanceof` ä¼šåˆ¤æ–­è¿™ä¸ªå¯¹è±¡çš„åŸå‹é“¾ä¸Šæ˜¯å¦ä¼šæ‰¾åˆ°å¯¹åº”çš„ `Array` çš„åŸå‹ï¼Œæ‰¾åˆ°è¿”å› `true`ï¼Œå¦åˆ™è¿”å› `false`ã€‚

```
[]  instanceof Array; // true
```

ä½† `instanceof` åªèƒ½ç”¨æ¥åˆ¤æ–­å¯¹è±¡ç±»å‹ï¼ŒåŸå§‹ç±»å‹ä¸å¯ä»¥ã€‚å¹¶ä¸”æ‰€æœ‰å¯¹è±¡ç±»å‹ instanceof Object éƒ½æ˜¯ trueã€‚

```
[]  instanceof Object; // true
```

#### 3. Array.isArray()

- åŠŸèƒ½ï¼šç”¨æ¥åˆ¤æ–­å¯¹è±¡æ˜¯å¦ä¸ºæ•°ç»„

- instanceof ä¸ isArray

  å½“æ£€æµ‹Arrayå®ä¾‹æ—¶ï¼Œ`Array.isArray` ä¼˜äº `instanceof` ï¼Œå› ä¸º `Array.isArray` å¯ä»¥æ£€æµ‹å‡º `iframes`

  ```
  var iframe = document.createElement('iframe');
  document.body.appendChild(iframe);
  xArray = window.frames[window.frames.length-1].Array;
  var arr = new xArray(1,2,3); // [1,2,3]
  
  // Correctly checking for Array
  Array.isArray(arr);  // true
  Object.prototype.toString.call(arr); // true
  // Considered harmful, because doesn't work though iframes
  arr instanceof Array; // false
  ```

- `Array.isArray()` ä¸ `Object.prototype.toString.call()`

  `Array.isArray()`æ˜¯ES5æ–°å¢çš„æ–¹æ³•ï¼Œå½“ä¸å­˜åœ¨ `Array.isArray()` ï¼Œå¯ä»¥ç”¨ `Object.prototype.toString.call()` å®ç°ã€‚

  ```
  if (!Array.isArray) {
    Array.isArray = function(arg) {
      return Object.prototype.toString.call(arg) === '[object Array]';
    };
  }
  ```







## ç¬¬ 22 é¢˜ï¼šä»‹ç»ä¸‹é‡ç»˜å’Œå›æµï¼ˆRepaint & Reflowï¼‰ï¼Œä»¥åŠå¦‚ä½•è¿›è¡Œä¼˜åŒ–

è§£æï¼šç¬¬ 22 é¢˜

#### 1. æµè§ˆå™¨æ¸²æŸ“æœºåˆ¶

- æµè§ˆå™¨é‡‡ç”¨æµå¼å¸ƒå±€æ¨¡å‹ï¼ˆ`Flow Based Layout`ï¼‰
- æµè§ˆå™¨ä¼šæŠŠ`HTML`è§£ææˆ`DOM`ï¼ŒæŠŠ`CSS`è§£ææˆ`CSSOM`ï¼Œ`DOM`å’Œ`CSSOM`åˆå¹¶å°±äº§ç”Ÿäº†æ¸²æŸ“æ ‘ï¼ˆ`Render Tree`ï¼‰ã€‚
- æœ‰äº†`RenderTree`ï¼Œæˆ‘ä»¬å°±çŸ¥é“äº†æ‰€æœ‰èŠ‚ç‚¹çš„æ ·å¼ï¼Œç„¶åè®¡ç®—ä»–ä»¬åœ¨é¡µé¢ä¸Šçš„å¤§å°å’Œä½ç½®ï¼Œæœ€åæŠŠèŠ‚ç‚¹ç»˜åˆ¶åˆ°é¡µé¢ä¸Šã€‚
- ç”±äºæµè§ˆå™¨ä½¿ç”¨æµå¼å¸ƒå±€ï¼Œå¯¹`Render Tree`çš„è®¡ç®—é€šå¸¸åªéœ€è¦éå†ä¸€æ¬¡å°±å¯ä»¥å®Œæˆï¼Œ**ä½†`table`åŠå…¶å†…éƒ¨å…ƒç´ é™¤å¤–ï¼Œä»–ä»¬å¯èƒ½éœ€è¦å¤šæ¬¡è®¡ç®—ï¼Œé€šå¸¸è¦èŠ±3å€äºåŒç­‰å…ƒç´ çš„æ—¶é—´ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè¦é¿å…ä½¿ç”¨`table`å¸ƒå±€çš„åŸå› ä¹‹ä¸€**ã€‚

#### 2. é‡ç»˜

ç”±äºèŠ‚ç‚¹çš„å‡ ä½•å±æ€§å‘ç”Ÿæ”¹å˜æˆ–è€…ç”±äºæ ·å¼å‘ç”Ÿæ”¹å˜è€Œä¸ä¼šå½±å“å¸ƒå±€çš„ï¼Œç§°ä¸ºé‡ç»˜ï¼Œä¾‹å¦‚`outline`, `visibility`, `color`ã€`background-color`ç­‰ï¼Œé‡ç»˜çš„ä»£ä»·æ˜¯é«˜æ˜‚çš„ï¼Œå› ä¸ºæµè§ˆå™¨å¿…é¡»éªŒè¯DOMæ ‘ä¸Šå…¶ä»–èŠ‚ç‚¹å…ƒç´ çš„å¯è§æ€§ã€‚

#### 3. å›æµ

å›æµæ˜¯å¸ƒå±€æˆ–è€…å‡ ä½•å±æ€§éœ€è¦æ”¹å˜å°±ç§°ä¸ºå›æµã€‚å›æµæ˜¯å½±å“æµè§ˆå™¨æ€§èƒ½çš„å…³é”®å› ç´ ï¼Œå› ä¸ºå…¶å˜åŒ–æ¶‰åŠåˆ°éƒ¨åˆ†é¡µé¢ï¼ˆæˆ–æ˜¯æ•´ä¸ªé¡µé¢ï¼‰çš„å¸ƒå±€æ›´æ–°ã€‚ä¸€ä¸ªå…ƒç´ çš„å›æµå¯èƒ½ä¼šå¯¼è‡´äº†å…¶æ‰€æœ‰å­å…ƒç´ ä»¥åŠDOMä¸­ç´§éšå…¶åçš„èŠ‚ç‚¹ã€ç¥–å…ˆèŠ‚ç‚¹å…ƒç´ çš„éšåçš„å›æµã€‚

```
<body>
<div class="error">
    <h4>æˆ‘çš„ç»„ä»¶</h4>
    <p><strong>é”™è¯¯ï¼š</strong>é”™è¯¯çš„æè¿°â€¦</p>
    <h5>é”™è¯¯çº æ­£</h5>
    <ol>
        <li>ç¬¬ä¸€æ­¥</li>
        <li>ç¬¬äºŒæ­¥</li>
    </ol>
</div>
</body>
```

åœ¨ä¸Šé¢çš„HTMLç‰‡æ®µä¸­ï¼Œå¯¹è¯¥æ®µè½(`<p>`æ ‡ç­¾)å›æµå°†ä¼šå¼•å‘å¼ºçƒˆçš„å›æµï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªå­èŠ‚ç‚¹ã€‚è¿™ä¹Ÿå¯¼è‡´äº†ç¥–å…ˆçš„å›æµï¼ˆ`div.error`å’Œ`body` â€“ è§†æµè§ˆå™¨è€Œå®šï¼‰ã€‚æ­¤å¤–ï¼Œ`<h5>`å’Œ`<ol>`ä¹Ÿä¼šæœ‰ç®€å•çš„å›æµï¼Œå› ä¸ºå…¶åœ¨DOMä¸­åœ¨å›æµå…ƒç´ ä¹‹åã€‚**å¤§éƒ¨åˆ†çš„å›æµå°†å¯¼è‡´é¡µé¢çš„é‡æ–°æ¸²æŸ“ã€‚**

**å›æµå¿…å®šä¼šå‘ç”Ÿé‡ç»˜ï¼Œé‡ç»˜ä¸ä¸€å®šä¼šå¼•å‘å›æµã€‚**

#### 4. æµè§ˆå™¨ä¼˜åŒ–

ç°ä»£æµè§ˆå™¨å¤§å¤šéƒ½æ˜¯é€šè¿‡é˜Ÿåˆ—æœºåˆ¶æ¥æ‰¹é‡æ›´æ–°å¸ƒå±€ï¼Œæµè§ˆå™¨ä¼šæŠŠä¿®æ”¹æ“ä½œæ”¾åœ¨é˜Ÿåˆ—ä¸­ï¼Œè‡³å°‘ä¸€ä¸ªæµè§ˆå™¨åˆ·æ–°ï¼ˆå³16.6msï¼‰æ‰ä¼šæ¸…ç©ºé˜Ÿåˆ—ï¼Œä½†å½“ä½ **è·å–å¸ƒå±€ä¿¡æ¯çš„æ—¶å€™ï¼Œé˜Ÿåˆ—ä¸­å¯èƒ½æœ‰ä¼šå½±å“è¿™äº›å±æ€§æˆ–æ–¹æ³•è¿”å›å€¼çš„æ“ä½œï¼Œå³ä½¿æ²¡æœ‰ï¼Œæµè§ˆå™¨ä¹Ÿä¼šå¼ºåˆ¶æ¸…ç©ºé˜Ÿåˆ—ï¼Œè§¦å‘å›æµä¸é‡ç»˜æ¥ç¡®ä¿è¿”å›æ­£ç¡®çš„å€¼**ã€‚

ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å±æ€§æˆ–æ–¹æ³•ï¼š

- `offsetTop`ã€`offsetLeft`ã€`offsetWidth`ã€`offsetHeight`
- `scrollTop`ã€`scrollLeft`ã€`scrollWidth`ã€`scrollHeight`
- `clientTop`ã€`clientLeft`ã€`clientWidth`ã€`clientHeight`
- `width`ã€`height`
- `getComputedStyle()`
- `getBoundingClientRect()`

æ‰€ä»¥ï¼Œæˆ‘ä»¬åº”è¯¥é¿å…é¢‘ç¹çš„ä½¿ç”¨ä¸Šè¿°çš„å±æ€§ï¼Œä»–ä»¬éƒ½ä¼šå¼ºåˆ¶æ¸²æŸ“åˆ·æ–°é˜Ÿåˆ—ã€‚

#### 5. å‡å°‘é‡ç»˜ä¸å›æµ

1. CSS

   - **ä½¿ç”¨ `transform` æ›¿ä»£ `top`**

   - **ä½¿ç”¨ `visibility` æ›¿æ¢ `display: none`** ï¼Œå› ä¸ºå‰è€…åªä¼šå¼•èµ·é‡ç»˜ï¼Œåè€…ä¼šå¼•å‘å›æµï¼ˆæ”¹å˜äº†å¸ƒå±€

   - **é¿å…ä½¿ç”¨`table`å¸ƒå±€**ï¼Œå¯èƒ½å¾ˆå°çš„ä¸€ä¸ªå°æ”¹åŠ¨ä¼šé€ æˆæ•´ä¸ª `table` çš„é‡æ–°å¸ƒå±€ã€‚

   - **å°½å¯èƒ½åœ¨`DOM`æ ‘çš„æœ€æœ«ç«¯æ”¹å˜`class`**ï¼Œå›æµæ˜¯ä¸å¯é¿å…çš„ï¼Œä½†å¯ä»¥å‡å°‘å…¶å½±å“ã€‚å°½å¯èƒ½åœ¨DOMæ ‘çš„æœ€æœ«ç«¯æ”¹å˜classï¼Œå¯ä»¥é™åˆ¶äº†å›æµçš„èŒƒå›´ï¼Œä½¿å…¶å½±å“å°½å¯èƒ½å°‘çš„èŠ‚ç‚¹ã€‚

   - **é¿å…è®¾ç½®å¤šå±‚å†…è”æ ·å¼**ï¼ŒCSS é€‰æ‹©ç¬¦**ä»å³å¾€å·¦**åŒ¹é…æŸ¥æ‰¾ï¼Œé¿å…èŠ‚ç‚¹å±‚çº§è¿‡å¤šã€‚

     ```
     <div>
       <a> <span></span> </a>
     </div>
     <style>
       span {
         color: red;
       }
       div > a > span {
         color: red;
       }
     </style>
     ```

     å¯¹äºç¬¬ä¸€ç§è®¾ç½®æ ·å¼çš„æ–¹å¼æ¥è¯´ï¼Œæµè§ˆå™¨åªéœ€è¦æ‰¾åˆ°é¡µé¢ä¸­æ‰€æœ‰çš„ `span` æ ‡ç­¾ç„¶åè®¾ç½®é¢œè‰²ï¼Œä½†æ˜¯å¯¹äºç¬¬äºŒç§è®¾ç½®æ ·å¼çš„æ–¹å¼æ¥è¯´ï¼Œæµè§ˆå™¨é¦–å…ˆéœ€è¦æ‰¾åˆ°æ‰€æœ‰çš„ `span` æ ‡ç­¾ï¼Œç„¶åæ‰¾åˆ° `span` æ ‡ç­¾ä¸Šçš„ `a` æ ‡ç­¾ï¼Œæœ€åå†å»æ‰¾åˆ° `div` æ ‡ç­¾ï¼Œç„¶åç»™ç¬¦åˆè¿™ç§æ¡ä»¶çš„ `span` æ ‡ç­¾è®¾ç½®é¢œè‰²ï¼Œè¿™æ ·çš„é€’å½’è¿‡ç¨‹å°±å¾ˆå¤æ‚ã€‚æ‰€ä»¥æˆ‘ä»¬åº”è¯¥å°½å¯èƒ½çš„é¿å…å†™**è¿‡äºå…·ä½“**çš„ CSS é€‰æ‹©å™¨ï¼Œç„¶åå¯¹äº HTML æ¥è¯´ä¹Ÿå°½é‡å°‘çš„æ·»åŠ æ— æ„ä¹‰æ ‡ç­¾ï¼Œä¿è¯**å±‚çº§æ‰å¹³**ã€‚

   - **å°†åŠ¨ç”»æ•ˆæœåº”ç”¨åˆ°`position`å±æ€§ä¸º`absolute`æˆ–`fixed`çš„å…ƒç´ ä¸Š**ï¼Œé¿å…å½±å“å…¶ä»–å…ƒç´ çš„å¸ƒå±€ï¼Œè¿™æ ·åªæ˜¯ä¸€ä¸ªé‡ç»˜ï¼Œè€Œä¸æ˜¯å›æµï¼ŒåŒæ—¶ï¼Œæ§åˆ¶åŠ¨ç”»é€Ÿåº¦å¯ä»¥é€‰æ‹© `requestAnimationFrame`ï¼Œè¯¦è§[æ¢è®¨ requestAnimationFrame](https://github.com/LuNaHaiJiao/blog/issues/30)ã€‚

   - **é¿å…ä½¿ç”¨`CSS`è¡¨è¾¾å¼**ï¼Œå¯èƒ½ä¼šå¼•å‘å›æµã€‚

   - **å°†é¢‘ç¹é‡ç»˜æˆ–è€…å›æµçš„èŠ‚ç‚¹è®¾ç½®ä¸ºå›¾å±‚**ï¼Œå›¾å±‚èƒ½å¤Ÿé˜»æ­¢è¯¥èŠ‚ç‚¹çš„æ¸²æŸ“è¡Œä¸ºå½±å“åˆ«çš„èŠ‚ç‚¹ï¼Œä¾‹å¦‚`will-change`ã€`video`ã€`iframe`ç­‰æ ‡ç­¾ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨å°†è¯¥èŠ‚ç‚¹å˜ä¸ºå›¾å±‚ã€‚

   - **CSS3 ç¡¬ä»¶åŠ é€Ÿï¼ˆGPUåŠ é€Ÿï¼‰**ï¼Œä½¿ç”¨css3ç¡¬ä»¶åŠ é€Ÿï¼Œå¯ä»¥è®©`transform`ã€`opacity`ã€`filters`è¿™äº›åŠ¨ç”»ä¸ä¼šå¼•èµ·å›æµé‡ç»˜ ã€‚ä½†æ˜¯å¯¹äºåŠ¨ç”»çš„å…¶å®ƒå±æ€§ï¼Œæ¯”å¦‚`background-color`è¿™äº›ï¼Œè¿˜æ˜¯ä¼šå¼•èµ·å›æµé‡ç»˜çš„ï¼Œä¸è¿‡å®ƒè¿˜æ˜¯å¯ä»¥æå‡è¿™äº›åŠ¨ç”»çš„æ€§èƒ½ã€‚

2. JavaScript

   - **é¿å…é¢‘ç¹æ“ä½œæ ·å¼**ï¼Œæœ€å¥½ä¸€æ¬¡æ€§é‡å†™`style`å±æ€§ï¼Œæˆ–è€…å°†æ ·å¼åˆ—è¡¨å®šä¹‰ä¸º`class`å¹¶ä¸€æ¬¡æ€§æ›´æ”¹`class`å±æ€§ã€‚
   - **é¿å…é¢‘ç¹æ“ä½œ`DOM`**ï¼Œåˆ›å»ºä¸€ä¸ª`documentFragment`ï¼Œåœ¨å®ƒä¸Šé¢åº”ç”¨æ‰€æœ‰`DOMæ“ä½œ`ï¼Œæœ€åå†æŠŠå®ƒæ·»åŠ åˆ°æ–‡æ¡£ä¸­ã€‚
   - **é¿å…é¢‘ç¹è¯»å–ä¼šå¼•å‘å›æµ/é‡ç»˜çš„å±æ€§**ï¼Œå¦‚æœç¡®å®éœ€è¦å¤šæ¬¡ä½¿ç”¨ï¼Œå°±ç”¨ä¸€ä¸ªå˜é‡ç¼“å­˜èµ·æ¥ã€‚
   - **å¯¹å…·æœ‰å¤æ‚åŠ¨ç”»çš„å…ƒç´ ä½¿ç”¨ç»å¯¹å®šä½**ï¼Œä½¿å®ƒè„±ç¦»æ–‡æ¡£æµï¼Œå¦åˆ™ä¼šå¼•èµ·çˆ¶å…ƒç´ åŠåç»­å…ƒç´ é¢‘ç¹å›æµã€‚

è¯¦è§[æµè§ˆå™¨çš„é‡ç»˜ä¸å›æµï¼ˆRepaintã€Reflowï¼‰](https://github.com/sisterAn/blog/issues/33)



## ç¬¬ 23 é¢˜ï¼šä»‹ç»ä¸‹è§‚å¯Ÿè€…æ¨¡å¼å’Œè®¢é˜…-å‘å¸ƒæ¨¡å¼çš„åŒºåˆ«ï¼Œå„è‡ªé€‚ç”¨äºä»€ä¹ˆåœºæ™¯

è§£æï¼šç¬¬ 23 é¢˜

å¯ä¸å¯ä»¥ç†è§£ ä¸º è§‚å¯Ÿè€…æ¨¡å¼æ²¡ä¸­é—´å•†èµšå·®ä»·
å‘å¸ƒè®¢é˜…æ¨¡å¼ æœ‰ä¸­é—´å•†èµšå·®ä»·

1. å‘å¸ƒ-è®¢é˜…æ¨¡å¼å°±å¥½åƒæŠ¥ç¤¾ï¼Œ é‚®å±€å’Œä¸ªäººçš„å…³ç³»ï¼ŒæŠ¥çº¸çš„è®¢é˜…å’Œåˆ†å‘æ˜¯ç”±é‚®å±€æ¥å®Œæˆçš„ã€‚æŠ¥ç¤¾åªè´Ÿè´£å°†æŠ¥çº¸å‘é€ç»™é‚®å±€ã€‚
2. è§‚å¯Ÿè€…æ¨¡å¼å°±å¥½åƒ ä¸ªä½“å¥¶å†œå’Œä¸ªäººçš„å…³ç³»ã€‚å¥¶å†œè´Ÿè´£ç»Ÿè®¡æœ‰å¤šå°‘äººè®¢äº†äº§å“ï¼Œæ‰€ä»¥ä¸ªäººéƒ½ä¼šæœ‰ä¸€ä¸ªç›¸åŒæ‹¿ç‰›å¥¶çš„æ–¹æ³•ã€‚å¥¶å†œæœ‰æ–°å¥¶äº†å°±è´Ÿè´£è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚

https://juejin.cn/post/6844903513009422343



## ç¬¬ 24 é¢˜ï¼šèŠèŠ Redux å’Œ Vuex çš„è®¾è®¡æ€æƒ³

è§£æï¼šç¬¬ 24 é¢˜

> çŸ¥ä¹ä¸Šçœ‹åˆ°çš„ä¸€ç¯‡æ–‡ç« ï¼šVuexã€Fluxã€Reduxã€Redux-sagaã€Dvaã€MobXï¼ˆhttps://zhuanlan.zhihu.com/p/53599723ï¼‰

æ–°çš„è¿æ¥ï¼š https://zhuanlan.zhihu.com/p/53599723



## ç¬¬ 25 é¢˜ï¼šè¯´è¯´æµè§ˆå™¨å’Œ Node äº‹ä»¶å¾ªç¯çš„åŒºåˆ«

è§£æï¼šç¬¬ 25 é¢˜

ä¸ºæ¥¼ä¸Šè¡¥å……ä¸€ä¸ªä¾‹å­

> åŸæ–‡å‡ºè‡ª[liubasaraçš„ä¸ªäººåšå®¢](https://blog.liubasara.info/#/post/åˆ†äº«nodeä¸æµè§ˆå™¨å…³äºeventLoopçš„å¼‚åŒçš„ä¸€ä¸ªå°ä¾‹å­)

```
function test () {
   console.log('start')
    setTimeout(() => {
        console.log('children2')
        Promise.resolve().then(() => {console.log('children2-1')})
    }, 0)
    setTimeout(() => {
        console.log('children3')
        Promise.resolve().then(() => {console.log('children3-1')})
    }, 0)
    Promise.resolve().then(() => {console.log('children1')})
    console.log('end') 
}

test()

// ä»¥ä¸Šä»£ç åœ¨node11ä»¥ä¸‹ç‰ˆæœ¬çš„æ‰§è¡Œç»“æœ(å…ˆæ‰§è¡Œæ‰€æœ‰çš„å®ä»»åŠ¡ï¼Œå†æ‰§è¡Œå¾®ä»»åŠ¡)
// start
// end
// children1
// children2
// children3
// children2-1
// children3-1

// ä»¥ä¸Šä»£ç åœ¨node11åŠæµè§ˆå™¨çš„æ‰§è¡Œç»“æœ(é¡ºåºæ‰§è¡Œå®ä»»åŠ¡å’Œå¾®ä»»åŠ¡)
// start
// end
// children1
// children2
// children2-1
// children3
// children3-1
```

é¢˜ç›®åº”è¯¥æ˜¯ï¼šæµè§ˆå™¨å’Œnodeçš„äº‹ä»¶å¾ªç¯çš„åŒºåˆ«å§ï¼Œ

å…ˆä¸Šé“¾æ¥ï¼š

- [æµè§ˆå™¨ä¸Nodeçš„äº‹ä»¶å¾ªç¯(Event Loop)æœ‰ä½•åŒºåˆ«?](https://juejin.im/post/5c337ae06fb9a049bc4cd218#heading-12)
- [html#event-loops](https://html.spec.whatwg.org/multipage/webappapis.html#event-loops)
- [Node.js äº‹ä»¶å¾ªç¯ï¼Œå®šæ—¶å™¨å’Œ process.nextTick()](https://nodejs.org/zh-cn/docs/guides/event-loop-timers-and-nexttick/)

ç¬¬ä¸€ä¸ªé“¾æ¥é‡Œé¢å¤§ä½¬è®²çš„å·²ç»éå¸¸é€å½»äº†æˆ‘æ¥æ€»ç»“ä¸€ä¸‹ã€‚

#### æµè§ˆå™¨

**å…³äºå¾®ä»»åŠ¡å’Œå®ä»»åŠ¡åœ¨æµè§ˆå™¨çš„æ‰§è¡Œé¡ºåºæ˜¯è¿™æ ·çš„ï¼š**

- æ‰§è¡Œä¸€åªtaskï¼ˆå®ä»»åŠ¡ï¼‰
- æ‰§è¡Œå®Œmicro-taské˜Ÿåˆ— ï¼ˆå¾®ä»»åŠ¡ï¼‰

å¦‚æ­¤å¾ªç¯å¾€å¤ä¸‹å»

> æµè§ˆå™¨çš„taskï¼ˆå®ä»»åŠ¡ï¼‰æ‰§è¡Œé¡ºåºåœ¨ [html#event-loops](https://html.spec.whatwg.org/multipage/webappapis.html#event-loops) é‡Œé¢æœ‰è®²å°±ä¸ç¿»è¯‘äº†
> å¸¸è§çš„ taskï¼ˆå®ä»»åŠ¡ï¼‰ æ¯”å¦‚ï¼šsetTimeoutã€setIntervalã€scriptï¼ˆæ•´ä½“ä»£ç ï¼‰ã€ I/O æ“ä½œã€UI æ¸²æŸ“ç­‰ã€‚
> å¸¸è§çš„ micro-task æ¯”å¦‚: new Promise().then(å›è°ƒ)ã€MutationObserver(html5æ–°ç‰¹æ€§) ç­‰ã€‚

#### Node

Nodeçš„äº‹ä»¶å¾ªç¯æ˜¯libuvå®ç°çš„ï¼Œå¼•ç”¨ä¸€å¼ å®˜ç½‘çš„å›¾ï¼š

[![default](https://user-images.githubusercontent.com/20101525/53734427-eba9e880-3ebe-11e9-8511-eb4948e336ae.png)](https://user-images.githubusercontent.com/20101525/53734427-eba9e880-3ebe-11e9-8511-eb4948e336ae.png)

å¤§ä½“çš„taskï¼ˆå®ä»»åŠ¡ï¼‰æ‰§è¡Œé¡ºåºæ˜¯è¿™æ ·çš„ï¼š

- timerså®šæ—¶å™¨ï¼šæœ¬é˜¶æ®µæ‰§è¡Œå·²ç»å®‰æ’çš„ setTimeout() å’Œ setInterval() çš„å›è°ƒå‡½æ•°ã€‚
- pending callbackså¾…å®šå›è°ƒï¼šæ‰§è¡Œå»¶è¿Ÿåˆ°ä¸‹ä¸€ä¸ªå¾ªç¯è¿­ä»£çš„ I/O å›è°ƒã€‚
- idle, prepareï¼šä»…ç³»ç»Ÿå†…éƒ¨ä½¿ç”¨ã€‚
- poll è½®è¯¢ï¼šæ£€ç´¢æ–°çš„ I/O äº‹ä»¶;æ‰§è¡Œä¸ I/O ç›¸å…³çš„å›è°ƒï¼ˆå‡ ä¹æ‰€æœ‰æƒ…å†µä¸‹ï¼Œé™¤äº†å…³é—­çš„å›è°ƒå‡½æ•°ï¼Œå®ƒä»¬ç”±è®¡æ—¶å™¨å’Œ setImmediate() æ’å®šçš„ä¹‹å¤–ï¼‰ï¼Œå…¶ä½™æƒ…å†µ node å°†åœ¨æ­¤å¤„é˜»å¡ã€‚
- check æ£€æµ‹ï¼šsetImmediate() å›è°ƒå‡½æ•°åœ¨è¿™é‡Œæ‰§è¡Œã€‚
- close callbacks å…³é—­çš„å›è°ƒå‡½æ•°ï¼šä¸€äº›å‡†å¤‡å…³é—­çš„å›è°ƒå‡½æ•°ï¼Œå¦‚ï¼šsocket.on('close', ...)ã€‚

**å¾®ä»»åŠ¡å’Œå®ä»»åŠ¡åœ¨Nodeçš„æ‰§è¡Œé¡ºåº**

Node 10ä»¥å‰ï¼š

- æ‰§è¡Œå®Œä¸€ä¸ªé˜¶æ®µçš„æ‰€æœ‰ä»»åŠ¡
- æ‰§è¡Œå®ŒnextTické˜Ÿåˆ—é‡Œé¢çš„å†…å®¹
- ç„¶åæ‰§è¡Œå®Œå¾®ä»»åŠ¡é˜Ÿåˆ—çš„å†…å®¹

Node 11ä»¥åï¼š
å’Œæµè§ˆå™¨çš„è¡Œä¸ºç»Ÿä¸€äº†ï¼Œéƒ½æ˜¯æ¯æ‰§è¡Œä¸€ä¸ªå®ä»»åŠ¡å°±æ‰§è¡Œå®Œå¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚



## ç¬¬ 26 é¢˜ï¼šä»‹ç»æ¨¡å—åŒ–å‘å±•å†ç¨‹

å¯ä»IIFEã€AMDã€CMDã€CommonJSã€UMDã€webpack(require.ensure)ã€ES Moduleã€<script type="module"> è¿™å‡ ä¸ªè§’åº¦è€ƒè™‘ã€‚

è§£æï¼šç¬¬ 26 é¢˜

æ¨¡å—åŒ–ä¸»è¦æ˜¯ç”¨æ¥æŠ½ç¦»å…¬å…±ä»£ç ï¼Œéš”ç¦»ä½œç”¨åŸŸï¼Œé¿å…å˜é‡å†²çªç­‰ã€‚

**IIFE**ï¼š ä½¿ç”¨è‡ªæ‰§è¡Œå‡½æ•°æ¥ç¼–å†™æ¨¡å—åŒ–ï¼Œç‰¹ç‚¹ï¼š**åœ¨ä¸€ä¸ªå•ç‹¬çš„å‡½æ•°ä½œç”¨åŸŸä¸­æ‰§è¡Œä»£ç ï¼Œé¿å…å˜é‡å†²çª**ã€‚

```
(function(){
  return {
	data:[]
  }
})()
```

**AMD**ï¼š ä½¿ç”¨requireJS æ¥ç¼–å†™æ¨¡å—åŒ–ï¼Œç‰¹ç‚¹ï¼š**ä¾èµ–å¿…é¡»æå‰å£°æ˜å¥½**ã€‚

```
define('./index.js',function(code){
	// code å°±æ˜¯index.js è¿”å›çš„å†…å®¹
})
```

**CMD**ï¼š ä½¿ç”¨seaJS æ¥ç¼–å†™æ¨¡å—åŒ–ï¼Œç‰¹ç‚¹ï¼š**æ”¯æŒåŠ¨æ€å¼•å…¥ä¾èµ–æ–‡ä»¶**ã€‚

```
define(function(require, exports, module) {  
  var indexCode = require('./index.js');
});
```

**CommonJS**ï¼š nodejs ä¸­è‡ªå¸¦çš„æ¨¡å—åŒ–ã€‚

```
var fs = require('fs');
```

**UMD**ï¼šå…¼å®¹AMDï¼ŒCommonJS æ¨¡å—åŒ–è¯­æ³•ã€‚

**webpack(require.ensure)**ï¼šwebpack 2.x ç‰ˆæœ¬ä¸­çš„ä»£ç åˆ†å‰²ã€‚

**ES Modules**ï¼š ES6 å¼•å…¥çš„æ¨¡å—åŒ–ï¼Œæ”¯æŒimport æ¥å¼•å…¥å¦ä¸€ä¸ª js ã€‚

```
import a from 'a';
```





## ç¬¬ 27 é¢˜ï¼šå…¨å±€ä½œç”¨åŸŸä¸­ï¼Œç”¨ const å’Œ let å£°æ˜çš„å˜é‡ä¸åœ¨ window ä¸Šï¼Œé‚£åˆ°åº•åœ¨å“ªé‡Œï¼Ÿå¦‚ä½•å»è·å–ï¼Ÿã€‚

è§£æï¼šç¬¬ 27 é¢˜

åœ¨ES5ä¸­ï¼Œé¡¶å±‚å¯¹è±¡çš„å±æ€§å’Œå…¨å±€å˜é‡æ˜¯ç­‰ä»·çš„ï¼Œvar å‘½ä»¤å’Œ function å‘½ä»¤å£°æ˜çš„å…¨å±€å˜é‡ï¼Œè‡ªç„¶ä¹Ÿæ˜¯é¡¶å±‚å¯¹è±¡ã€‚

```
var a = 12;
function f(){};

console.log(window.a); // 12
console.log(window.f); // f(){}
```

ä½†ES6è§„å®šï¼Œvar å‘½ä»¤å’Œ function å‘½ä»¤å£°æ˜çš„å…¨å±€å˜é‡ï¼Œä¾æ—§æ˜¯é¡¶å±‚å¯¹è±¡çš„å±æ€§ï¼Œä½† letå‘½ä»¤ã€constå‘½ä»¤ã€classå‘½ä»¤å£°æ˜çš„å…¨å±€å˜é‡ï¼Œä¸å±äºé¡¶å±‚å¯¹è±¡çš„å±æ€§ã€‚

```
let aa = 1;
const bb = 2;

console.log(window.aa); // undefined
console.log(window.bb); // undefined
```

åœ¨å“ªé‡Œï¼Ÿæ€ä¹ˆè·å–ï¼Ÿé€šè¿‡åœ¨è®¾ç½®æ–­ç‚¹ï¼Œçœ‹çœ‹æµè§ˆå™¨æ˜¯æ€ä¹ˆå¤„ç†çš„ï¼š

[![letandconst](https://user-images.githubusercontent.com/20290821/53854366-2ec1a400-4004-11e9-8c62-5a1dd91b8a5b.png)](https://user-images.githubusercontent.com/20290821/53854366-2ec1a400-4004-11e9-8c62-5a1dd91b8a5b.png)

é€šè¿‡ä¸Šå›¾ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œåœ¨å…¨å±€ä½œç”¨åŸŸä¸­ï¼Œç”¨ let å’Œ const å£°æ˜çš„å…¨å±€å˜é‡å¹¶æ²¡æœ‰åœ¨å…¨å±€å¯¹è±¡ä¸­ï¼Œåªæ˜¯ä¸€ä¸ªå—çº§ä½œç”¨åŸŸï¼ˆScriptï¼‰ä¸­

æ€ä¹ˆè·å–ï¼Ÿåœ¨å®šä¹‰å˜é‡çš„å—çº§ä½œç”¨åŸŸä¸­å°±èƒ½è·å–å•Šï¼Œæ—¢ç„¶ä¸å±äºé¡¶å±‚å¯¹è±¡ï¼Œé‚£å°±ä¸åŠ  windowï¼ˆglobalï¼‰å‘—ã€‚

```
let aa = 1;
const bb = 2;

console.log(aa); // 1
console.log(bb); // 2
```



## ç¬¬ 28 é¢˜ï¼šcookie å’Œ token éƒ½å­˜æ”¾åœ¨ header ä¸­ï¼Œä¸ºä»€ä¹ˆä¸ä¼šåŠ«æŒ tokenï¼Ÿ

è§£æï¼šç¬¬ 28 é¢˜

cookie
ä¸¾ä¾‹ï¼šæœåŠ¡å‘˜çœ‹ä½ çš„èº«ä»½è¯ï¼Œç»™ä½ ä¸€ä¸ªç¼–å·ï¼Œä»¥åï¼Œè¿›è¡Œä»»ä½•æ“ä½œï¼Œéƒ½å‡ºç¤ºç¼–å·åæœåŠ¡å‘˜å»çœ‹æŸ¥ä½ æ˜¯è°ã€‚

token
ä¸¾ä¾‹ï¼šç›´æ¥ç»™æœåŠ¡å‘˜çœ‹è‡ªå·±èº«ä»½è¯

1ã€é¦–å…ˆtokenä¸æ˜¯é˜²æ­¢XSSçš„ï¼Œè€Œæ˜¯ä¸ºäº†é˜²æ­¢CSRFçš„ï¼›
2ã€CSRFæ”»å‡»çš„åŸå› æ˜¯æµè§ˆå™¨ä¼šè‡ªåŠ¨å¸¦ä¸Šcookieï¼Œè€Œæµè§ˆå™¨ä¸ä¼šè‡ªåŠ¨å¸¦ä¸Štoken

> cookieï¼šç™»é™†ååç«¯ç”Ÿæˆä¸€ä¸ªsessionidæ”¾åœ¨cookieä¸­è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå¹¶ä¸”æœåŠ¡ç«¯ä¸€ç›´è®°å½•ç€è¿™ä¸ªsessionidï¼Œå®¢æˆ·ç«¯ä»¥åæ¯æ¬¡è¯·æ±‚éƒ½ä¼šå¸¦ä¸Šè¿™ä¸ªsessionidï¼ŒæœåŠ¡ç«¯é€šè¿‡è¿™ä¸ªsessionidæ¥éªŒè¯èº«ä»½ä¹‹ç±»çš„æ“ä½œã€‚æ‰€ä»¥åˆ«äººæ‹¿åˆ°äº†cookieæ‹¿åˆ°äº†sessionidåï¼Œå°±å¯ä»¥å®Œå…¨æ›¿ä»£ä½ ã€‚

> tokenï¼šç™»é™†ååç«¯ä¸è¿”å›ä¸€ä¸ªtokenç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯å°†è¿™ä¸ªtokenå­˜å‚¨èµ·æ¥ï¼Œç„¶åæ¯æ¬¡å®¢æˆ·ç«¯è¯·æ±‚éƒ½éœ€è¦å¼€å‘è€…æ‰‹åŠ¨å°†tokenæ”¾åœ¨headerä¸­å¸¦è¿‡å»ï¼ŒæœåŠ¡ç«¯æ¯æ¬¡åªéœ€è¦å¯¹è¿™ä¸ªtokenè¿›è¡ŒéªŒè¯å°±èƒ½ä½¿ç”¨tokenä¸­çš„ä¿¡æ¯æ¥è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œäº†ã€‚

> xssï¼šç”¨æˆ·é€šè¿‡å„ç§æ–¹å¼å°†æ¶æ„ä»£ç æ³¨å…¥åˆ°å…¶ä»–ç”¨æˆ·çš„é¡µé¢ä¸­ã€‚å°±å¯ä»¥é€šè¿‡è„šæœ¬è·å–ä¿¡æ¯ï¼Œå‘èµ·è¯·æ±‚ï¼Œä¹‹ç±»çš„æ“ä½œã€‚

> csrfï¼šè·¨ç«™è¯·æ±‚æ”»å‡»ï¼Œç®€å•åœ°è¯´ï¼Œæ˜¯æ”»å‡»è€…é€šè¿‡ä¸€äº›æŠ€æœ¯æ‰‹æ®µæ¬ºéª—ç”¨æˆ·çš„æµè§ˆå™¨å»è®¿é—®ä¸€ä¸ªè‡ªå·±æ›¾ç»è®¤è¯è¿‡çš„ç½‘ç«™å¹¶è¿è¡Œä¸€äº›æ“ä½œï¼ˆå¦‚å‘é‚®ä»¶ï¼Œå‘æ¶ˆæ¯ï¼Œç”šè‡³è´¢äº§æ“ä½œå¦‚è½¬è´¦å’Œè´­ä¹°å•†å“ï¼‰ã€‚ç”±äºæµè§ˆå™¨æ›¾ç»è®¤è¯è¿‡ï¼Œæ‰€ä»¥è¢«è®¿é—®çš„ç½‘ç«™ä¼šè®¤ä¸ºæ˜¯çœŸæ­£çš„ç”¨æˆ·æ“ä½œè€Œå»è¿è¡Œã€‚è¿™åˆ©ç”¨äº†webä¸­ç”¨æˆ·èº«ä»½éªŒè¯çš„ä¸€ä¸ªæ¼æ´ï¼š**ç®€å•çš„èº«ä»½éªŒè¯åªèƒ½ä¿è¯è¯·æ±‚å‘è‡ªæŸä¸ªç”¨æˆ·çš„æµè§ˆå™¨ï¼Œå´ä¸èƒ½ä¿è¯è¯·æ±‚æœ¬èº«æ˜¯ç”¨æˆ·è‡ªæ„¿å‘å‡ºçš„**ã€‚csrfå¹¶ä¸èƒ½å¤Ÿæ‹¿åˆ°ç”¨æˆ·çš„ä»»ä½•ä¿¡æ¯ï¼Œå®ƒåªæ˜¯æ¬ºéª—ç”¨æˆ·æµè§ˆå™¨ï¼Œè®©å…¶ä»¥ç”¨æˆ·çš„åä¹‰è¿›è¡Œæ“ä½œã€‚

> csrfä¾‹å­ï¼šå‡å¦‚ä¸€å®¶é“¶è¡Œç”¨ä»¥è¿è¡Œè½¬è´¦æ“ä½œçš„URLåœ°å€å¦‚ä¸‹ï¼š http://www.examplebank.com/withdraw?account=AccoutName&amount=1000&for=PayeeName
> é‚£ä¹ˆï¼Œä¸€ä¸ªæ¶æ„æ”»å‡»è€…å¯ä»¥åœ¨å¦ä¸€ä¸ªç½‘ç«™ä¸Šæ”¾ç½®å¦‚ä¸‹ä»£ç ï¼š `<img src="<http://www.examplebank.com/withdraw?account=Alice&amount=1000&for=Badman>">`
> å¦‚æœæœ‰è´¦æˆ·åä¸ºAliceçš„ç”¨æˆ·è®¿é—®äº†æ¶æ„ç«™ç‚¹ï¼Œè€Œå¥¹ä¹‹å‰åˆšè®¿é—®è¿‡é“¶è¡Œä¸ä¹…ï¼Œç™»å½•ä¿¡æ¯å°šæœªè¿‡æœŸï¼Œé‚£ä¹ˆå¥¹å°±ä¼šæŸå¤±1000èµ„é‡‘ã€‚

ä¸Šé¢çš„ä¸¤ç§æ”»å‡»æ–¹å¼ï¼Œå¦‚æœè¢«xssæ”»å‡»äº†ï¼Œä¸ç®¡æ˜¯tokenè¿˜æ˜¯cookieï¼Œéƒ½èƒ½è¢«æ‹¿åˆ°ï¼Œæ‰€ä»¥å¯¹äºxssæ”»å‡»æ¥è¯´ï¼Œcookieå’Œtokenæ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚ä½†æ˜¯å¯¹äºcsrfæ¥è¯´å°±æœ‰åŒºåˆ«äº†ã€‚

ä»¥ä¸Šé¢çš„csrfæ”»å‡»ä¸ºä¾‹ï¼š

- cookieï¼šç”¨æˆ·ç‚¹å‡»äº†é“¾æ¥ï¼Œcookieæœªå¤±æ•ˆï¼Œå¯¼è‡´å‘èµ·è¯·æ±‚ååç«¯ä»¥ä¸ºæ˜¯ç”¨æˆ·æ­£å¸¸æ“ä½œï¼Œäºæ˜¯è¿›è¡Œæ‰£æ¬¾æ“ä½œã€‚
- tokenï¼šç”¨æˆ·ç‚¹å‡»é“¾æ¥ï¼Œç”±äºæµè§ˆå™¨ä¸ä¼šè‡ªåŠ¨å¸¦ä¸Štokenï¼Œæ‰€ä»¥å³ä½¿å‘äº†è¯·æ±‚ï¼Œåç«¯çš„tokenéªŒè¯ä¸ä¼šé€šè¿‡ï¼Œæ‰€ä»¥ä¸ä¼šè¿›è¡Œæ‰£æ¬¾æ“ä½œã€‚

è¿™æ˜¯ä¸ªäººç†è§£çš„ä¸ºä»€ä¹ˆåªåŠ«æŒcookieä¸åŠ«æŒtokençš„åŸå› ã€‚





## ç¬¬ 29 é¢˜ï¼šèŠèŠ Vue çš„åŒå‘æ•°æ®ç»‘å®šï¼ŒModel å¦‚ä½•æ”¹å˜ Viewï¼ŒView åˆæ˜¯å¦‚ä½•æ”¹å˜ Model çš„

è§£æï¼šç¬¬ 29 é¢˜

https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/34









## A ç¬¬ 1 é¢˜ï¼šå†™ React / Vue é¡¹ç›®æ—¶ä¸ºä»€ä¹ˆè¦åœ¨åˆ—è¡¨ç»„ä»¶ä¸­å†™ keyï¼Œå…¶ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ

è§£æï¼šç¬¬ 1 é¢˜

å—æ¥¼ä¸‹ç­”æ¡ˆçš„ä¸€äº›ç‰¹æ®Šæƒ…å†µå½±å“ï¼Œå¯¼è‡´å¾ˆå¤šäººéƒ½è®¤ä¸ºkeyä¸èƒ½"æé«˜"diffé€Ÿåº¦ã€‚åœ¨æ­¤ç»§ç»­é‡æ–°æ¢³ç†ä¸€ä¸‹ç­”æ¡ˆã€‚

åœ¨æ¥¼ä¸‹çš„ç­”æ¡ˆä¸­ï¼Œéƒ¨åˆ†è®¨è®ºéƒ½æ˜¯åŸºäºæ²¡æœ‰keyçš„æƒ…å†µdiffé€Ÿåº¦ä¼šæ›´å¿«ã€‚ç¡®å®ï¼Œè¿™ç§è§‚ç‚¹å¹¶æ²¡æœ‰é”™ã€‚æ²¡æœ‰ç»‘å®škeyçš„æƒ…å†µä¸‹ï¼Œå¹¶ä¸”åœ¨éå†æ¨¡æ¿`ç®€å•`çš„æƒ…å†µä¸‹ï¼Œä¼šå¯¼è‡´è™šæ‹Ÿæ–°æ—§èŠ‚ç‚¹å¯¹æ¯”æ›´å¿«ï¼ŒèŠ‚ç‚¹ä¹Ÿä¼šå¤ç”¨ã€‚è€Œè¿™ç§å¤ç”¨æ˜¯`å°±åœ°å¤ç”¨`ï¼Œä¸€ç§`é¸­å­è¾©å‹`çš„å¤ç”¨ã€‚ä»¥ä¸‹ä¸ºç®€å•çš„ä¾‹å­:

```html
<div id="app">
    <div v-for="i in dataList">{{ i }}</div>
</div>
var vm = new Vue({
  el: '#app',
  data: {
    dataList: [1, 2, 3, 4, 5]
  }
})
```

ä»¥ä¸Šçš„ä¾‹å­ï¼Œv-forçš„å†…å®¹ä¼šç”Ÿæˆä»¥ä¸‹çš„domèŠ‚ç‚¹æ•°ç»„ï¼Œæˆ‘ä»¬ç»™æ¯ä¸€ä¸ªèŠ‚ç‚¹æ ‡è®°ä¸€ä¸ªèº«ä»½idï¼š

```js
  [
    '<div>1</div>', // idï¼š A
    '<div>2</div>', // id:  B
    '<div>3</div>', // id:  C
    '<div>4</div>', // id:  D
    '<div>5</div>'  // id:  E
  ]
```

> 1. æ”¹å˜dataListæ•°æ®ï¼Œè¿›è¡Œæ•°æ®ä½ç½®æ›¿æ¢ï¼Œå¯¹æ¯”æ”¹å˜åçš„æ•°æ®

```js
 vm.dataList = [4, 1, 3, 5, 2] // æ•°æ®ä½ç½®æ›¿æ¢

 // æ²¡æœ‰keyçš„æƒ…å†µï¼Œ èŠ‚ç‚¹ä½ç½®ä¸å˜ï¼Œä½†æ˜¯èŠ‚ç‚¹innerTextå†…å®¹æ›´æ–°äº†
  [
    '<div>4</div>', // idï¼š A
    '<div>1</div>', // id:  B
    '<div>3</div>', // id:  C
    '<div>5</div>', // id:  D
    '<div>2</div>'  // id:  E
  ]

  // æœ‰keyçš„æƒ…å†µï¼ŒdomèŠ‚ç‚¹ä½ç½®è¿›è¡Œäº†äº¤æ¢ï¼Œä½†æ˜¯å†…å®¹æ²¡æœ‰æ›´æ–°
  // <div v-for="i in dataList" :key='i'>{{ i }}</div>
  [
    '<div>4</div>', // idï¼š D
    '<div>1</div>', // id:  A
    '<div>3</div>', // id:  C
    '<div>5</div>', // id:  E
    '<div>2</div>'  // id:  B
  ]
```

> å¢åˆ dataListåˆ—è¡¨é¡¹

```js
  vm.dataList = [3, 4, 5, 6, 7] // æ•°æ®è¿›è¡Œå¢åˆ 

  // 1. æ²¡æœ‰keyçš„æƒ…å†µï¼Œ èŠ‚ç‚¹ä½ç½®ä¸å˜ï¼Œå†…å®¹ä¹Ÿæ›´æ–°äº†
  [
    '<div>3</div>', // idï¼š A
    '<div>4</div>', // id:  B
    '<div>5</div>', // id:  C
    '<div>6</div>', // id:  D
    '<div>7</div>'  // id:  E
  ]

  // 2. æœ‰keyçš„æƒ…å†µï¼Œ èŠ‚ç‚¹åˆ é™¤äº† A, B èŠ‚ç‚¹ï¼Œæ–°å¢äº† F, G èŠ‚ç‚¹
  // <div v-for="i in dataList" :key='i'>{{ i }}</div>
  [
    '<div>3</div>', // idï¼š C
    '<div>4</div>', // id:  D
    '<div>5</div>', // id:  E
    '<div>6</div>', // id:  F
    '<div>7</div>'  // id:  G
  ]
```

ä»ä»¥ä¸Šæ¥çœ‹ï¼Œä¸å¸¦æœ‰keyï¼Œå¹¶ä¸”ä½¿ç”¨ç®€å•çš„æ¨¡æ¿ï¼ŒåŸºäºè¿™ä¸ªå‰æä¸‹ï¼Œå¯ä»¥æ›´æœ‰æ•ˆçš„å¤ç”¨èŠ‚ç‚¹ï¼Œdiffé€Ÿåº¦æ¥çœ‹ä¹Ÿæ˜¯ä¸å¸¦keyæ›´åŠ å¿«é€Ÿçš„ï¼Œå› ä¸ºå¸¦keyåœ¨å¢åˆ èŠ‚ç‚¹ä¸Šæœ‰è€—æ—¶ã€‚è¿™å°±æ˜¯vueæ–‡æ¡£æ‰€è¯´çš„`é»˜è®¤æ¨¡å¼`ã€‚ä½†æ˜¯è¿™ä¸ªå¹¶ä¸æ˜¯keyä½œç”¨ï¼Œè€Œæ˜¯æ²¡æœ‰keyçš„æƒ…å†µä¸‹å¯ä»¥å¯¹èŠ‚ç‚¹`å°±åœ°å¤ç”¨`ï¼Œæé«˜æ€§èƒ½ã€‚

è¿™ç§æ¨¡å¼ä¼šå¸¦æ¥ä¸€äº›éšè—çš„å‰¯ä½œç”¨ï¼Œæ¯”å¦‚å¯èƒ½ä¸ä¼šäº§ç”Ÿè¿‡æ¸¡æ•ˆæœï¼Œæˆ–è€…åœ¨æŸäº›èŠ‚ç‚¹æœ‰ç»‘å®šæ•°æ®ï¼ˆè¡¨å•ï¼‰çŠ¶æ€ï¼Œä¼šå‡ºç°çŠ¶æ€é”™ä½ã€‚VUEæ–‡æ¡£ä¹Ÿè¯´æ˜äº† [`è¿™ä¸ªé»˜è®¤çš„æ¨¡å¼æ˜¯é«˜æ•ˆçš„ï¼Œä½†æ˜¯åªé€‚ç”¨äºä¸ä¾èµ–å­ç»„ä»¶çŠ¶æ€æˆ–ä¸´æ—¶ DOM çŠ¶æ€ (ä¾‹å¦‚ï¼šè¡¨å•è¾“å…¥å€¼) çš„åˆ—è¡¨æ¸²æŸ“è¾“å‡º`](https://cn.vuejs.org/v2/guide/list.html#key)

æ¥¼ä¸‹ [@yeild](https://github.com/yeild) ä¹Ÿæåˆ°ï¼Œåœ¨ä¸å¸¦keyçš„æƒ…å†µä¸‹ï¼Œå¯¹äº`ç®€å•åˆ—è¡¨é¡µæ¸²æŸ“`æ¥è¯´diffèŠ‚ç‚¹æ›´å¿«æ˜¯æ²¡æœ‰é”™è¯¯çš„ã€‚ä½†æ˜¯è¿™å¹¶ä¸æ˜¯keyçš„ä½œç”¨å‘€ã€‚

ä½†æ˜¯keyçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ

æˆ‘é‡æ–°æ¢³ç†äº†ä¸€ä¸‹æ–‡å­—ï¼Œå¯èƒ½è¿™æ ·å­ä¼šæ›´å¥½ç†è§£ä¸€äº›ã€‚

keyæ˜¯ç»™æ¯ä¸€ä¸ªvnodeçš„å”¯ä¸€id,å¯ä»¥`ä¾é key`,æ›´`å‡†ç¡®`, æ›´`å¿«`çš„æ‹¿åˆ°oldVnodeä¸­å¯¹åº”çš„vnodeèŠ‚ç‚¹ã€‚

1. æ›´å‡†ç¡®

å› ä¸ºå¸¦keyå°±ä¸æ˜¯`å°±åœ°å¤ç”¨`äº†ï¼Œåœ¨sameNodeå‡½æ•° `a.key === b.key`å¯¹æ¯”ä¸­å¯ä»¥é¿å…å°±åœ°å¤ç”¨çš„æƒ…å†µã€‚æ‰€ä»¥ä¼šæ›´åŠ å‡†ç¡®ã€‚

2. æ›´å¿«

åˆ©ç”¨keyçš„å”¯ä¸€æ€§ç”Ÿæˆmapå¯¹è±¡æ¥è·å–å¯¹åº”èŠ‚ç‚¹ï¼Œæ¯”éå†æ–¹å¼æ›´å¿«ã€‚(è¿™ä¸ªè§‚ç‚¹ï¼Œå°±æ˜¯æˆ‘æœ€åˆçš„é‚£ä¸ªè§‚ç‚¹ã€‚ä»è¿™ä¸ªè§’åº¦çœ‹ï¼Œmapä¼šæ¯”éå†æ›´å¿«ã€‚)

vueå’Œreactéƒ½æ˜¯é‡‡ç”¨diffç®—æ³•æ¥å¯¹æ¯”æ–°æ—§è™šæ‹ŸèŠ‚ç‚¹ï¼Œä»è€Œæ›´æ–°èŠ‚ç‚¹ã€‚åœ¨vueçš„diffå‡½æ•°ä¸­ï¼ˆå»ºè®®å…ˆäº†è§£ä¸€ä¸‹diffç®—æ³•è¿‡ç¨‹ï¼‰ã€‚
åœ¨äº¤å‰å¯¹æ¯”ä¸­ï¼Œå½“æ–°èŠ‚ç‚¹è·Ÿæ—§èŠ‚ç‚¹`å¤´å°¾äº¤å‰å¯¹æ¯”`æ²¡æœ‰ç»“æœæ—¶ï¼Œä¼šæ ¹æ®æ–°èŠ‚ç‚¹çš„keyå»å¯¹æ¯”æ—§èŠ‚ç‚¹æ•°ç»„ä¸­çš„keyï¼Œä»è€Œæ‰¾åˆ°ç›¸åº”æ—§èŠ‚ç‚¹ï¼ˆè¿™é‡Œå¯¹åº”çš„æ˜¯ä¸€ä¸ªkey => index çš„mapæ˜ å°„ï¼‰ã€‚å¦‚æœæ²¡æ‰¾åˆ°å°±è®¤ä¸ºæ˜¯ä¸€ä¸ªæ–°å¢èŠ‚ç‚¹ã€‚è€Œå¦‚æœæ²¡æœ‰keyï¼Œé‚£ä¹ˆå°±ä¼šé‡‡ç”¨éå†æŸ¥æ‰¾çš„æ–¹å¼å»æ‰¾åˆ°å¯¹åº”çš„æ—§èŠ‚ç‚¹ã€‚ä¸€ç§ä¸€ä¸ªmapæ˜ å°„ï¼Œå¦ä¸€ç§æ˜¯éå†æŸ¥æ‰¾ã€‚ç›¸æ¯”è€Œè¨€ã€‚mapæ˜ å°„çš„é€Ÿåº¦æ›´å¿«ã€‚
vueéƒ¨åˆ†æºç å¦‚ä¸‹ï¼š

```
// vueé¡¹ç›®  src/core/vdom/patch.js  -488è¡Œ
// ä»¥ä¸‹æ˜¯ä¸ºäº†é˜…è¯»æ€§è¿›è¡Œæ ¼å¼åŒ–åçš„ä»£ç 

// oldCh æ˜¯ä¸€ä¸ªæ—§è™šæ‹ŸèŠ‚ç‚¹æ•°ç»„
if (isUndef(oldKeyToIdx)) {
  oldKeyToIdx = createKeyToOldIdx(oldCh, oldStartIdx, oldEndIdx)
}
if(isDef(newStartVnode.key)) {
  // map æ–¹å¼è·å–
  idxInOld = oldKeyToIdx[newStartVnode.key]
} else {
  // éå†æ–¹å¼è·å–
  idxInOld = findIdxInOld(newStartVnode, oldCh, oldStartIdx, oldEndIdx)
}
```

åˆ›å»ºmapå‡½æ•°

```
function createKeyToOldIdx (children, beginIdx, endIdx) {
  let i, key
  const map = {}
  for (i = beginIdx; i <= endIdx; ++i) {
    key = children[i].key
    if (isDef(key)) map[key] = i
  }
  return map
}
```

éå†å¯»æ‰¾

```
// sameVnode æ˜¯å¯¹æ¯”æ–°æ—§èŠ‚ç‚¹æ˜¯å¦ç›¸åŒçš„å‡½æ•°
 function findIdxInOld (node, oldCh, start, end) {
    for (let i = start; i < end; i++) {
      const c = oldCh[i]
      
      if (isDef(c) && sameVnode(node, c)) return i
    }
  }
```

å°±æˆ‘çš„ä½¿ç”¨æ¥è¯´(Vue)keyçš„ä½œç”¨æ˜¯ä¸ºäº†åœ¨æ•°æ®å˜åŒ–æ—¶å¼ºåˆ¶æ›´æ–°ç»„ä»¶ï¼Œä»¥é¿å…â€œåŸåœ°å¤ç”¨â€å¸¦æ¥çš„å‰¯ä½œç”¨ã€‚å¦å¤–ï¼ŒæŸäº›æƒ…å†µä¸‹**ä¸å¸¦keyå¯èƒ½æ€§èƒ½æ›´å¥½**ï¼Œè§ï¼š[issuecomment](https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/1#issuecomment-465847432)
å®˜æ–¹æ–‡æ¡£å¯¹äºkeyçš„æè¿°ï¼š [åˆ—è¡¨æ¸²æŸ“-key](https://cn.vuejs.org/v2/guide/list.html#key) | [API-key](https://cn.vuejs.org/v2/api/#key)

## A ç¬¬ 2 é¢˜ï¼š['1', '2', '3'].map(parseInt) 

è§£æï¼šç¬¬ 2 é¢˜

ç¬¬ä¸€çœ¼çœ‹åˆ°è¿™ä¸ªé¢˜ç›®çš„æ—¶å€™ï¼Œè„‘æµ·è·³å‡ºçš„ç­”æ¡ˆæ˜¯ [1, 2, 3]ï¼Œä½†æ˜¯**çœŸæ­£çš„ç­”æ¡ˆæ˜¯[1, NaN, NaN]**ã€‚

- é¦–å…ˆè®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹ï¼Œmapå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°callbackï¼š

`var new_array = arr.map(function callback(currentValue[, index[, array]]) { // Return element for new_array }[, thisArg])`
è¿™ä¸ªcallbackä¸€å…±å¯ä»¥æ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå‚æ•°ä»£è¡¨å½“å‰è¢«å¤„ç†çš„å…ƒç´ ï¼Œè€Œç¬¬äºŒä¸ªå‚æ•°ä»£è¡¨è¯¥å…ƒç´ çš„ç´¢å¼•ã€‚

- è€ŒparseIntåˆ™æ˜¯ç”¨æ¥è§£æå­—ç¬¦ä¸²çš„ï¼Œä½¿å­—ç¬¦ä¸²æˆä¸ºæŒ‡å®šåŸºæ•°çš„æ•´æ•°-è¿™ä¸ªå‡½æ•°ä¸ç†Ÿæ‚‰ã€‚
  `parseInt(string, radix)`
  æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªè¡¨ç¤ºè¢«å¤„ç†çš„å€¼ï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼Œç¬¬äºŒä¸ªè¡¨ç¤ºä¸ºè§£ææ—¶çš„åŸºæ•°ã€‚
- äº†è§£è¿™ä¸¤ä¸ªå‡½æ•°åï¼Œæˆ‘ä»¬å¯ä»¥æ¨¡æ‹Ÿä¸€ä¸‹è¿è¡Œæƒ…å†µ

1. parseInt('1', 0) //radixä¸º0æ—¶ï¼Œä¸”stringå‚æ•°ä¸ä»¥â€œ0xâ€å’Œâ€œ0â€å¼€å¤´æ—¶ï¼ŒæŒ‰ç…§10ä¸ºåŸºæ•°å¤„ç†ã€‚è¿™ä¸ªæ—¶å€™è¿”å›1
2. parseInt('2', 1) //åŸºæ•°ä¸º1ï¼ˆ1è¿›åˆ¶ï¼‰è¡¨ç¤ºçš„æ•°ä¸­ï¼Œæœ€å¤§å€¼å°äº2ï¼Œæ‰€ä»¥æ— æ³•è§£æï¼Œè¿”å›NaN
3. parseInt('3', 2) //åŸºæ•°ä¸º2ï¼ˆ2è¿›åˆ¶ï¼‰è¡¨ç¤ºçš„æ•°ä¸­ï¼Œæœ€å¤§å€¼å°äº3ï¼Œæ‰€ä»¥æ— æ³•è§£æï¼Œè¿”å›NaN

- mapå‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ‰€ä»¥æœ€åç»“æœä¸º[1, NaN, NaN]
- æœ€åé™„ä¸ŠMDNä¸Šå¯¹äºè¿™ä¸¤ä¸ªå‡½æ•°çš„é“¾æ¥ï¼Œå…·ä½“å‚æ•°å¤§å®¶å¯ä»¥åˆ°é‡Œé¢çœ‹
  [https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/parseInt](https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/url)
  [https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/map](https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/url)

parseInt åŸºæ•°æ˜¯ä¸€ä¸ªä»‹äº2å’Œ36ä¹‹é—´çš„æ•´æ•° å¯èƒ½ç¬¬äºŒç‚¹è¿™ä¸ªè¯´æ³•ä¸å¤ªå‡†ç¡®